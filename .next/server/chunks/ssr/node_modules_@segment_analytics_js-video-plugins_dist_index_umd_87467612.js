module.exports=[79743,(a,b,c)=>{window,b.exports=function(){var a=[function(a,b,c){"use strict";c.r(b),b.default="function"==typeof fetch?fetch.bind():function(a,b){return b=b||{},new Promise(function(c,d){var e=new XMLHttpRequest;for(var f in e.open(b.method||"get",a,!0),b.headers)e.setRequestHeader(f,b.headers[f]);e.withCredentials="include"==b.credentials,e.onload=function(){c(function a(){var b,c=[],d=[],f={};return e.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(a,e,g){c.push(e=e.toLowerCase()),d.push([e,g]),b=f[e],f[e]=b?b+","+g:g}),{ok:2==(e.status/100|0),status:e.status,statusText:e.statusText,url:e.responseURL,clone:a,text:function(){return Promise.resolve(e.responseText)},json:function(){return Promise.resolve(e.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([e.response]))},headers:{keys:function(){return c},entries:function(){return d},get:function(a){return f[a.toLowerCase()]},has:function(a){return a.toLowerCase()in f}}}}())},e.onerror=d,e.send(b.body)})}},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();b.default=function(){function a(b,c){!function(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}(this,a),this.pluginName=b}return d(a,[{key:"track",value:function(a,b){window.analytics.track(a,b,{integration:{name:this.pluginName}})}}]),a}()},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.YouTubeAnalytics=b.VimeoAnalytics=void 0;var d=f(c(3)),e=f(c(4));function f(a){return a&&a.__esModule?a:{default:a}}b.VimeoAnalytics=d.default,b.YouTubeAnalytics=e.default},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=f(c(0));function f(a){return a&&a.__esModule?a:{default:a}}b.default=function(a){function b(a,c){if(!(this instanceof b))throw TypeError("Cannot call a class as a function");var d=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"VimeoAnalytics"));return d.authToken=c,d.player=a,d.metadata={content:{},playback:{videoPlayer:"Vimeo"}},d.mostRecentHeartbeat=0,d.isPaused=!1,d}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),d(b,[{key:"initialize",value:function(){var a=this,b={loaded:this.retrieveMetadata,play:this.trackPlay,pause:this.trackPause,ended:this.trackEnded,timeupdate:this.trackHeartbeat};for(var c in b)this.registerHandler(c,b[c]);this.player.getVideoId().then(function(b){a.retrieveMetadata({id:b})}).catch(console.error)}},{key:"registerHandler",value:function(a,b){var c=this;this.player.on(a,function(a){c.updateMetadata(a),b.call(c,a)})}},{key:"trackPlay",value:function(){this.isPaused?(this.track("Video Playback Resumed",this.metadata.playback),this.isPaused=!1):(this.track("Video Playback Started",this.metadata.playback),this.track("Video Content Started",this.metadata.content))}},{key:"trackEnded",value:function(){this.track("Video Playback Completed",this.metadata.playback),this.track("Video Content Completed",this.metadata.content)}},{key:"trackHeartbeat",value:function(){var a=this.mostRecentHeartbeat,b=this.metadata.playback.position;b!==a&&b-a>=10&&(this.track("Video Content Playing",this.metadata.content),this.mostRecentHeartbeat=Math.floor(b))}},{key:"trackPause",value:function(){this.isPaused=!0,this.track("Video Playback Paused",this.metadata.playback)}},{key:"retrieveMetadata",value:function(a){var b=this;return new Promise(function(c,d){var f=a.id;(0,e.default)("https://api.vimeo.com/videos/"+f,{headers:{Authorization:"Bearer "+b.authToken}}).then(function(a){return a.ok?a.json():d(a)}).then(function(a){b.metadata.content.title=a.name,b.metadata.content.description=a.description,b.metadata.content.publisher=a.user.name,b.metadata.playback.position=0,b.metadata.playback.totalLength=a.duration}).catch(function(a){return console.error("Request to Vimeo API Failed with: ",a),d(a)})})}},{key:"updateMetadata",value:function(a){var b=this;return new Promise(function(c,d){b.player.getVolume().then(function(d){d&&(b.metadata.playback.sound=100*d),b.metadata.playback.position=a.seconds,c()}).catch(d)})}}]),b}(f(c(1)).default)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=f(c(0));function f(a){return a&&a.__esModule?a:{default:a}}b.default=function(a){function b(a,c){if(!(this instanceof b))throw TypeError("Cannot call a class as a function");var d=function(a,b){if(!a)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"YoutubeAnalytics"));return d.player=a,d.apiKey=c,d.playerLoaded=!1,d.playbackStarted=!1,d.contentStarted=!1,d.isPaused=!1,d.isBuffering=!1,d.isSeeking=!1,d.lastRecordedTime={timeReported:Date.now(),timeElapsed:0},d.metadata=[{playback:{video_player:"youtube"},content:{}}],d.playlistIndex=0,d}return function(a,b){if("function"!=typeof b&&null!==b)throw TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(b,a),d(b,[{key:"initialize",value:function(){window.segmentYoutubeOnStateChange=this.onPlayerStateChange.bind(this),window.segmentYoutubeOnReady=this.onPlayerReady.bind(this),this.player.addEventListener("onReady","segmentYoutubeOnReady"),this.player.addEventListener("onStateChange","segmentYoutubeOnStateChange")}},{key:"onPlayerReady",value:function(a){this.retrieveMetadata()}},{key:"onPlayerStateChange",value:function(a){var b=this.player.getCurrentTime();switch(this.metadata[this.playlistIndex]&&(this.metadata[this.playlistIndex].playback.position=this.metadata[this.playlistIndex].content.position=b,this.metadata[this.playlistIndex].playback.quality=this.player.getPlaybackQuality(),this.metadata[this.playlistIndex].playback.sound=this.player.isMuted()?0:this.player.getVolume()),a.data){case -1:if(this.playerLoaded)break;this.retrieveMetadata(),this.playerLoaded=!0;break;case YT.PlayerState.BUFFERING:this.handleBuffer();break;case YT.PlayerState.PLAYING:this.handlePlay();break;case YT.PlayerState.PAUSED:this.handlePause();break;case YT.PlayerState.ENDED:this.handleEnd()}this.lastRecordedTime={timeReported:Date.now(),timeElapsed:1e3*this.player.getCurrentTime()}}},{key:"retrieveMetadata",value:function(){var a=this;return new Promise(function(b,c){var d=a.player.getVideoData(),f=a.player.getPlaylist()||[d.video_id],g=f.join();(0,e.default)("https://www.googleapis.com/youtube/v3/videos?id="+g+"&part=snippet,contentDetails&key="+a.apiKey).then(function(a){if(!a.ok){var b=Error("Segment request to Youtube API failed (likely due to a bad API Key. Events will still be sent but will not contain video metadata)");throw b.response=a,b}return a.json()}).then(function(c){a.metadata=[];for(var d=0,e=0;e<f.length;e++){var g=c.items[e];a.metadata.push({content:{title:g.snippet.title,description:g.snippet.description,keywords:g.snippet.tags,channel:g.snippet.channelTitle,airdate:g.snippet.publishedAt}}),d+=function(a){var b=a.match(/PT(\d+H)?(\d+M)?(\d+S)?/);return 3600*(parseInt((b=b.slice(1).map(function(a){if(null!=a)return a.replace(/\D/,"")}))[0])||0)+60*(parseInt(b[1])||0)+(parseInt(b[2])||0)}(g.contentDetails.duration)}for(e=0;e<f.length;e++)a.metadata[e].playback={total_length:d,video_player:"youtube"};b()}).catch(function(b){a.metadata=f.map(function(a){return{playback:{video_player:"youtube"},content:{}}}),c(b)})})}},{key:"handleBuffer",value:function(){var a=this.determineSeek();this.playbackStarted||(this.playbackStarted=!0,this.track("Video Playback Started",this.metadata[this.playlistIndex].playback)),a&&!this.isSeeking&&(this.isSeeking=!0,this.track("Video Playback Seek Started",this.metadata[this.playlistIndex].playback)),this.isSeeking&&(this.track("Video Playback Seek Completed",this.metadata[this.playlistIndex].playback),this.isSeeking=!1);var b=this.player.getPlaylist();b&&0===this.player.getCurrentTime()&&this.player.getPlaylistIndex()!==this.playlistIndex&&(this.contentStarted=!1,this.playlistIndex===b.length-1&&0===this.player.getPlaylistIndex()&&(this.track("Video Playback Completed",this.metadata[this.player.getPlaylistIndex()].playback),this.track("Video Playback Started",this.metadata[this.player.getPlaylistIndex()].playback))),this.track("Video Playback Buffer Started",this.metadata[this.playlistIndex].playback),this.isBuffering=!0}},{key:"handlePlay",value:function(){this.contentStarted||(this.playlistIndex=this.player.getPlaylistIndex(),-1===this.playlistIndex&&(this.playlistIndex=0),this.track("Video Content Started",this.metadata[this.playlistIndex].content),this.contentStarted=!0),this.isBuffering&&(this.track("Video Playback Buffer Completed",this.metadata[this.playlistIndex].playback),this.isBuffering=!1),this.isPaused&&(this.track("Video Playback Resumed",this.metadata[this.playlistIndex].playback),this.isPaused=!1)}},{key:"handlePause",value:function(){var a=this.determineSeek();this.isBuffering&&(this.track("Video Playback Buffer Completed",this.metadata[this.playlistIndex].playback),this.isBuffering=!1),this.isPaused||(a?(this.track("Video Playback Seek Started",this.metadata[this.playlistIndex].playback),this.isSeeking=!0):(this.track("Video Playback Paused",this.metadata[this.playlistIndex].playback),this.isPaused=!0))}},{key:"handleEnd",value:function(){this.track("Video Content Completed",this.metadata[this.playlistIndex].content),this.contentStarted=!1;var a=this.player.getPlaylistIndex(),b=this.player.getPlaylist();(b&&a===b.length-1||-1===a)&&(this.track("Video Playback Completed",this.metadata[this.playlistIndex].playback),this.playbackStarted=!1)}},{key:"determineSeek",value:function(){return Math.abs((this.isPaused||this.isBuffering?0:Date.now()-this.lastRecordedTime.timeReported)-(1e3*this.player.getCurrentTime()-this.lastRecordedTime.timeElapsed))>2e3}}]),b}(f(c(1)).default)}],b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b||4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,(function(b){return a[b]}).bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s=2)}()}];

//# sourceMappingURL=node_modules_%40segment_analytics_js-video-plugins_dist_index_umd_87467612.js.map