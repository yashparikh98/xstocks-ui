module.exports=[8219,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,c)};function c(a,c){function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function k(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function l(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function o(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(n(arguments[b]));return a}function p(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function q(a){return this instanceof q?(this.v=a,this):new q(a)}function r(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof q?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function s(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:q(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function t(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=m(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function u(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function v(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function w(a){return a&&a.__esModule?a:{default:a}}function x(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function y(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}a.s(["__assign",()=>d,"__asyncDelegator",()=>s,"__asyncGenerator",()=>r,"__asyncValues",()=>t,"__await",()=>q,"__awaiter",()=>i,"__classPrivateFieldGet",()=>x,"__classPrivateFieldSet",()=>y,"__createBinding",()=>k,"__decorate",()=>f,"__exportStar",()=>l,"__extends",()=>c,"__generator",()=>j,"__importDefault",()=>w,"__importStar",()=>v,"__makeTemplateObject",()=>u,"__metadata",()=>h,"__param",()=>g,"__read",()=>n,"__rest",()=>e,"__spread",()=>o,"__spreadArrays",()=>p,"__values",()=>m])},8029,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.delay=void 0,c.delay=function(a){return new Promise(b=>{setTimeout(()=>{b(!0)},a)})}},45775,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ONE_THOUSAND=c.ONE_HUNDRED=void 0,c.ONE_HUNDRED=100,c.ONE_THOUSAND=1e3},59162,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ONE_YEAR=c.FOUR_WEEKS=c.THREE_WEEKS=c.TWO_WEEKS=c.ONE_WEEK=c.THIRTY_DAYS=c.SEVEN_DAYS=c.FIVE_DAYS=c.THREE_DAYS=c.ONE_DAY=c.TWENTY_FOUR_HOURS=c.TWELVE_HOURS=c.SIX_HOURS=c.THREE_HOURS=c.ONE_HOUR=c.SIXTY_MINUTES=c.THIRTY_MINUTES=c.TEN_MINUTES=c.FIVE_MINUTES=c.ONE_MINUTE=c.SIXTY_SECONDS=c.THIRTY_SECONDS=c.TEN_SECONDS=c.FIVE_SECONDS=c.ONE_SECOND=void 0,c.ONE_SECOND=1,c.FIVE_SECONDS=5,c.TEN_SECONDS=10,c.THIRTY_SECONDS=30,c.SIXTY_SECONDS=60,c.ONE_MINUTE=c.SIXTY_SECONDS,c.FIVE_MINUTES=5*c.ONE_MINUTE,c.TEN_MINUTES=10*c.ONE_MINUTE,c.THIRTY_MINUTES=30*c.ONE_MINUTE,c.SIXTY_MINUTES=60*c.ONE_MINUTE,c.ONE_HOUR=c.SIXTY_MINUTES,c.THREE_HOURS=3*c.ONE_HOUR,c.SIX_HOURS=6*c.ONE_HOUR,c.TWELVE_HOURS=12*c.ONE_HOUR,c.TWENTY_FOUR_HOURS=24*c.ONE_HOUR,c.ONE_DAY=c.TWENTY_FOUR_HOURS,c.THREE_DAYS=3*c.ONE_DAY,c.FIVE_DAYS=5*c.ONE_DAY,c.SEVEN_DAYS=7*c.ONE_DAY,c.THIRTY_DAYS=30*c.ONE_DAY,c.ONE_WEEK=c.SEVEN_DAYS,c.TWO_WEEKS=2*c.ONE_WEEK,c.THREE_WEEKS=3*c.ONE_WEEK,c.FOUR_WEEKS=4*c.ONE_WEEK,c.ONE_YEAR=365*c.ONE_DAY},53628,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8219);d.__exportStar(a.r(45775),c),d.__exportStar(a.r(59162),c)},65290,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.fromMiliseconds=c.toMiliseconds=void 0;let d=a.r(53628);c.toMiliseconds=function(a){return a*d.ONE_THOUSAND},c.fromMiliseconds=function(a){return Math.floor(a/d.ONE_THOUSAND)}},86805,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8219);d.__exportStar(a.r(8029),c),d.__exportStar(a.r(65290),c)},35315,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Watch=void 0;class d{constructor(){this.timestamps=new Map}start(a){if(this.timestamps.has(a))throw Error(`Watch already started for label: ${a}`);this.timestamps.set(a,{started:Date.now()})}stop(a){let b=this.get(a);if(void 0!==b.elapsed)throw Error(`Watch already stopped for label: ${a}`);let c=Date.now()-b.started;this.timestamps.set(a,{started:b.started,elapsed:c})}get(a){let b=this.timestamps.get(a);if(void 0===b)throw Error(`No timestamp found for label: ${a}`);return b}elapsed(a){let b=this.get(a);return b.elapsed||Date.now()-b.started}}c.Watch=d,c.default=d},29323,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IWatch=void 0,c.IWatch=class{}},30635,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),a.r(8219).__exportStar(a.r(29323),c)},73620,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(8219);d.__exportStar(a.r(86805),c),d.__exportStar(a.r(35315),c),d.__exportStar(a.r(30635),c),d.__exportStar(a.r(53628),c)},79628,(a,b,c)=>{"use strict";function d(a){}function e(a){let b=d(a);if(!b)throw Error(`${a} is not defined in Window`);return b}Object.defineProperty(c,"__esModule",{value:!0}),c.getLocalStorage=c.getLocalStorageOrThrow=c.getCrypto=c.getCryptoOrThrow=c.getLocation=c.getLocationOrThrow=c.getNavigator=c.getNavigatorOrThrow=c.getDocument=c.getDocumentOrThrow=c.getFromWindowOrThrow=c.getFromWindow=void 0,c.getFromWindow=d,c.getFromWindowOrThrow=e,c.getDocumentOrThrow=function(){return e("document")},c.getDocument=function(){return d("document")},c.getNavigatorOrThrow=function(){return e("navigator")},c.getNavigator=function(){return d("navigator")},c.getLocationOrThrow=function(){return e("location")},c.getLocation=function(){return d("location")},c.getCryptoOrThrow=function(){return e("crypto")},c.getCrypto=function(){return d("crypto")},c.getLocalStorageOrThrow=function(){return e("localStorage")},c.getLocalStorage=function(){return d("localStorage")}},41721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getWindowMetadata=void 0;let d=a.r(79628);c.getWindowMetadata=function(){let a,b,c;try{a=d.getDocumentOrThrow(),b=d.getLocationOrThrow()}catch(a){return null}function e(...b){let c=a.getElementsByTagName("meta");for(let a=0;a<c.length;a++){let d=c[a],e=["itemprop","property","name"].map(a=>d.getAttribute(a)).filter(a=>!!a&&b.includes(a));if(e.length&&e){let a=d.getAttribute("content");if(a)return a}}return""}let f=((c=e("name","og:site_name","og:title","twitter:title"))||(c=a.title),c),g=e("description","og:description","twitter:description","keywords"),h=b.origin;return{description:g,url:h,icons:function(){let c=a.getElementsByTagName("link"),d=[];for(let a=0;a<c.length;a++){let e=c[a],f=e.getAttribute("rel");if(f&&f.toLowerCase().indexOf("icon")>-1){let a=e.getAttribute("href");if(a)if(-1===a.toLowerCase().indexOf("https:")&&-1===a.toLowerCase().indexOf("http:")&&0!==a.indexOf("//")){let c=b.protocol+"//"+b.host;if(0===a.indexOf("/"))c+=a;else{let d=b.pathname.split("/");d.pop(),c+=d.join("/")+"/"+a}d.push(c)}else if(0===a.indexOf("//")){let c=b.protocol+a;d.push(c)}else d.push(a)}}return d}(),name:f}}},43579,(a,b,c)=>{function d(a){return(0x100000000+a).toString(16).substring(1)}b.exports={normalizeInput:function(a){let b;if(a instanceof Uint8Array)b=a;else if("string"==typeof a)b=new TextEncoder().encode(a);else throw Error("Input must be an string, Buffer or Uint8Array");return b},toHex:function(a){return Array.prototype.map.call(a,function(a){return(a<16?"0":"")+a.toString(16)}).join("")},debugPrint:function(a,b,c){let e="\n"+a+" = ";for(let f=0;f<b.length;f+=2){if(32===c)e+=d(b[f]).toUpperCase(),e+=" ",e+=d(b[f+1]).toUpperCase();else if(64===c)e+=d(b[f+1]).toUpperCase(),e+=d(b[f]).toUpperCase();else throw Error("Invalid size "+c);f%6==4?e+="\n"+Array(a.length+4).join(" "):f<b.length-2&&(e+=" ")}console.log(e)},testSpeed:function(a,b,c){let d=new Date().getTime(),e=new Uint8Array(b);for(let a=0;a<b;a++)e[a]=a%256;let f=new Date().getTime();console.log("Generated random input in "+(f-d)+"ms"),d=f;for(let f=0;f<c;f++){let c=a(e),f=new Date().getTime(),g=f-d;d=f,console.log("Hashed in "+g+"ms: "+c.substring(0,20)+"..."),console.log(Math.round(b/1048576/(g/1e3)*100)/100+" MB PER SECOND")}}}},35783,(a,b,c)=>{let d=a.r(43579);function e(a,b,c){let d=a[b]+a[c],e=a[b+1]+a[c+1];d>=0x100000000&&e++,a[b]=d,a[b+1]=e}function f(a,b,c,d){let e=a[b]+c;c<0&&(e+=0x100000000);let f=a[b+1]+d;e>=0x100000000&&f++,a[b]=e,a[b+1]=f}function g(a,b){return a[b]^a[b+1]<<8^a[b+2]<<16^a[b+3]<<24}function h(a,b,c,d,g,h){let i=l[g],j=l[g+1],m=l[h],n=l[h+1];e(k,a,b),f(k,a,i,j);let o=k[d]^k[a],p=k[d+1]^k[a+1];k[d]=p,k[d+1]=o,e(k,c,d),o=k[b]^k[c],p=k[b+1]^k[c+1],k[b]=o>>>24^p<<8,k[b+1]=p>>>24^o<<8,e(k,a,b),f(k,a,m,n),o=k[d]^k[a],p=k[d+1]^k[a+1],k[d]=o>>>16^p<<16,k[d+1]=p>>>16^o<<16,e(k,c,d),o=k[b]^k[c],p=k[b+1]^k[c+1],k[b]=p>>>31^o<<1,k[b+1]=o>>>31^p<<1}let i=new Uint32Array([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),j=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(a){return 2*a})),k=new Uint32Array(32),l=new Uint32Array(32);function m(a,b){let c=0;for(c=0;c<16;c++)k[c]=a.h[c],k[c+16]=i[c];for(k[24]=k[24]^a.t,k[25]=k[25]^a.t/0x100000000,b&&(k[28]=~k[28],k[29]=~k[29]),c=0;c<32;c++)l[c]=g(a.b,4*c);for(c=0;c<12;c++)h(0,8,16,24,j[16*c+0],j[16*c+1]),h(2,10,18,26,j[16*c+2],j[16*c+3]),h(4,12,20,28,j[16*c+4],j[16*c+5]),h(6,14,22,30,j[16*c+6],j[16*c+7]),h(0,10,20,30,j[16*c+8],j[16*c+9]),h(2,12,22,24,j[16*c+10],j[16*c+11]),h(4,14,16,26,j[16*c+12],j[16*c+13]),h(6,8,18,28,j[16*c+14],j[16*c+15]);for(c=0;c<16;c++)a.h[c]=a.h[c]^k[c]^k[c+16]}let n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function o(a,b,c,d){if(0===a||a>64)throw Error("Illegal output length, expected 0 < length <= 64");if(b&&b.length>64)throw Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(c&&16!==c.length)throw Error("Illegal salt, expected Uint8Array with length is 16");if(d&&16!==d.length)throw Error("Illegal personal, expected Uint8Array with length is 16");let e={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:a};n.fill(0),n[0]=a,b&&(n[1]=b.length),n[2]=1,n[3]=1,c&&n.set(c,32),d&&n.set(d,48);for(let a=0;a<16;a++)e.h[a]=i[a]^g(n,4*a);return b&&(p(e,b),e.c=128),e}function p(a,b){for(let c=0;c<b.length;c++)128===a.c&&(a.t+=a.c,m(a,!1),a.c=0),a.b[a.c++]=b[c]}function q(a){for(a.t+=a.c;a.c<128;)a.b[a.c++]=0;m(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c);return b}function r(a,b,c,e,f){c=c||64,a=d.normalizeInput(a),e&&(e=d.normalizeInput(e)),f&&(f=d.normalizeInput(f));let g=o(c,b,e,f);return p(g,a),q(g)}b.exports={blake2b:r,blake2bHex:function(a,b,c,e,f){let g=r(a,b,c,e,f);return d.toHex(g)},blake2bInit:o,blake2bUpdate:p,blake2bFinal:q}},24034,(a,b,c)=>{let d=a.r(43579);function e(a,b,c,d,e,g){i[a]=i[a]+i[b]+e,i[d]=f(i[d]^i[a],16),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],12),i[a]=i[a]+i[b]+g,i[d]=f(i[d]^i[a],8),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],7)}function f(a,b){return a>>>b^a<<32-b}let g=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),h=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),i=new Uint32Array(16),j=new Uint32Array(16);function k(a,b){let c=0;for(c=0;c<8;c++)i[c]=a.h[c],i[c+8]=g[c];for(i[12]^=a.t,i[13]^=a.t/0x100000000,b&&(i[14]=~i[14]),c=0;c<16;c++){var d,f;j[c]=(d=a.b)[f=4*c]^d[f+1]<<8^d[f+2]<<16^d[f+3]<<24}for(c=0;c<10;c++)e(0,4,8,12,j[h[16*c+0]],j[h[16*c+1]]),e(1,5,9,13,j[h[16*c+2]],j[h[16*c+3]]),e(2,6,10,14,j[h[16*c+4]],j[h[16*c+5]]),e(3,7,11,15,j[h[16*c+6]],j[h[16*c+7]]),e(0,5,10,15,j[h[16*c+8]],j[h[16*c+9]]),e(1,6,11,12,j[h[16*c+10]],j[h[16*c+11]]),e(2,7,8,13,j[h[16*c+12]],j[h[16*c+13]]),e(3,4,9,14,j[h[16*c+14]],j[h[16*c+15]]);for(c=0;c<8;c++)a.h[c]^=i[c]^i[c+8]}function l(a,b){if(!(a>0&&a<=32))throw Error("Incorrect output length, should be in [1, 32]");let c=b?b.length:0;if(b&&!(c>0&&c<=32))throw Error("Incorrect key length, should be in [1, 32]");let d={h:new Uint32Array(g),b:new Uint8Array(64),c:0,t:0,outlen:a};return d.h[0]^=0x1010000^c<<8^a,c>0&&(m(d,b),d.c=64),d}function m(a,b){for(let c=0;c<b.length;c++)64===a.c&&(a.t+=a.c,k(a,!1),a.c=0),a.b[a.c++]=b[c]}function n(a){for(a.t+=a.c;a.c<64;)a.b[a.c++]=0;k(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c)&255;return b}function o(a,b,c){c=c||32,a=d.normalizeInput(a);let e=l(c,b);return m(e,a),n(e)}b.exports={blake2s:o,blake2sHex:function(a,b,c){let e=o(a,b,c);return d.toHex(e)},blake2sInit:l,blake2sUpdate:m,blake2sFinal:n}},72696,(a,b,c)=>{let d=a.r(35783),e=a.r(24034);b.exports={blake2b:d.blake2b,blake2bHex:d.blake2bHex,blake2bInit:d.blake2bInit,blake2bUpdate:d.blake2bUpdate,blake2bFinal:d.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal}},88047,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,c)};function c(a,c){function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function k(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function l(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function o(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(n(arguments[b]));return a}function p(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function q(a){return this instanceof q?(this.v=a,this):new q(a)}function r(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof q?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function s(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:q(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function t(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=m(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function u(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function v(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function w(a){return a&&a.__esModule?a:{default:a}}function x(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function y(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}a.s(["__assign",()=>d,"__asyncDelegator",()=>s,"__asyncGenerator",()=>r,"__asyncValues",()=>t,"__await",()=>q,"__awaiter",()=>i,"__classPrivateFieldGet",()=>x,"__classPrivateFieldSet",()=>y,"__createBinding",()=>k,"__decorate",()=>f,"__exportStar",()=>l,"__extends",()=>c,"__generator",()=>j,"__importDefault",()=>w,"__importStar",()=>v,"__makeTemplateObject",()=>u,"__metadata",()=>h,"__param",()=>g,"__read",()=>n,"__rest",()=>e,"__spread",()=>o,"__spreadArrays",()=>p,"__values",()=>m])},83435,(a,b,c)=>{"use strict";function d(){return(null===a.g||void 0===a.g?void 0:a.g.crypto)||(null===a.g||void 0===a.g?void 0:a.g.msCrypto)||{}}function e(){let a=d();return a.subtle||a.webkitSubtle}Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowserCryptoAvailable=c.getSubtleCrypto=c.getBrowerCrypto=void 0,c.getBrowerCrypto=d,c.getSubtleCrypto=e,c.isBrowserCryptoAvailable=function(){return!!d()&&!!e()}},66818,(a,b,c)=>{"use strict";function d(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function e(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowser=c.isNode=c.isReactNative=void 0,c.isReactNative=d,c.isNode=e,c.isBrowser=function(){return!d()&&!e()}},42289,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(88047);d.__exportStar(a.r(83435),c),d.__exportStar(a.r(66818),c)},83855,(a,b,c)=>{"use strict";b.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},24321,(a,b,c)=>{"use strict";let{EMPTY_BUFFER:d}=a.r(83855);function e(a,b){if(0===a.length)return d;if(1===a.length)return a[0];let c=Buffer.allocUnsafe(b),e=0;for(let b=0;b<a.length;b++){let d=a[b];c.set(d,e),e+=d.length}return e<b?c.slice(0,e):c}function f(a,b,c,d,e){for(let f=0;f<e;f++)c[d+f]=a[f]^b[3&f]}function g(a,b){let c=a.length;for(let d=0;d<c;d++)a[d]^=b[3&d]}function h(a){return a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}function i(a){let b;return(i.readOnly=!0,Buffer.isBuffer(a))?a:(a instanceof ArrayBuffer?b=Buffer.from(a):ArrayBuffer.isView(a)?b=Buffer.from(a.buffer,a.byteOffset,a.byteLength):(b=Buffer.from(a),i.readOnly=!1),b)}try{let c=a.r(2625),d=c.BufferUtil||c;b.exports={concat:e,mask(a,b,c,e,g){g<48?f(a,b,c,e,g):d.mask(a,b,c,e,g)},toArrayBuffer:h,toBuffer:i,unmask(a,b){a.length<32?g(a,b):d.unmask(a,b)}}}catch(a){b.exports={concat:e,mask:f,toArrayBuffer:h,toBuffer:i,unmask:g}}},3099,(a,b,c)=>{"use strict";let d=Symbol("kDone"),e=Symbol("kRun");b.exports=class{constructor(a){this[d]=()=>{this.pending--,this[e]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(a){this.jobs.push(a),this[e]()}[e](){if(this.pending!==this.concurrency&&this.jobs.length){let a=this.jobs.shift();this.pending++,a(this[d])}}}},90739,(a,b,c)=>{"use strict";let d,e=a.r(6461),f=a.r(24321),g=a.r(3099),{kStatusCode:h,NOOP:i}=a.r(83855),j=Buffer.from([0,0,255,255]),k=Symbol("permessage-deflate"),l=Symbol("total-length"),m=Symbol("callback"),n=Symbol("buffers"),o=Symbol("error");function p(a){this[n].push(a),this[l]+=a.length}function q(a){(this[l]+=a.length,this[k]._maxPayload<1||this[l]<=this[k]._maxPayload)?this[n].push(a):(this[o]=RangeError("Max payload size exceeded"),this[o].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[o][h]=1009,this.removeListener("data",q),this.reset())}function r(a){this[k]._inflate=null,a[h]=1007,this[m](a)}b.exports=class{constructor(a,b,c){this._maxPayload=0|c,this._options=a||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!b,this._deflate=null,this._inflate=null,this.params=null,d||(d=new g(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let a={};return this._options.serverNoContextTakeover&&(a.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(a.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(a.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?a.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(a.client_max_window_bits=!0),a}accept(a){return a=this.normalizeParams(a),this.params=this._isServer?this.acceptAsServer(a):this.acceptAsClient(a),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let a=this._deflate[m];this._deflate.close(),this._deflate=null,a&&a(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(a){let b=this._options,c=a.find(a=>(!1!==b.serverNoContextTakeover||!a.server_no_context_takeover)&&(!a.server_max_window_bits||!1!==b.serverMaxWindowBits&&("number"!=typeof b.serverMaxWindowBits||!(b.serverMaxWindowBits>a.server_max_window_bits)))&&("number"!=typeof b.clientMaxWindowBits||!!a.client_max_window_bits));if(!c)throw Error("None of the extension offers can be accepted");return b.serverNoContextTakeover&&(c.server_no_context_takeover=!0),b.clientNoContextTakeover&&(c.client_no_context_takeover=!0),"number"==typeof b.serverMaxWindowBits&&(c.server_max_window_bits=b.serverMaxWindowBits),"number"==typeof b.clientMaxWindowBits?c.client_max_window_bits=b.clientMaxWindowBits:(!0===c.client_max_window_bits||!1===b.clientMaxWindowBits)&&delete c.client_max_window_bits,c}acceptAsClient(a){let b=a[0];if(!1===this._options.clientNoContextTakeover&&b.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(b.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&b.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(b.client_max_window_bits=this._options.clientMaxWindowBits);return b}normalizeParams(a){return a.forEach(a=>{Object.keys(a).forEach(b=>{let c=a[b];if(c.length>1)throw Error(`Parameter "${b}" must have only a single value`);if(c=c[0],"client_max_window_bits"===b){if(!0!==c){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else if("server_max_window_bits"===b){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if("client_no_context_takeover"===b||"server_no_context_takeover"===b){if(!0!==c)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else throw Error(`Unknown parameter "${b}"`);a[b]=c})}),a}decompress(a,b,c){d.add(d=>{this._decompress(a,b,(a,b)=>{d(),c(a,b)})})}compress(a,b,c){d.add(d=>{this._compress(a,b,(a,b)=>{d(),c(a,b)})})}_decompress(a,b,c){let d=this._isServer?"client":"server";if(!this._inflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:b}),this._inflate[k]=this,this._inflate[l]=0,this._inflate[n]=[],this._inflate.on("error",r),this._inflate.on("data",q)}this._inflate[m]=c,this._inflate.write(a),b&&this._inflate.write(j),this._inflate.flush(()=>{let a=this._inflate[o];if(a){this._inflate.close(),this._inflate=null,c(a);return}let e=f.concat(this._inflate[n],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._inflate.reset()),c(null,e)})}_compress(a,b,c){let d=this._isServer?"server":"client";if(!this._deflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:b}),this._deflate[l]=0,this._deflate[n]=[],this._deflate.on("error",i),this._deflate.on("data",p)}this._deflate[m]=c,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let a=f.concat(this._deflate[n],this._deflate[l]);b&&(a=a.slice(0,a.length-4)),this._deflate[m]=null,this._deflate[l]=0,this._deflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._deflate.reset(),c(null,a)})}}},80553,(a,b,c)=>{"use strict";function d(a){return a>=1e3&&a<=1014&&1004!==a&&1005!==a&&1006!==a||a>=3e3&&a<=4999}function e(a){let b=a.length,c=0;for(;c<b;)if((128&a[c])==0)c++;else if((224&a[c])==192){if(c+1===b||(192&a[c+1])!=128||(254&a[c])==192)return!1;c+=2}else if((240&a[c])==224){if(c+2>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||224===a[c]&&(224&a[c+1])==128||237===a[c]&&(224&a[c+1])==160)return!1;c+=3}else{if((248&a[c])!=240||c+3>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||(192&a[c+3])!=128||240===a[c]&&(240&a[c+1])==128||244===a[c]&&a[c+1]>143||a[c]>244)return!1;c+=4}return!0}try{let c=a.r(99873);"object"==typeof c&&(c=c.Validation.isValidUTF8),b.exports={isValidStatusCode:d,isValidUTF8:a=>a.length<150?e(a):c(a)}}catch(a){b.exports={isValidStatusCode:d,isValidUTF8:e}}},3833,(a,b,c)=>{"use strict";let{Writable:d}=a.r(88947),e=a.r(90739),{BINARY_TYPES:f,EMPTY_BUFFER:g,kStatusCode:h,kWebSocket:i}=a.r(83855),{concat:j,toArrayBuffer:k,unmask:l}=a.r(24321),{isValidStatusCode:m,isValidUTF8:n}=a.r(80553);function o(a,b,c,d,e){let f=new a(c?`Invalid WebSocket frame: ${b}`:b);return Error.captureStackTrace(f,o),f.code=e,f[h]=d,f}b.exports=class extends d{constructor(a,b,c,d){super(),this._binaryType=a||f[0],this[i]=void 0,this._extensions=b||{},this._isServer=!!c,this._maxPayload=0|d,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(a,b,c){if(8===this._opcode&&0==this._state)return c();this._bufferedBytes+=a.length,this._buffers.push(a),this.startLoop(c)}consume(a){if(this._bufferedBytes-=a,a===this._buffers[0].length)return this._buffers.shift();if(a<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=b.slice(a),b.slice(0,a)}let b=Buffer.allocUnsafe(a);do{let c=this._buffers[0],d=b.length-a;a>=c.length?b.set(this._buffers.shift(),d):(b.set(new Uint8Array(c.buffer,c.byteOffset,a),d),this._buffers[0]=c.slice(a)),a-=c.length}while(a>0)return b}startLoop(a){let b;this._loop=!0;do switch(this._state){case 0:b=this.getInfo();break;case 1:b=this.getPayloadLength16();break;case 2:b=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:b=this.getData(a);break;default:this._loop=!1;return}while(this._loop)a(b)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let a=this.consume(2);if((48&a[0])!=0)return this._loop=!1,o(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let b=(64&a[0])==64;if(b&&!this._extensions[e.extensionName])return this._loop=!1,o(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(128&a[0])==128,this._opcode=15&a[0],this._payloadLength=127&a[1],0===this._opcode){if(b)return this._loop=!1,o(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,o(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,o(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=b}else{if(!(this._opcode>7)||!(this._opcode<11))return this._loop=!1,o(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,o(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(b)return this._loop=!1,o(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,o(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&a[1])==128,this._isServer){if(!this._masked)return this._loop=!1,o(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,o(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let a=this.consume(8),b=a.readUInt32BE(0);return b>2097151?(this._loop=!1,o(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*b+a.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,o(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(a){let b=g;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}b=this.consume(this._payloadLength),this._masked&&l(b,this._mask)}if(this._opcode>7)return this.controlMessage(b);if(this._compressed){this._state=5,this.decompress(b,a);return}return b.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(b)),this.dataMessage()}decompress(a,b){this._extensions[e.extensionName].decompress(a,this._fin,(a,c)=>{if(a)return b(a);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return b(o(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}let d=this.dataMessage();if(d)return b(d);this.startLoop(b)})}dataMessage(){if(this._fin){let a=this._messageLength,b=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let c;c="nodebuffer"===this._binaryType?j(b,a):"arraybuffer"===this._binaryType?k(j(b,a)):b,this.emit("message",c)}else{let c=j(b,a);if(!n(c))return this._loop=!1,o(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",c.toString())}}this._state=0}controlMessage(a){if(8===this._opcode)if(this._loop=!1,0===a.length)this.emit("conclude",1005,""),this.end();else{if(1===a.length)return o(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");let b=a.readUInt16BE(0);if(!m(b))return o(RangeError,`invalid status code ${b}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let c=a.slice(2);if(!n(c))return o(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",b,c.toString()),this.end()}else 9===this._opcode?this.emit("ping",a):this.emit("pong",a);this._state=0}}},18307,(a,b,c)=>{"use strict";a.r(4446),a.r(55004);let{randomFillSync:d}=a.r(54799),e=a.r(90739),{EMPTY_BUFFER:f}=a.r(83855),{isValidStatusCode:g}=a.r(80553),{mask:h,toBuffer:i}=a.r(24321),j=Buffer.alloc(4);class k{constructor(a,b){this._extensions=b||{},this._socket=a,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(a,b){let c=b.mask&&b.readOnly,e=b.mask?6:2,f=a.length;a.length>=65536?(e+=8,f=127):a.length>125&&(e+=2,f=126);let g=Buffer.allocUnsafe(c?a.length+e:e);return(g[0]=b.fin?128|b.opcode:b.opcode,b.rsv1&&(g[0]|=64),g[1]=f,126===f?g.writeUInt16BE(a.length,2):127===f&&(g.writeUInt32BE(0,2),g.writeUInt32BE(a.length,6)),b.mask)?(d(j,0,4),g[1]|=128,g[e-4]=j[0],g[e-3]=j[1],g[e-2]=j[2],g[e-1]=j[3],c)?(h(a,j,g,e,a.length),[g]):(h(a,j,a,0,a.length),[g,a]):[g,a]}close(a,b,c,d){let e;if(void 0===a)e=f;else if("number"==typeof a&&g(a))if(void 0===b||""===b)(e=Buffer.allocUnsafe(2)).writeUInt16BE(a,0);else{let c=Buffer.byteLength(b);if(c>123)throw RangeError("The message must not be greater than 123 bytes");(e=Buffer.allocUnsafe(2+c)).writeUInt16BE(a,0),e.write(b,2)}else throw TypeError("First argument must be a valid error code number");this._deflating?this.enqueue([this.doClose,e,c,d]):this.doClose(e,c,d)}doClose(a,b,c){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:8,mask:b,readOnly:!1}),c)}ping(a,b,c){let d=i(a);if(d.length>125)throw RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,d,b,i.readOnly,c]):this.doPing(d,b,i.readOnly,c)}doPing(a,b,c,d){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:9,mask:b,readOnly:c}),d)}pong(a,b,c){let d=i(a);if(d.length>125)throw RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,d,b,i.readOnly,c]):this.doPong(d,b,i.readOnly,c)}doPong(a,b,c,d){this.sendFrame(k.frame(a,{fin:!0,rsv1:!1,opcode:10,mask:b,readOnly:c}),d)}send(a,b,c){let d=i(a),f=this._extensions[e.extensionName],g=b.binary?2:1,h=b.compress;if(this._firstFragment?(this._firstFragment=!1,h&&f&&(h=d.length>=f._threshold),this._compress=h):(h=!1,g=0),b.fin&&(this._firstFragment=!0),f){let a={fin:b.fin,rsv1:h,opcode:g,mask:b.mask,readOnly:i.readOnly};this._deflating?this.enqueue([this.dispatch,d,this._compress,a,c]):this.dispatch(d,this._compress,a,c)}else this.sendFrame(k.frame(d,{fin:b.fin,rsv1:!1,opcode:g,mask:b.mask,readOnly:i.readOnly}),c)}dispatch(a,b,c,d){if(!b)return void this.sendFrame(k.frame(a,c),d);let f=this._extensions[e.extensionName];this._bufferedBytes+=a.length,this._deflating=!0,f.compress(a,c.fin,(b,e)=>{if(this._socket.destroyed){let a=Error("The socket was closed while data was being compressed");"function"==typeof d&&d(a);for(let b=0;b<this._queue.length;b++){let c=this._queue[b][4];"function"==typeof c&&c(a)}return}this._bufferedBytes-=a.length,this._deflating=!1,c.readOnly=!1,this.sendFrame(k.frame(e,c),d),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let a=this._queue.shift();this._bufferedBytes-=a[1].length,Reflect.apply(a[0],this,a.slice(1))}}enqueue(a){this._bufferedBytes+=a[1].length,this._queue.push(a)}sendFrame(a,b){2===a.length?(this._socket.cork(),this._socket.write(a[0]),this._socket.write(a[1],b),this._socket.uncork()):this._socket.write(a[0],b)}}b.exports=k},75134,(a,b,c)=>{"use strict";class d{constructor(a,b){this.target=b,this.type=a}}class e extends d{constructor(a,b){super("message",b),this.data=a}}class f extends d{constructor(a,b,c){super("close",c),this.wasClean=c._closeFrameReceived&&c._closeFrameSent,this.reason=b,this.code=a}}class g extends d{constructor(a){super("open",a)}}class h extends d{constructor(a,b){super("error",b),this.message=a.message,this.error=a}}b.exports={addEventListener(a,b,c){if("function"!=typeof b)return;function d(a){b.call(this,new e(a,this))}function i(a,c){b.call(this,new f(a,c,this))}function j(a){b.call(this,new h(a,this))}function k(){b.call(this,new g(this))}let l=c&&c.once?"once":"on";"message"===a?(d._listener=b,this[l](a,d)):"close"===a?(i._listener=b,this[l](a,i)):"error"===a?(j._listener=b,this[l](a,j)):"open"===a?(k._listener=b,this[l](a,k)):this[l](a,b)},removeEventListener(a,b){let c=this.listeners(a);for(let d=0;d<c.length;d++)(c[d]===b||c[d]._listener===b)&&this.removeListener(a,c[d])}}},52882,(a,b,c)=>{"use strict";let d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function e(a,b,c){void 0===a[b]?a[b]=[c]:a[b].push(c)}b.exports={format:function(a){return Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>[b].concat(Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>!0===a?b:`${b}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){let b,c,f=Object.create(null);if(void 0===a||""===a)return f;let g=Object.create(null),h=!1,i=!1,j=!1,k=-1,l=-1,m=0;for(;m<a.length;m++){let n=a.charCodeAt(m);if(void 0===b)if(-1===l&&1===d[n])-1===k&&(k=m);else if(32===n||9===n)-1===l&&-1!==k&&(l=m);else if(59===n||44===n){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m);let c=a.slice(k,l);44===n?(e(f,c,g),g=Object.create(null)):b=c,k=l=-1}else throw SyntaxError(`Unexpected character at index ${m}`);else if(void 0===c)if(-1===l&&1===d[n])-1===k&&(k=m);else if(32===n||9===n)-1===l&&-1!==k&&(l=m);else if(59===n||44===n){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m),e(g,a.slice(k,l),!0),44===n&&(e(f,b,g),g=Object.create(null),b=void 0),k=l=-1}else if(61===n&&-1!==k&&-1===l)c=a.slice(k,m),k=l=-1;else throw SyntaxError(`Unexpected character at index ${m}`);else if(i){if(1!==d[n])throw SyntaxError(`Unexpected character at index ${m}`);-1===k?k=m:h||(h=!0),i=!1}else if(j)if(1===d[n])-1===k&&(k=m);else if(34===n&&-1!==k)j=!1,l=m;else if(92===n)i=!0;else throw SyntaxError(`Unexpected character at index ${m}`);else if(34===n&&61===a.charCodeAt(m-1))j=!0;else if(-1===l&&1===d[n])-1===k&&(k=m);else if(-1!==k&&(32===n||9===n))-1===l&&(l=m);else if(59===n||44===n){if(-1===k)throw SyntaxError(`Unexpected character at index ${m}`);-1===l&&(l=m);let d=a.slice(k,l);h&&(d=d.replace(/\\/g,""),h=!1),e(g,c,d),44===n&&(e(f,b,g),g=Object.create(null),b=void 0),c=void 0,k=l=-1}else throw SyntaxError(`Unexpected character at index ${m}`)}if(-1===k||j)throw SyntaxError("Unexpected end of input");-1===l&&(l=m);let n=a.slice(k,l);return void 0===b?e(f,n,g):(void 0===c?e(g,n,!0):h?e(g,c,n.replace(/\\/g,"")):e(g,c,n),e(f,b,g)),f}}},13523,(a,b,c)=>{"use strict";let d=a.r(27699),e=a.r(24836),f=a.r(21517),g=a.r(4446),h=a.r(55004),{randomBytes:i,createHash:j}=a.r(54799),{Readable:k}=a.r(88947),{URL:l}=a.r(92509),m=a.r(90739),n=a.r(3833),o=a.r(18307),{BINARY_TYPES:p,EMPTY_BUFFER:q,GUID:r,kStatusCode:s,kWebSocket:t,NOOP:u}=a.r(83855),{addEventListener:v,removeEventListener:w}=a.r(75134),{format:x,parse:y}=a.r(52882),{toBuffer:z}=a.r(24321),A=["CONNECTING","OPEN","CLOSING","CLOSED"],B=[8,13];class C extends d{constructor(a,b,c){super(),this._binaryType=p[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=C.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==a?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(b)?b=b.join(", "):"object"==typeof b&&null!==b&&(c=b,b=void 0),function a(b,c,d,g){let h,k,n={protocolVersion:B[1],maxPayload:0x6400000,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...g,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!B.includes(n.protocolVersion))throw RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${B.join(", ")})`);c instanceof l?(h=c,b._url=c.href):(h=new l(c),b._url=c);let o="ws+unix:"===h.protocol;if(!h.host&&(!o||!h.pathname)){let a=Error(`Invalid URL: ${b.url}`);if(0!==b._redirects)return void D(b,a);throw a}let p="wss:"===h.protocol||"https:"===h.protocol,q=p?443:80,s=i(16).toString("base64"),t=p?e.get:f.get;if(n.createConnection=p?F:E,n.defaultPort=n.defaultPort||q,n.port=h.port||q,n.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":s,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=h.pathname+h.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(k=new m(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=x({[m.extensionName]:k.offer()})),d&&(n.headers["Sec-WebSocket-Protocol"]=d),n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(h.username||h.password)&&(n.auth=`${h.username}:${h.password}`),o){let a=n.path.split(":");n.socketPath=a[0],n.path=a[1]}if(n.followRedirects){if(0===b._redirects){b._originalUnixSocket=o,b._originalSecure=p,b._originalHostOrSocketPath=o?n.socketPath:h.host;let a=g&&g.headers;if(g={...g,headers:{}},a)for(let[b,c]of Object.entries(a))g.headers[b.toLowerCase()]=c}else{let a=o?!!b._originalUnixSocket&&n.socketPath===b._originalHostOrSocketPath:!b._originalUnixSocket&&h.host===b._originalHostOrSocketPath;a&&(!b._originalSecure||p)||(delete n.headers.authorization,delete n.headers.cookie,a||delete n.headers.host,n.auth=void 0)}n.auth&&!g.headers.authorization&&(g.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64"))}let u=b._req=t(n);n.timeout&&u.on("timeout",()=>{G(b,u,"Opening handshake has timed out")}),u.on("error",a=>{null===u||u.aborted||(u=b._req=null,D(b,a))}),u.on("response",e=>{let f=e.headers.location,h=e.statusCode;if(f&&n.followRedirects&&h>=300&&h<400){let e;if(++b._redirects>n.maxRedirects)return void G(b,u,"Maximum redirects exceeded");u.abort();try{e=new l(f,c)}catch(a){D(b,a);return}a(b,e,d,g)}else b.emit("unexpected-response",u,e)||G(b,u,`Unexpected server response: ${e.statusCode}`)}),u.on("upgrade",(a,c,e)=>{let f;if(b.emit("upgrade",a),b.readyState!==C.CONNECTING)return;u=b._req=null;let g=a.headers.upgrade;if(void 0===g||"websocket"!==g.toLowerCase())return void G(b,c,"Invalid Upgrade header");let h=j("sha1").update(s+r).digest("base64");if(a.headers["sec-websocket-accept"]!==h)return void G(b,c,"Invalid Sec-WebSocket-Accept header");let i=a.headers["sec-websocket-protocol"],l=(d||"").split(/, */);if(!d&&i?f="Server sent a subprotocol but none was requested":d&&!i?f="Server sent no subprotocol":i&&!l.includes(i)&&(f="Server sent an invalid subprotocol"),f)return void G(b,c,f);i&&(b._protocol=i);let o=a.headers["sec-websocket-extensions"];if(void 0!==o){let a;if(!k)return void G(b,c,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{a=y(o)}catch(a){G(b,c,"Invalid Sec-WebSocket-Extensions header");return}let d=Object.keys(a);if(d.length){if(1!==d.length||d[0]!==m.extensionName)return void G(b,c,"Server indicated an extension that was not requested");try{k.accept(a[m.extensionName])}catch(a){G(b,c,"Invalid Sec-WebSocket-Extensions header");return}b._extensions[m.extensionName]=k}}b.setSocket(c,e,n.maxPayload)})}(this,a,b,c)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(a){p.includes(a)&&(this._binaryType=a,this._receiver&&(this._receiver._binaryType=a))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){}set onclose(a){}get onerror(){}set onerror(a){}get onopen(){}set onopen(a){}get onmessage(){}set onmessage(a){}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(a,b,c){let d=new n(this.binaryType,this._extensions,this._isServer,c);this._sender=new o(a,this._extensions),this._receiver=d,this._socket=a,d[t]=this,a[t]=this,d.on("conclude",I),d.on("drain",J),d.on("error",K),d.on("message",M),d.on("ping",N),d.on("pong",O),a.setTimeout(0),a.setNoDelay(),b.length>0&&a.unshift(b),a.on("close",Q),a.on("data",R),a.on("end",S),a.on("error",T),this._readyState=C.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[m.extensionName]&&this._extensions[m.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(a,b){if(this.readyState!==C.CLOSED){if(this.readyState===C.CONNECTING)return G(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===C.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=C.CLOSING,this._sender.close(a,b,!this._isServer,a=>{!a&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)}}ping(a,b,c){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==C.OPEN)?H(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.ping(a||q,b,c))}pong(a,b,c){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==C.OPEN)?H(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.pong(a||q,b,c))}send(a,b,c){if(this.readyState===C.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof b&&(c=b,b={}),"number"==typeof a&&(a=a.toString()),this.readyState!==C.OPEN)return void H(this,a,c);let d={binary:"string"!=typeof a,mask:!this._isServer,compress:!0,fin:!0,...b};this._extensions[m.extensionName]||(d.compress=!1),this._sender.send(a||q,d,c)}terminate(){if(this.readyState!==C.CLOSED){if(this.readyState===C.CONNECTING)return G(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=C.CLOSING,this._socket.destroy())}}}function D(a,b){a._readyState=C.CLOSING,a.emit("error",b),a.emitClose()}function E(a){return a.path=a.socketPath,g.connect(a)}function F(a){return a.path=void 0,a.servername||""===a.servername||(a.servername=g.isIP(a.host)?"":a.host),h.connect(a)}function G(a,b,c){a._readyState=C.CLOSING;let d=Error(c);Error.captureStackTrace(d,G),b.setHeader?(b.abort(),b.socket&&!b.socket.destroyed&&b.socket.destroy(),b.once("abort",a.emitClose.bind(a)),a.emit("error",d)):(b.destroy(d),b.once("error",a.emit.bind(a,"error")),b.once("close",a.emitClose.bind(a)))}function H(a,b,c){if(b){let c=z(b).length;a._socket?a._sender._bufferedBytes+=c:a._bufferedAmount+=c}c&&c(Error(`WebSocket is not open: readyState ${a.readyState} (${A[a.readyState]})`))}function I(a,b){let c=this[t];c._closeFrameReceived=!0,c._closeMessage=b,c._closeCode=a,void 0!==c._socket[t]&&(c._socket.removeListener("data",R),process.nextTick(P,c._socket),1005===a?c.close():c.close(a,b))}function J(){this[t]._socket.resume()}function K(a){let b=this[t];void 0!==b._socket[t]&&(b._socket.removeListener("data",R),process.nextTick(P,b._socket),b.close(a[s])),b.emit("error",a)}function L(){this[t].emitClose()}function M(a){this[t].emit("message",a)}function N(a){let b=this[t];b.pong(a,!b._isServer,u),b.emit("ping",a)}function O(a){this[t].emit("pong",a)}function P(a){a.resume()}function Q(){let a,b=this[t];this.removeListener("close",Q),this.removeListener("data",R),this.removeListener("end",S),b._readyState=C.CLOSING,this._readableState.endEmitted||b._closeFrameReceived||b._receiver._writableState.errorEmitted||null===(a=b._socket.read())||b._receiver.write(a),b._receiver.end(),this[t]=void 0,clearTimeout(b._closeTimer),b._receiver._writableState.finished||b._receiver._writableState.errorEmitted?b.emitClose():(b._receiver.on("error",L),b._receiver.on("finish",L))}function R(a){this[t]._receiver.write(a)||this.pause()}function S(){let a=this[t];a._readyState=C.CLOSING,a._receiver.end(),this.end()}function T(){let a=this[t];this.removeListener("error",T),this.on("error",u),a&&(a._readyState=C.CLOSING,this.destroy())}Object.defineProperty(C,"CONNECTING",{enumerable:!0,value:A.indexOf("CONNECTING")}),Object.defineProperty(C.prototype,"CONNECTING",{enumerable:!0,value:A.indexOf("CONNECTING")}),Object.defineProperty(C,"OPEN",{enumerable:!0,value:A.indexOf("OPEN")}),Object.defineProperty(C.prototype,"OPEN",{enumerable:!0,value:A.indexOf("OPEN")}),Object.defineProperty(C,"CLOSING",{enumerable:!0,value:A.indexOf("CLOSING")}),Object.defineProperty(C.prototype,"CLOSING",{enumerable:!0,value:A.indexOf("CLOSING")}),Object.defineProperty(C,"CLOSED",{enumerable:!0,value:A.indexOf("CLOSED")}),Object.defineProperty(C.prototype,"CLOSED",{enumerable:!0,value:A.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(a=>{Object.defineProperty(C.prototype,a,{enumerable:!0})}),["open","error","close","message"].forEach(a=>{Object.defineProperty(C.prototype,`on${a}`,{enumerable:!0,get(){let b=this.listeners(a);for(let a=0;a<b.length;a++)if(b[a]._listener)return b[a]._listener},set(b){let c=this.listeners(a);for(let b=0;b<c.length;b++)c[b]._listener&&this.removeListener(a,c[b]);this.addEventListener(a,b)}})}),C.prototype.addEventListener=v,C.prototype.removeEventListener=w,b.exports=C},27493,(a,b,c)=>{"use strict";let{Duplex:d}=a.r(88947);function e(a){a.emit("close")}function f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function g(a){this.removeListener("error",g),this.destroy(),0===this.listenerCount("error")&&this.emit("error",a)}b.exports=function(a,b){let c=!0,h=!0;function i(){c&&a._socket.resume()}a.readyState===a.CONNECTING?a.once("open",function(){a._receiver.removeAllListeners("drain"),a._receiver.on("drain",i)}):(a._receiver.removeAllListeners("drain"),a._receiver.on("drain",i));let j=new d({...b,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return a.on("message",function(b){j.push(b)||(c=!1,a._socket.pause())}),a.once("error",function(a){j.destroyed||(h=!1,j.destroy(a))}),a.once("close",function(){j.destroyed||j.push(null)}),j._destroy=function(b,c){if(a.readyState===a.CLOSED){c(b),process.nextTick(e,j);return}let d=!1;a.once("error",function(a){d=!0,c(a)}),a.once("close",function(){d||c(b),process.nextTick(e,j)}),h&&a.terminate()},j._final=function(b){a.readyState===a.CONNECTING?a.once("open",function(){j._final(b)}):null!==a._socket&&(a._socket._writableState.finished?(b(),j._readableState.endEmitted&&j.destroy()):(a._socket.once("finish",function(){b()}),a.close()))},j._read=function(){(a.readyState===a.OPEN||a.readyState===a.CLOSING)&&!c&&(c=!0,a._receiver._writableState.needDrain||a._socket.resume())},j._write=function(b,c,d){a.readyState===a.CONNECTING?a.once("open",function(){j._write(b,c,d)}):a.send(b,d)},j.on("end",f),j.on("error",g),j}},56492,(a,b,c)=>{"use strict";let d=a.r(27699),e=a.r(21517);a.r(24836),a.r(4446),a.r(55004);let{createHash:f}=a.r(54799),g=a.r(90739),h=a.r(13523),{format:i,parse:j}=a.r(52882),{GUID:k,kWebSocket:l}=a.r(83855),m=/^[+/0-9A-Za-z]{22}==$/;function n(a){a._state=2,a.emit("close")}function o(){this.destroy()}function p(a,b,c,d){a.writable&&(c=c||e.STATUS_CODES[b],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(c),...d},a.write(`HTTP/1.1 ${b} ${e.STATUS_CODES[b]}\r
`+Object.keys(d).map(a=>`${a}: ${d[a]}`).join("\r\n")+"\r\n\r\n"+c)),a.removeListener("error",o),a.destroy()}function q(a){return a.trim()}b.exports=class extends d{constructor(a,b){if(super(),null==(a={maxPayload:0x6400000,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...a}).port&&!a.server&&!a.noServer||null!=a.port&&(a.server||a.noServer)||a.server&&a.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=a.port?(this._server=e.createServer((a,b)=>{let c=e.STATUS_CODES[426];b.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),b.end(c)}),this._server.listen(a.port,a.host,a.backlog,b)):a.server&&(this._server=a.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=function(a,b){for(let c of Object.keys(b))a.on(c,b[c]);return function(){for(let c of Object.keys(b))a.removeListener(c,b[c])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,c,d)=>{this.handleUpgrade(b,c,d,a)}})}!0===a.perMessageDeflate&&(a.perMessageDeflate={}),a.clientTracking&&(this.clients=new Set),this.options=a,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(a){if(a&&this.once("close",a),2===this._state)return void process.nextTick(n,this);if(1===this._state)return;if(this._state=1,this.clients)for(let a of this.clients)a.terminate();let b=this._server;b&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?b.close(n.bind(void 0,this)):process.nextTick(n,this)}shouldHandle(a){if(this.options.path){let b=a.url.indexOf("?");if((-1!==b?a.url.slice(0,b):a.url)!==this.options.path)return!1}return!0}handleUpgrade(a,b,c,d){b.on("error",o);let e=void 0!==a.headers["sec-websocket-key"]&&a.headers["sec-websocket-key"].trim(),f=a.headers.upgrade,h=+a.headers["sec-websocket-version"],i={};if("GET"!==a.method||void 0===f||"websocket"!==f.toLowerCase()||!e||!m.test(e)||8!==h&&13!==h||!this.shouldHandle(a))return p(b,400);if(this.options.perMessageDeflate){let c=new g(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let b=j(a.headers["sec-websocket-extensions"]);b[g.extensionName]&&(c.accept(b[g.extensionName]),i[g.extensionName]=c)}catch(a){return p(b,400)}}if(this.options.verifyClient){let f={origin:a.headers[`${8===h?"sec-websocket-origin":"origin"}`],secure:!!(a.socket.authorized||a.socket.encrypted),req:a};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(f,g,h,j)=>{if(!f)return p(b,g||401,h,j);this.completeUpgrade(e,i,a,b,c,d)});if(!this.options.verifyClient(f))return p(b,401)}this.completeUpgrade(e,i,a,b,c,d)}completeUpgrade(a,b,c,d,e,j){if(!d.readable||!d.writable)return d.destroy();if(d[l])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return p(d,503);let m=f("sha1").update(a+k).digest("base64"),n=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${m}`],r=new h(null),s=c.headers["sec-websocket-protocol"];if(s&&(s=s.split(",").map(q),(s=this.options.handleProtocols?this.options.handleProtocols(s,c):s[0])&&(n.push(`Sec-WebSocket-Protocol: ${s}`),r._protocol=s)),b[g.extensionName]){let a=b[g.extensionName].params,c=i({[g.extensionName]:[a]});n.push(`Sec-WebSocket-Extensions: ${c}`),r._extensions=b}this.emit("headers",n,c),d.write(n.concat("\r\n").join("\r\n")),d.removeListener("error",o),r.setSocket(d,e,this.options.maxPayload),this.clients&&(this.clients.add(r),r.on("close",()=>this.clients.delete(r))),j(r,c)}}},69084,(a,b,c)=>{"use strict";let d=a.r(13523);d.createWebSocketStream=a.r(27493),d.Server=a.r(56492),d.Receiver=a.r(3833),d.Sender=a.r(18307),b.exports=d},49386,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k;a.s([],91485),a.i(91485);var l,m,n,o,p,q,r,s,t,u=a.i(98549),v=a.i(41623),w=a.i(38013);let x=((l={}).ETH_SEND_TRANSACTION="eth_sendTransaction",l.ETH_SIGN_TRANSACTION="eth_signTransaction",l.ETH_SIGN="eth_sign",l.PERSONAL_SIGN="personal_sign",l.ETH_SIGN_TYPED_DATA="eth_signTypedData",l.ETH_SIGN_TYPED_DATA_V3="eth_signTypedData_v3",l.ETH_SIGN_TYPED_DATA_V4="eth_signTypedData_v4",l.ADD_ETHEREUM_CHAIN="wallet_addEthereumChain",l.SWITCH_ETHEREUM_CHAIN="wallet_switchEthereumChain",l),y=((m={}).SIGN_TRANSACTION="solana_signTransaction",m.SIGN_MESSAGE="solana_signMessage",m),z=((n={}).ETH_CHAIN_CHANGED="chainChanged",n.ETH_ACCOUNTS_CHANGED="accountsChanged",n),A=((o={}).SOL_CHAIN_CHANGED="chainChanged",o.SOL_ACCOUNTS_CHANGED="accountsChanged",o),B=async()=>({name:(0,u.getSiteName)(window),icon:await (0,u.getSiteIcon)(window)}),C=a=>{let b=[];return a.forEach(a=>{let[c]=a.split(":");b.includes(c)||b.push(c)}),b},D=a=>{switch(a){case w.CHAIN_NAMESPACES.EIP155:return Object.values(x);case w.CHAIN_NAMESPACES.SOLANA:return Object.values(y);default:throw Error(`No default methods for namespace: ${a}`)}},E=a=>{switch(a){case w.CHAIN_NAMESPACES.EIP155:return Object.values(z);case w.CHAIN_NAMESPACES.SOLANA:return Object.values(A);default:throw Error(`No default events for namespace: ${a}`)}},F=a=>Object.fromEntries(C(a).map(b=>[b,{methods:D(b),chains:a.filter(a=>a.startsWith(b)),events:E(b)}])),G=async(a,b)=>{let c=await B();return{connectorSettings:{walletConnectInitOptions:{projectId:b,relayUrl:"wss://relay.walletconnect.com",metadata:{name:c.name,description:c.name,url:window.location.origin,icons:[c.icon||""]}}},loginSettings:{optionalNamespaces:F(a.map(a=>{if(a.chainNamespace===w.CHAIN_NAMESPACES.SOLANA)return`${a.chainNamespace}:${v.SOLANA_CAIP_CHAIN_MAP[a.chainId]}`;if(a.chainNamespace===w.CHAIN_NAMESPACES.EIP155)return`${a.chainNamespace}:${parseInt(a.chainId,16)}`;throw Error(`Unsupported chain namespace: ${a.chainNamespace}`)}))}}};var H=a.i(95851),I=a.i(41415),J=a.i(35479),K=a.i(55412),L=a.i(27699),M=a.i(73620);class N{}class O extends N{constructor(a){super()}}let P=M.FIVE_SECONDS,Q="heartbeat_pulse";class R extends O{constructor(a){super(a),this.events=new L.EventEmitter,this.interval=P,this.interval=a?.interval||P}static async init(a){let b=new R(a);return await b.init(),b}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,M.toMiliseconds)(this.interval))}pulse(){this.events.emit(Q)}}let S=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,T=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,U=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function V(a,b){var c;return"__proto__"===a||"constructor"===a&&b&&"object"==typeof b&&"prototype"in b?void(c=a,console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)):b}function W(a,b={}){if("string"!=typeof a)return a;if('"'===a[0]&&'"'===a[a.length-1]&&-1===a.indexOf("\\"))return a.slice(1,-1);let c=a.trim();if(c.length<=9)switch(c.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return NaN;case"infinity":return 1/0;case"-infinity":return-1/0}if(!U.test(a)){if(b.strict)throw SyntaxError("[destr] Invalid JSON");return a}try{if(S.test(a)||T.test(a)){if(b.strict)throw Error("[destr] Possible prototype pollution");return JSON.parse(a,V)}return JSON.parse(a)}catch(c){if(b.strict)throw c;return a}}function X(a,...b){try{var c;return(c=a(...b))&&"function"==typeof c.then?c:Promise.resolve(c)}catch(a){return Promise.reject(a)}}function Y(a){let b,c;if(b=typeof a,null===a||"object"!==b&&"function"!==b)return String(a);if(!(c=Object.getPrototypeOf(a))||c.isPrototypeOf(Object)||Array.isArray(a))return JSON.stringify(a);if("function"==typeof a.toJSON)return Y(a.toJSON());throw Error("[unstorage] Cannot stringify value!")}let Z="base64:";function $(a){return a&&a.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function _(a){return(a=$(a))?a+":":""}function aa(a,b,c){return a.watch?a.watch((a,d)=>b(a,c+d)):()=>{}}async function ab(a){"function"==typeof a.dispose&&await X(a.dispose)}function ac(a){return new Promise((b,c)=>{a.oncomplete=a.onsuccess=()=>b(a.result),a.onabort=a.onerror=()=>c(a.error)})}function ad(a,b){let c;return(d,e)=>(()=>{if(c)return c;let d=indexedDB.open(a);return d.onupgradeneeded=()=>d.result.createObjectStore(b),(c=ac(d)).then(a=>{a.onclose=()=>c=void 0},()=>{}),c})().then(a=>e(a.transaction(b,d).objectStore(b)))}function ae(){return b||(b=ad("keyval-store","keyval")),b}function af(a,b=ae()){return b("readonly",b=>ac(b.get(a)))}function ag(a){if("string"!=typeof a)throw Error(`Cannot safe json parse value of type ${typeof a}`);try{return JSON.parse(a.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3'),(a,b)=>"string"==typeof b&&b.match(/^\d+n$/)?BigInt(b.substring(0,b.length-1)):b)}catch(b){return a}}function ah(a){return"string"==typeof a?a:JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString()+"n":b)||""}class ai{constructor(){this.indexedDb=function(a={}){let b,c={mounts:{"":a.driver||(b=new Map,{name:"memory",getInstance:()=>b,hasItem:a=>b.has(a),getItem:a=>b.get(a)??null,getItemRaw:a=>b.get(a)??null,setItem(a,c){b.set(a,c)},setItemRaw(a,c){b.set(a,c)},removeItem(a){b.delete(a)},getKeys:()=>[...b.keys()],clear(){b.clear()},dispose(){b.clear()}})},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},d=a=>{for(let b of c.mountpoints)if(a.startsWith(b))return{base:b,relativeKey:a.slice(b.length),driver:c.mounts[b]};return{base:"",relativeKey:a,driver:c.mounts[""]}},e=(a,b)=>c.mountpoints.filter(c=>c.startsWith(a)||b&&a.startsWith(c)).map(b=>({relativeBase:a.length>b.length?a.slice(b.length):void 0,mountpoint:b,driver:c.mounts[b]})),f=(a,b)=>{if(c.watching)for(let d of(b=$(b),c.watchListeners))d(a,b)},g=async()=>{if(!c.watching)for(let a in c.watching=!0,c.mounts)c.unwatch[a]=await aa(c.mounts[a],f,a)},h=async()=>{if(c.watching){for(let a in c.unwatch)await c.unwatch[a]();c.unwatch={},c.watching=!1}},i=(a,b,c)=>{let e=new Map,f=a=>{let b=e.get(a.base);return b||(b={driver:a.driver,base:a.base,items:[]},e.set(a.base,b)),b};for(let c of a){let a="string"==typeof c,e=$(a?c:c.key),g=a?void 0:c.value,h=a||!c.options?b:{...b,...c.options},i=d(e);f(i).items.push({key:e,value:g,relativeKey:i.relativeKey,options:h})}return Promise.all([...e.values()].map(a=>c(a))).then(a=>a.flat())},j={hasItem(a,b={}){let{relativeKey:c,driver:e}=d(a=$(a));return X(e.hasItem,c,b)},getItem(a,b={}){let{relativeKey:c,driver:e}=d(a=$(a));return X(e.getItem,c,b).then(a=>W(a))},getItems:(a,b={})=>i(a,b,a=>a.driver.getItems?X(a.driver.getItems,a.items.map(a=>({key:a.relativeKey,options:a.options})),b).then(b=>b.map(b=>({key:function(...a){return $(a.join(":"))}(a.base,b.key),value:W(b.value)}))):Promise.all(a.items.map(b=>X(a.driver.getItem,b.relativeKey,b.options).then(a=>({key:b.key,value:W(a)}))))),getItemRaw(a,b={}){let{relativeKey:c,driver:e}=d(a=$(a));return e.getItemRaw?X(e.getItemRaw,c,b):X(e.getItem,c,b).then(a=>{var b;return"string"==typeof a&&a.startsWith(Z)?(b=a.slice(Z.length),globalThis.Buffer?Buffer.from(b,"base64"):Uint8Array.from(globalThis.atob(b),a=>a.codePointAt(0))):a})},async setItem(a,b,c={}){if(void 0===b)return j.removeItem(a);let{relativeKey:e,driver:g}=d(a=$(a));g.setItem&&(await X(g.setItem,e,Y(b),c),g.watch||f("update",a))},async setItems(a,b){await i(a,b,async a=>{if(a.driver.setItems)return X(a.driver.setItems,a.items.map(a=>({key:a.relativeKey,value:Y(a.value),options:a.options})),b);a.driver.setItem&&await Promise.all(a.items.map(b=>X(a.driver.setItem,b.relativeKey,Y(b.value),b.options)))})},async setItemRaw(a,b,c={}){if(void 0===b)return j.removeItem(a,c);let{relativeKey:e,driver:g}=d(a=$(a));if(g.setItemRaw)await X(g.setItemRaw,e,b,c);else{var h;if(!g.setItem)return;await X(g.setItem,e,"string"==typeof b?b:Z+(h=b,globalThis.Buffer?Buffer.from(h).toString("base64"):globalThis.btoa(String.fromCodePoint(...h))),c)}g.watch||f("update",a)},async removeItem(a,b={}){"boolean"==typeof b&&(b={removeMeta:b});let{relativeKey:c,driver:e}=d(a=$(a));e.removeItem&&(await X(e.removeItem,c,b),(b.removeMeta||b.removeMata)&&await X(e.removeItem,c+"$",b),e.watch||f("remove",a))},async getMeta(a,b={}){"boolean"==typeof b&&(b={nativeOnly:b});let{relativeKey:c,driver:e}=d(a=$(a)),f=Object.create(null);if(e.getMeta&&Object.assign(f,await X(e.getMeta,c,b)),!b.nativeOnly){let a=await X(e.getItem,c+"$",b).then(a=>W(a));a&&"object"==typeof a&&("string"==typeof a.atime&&(a.atime=new Date(a.atime)),"string"==typeof a.mtime&&(a.mtime=new Date(a.mtime)),Object.assign(f,a))}return f},setMeta(a,b,c={}){return this.setItem(a+"$",b,c)},removeMeta(a,b={}){return this.removeItem(a+"$",b)},async getKeys(a,b={}){let c=e(a=_(a),!0),d=[],f=[],g=!0;for(let a of c){for(let c of(a.driver.flags?.maxDepth||(g=!1),await X(a.driver.getKeys,a.relativeBase,b))){let b=a.mountpoint+$(c);d.some(a=>b.startsWith(a))||f.push(b)}d=[a.mountpoint,...d.filter(b=>!b.startsWith(a.mountpoint))]}let h=void 0!==b.maxDepth&&!g;return f.filter(c=>{var d;return(!h||function(a,b){if(void 0===b)return!0;let c=0,d=a.indexOf(":");for(;d>-1;)c++,d=a.indexOf(":",d+1);return c<=b}(c,b.maxDepth))&&((d=a)?c.startsWith(d)&&"$"!==c[c.length-1]:"$"!==c[c.length-1])})},async clear(a,b={}){a=_(a),await Promise.all(e(a,!1).map(async a=>a.driver.clear?X(a.driver.clear,a.relativeBase,b):a.driver.removeItem?Promise.all((await a.driver.getKeys(a.relativeBase||"",b)).map(c=>a.driver.removeItem(c,b))):void 0))},async dispose(){await Promise.all(Object.values(c.mounts).map(a=>ab(a)))},watch:async a=>(await g(),c.watchListeners.push(a),async()=>{c.watchListeners=c.watchListeners.filter(b=>b!==a),0===c.watchListeners.length&&await h()}),async unwatch(){c.watchListeners=[],await h()},mount(a,b){if((a=_(a))&&c.mounts[a])throw Error(`already mounted at ${a}`);return a&&(c.mountpoints.push(a),c.mountpoints.sort((a,b)=>b.length-a.length)),c.mounts[a]=b,c.watching&&Promise.resolve(aa(b,f,a)).then(b=>{c.unwatch[a]=b}).catch(console.error),j},async unmount(a,b=!0){(a=_(a))&&c.mounts[a]&&(c.watching&&a in c.unwatch&&(c.unwatch[a]?.(),delete c.unwatch[a]),b&&await ab(c.mounts[a]),c.mountpoints=c.mountpoints.filter(b=>b!==a),delete c.mounts[a])},getMount(a=""){let b=d(a=$(a)+":");return{driver:b.driver,base:b.base}},getMounts:(a="",b={})=>e(a=$(a),b.parents).map(a=>({driver:a.driver,base:a.mountpoint})),keys:(a,b={})=>j.getKeys(a,b),get:(a,b={})=>j.getItem(a,b),set:(a,b,c={})=>j.setItem(a,b,c),has:(a,b={})=>j.hasItem(a,b),del:(a,b={})=>j.removeItem(a,b),remove:(a,b={})=>j.removeItem(a,b)};return j}({driver:((a={})=>{let b,c=a.base&&a.base.length>0?`${a.base}:`:"";return a.dbName&&a.storeName&&(b=ad(a.dbName,a.storeName)),{name:"idb-keyval",options:a,hasItem:async a=>!(typeof await af(c+a,b)>"u"),getItem:async a=>await af(c+a,b)??null,setItem:(a,d)=>(function(a,b,c=ae()){return c("readwrite",c=>(c.put(b,a),ac(c.transaction)))})(c+a,d,b),removeItem:a=>(function(a,b=ae()){return b("readwrite",b=>(b.delete(a),ac(b.transaction)))})(c+a,b),getKeys:()=>(function(a=ae()){return a("readonly",a=>{var b;if(a.getAllKeys)return ac(a.getAllKeys());let c=[];return(b=a=>c.push(a.key),a.openCursor().onsuccess=function(){this.result&&(b(this.result),this.result.continue())},ac(a.transaction)).then(()=>c)})})(b),clear:()=>(function(a=ae()){return a("readwrite",a=>(a.clear(),ac(a.transaction)))})(b)}})({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(a=>[a.key,a.value])}async getItem(a){let b=await this.indexedDb.getItem(a);if(null!==b)return b}async setItem(a,b){await this.indexedDb.setItem(a,ah(b))}async removeItem(a){await this.indexedDb.removeItem(a)}}var aj="u">typeof globalThis?globalThis:a.g,ak={exports:{}};function al(a){var b;return[a[0],ag(null!=(b=a[1])?b:"")]}function am(){}am.prototype.getItem=function(a){return this.hasOwnProperty(a)?String(this[a]):null},am.prototype.setItem=function(a,b){this[a]=String(b)},am.prototype.removeItem=function(a){delete this[a]},am.prototype.clear=function(){let a=this;Object.keys(a).forEach(function(b){a[b]=void 0,delete a[b]})},am.prototype.key=function(a){return a=a||0,Object.keys(this)[a]},am.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),"u">typeof aj&&aj.localStorage?ak.exports=aj.localStorage:ak.exports=new am;class an{constructor(){this.localStorage=ak.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(al)}async getItem(a){let b=this.localStorage.getItem(a);if(null!==b)return ag(b)}async setItem(a,b){this.localStorage.setItem(a,ah(b))}async removeItem(a){this.localStorage.removeItem(a)}}let ao=async(a,b,c)=>{let d="wc_storage_version",e=await b.getItem(d);if(e&&e>=1)return void c(b);let f=await a.getKeys();if(!f.length)return void c(b);let g=[];for(;f.length;){let c=f.shift();if(!c)continue;let d=c.toLowerCase();if(d.includes("wc@")||d.includes("walletconnect")||d.includes("wc_")||d.includes("wallet_connect")){let d=await a.getItem(c);await b.setItem(c,d),g.push(c)}}await b.setItem(d,1),c(b),ap(a,g)},ap=async(a,b)=>{b.length&&b.forEach(async b=>{await a.removeItem(b)})};class aq{constructor(){this.initialized=!1,this.setInitialized=a=>{this.storage=a,this.initialized=!0};const a=new an;this.storage=a;try{const b=new ai;ao(a,b,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(a){return await this.initialize(),this.storage.getItem(a)}async setItem(a,b){return await this.initialize(),this.storage.setItem(a,b)}async removeItem(a){return await this.initialize(),this.storage.removeItem(a)}async initialize(){this.initialized||await new Promise(a=>{let b=setInterval(()=>{this.initialized&&(clearInterval(b),a())},20)})}}var ar={exports:{}};function as(a){try{return JSON.stringify(a)}catch{return'"[Circular]"'}}let at=function(a,b,c){var d=c&&c.stringify||as;if("object"==typeof a&&null!==a){var e=b.length+1;if(1===e)return a;var f=Array(e);f[0]=d(a);for(var g=1;g<e;g++)f[g]=d(b[g]);return f.join(" ")}if("string"!=typeof a)return a;var h=b.length;if(0===h)return a;for(var i="",j=0,k=-1,l=a&&a.length||0,m=0;m<l;){if(37===a.charCodeAt(m)&&m+1<l){switch(k=k>-1?k:0,a.charCodeAt(m+1)){case 100:case 102:if(j>=h||null==b[j])break;k<m&&(i+=a.slice(k,m)),i+=Number(b[j]),k=m+2,m++;break;case 105:if(j>=h||null==b[j])break;k<m&&(i+=a.slice(k,m)),i+=Math.floor(Number(b[j])),k=m+2,m++;break;case 79:case 111:case 106:if(j>=h||void 0===b[j])break;k<m&&(i+=a.slice(k,m));var n=typeof b[j];if("string"===n){i+="'"+b[j]+"'",k=m+2,m++;break}if("function"===n){i+=b[j].name||"<anonymous>",k=m+2,m++;break}i+=d(b[j]),k=m+2,m++;break;case 115:if(j>=h)break;k<m&&(i+=a.slice(k,m)),i+=String(b[j]),k=m+2,m++;break;case 37:k<m&&(i+=a.slice(k,m)),i+="%",k=m+2,m++,j--}++j}++m}return -1===k?a:(k<l&&(i+=a.slice(k)),i)};ar.exports=aA;let au=function(){function a(a){return"u">typeof a&&a}try{return"u">typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return a(self)||a(window)||a(this)||{}}}().console||{};function av(a,b){return"silent"===a?1/0:b.levels.values[a]}let aw=Symbol("pino.logFuncs"),ax=Symbol("pino.hierarchy"),ay={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function az(a,b){let c={logger:b,parent:a[ax]};b[ax]=c}function aA(a){var b,c,d;let e,f,g;(a=a||{}).browser=a.browser||{};let h=a.browser.transmit;if(h&&"function"!=typeof h.send)throw Error("pino: transmit option must have a send function");let i=a.browser.write||au;a.browser.write&&(a.browser.asObject=!0);let j=a.serializers||{},k=(b=a.browser.serialize,Array.isArray(b)?b.filter(function(a){return"!stdSerializers.err"!==a}):!0===b&&Object.keys(j)),l=a.browser.serialize;Array.isArray(a.browser.serialize)&&a.browser.serialize.indexOf("!stdSerializers.err")>-1&&(l=!1);let m=Object.keys(a.customLevels||{}),n=["error","fatal","warn","info","debug","trace"].concat(m);"function"==typeof i&&n.forEach(function(a){i[a]=i}),(!1===a.enabled||a.browser.disabled)&&(a.level="silent");let o=a.level||"info",p=Object.create(i);p.log||(p.log=aH),e={},n.forEach(a=>{e[a]=i[a]?i[a]:au[a]||au[ay[a]||"log"]||aH}),p[aw]=e,az({},p),Object.defineProperty(p,"levelVal",{get:function(){return av(this.level,this)}}),Object.defineProperty(p,"level",{get:function(){return this._level},set:function(a){if("silent"!==a&&!this.levels.values[a])throw Error("unknown level "+a);this._level=a,aB(this,q,p,"error"),aB(this,q,p,"fatal"),aB(this,q,p,"warn"),aB(this,q,p,"info"),aB(this,q,p,"debug"),aB(this,q,p,"trace"),m.forEach(a=>{aB(this,q,p,a)})}});let q={transmit:h,serialize:k,asObject:a.browser.asObject,asObjectBindingsOnly:a.browser.asObjectBindingsOnly,formatters:a.browser.formatters,levels:n,timestamp:"function"==typeof(c=a).timestamp?c.timestamp:!1===c.timestamp?aI:aJ,messageKey:a.messageKey||"msg",onChild:a.onChild||aH};function r(b,c,d){if(!c)throw Error("missing bindings for child Pino");d=d||{},k&&c.serializers&&(d.serializers=c.serializers);let e=d.serializers;if(k&&e){var f=Object.assign({},j,e),g=!0===a.browser.serialize?Object.keys(f):k;delete c.serializers,aC([c],g,f,this._stdErrSerialize)}function i(a){this._childLevel=(0|a._childLevel)+1,this.bindings=c,f&&(this.serializers=f,this._serialize=g),h&&(this._logEvent=aD([].concat(a._logEvent.bindings,c)))}i.prototype=this;let l=new i(this);return az(this,l),l.child=function(...a){return r.call(this,b,...a)},l.level=d.level||this.level,b.onChild(l),l}return f=a.customLevels||{},p.levels={values:Object.assign({},aA.levels.values,f),labels:Object.assign({},aA.levels.labels,(g={},Object.keys(d=f).forEach(function(a){g[d[a]]=a}),g))},p.level=o,p.isLevelEnabled=function(a){return!!this.levels.values[a]&&this.levels.values[a]>=this.levels.values[this.level]},p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=aH,p.serializers=j,p._serialize=k,p._stdErrSerialize=l,p.child=function(...a){return r.call(this,q,...a)},h&&(p._logEvent=aD()),p}function aB(a,b,c,d){var e,f,g,h,i,j,k;if(Object.defineProperty(a,d,{value:av(a.level,c)>av(d,c)?aH:c[aw][d],writable:!0,enumerable:!0,configurable:!0}),a[d]===aH){if(!b.transmit)return;let e=av(b.transmit.level||a.level,c);if(av(d,c)<e)return}a[d]=(e=a,f=b,g=c,h=d,i=e[aw][h],function(){let a=f.timestamp(),b=Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===au?au:this;for(var d=0;d<b.length;d++)b[d]=arguments[d];var j=!1;if(f.serialize&&(aC(b,this._serialize,this.serializers,this._stdErrSerialize),j=!0),f.asObject||f.formatters?i.call(c,...function(a,b,c,d,e){let{level:f,log:g=a=>a}=e.formatters||{},h=c.slice(),i=h[0],j={},k=(0|a._childLevel)+1;if((k<1&&(k=1),d&&(j.time=d),f)?Object.assign(j,f(b,a.levels.values[b])):j.level=a.levels.values[b],e.asObjectBindingsOnly){if(null!==i&&"object"==typeof i)for(;k--&&"object"==typeof h[0];)Object.assign(j,h.shift());return[g(j),...h]}if(null!==i&&"object"==typeof i){for(;k--&&"object"==typeof h[0];)Object.assign(j,h.shift());i=h.length?at(h.shift(),h):void 0}else"string"==typeof i&&(i=at(h.shift(),h));return void 0!==i&&(j[e.messageKey]=i),[g(j)]}(this,h,b,a,f)):i.apply(c,b),f.transmit){let c=f.transmit.level||e._level,d=av(c,g),i=av(h,g);if(i<d)return;!function(a,b,c,d=!1){let e=b.send,f=b.ts,g=b.methodLevel,h=b.methodValue,i=b.val,j=a._logEvent.bindings;d||aC(c,a._serialize||Object.keys(a.serializers),a.serializers,void 0===a._stdErrSerialize||a._stdErrSerialize),a._logEvent.ts=f,a._logEvent.messages=c.filter(function(a){return -1===j.indexOf(a)}),a._logEvent.level.label=g,a._logEvent.level.value=h,e(g,a._logEvent,i),a._logEvent=aD(j)}(this,{ts:a,methodLevel:h,methodValue:i,transmitLevel:c,transmitValue:g.levels.values[f.transmit.level||e._level],send:f.transmit.send,val:av(e._level,g)},b,j)}});let l=function(a){let b=[];a.bindings&&b.push(a.bindings);let c=a[ax];for(;c.parent;)(c=c.parent).logger.bindings&&b.push(c.logger.bindings);return b.reverse()}(a);0!==l.length&&(a[d]=(j=l,k=a[d],function(){return k.apply(this,[...j,...arguments])}))}function aC(a,b,c,d){for(let e in a)if(d&&a[e]instanceof Error)a[e]=aA.stdSerializers.err(a[e]);else if("object"==typeof a[e]&&!Array.isArray(a[e])&&b)for(let d in a[e])b.indexOf(d)>-1&&d in c&&(a[e][d]=c[d](a[e][d]))}function aD(a){return{ts:0,messages:[],bindings:a||[],level:{label:"",value:0}}}function aE(a){let b={type:a.constructor.name,msg:a.message,stack:a.stack};for(let c in a)void 0===b[c]&&(b[c]=a[c]);return b}function aF(){return{}}function aG(a){return a}function aH(){}function aI(){return!1}function aJ(){return Date.now()}aA.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},aA.stdSerializers={mapHttpRequest:aF,mapHttpResponse:aF,wrapRequestSerializer:aG,wrapResponseSerializer:aG,wrapErrorSerializer:aG,req:aF,res:aF,err:aE,errWithCause:aE},aA.stdTimeFunctions=Object.assign({},{nullTime:aI,epochTime:aJ,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),ar.exports.default=aA,ar.exports.pino=aA;let aK="custom_context";var aL=Object.defineProperty,aM=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?aL(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class aN{constructor(a){aM(this,"nodeValue"),aM(this,"sizeInBytes"),aM(this,"next"),this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class aO{constructor(a){aM(this,"lengthInNodes"),aM(this,"sizeInBytes"),aM(this,"head"),aM(this,"tail"),aM(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new aN(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}function aP(a){return"string"==typeof a?a:JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString()+"n":b)||""}var aQ=Object.defineProperty,aR=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?aQ(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class aS{constructor(a,b=1024e3){aR(this,"logs"),aR(this,"level"),aR(this,"levelValue"),aR(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=a??"error",this.levelValue=ar.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new aO(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===ar.exports.levels.values.error?console.error(a):b===ar.exports.levels.values.warn?console.warn(a):b===ar.exports.levels.values.debug?console.debug(a):b===ar.exports.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append(aP({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new aO(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push(aP({extraMetadata:a})),new Blob(b,{type:"application/json"})}}var aT=Object.defineProperty;class aU{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?aT(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new aS(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var aV=Object.defineProperty,aW=Object.defineProperties,aX=Object.getOwnPropertyDescriptors,aY=Object.getOwnPropertySymbols,aZ=Object.prototype.hasOwnProperty,a$=Object.prototype.propertyIsEnumerable,a_=(a,b,c)=>b in a?aV(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,a0=(a,b)=>{for(var c in b||(b={}))aZ.call(b,c)&&a_(a,c,b[c]);if(aY)for(var c of aY(b))a$.call(b,c)&&a_(a,c,b[c]);return a};function a1(a,b=aK){return a[b]||""}function a2(a,b,c=aK){let d=function(a,b,c=aK){let d=a1(a,c);return d.trim()?`${d}/${b}`:b}(a,b,c);return function(a,b,c=aK){return a[c]=b,a}(a.child({context:d}),d,c)}function a3(a){var b;let c;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:(c=new aU(null==(b=a.opts)?void 0:b.level,a.maxSizeInBytes),{logger:ar.exports(aW(a0({},a.opts),aX({level:"trace"})),c),chunkLoggerController:c})}var a4=Object.defineProperty,a5=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?a4(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class a6 extends N{constructor(a){super(),this.opts=a,a5(this,"protocol","wc"),a5(this,"version",2)}}var a7=Object.defineProperty;class a8 extends N{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?a7(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class a9{constructor(a,b){this.logger=a,this.core=b}}class ba extends N{constructor(a,b){super(),this.relayer=a,this.logger=b}}class bb extends N{constructor(a){super()}}class bc{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class bd extends N{constructor(a,b){super(),this.relayer=a,this.logger=b}}class be extends N{constructor(a,b){super(),this.core=a,this.logger=b}}class bf{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class bg{constructor(a,b){this.projectId=a,this.logger=b}}class bh{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}var bi=Object.defineProperty,bj=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?bi(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};L.default;class bk{constructor(a){this.opts=a,bj(this,"protocol","wc"),bj(this,"version",2)}}L.EventEmitter;class bl{constructor(a){this.client=a}}function bm(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function bn(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}let bo="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,bp=a=>new DataView(a.buffer,a.byteOffset,a.byteLength);function bq(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),bm(a),a}class br{clone(){return this._cloneInto()}}function bs(a=32){if(bo&&"function"==typeof bo.getRandomValues)return bo.getRandomValues(new Uint8Array(a));if(bo&&"function"==typeof bo.randomBytes)return bo.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}class bt extends br{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=bp(this.buffer)}update(a){bn(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=bq(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=bp(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){bn(this),function(a,b){bm(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=bp(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let bu=BigInt(0x100000000-1),bv=BigInt(32),bw=(a,b,c)=>a>>>c,bx=(a,b,c)=>a<<32-c|b>>>c,by=(a,b,c)=>a>>>c|b<<32-c,bz=(a,b,c)=>a<<32-c|b>>>c,bA=(a,b,c)=>a<<64-c|b>>>c-32,bB=(a,b,c)=>a>>>c-32|b<<64-c,bC=function(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}},bD=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),bE=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,bF=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),bG=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,bH=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,bI=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),[bJ,bK]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&bu),l:Number(a>>bv&bu)}:{h:0|Number(a>>bv&bu),l:0|Number(a&bu)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),bL=new Uint32Array(80),bM=new Uint32Array(80);class bN extends bt{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)bL[c]=a.getUint32(b),bM[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|bL[a-15],c=0|bM[a-15],d=by(b,c,1)^by(b,c,8)^bw(b,c,7),e=bz(b,c,1)^bz(b,c,8)^bx(b,c,7),f=0|bL[a-2],g=0|bM[a-2],h=by(f,g,19)^bA(f,g,61)^bw(f,g,6),i=bF(e,bz(f,g,19)^bB(f,g,61)^bx(f,g,6),bM[a-7],bM[a-16]),j=bG(i,d,h,bL[a-7],bL[a-16]);bL[a]=0|j,bM[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=by(k,l,14)^by(k,l,18)^bA(k,l,41),s=bz(k,l,14)^bz(k,l,18)^bB(k,l,41),t=k&m^~k&o,u=bI(r,s,l&n^~l&p,bK[a],bM[a]),v=bH(u,q,b,t,bJ[a],bL[a]),w=0|u,x=by(c,d,28)^bA(c,d,34)^bA(c,d,39),y=bz(c,d,28)^bB(c,d,34)^bB(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=bC(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=bD(w,y,A);c=bE(B,v,x,z),d=0|B}({h:c,l:d}=bC(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=bC(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=bC(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=bC(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=bC(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=bC(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=bC(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=bC(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){bL.fill(0),bM.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let bO=(p=()=>new bN,(c=a=>p().update(bq(a)).digest()).outputLen=(d=p()).outputLen,c.blockLen=d.blockLen,c.create=()=>p(),c),bP=BigInt(0),bQ=BigInt(1),bR=BigInt(2);function bS(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function bT(a){if(!bS(a))throw Error("Uint8Array expected")}function bU(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let bV=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bW(a){bT(a);let b="";for(let c=0;c<a.length;c++)b+=bV[a[c]];return b}function bX(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?bP:BigInt("0x"+a)}function bY(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function bZ(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=bY(a.charCodeAt(e)),f=bY(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function b$(a){return bT(a),bX(bW(Uint8Array.from(a).reverse()))}function b_(a,b){return bZ(a.toString(16).padStart(2*b,"0"))}function b0(a,b){return b_(a,b).reverse()}function b1(a,b,c){let d;if("string"==typeof b)try{d=bZ(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(bS(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function b2(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];bT(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let b3=a=>"bigint"==typeof a&&bP<=a;function b4(a,b,c,d){if(!(b3(b)&&b3(c)&&b3(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let b5={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||bS(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function b6(a,b,c={}){let d=(b,c,d)=>{let e=b5[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function b7(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let b8=BigInt(0),b9=BigInt(1),ca=BigInt(2),cb=BigInt(3),cc=BigInt(4),cd=BigInt(5),ce=BigInt(8);function cf(a,b){let c=a%b;return c>=b8?c:b+c}function cg(a,b,c){let d=a;for(;b-- >b8;)d*=d,d%=c;return d}function ch(a,b){if(a===b8)throw Error("invert: expected non-zero number");if(b<=b8)throw Error("invert: expected positive modulus, got "+b);let c=cf(a,b),d=b,e=b8,f=b9;for(;c!==b8;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==b9)throw Error("invert: does not exist");return cf(e,b)}let ci=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cj(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function ck(a,b,c=!1,d={}){let e;if(a<=b8)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=cj(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:(bR<<BigInt(f-1))-bQ,ZERO:b8,ONE:b9,create:b=>cf(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return b8<=b&&b<a},is0:a=>a===b8,isOdd:a=>(a&b9)===b9,neg:b=>cf(-b,a),eql:(a,b)=>a===b,sqr:b=>cf(b*b,a),add:(b,c)=>cf(b+c,a),sub:(b,c)=>cf(b-c,a),mul:(b,c)=>cf(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<b8)throw Error("invalid exponent, negatives unsupported");if(c===b8)return a.ONE;if(c===b9)return b;let d=a.ONE,e=b;for(;c>b8;)c&b9&&(d=a.mul(d,e)),e=a.sqr(e),c>>=b9;return d})(h,a,b),div:(b,c)=>cf(b*ch(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>ch(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%cc===cb){let b=(a+b9)/cc;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%ce===cd){let b=(a-cd)/ce;return function(a,c){let d=a.mul(c,ca),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,ca),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-b9)/ca;for(b=a-b9,c=0;b%ca===b8;b/=ca,c++);for(d=ca;d<a&&function(a,b,c){if(b<b8)throw Error("invalid exponent, negatives unsupported");if(c<=b8)throw Error("invalid modulus");if(c===b9)return b8;let d=b9;for(;b>b8;)b&b9&&(d=d*a%c),a=a*a%c,b>>=b9;return d}(d,e,a)!==a-b9;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+b9)/cc;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+b9)/ca;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,b9<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>{let b,c,d;return b=Array(a.length),c=a.reduce((a,c,d)=>h.is0(c)?a:(b[d]=a,h.mul(a,c)),h.ONE),d=h.inv(c),a.reduceRight((a,c,d)=>h.is0(c)?a:(b[d]=h.mul(a,b[d]),h.mul(a,c)),d),b},cmov:(a,b,c)=>c?b:a,toBytes:a=>c?b0(a,g):b_(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?b$(a):bX(bW(a))}});return Object.freeze(h)}let cl=BigInt(0),cm=BigInt(1);function cn(a,b){let c=b.negate();return a?c:b}function co(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function cp(a,b){return co(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let cq=new WeakMap,cr=new WeakMap;function cs(a){return cr.get(a)||1}let ct=BigInt(0),cu=BigInt(1),cv=BigInt(2),cw=BigInt(8),cx={zip215:!0};BigInt(0),BigInt(1);let cy=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),cz=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let cA=BigInt(1),cB=BigInt(2);BigInt(3);let cC=BigInt(5),cD=BigInt(8),cE=ck(cy,void 0,!0),cF=function(a){var b;let c,d=(b6(a.Fp,ci.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),b6(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),c=Object.freeze({...cj(a.n,a.nBitLength),...a,p:a.Fp.ORDER}),b6(a,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...c})),{Fp:e,n:f,prehash:g,hash:h,randomBytes:i,nByteLength:j,h:k}=d,l=cv<<BigInt(8*j)-cu,m=e.create,n=ck(d.n,d.nBitLength),o=d.uvRatio||((a,b)=>{try{return{isValid:!0,value:e.sqrt(a*e.inv(b))}}catch{return{isValid:!1,value:ct}}}),p=d.adjustScalarBytes||(a=>a),q=d.domain||((a,b,c)=>{if(bU("phflag",c),b.length||c)throw Error("Contexts/pre-hash are not supported");return a});function r(a,b){b4("coordinate "+a,b,ct,l)}function s(a){if(!(a instanceof v))throw Error("ExtendedPoint expected")}let t=b7((a,b)=>{let{ex:c,ey:d,ez:f}=a,g=a.is0();null==b&&(b=g?cw:e.inv(f));let h=m(c*b),i=m(d*b),j=m(f*b);if(g)return{x:ct,y:cu};if(j!==cu)throw Error("invZ was invalid");return{x:h,y:i}}),u=b7(a=>{let{a:b,d:c}=d;if(a.is0())throw Error("bad point: ZERO");let{ex:e,ey:f,ez:g,et:h}=a,i=m(e*e),j=m(f*f),k=m(g*g),l=m(k*k),n=m(i*b);if(m(k*m(n+j))!==m(l+m(c*m(i*j))))throw Error("bad point: equation left != right (1)");if(m(e*f)!==m(g*h))throw Error("bad point: equation left != right (2)");return!0});class v{constructor(a,b,c,d){this.ex=a,this.ey=b,this.ez=c,this.et=d,r("x",a),r("y",b),r("z",c),r("t",d),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(a){if(a instanceof v)throw Error("extended point not allowed");let{x:b,y:c}=a||{};return r("x",b),r("y",c),new v(b,c,cu,m(b*c))}static normalizeZ(a){let b=e.invertBatch(a.map(a=>a.ez));return a.map((a,c)=>a.toAffine(b[c])).map(v.fromAffine)}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=function(a){let b;for(b=0;a>bP;a>>=bQ,b+=1);return b}(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(v,n,a,b)}_setWindowSize(a){y.setWindowSize(this,a)}assertValidity(){u(this)}equals(a){s(a);let{ex:b,ey:c,ez:d}=this,{ex:e,ey:f,ez:g}=a,h=m(b*g),i=m(e*d),j=m(c*g),k=m(f*d);return h===i&&j===k}is0(){return this.equals(v.ZERO)}negate(){return new v(m(-this.ex),this.ey,this.ez,m(-this.et))}double(){let{a:a}=d,{ex:b,ey:c,ez:e}=this,f=m(b*b),g=m(c*c),h=m(cv*m(e*e)),i=m(a*f),j=b+c,k=m(m(j*j)-f-g),l=i+g,n=l-h,o=i-g,p=m(k*n),q=m(l*o),r=m(k*o);return new v(p,q,m(n*l),r)}add(a){s(a);let{a:b,d:c}=d,{ex:e,ey:f,ez:g,et:h}=this,{ex:i,ey:j,ez:k,et:l}=a;if(b===BigInt(-1)){let a=m((f-e)*(j+i)),b=m((f+e)*(j-i)),c=m(b-a);if(c===ct)return this.double();let d=m(g*cv*l),n=m(h*cv*k),o=n+d,p=b+a,q=n-d,r=m(o*c),s=m(p*q),t=m(o*q);return new v(r,s,m(c*p),t)}let n=m(e*i),o=m(f*j),p=m(h*c*l),q=m(g*k),r=m((e+f)*(i+j)-n-o),t=q-p,u=q+p,w=m(o-b*n),x=m(r*t),y=m(u*w),z=m(r*w);return new v(x,y,m(t*u),z)}subtract(a){return this.add(a.negate())}wNAF(a){return y.wNAFCached(this,a,v.normalizeZ)}multiply(a){b4("scalar",a,cu,f);let{p:b,f:c}=this.wNAF(a);return v.normalizeZ([b,c])[0]}multiplyUnsafe(a,b=v.ZERO){return b4("scalar",a,ct,f),a===ct?x:this.is0()||a===cu?this:y.wNAFCachedUnsafe(this,a,v.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(k).is0()}isTorsionFree(){return y.unsafeLadder(this,f).is0()}toAffine(a){return t(this,a)}clearCofactor(){let{h:a}=d;return a===cu?this:this.multiplyUnsafe(a)}static fromHex(a,b=!1){let{d:c,a:f}=d,g=e.BYTES;a=b1("pointHex",a,g),bU("zip215",b);let h=a.slice(),i=a[g-1];h[g-1]=-129&i;let j=b$(h);b4("pointHex.y",j,ct,b?l:e.ORDER);let k=m(j*j),{isValid:n,value:p}=o(m(k-cu),m(c*k-f));if(!n)throw Error("Point.fromHex: invalid y coordinate");let q=(p&cu)===cu,r=(128&i)!=0;if(!b&&p===ct&&r)throw Error("Point.fromHex: x=0 and x_0=1");return r!==q&&(p=m(-p)),v.fromAffine({x:p,y:j})}static fromPrivateKey(a){return z(a).point}toRawBytes(){let{x:a,y:b}=this.toAffine(),c=b0(b,e.BYTES);return c[c.length-1]|=a&cu?128:0,c}toHex(){return bW(this.toRawBytes())}}v.BASE=new v(d.Gx,d.Gy,cu,m(d.Gx*d.Gy)),v.ZERO=new v(ct,cu,cu,ct);let{BASE:w,ZERO:x}=v,y=(b=8*j,{constTimeNegate:cn,hasPrecomputes:a=>1!==cs(a),unsafeLadder(a,b,c=v.ZERO){let d=a;for(;b>cl;)b&cm&&(c=c.add(d)),d=d.double(),b>>=cm;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=cp(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=cp(a,b),g=v.ZERO,h=v.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=cm);let l=b+Math.abs(e)-1,m=a%2!=0,n=e<0;0===e?h=h.add(cn(m,c[b])):g=g.add(cn(n,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=v.ZERO){let{windows:f,windowSize:g}=cp(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===cl)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=cm),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=cq.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&cq.set(b,c(d))),d},wNAFCached(a,b,c){let d=cs(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=cs(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){co(c,b),cr.set(a,c),cq.delete(a)}});function z(a){let b=e.BYTES;a=b1("private key",a,b);let c=b1("hashed private key",h(a),2*b),d=p(c.slice(0,b)),g=c.slice(b,2*b),i=cf(b$(d),f),j=w.multiply(i),k=j.toRawBytes();return{head:d,prefix:g,scalar:i,point:j,pointBytes:k}}function A(a=new Uint8Array,...b){return cf(b$(h(q(b2(...b),b1("context",a),!!g))),f)}return w._setWindowSize(8),{CURVE:d,getPublicKey:function(a){return z(a).pointBytes},sign:function(a,b,c={}){a=b1("message",a),g&&(a=g(a));let{prefix:d,scalar:h,pointBytes:i}=z(b),j=A(c.context,d,a),k=w.multiply(j).toRawBytes(),l=cf(j+A(c.context,k,i,a)*h,f);return b4("signature.s",l,ct,f),b1("result",b2(k,b0(l,e.BYTES)),2*e.BYTES)},verify:function(a,b,c,d=cx){let f,h,i,{context:j,zip215:k}=d,l=e.BYTES;a=b1("signature",a,2*l),b=b1("message",b),c=b1("publicKey",c,l),void 0!==k&&bU("zip215",k),g&&(b=g(b));let m=b$(a.slice(l,2*l));try{f=v.fromHex(c,k),h=v.fromHex(a.slice(0,l),k),i=w.multiplyUnsafe(m)}catch{return!1}if(!k&&f.isSmallOrder())return!1;let n=A(j,h.toRawBytes(),f.toRawBytes(),b);return h.add(f.multiplyUnsafe(n)).subtract(i).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:z,randomPrivateKey:()=>i(e.BYTES),precompute:(a=8,b=v.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}}({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:cE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:cD,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:bO,randomBytes:bs,adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},uvRatio:function(a,b){var c;let d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=cf(b*b*b,cy),s=(c=a*cf(r*r*b,cy),d=BigInt(10),e=BigInt(20),f=BigInt(40),g=BigInt(80),i=cg(h=c*c%cy*c%cy,cB,cy)*h%cy,j=cg(i,cA,cy)*c%cy,k=cg(j,cC,cy)*j%cy,l=cg(k,d,cy)*k%cy,m=cg(l,e,cy)*l%cy,n=cg(m,f,cy)*m%cy,o=cg(n,g,cy)*n%cy,p=cg(o,g,cy)*n%cy,q=cg(p,d,cy)*k%cy,{pow_p_5_8:cg(q,cB,cy)*c%cy,b2:h}).pow_p_5_8,t=cf(a*r*s,cy),u=cf(b*t*t,cy),v=t,w=cf(t*cz,cy),x=u===a,y=u===cf(-a,cy),z=u===cf(-a*cz,cy);return x&&(t=v),(y||z)&&(t=w),(cf(t,cy)&b9)===b9&&(t=cf(-t,cy)),{isValid:x||y,value:t}}}),cG="base64url",cH="utf8",cI="utf8",cJ="base58btc";function cK(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function cL(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?cK(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function cM(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=cL(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return cK(c)}var cN=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let cO=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class cP{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class cQ{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return cS(this,a)}}class cR{constructor(a){this.decoders=a}or(a){return cS(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let cS=(a,b)=>new cR({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class cT{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new cP(a,b,c),this.decoder=new cQ(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let cU=({name:a,prefix:b,encode:c,decode:d})=>new cT(a,b,c,d),cV=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=cN(c,b);return cU({prefix:a,name:b,encode:d,decode:a=>cO(e(a))})},cW=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>cU({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var cX=Object.freeze({__proto__:null,identity:cU({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),cY=Object.freeze({__proto__:null,base2:cW({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),cZ=Object.freeze({__proto__:null,base8:cW({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),c$=Object.freeze({__proto__:null,base10:cV({prefix:"9",name:"base10",alphabet:"0123456789"})}),c_=Object.freeze({__proto__:null,base16:cW({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:cW({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),c0=Object.freeze({__proto__:null,base32:cW({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:cW({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:cW({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:cW({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:cW({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:cW({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:cW({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:cW({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:cW({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),c1=Object.freeze({__proto__:null,base36:cV({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:cV({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),c2=Object.freeze({__proto__:null,base58btc:cV({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:cV({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),c3=Object.freeze({__proto__:null,base64:cW({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:cW({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:cW({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:cW({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let c4=Array.from(""),c5=c4.reduce((a,b,c)=>(a[c]=b,a),[]),c6=c4.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var c7=Object.freeze({__proto__:null,base256emoji:cU({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=c5[b],"")},decode:function(a){let b=[];for(let c of a){let a=c6[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function c8(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,c8.bytes=c-d+1,b}var c9=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let da=(a,b,c=0)=>(c8(a,b,c),b),db=(a,b)=>{let c=b.byteLength,d=c9(a),e=d+c9(c),f=new Uint8Array(e+c);return da(a,f,0),da(c,f,d),f.set(b,e),new dc(a,c,b,f)};class dc{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let dd=({name:a,code:b,encode:c})=>new de(a,b,c);class de{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?db(this.code,b):b.then(a=>db(this.code,a))}throw Error("Unknown type, must be binary type")}}let df=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var dg=Object.freeze({__proto__:null,sha256:dd({name:"sha2-256",code:18,encode:df("SHA-256")}),sha512:dd({name:"sha2-512",code:19,encode:df("SHA-512")})}),dh=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:cO,digest:a=>db(0,cO(a))}});new TextEncoder,new TextDecoder;let di={...cX,...cY,...cZ,...c$,...c_,...c0,...c1,...c2,...c3,...c7};function dj(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...dg,...dh});let dk=dj("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),dl=dj("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=cL((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),dm={utf8:dk,"utf-8":dk,hex:di.base16,latin1:dl,ascii:dl,binary:dl,...di};function dn(a,b="utf8"){let c=dm[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}function dp(a,b="utf8"){let c=dm[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?cK(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function dq(a){return ag(dn(dp(a,cG),cH))}function dr(a){return dn(dp(ah(a),cH),cG)}function ds(a){return["did:key","z"+dn(cM([dp("K36",cJ),a]),cJ)].join(":")}function dt(a){let b=a.split(".");return{header:dq(b[0]),payload:dq(b[1]),signature:dp(b[2],cG),data:dp(b.slice(0,2).join("."),cI)}}function du(a=bs(32)){let b=cF.getPublicKey(a);return{secretKey:cM([a,b]),publicKey:b}}async function dv(a,b,c,d,e=(0,M.fromMiliseconds)(Date.now())){let f={alg:"EdDSA",typ:"JWT"},g={iss:ds(d.publicKey),sub:a,aud:b,iat:e,exp:e+c},h=dp([dr((i={header:f,payload:g}).header),dr(i.payload)].join("."),cI);var i,j={header:f,payload:g,signature:cF.sign(h,d.secretKey.slice(0,32))};return[dr(j.header),dr(j.payload),dn(j.signature,cG)].join(".")}var dw=function(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))},dx=function(a,b,c){this.name=a,this.version=b,this.os=c,this.type="browser"},dy=function(a){this.version=a,this.type="node",this.name="node",this.os=process.platform},dz=function(a,b,c,d){this.name=a,this.version=b,this.os=c,this.bot=d,this.type="bot-device"},dA=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},dB=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},dC=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,dD=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],dE=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]],dF=a.i(79628),dG=a.i(41721),dH=a.i(16148),dI=a.i(77832),dJ=a.i(57162);let dK=BigInt(0),dL=BigInt(1);function dM(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function dN(a){if(!dM(a))throw Error("Uint8Array expected")}function dO(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function dP(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function dQ(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?dK:BigInt("0x"+a)}let dR="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,dS=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function dT(a){if(dN(a),dR)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=dS[a[c]];return b}function dU(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function dV(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(dR)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=dU(a.charCodeAt(e)),f=dU(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function dW(a){return dQ(dT(a))}function dX(a){return dN(a),dQ(dT(Uint8Array.from(a).reverse()))}function dY(a,b){return dV(a.toString(16).padStart(2*b,"0"))}function dZ(a,b){return dY(a,b).reverse()}function d$(a,b,c){let d;if("string"==typeof b)try{d=dV(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(dM(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function d_(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];dN(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let d0=a=>"bigint"==typeof a&&dK<=a;function d1(a,b,c){return d0(a)&&d0(b)&&d0(c)&&b<=a&&a<c}function d2(a,b,c,d){if(!d1(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let d3=a=>(dL<<BigInt(a))-dL,d4=a=>new Uint8Array(a),d5={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||dM(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function d6(a,b,c={}){let d=(b,c,d)=>{let e=d5[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function d7(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let d8=BigInt(0),d9=BigInt(1),ea=BigInt(2),eb=BigInt(3),ec=BigInt(4),ed=BigInt(5),ee=BigInt(8);function ef(a,b){let c=a%b;return c>=d8?c:b+c}function eg(a,b,c){let d=a;for(;b-- >d8;)d*=d,d%=c;return d}function eh(a,b){if(a===d8)throw Error("invert: expected non-zero number");if(b<=d8)throw Error("invert: expected positive modulus, got "+b);let c=ef(a,b),d=b,e=d8,f=d9,g=d9,h=d8;for(;c!==d8;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==d9)throw Error("invert: does not exist");return ef(e,b)}function ei(a,b){let c=(a.ORDER+d9)/ec,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function ej(a,b){let c=(a.ORDER-ed)/ee,d=a.mul(b,ea),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,ea),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let ek=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function el(a){return d6(a,ek.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function em(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function en(a,b){let c=(a.ORDER-d9)/ea,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function eo(a,b){void 0!==b&&(0,dI.anumber)(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function ep(a,b,c=!1,d={}){let e;if(a<=d8)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=eo(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:d3(f),ZERO:d8,ONE:d9,create:b=>ef(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return d8<=b&&b<a},is0:a=>a===d8,isOdd:a=>(a&d9)===d9,neg:b=>ef(-b,a),eql:(a,b)=>a===b,sqr:b=>ef(b*b,a),add:(b,c)=>ef(b+c,a),sub:(b,c)=>ef(b-c,a),mul:(b,c)=>ef(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<d8)throw Error("invalid exponent, negatives unsupported");if(c===d8)return a.ONE;if(c===d9)return b;let d=a.ONE,e=b;for(;c>d8;)c&d9&&(d=a.mul(d,e)),e=a.sqr(e),c>>=d9;return d})(h,a,b),div:(b,c)=>ef(b*eh(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>eh(b,a),sqrt:d.sqrt||(b=>(e||(e=a%ec===eb?ei:a%ee===ed?ej:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-d9,c=0;for(;b%ea===d8;)b/=ea,c++;let d=ea,e=ep(a);for(;1===en(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return ei;let f=e.pow(d,b),g=(b+d9)/ea;return function(a,d){if(a.is0(d))return d;if(1!==en(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=d9<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),e(h,b))),toBytes:a=>c?dZ(a,g):dY(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?dX(a):dW(a)},invertBatch:a=>em(h,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(h)}function eq(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function er(a){let b=eq(a);return b+Math.ceil(b/2)}let es=BigInt(0),et=BigInt(1);function eu(a,b){let c=b.negate();return a?c:b}function ev(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function ew(a,b){ev(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:d3(a),maxNumber:e,shiftBy:BigInt(a)}}function ex(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=et);let j=b*d,k=j+Math.abs(h)-1,l=0===h;return{nextN:i,offset:k,isZero:l,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let ey=new WeakMap,ez=new WeakMap;function eA(a){return ez.get(a)||1}function eB(a){return el(a.Fp),d6(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...eo(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}function eC(a){void 0!==a.lowS&&dO("lowS",a.lowS),void 0!==a.prehash&&dO("prehash",a.prehash)}let eD={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=eD;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=dP(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?dP(e.length/2|128):"";return dP(a)+f+e+b},decode(a,b){let{Err:c}=eD,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=eD;if(a<eE)throw new b("integer: negative integers are not allowed");let c=dP(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=eD;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return dW(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=eD,e=d$("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=eD,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},eE=BigInt(0),eF=BigInt(1),eG=BigInt(2),eH=BigInt(3),eI=BigInt(4),eJ=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),eK=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),eL=BigInt(0),eM=BigInt(1),eN=BigInt(2),eO=(a,b)=>(a+b/eN)/b,eP=ep(eJ,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%eJ,j=i*i*a%eJ,k=eg(j,b,eJ)*j%eJ,l=eg(k,b,eJ)*j%eJ,m=eg(l,eN,eJ)*i%eJ,n=eg(m,d,eJ)*m%eJ,o=eg(n,e,eJ)*n%eJ,p=eg(o,g,eJ)*o%eJ,q=eg(p,h,eJ)*p%eJ,r=eg(q,g,eJ)*o%eJ,s=eg(r,b,eJ)*j%eJ,t=eg(s,f,eJ)*n%eJ,u=eg(t,c,eJ)*i%eJ,v=eg(u,eN,eJ);if(!eP.eql(eP.sqr(v),a))throw Error("Cannot find square root");return v}}),eQ=(q={a:eL,b:BigInt(7),Fp:eP,n:eK,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-eM*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=eO(b*a,eK),g=eO(-c*a,eK),h=ef(a-f*b-g*d,eK),i=ef(-f*c-g*b,eK),j=h>e,k=i>e;if(j&&(h=eK-h),k&&(i=eK-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},r=dH.sha256,{...(e=a=>(function(a){let b,c=(d6(b=eB(a),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e,nByteLength:f,nBitLength:g}=c,h=d.BYTES+1,i=2*d.BYTES+1;function j(a){return ef(a,e)}let{ProjectivePoint:k,normPrivateKeyToScalar:l,weierstrassEquation:m,isWithinCurveOrder:n}=function(a){var b;let c=function(a){let b=eB(a);d6(b,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...b})}(a),{Fp:d}=c,e=ep(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return d_(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}function i(a,b){let c=d.sqr(b),e=h(a);return d.eql(c,e)}if(!i(c.Gx,c.Gy))throw Error("bad curve params: generator point");let j=d.mul(d.pow(c.a,eH),eI),k=d.mul(d.sqr(c.b),BigInt(27));if(d.is0(d.add(j,k)))throw Error("bad curve params: a or b");function l(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(dM(a)&&(a=dT(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:dW(d$("private key",a,e))}catch(b){throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=ef(b,g)),d2("private key",b,eF,g),b}function m(a){if(!(a instanceof p))throw Error("ProjectivePoint expected")}let n=d7((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),o=d7(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");if(!i(b,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class p{constructor(a,b,c){if(null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b)||d.is0(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");this.px=a,this.py=b,this.pz=c,Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof p)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?p.ZERO:new p(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=em(d,a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(p.fromAffine)}static fromHex(a){let b=p.fromAffine(g(d$("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return p.BASE.multiply(l(a))}static msm(a,b){return function(a,b,c,d){if(!Array.isArray(c))throw Error("array expected");c.forEach((b,c)=>{if(!(b instanceof a))throw Error("invalid point at index "+c)});if(!Array.isArray(d))throw Error("array of scalars expected");d.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)});let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>dK;a>>=dL,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=d3(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(p,e,a,b)}_setWindowSize(a){s.setWindowSize(this,a)}assertValidity(){o(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){m(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new p(this.px,d.neg(this.py),this.pz)}double(){let{a,b}=c,e=d.mul(b,eH),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(f,g);return o=d.add(o,o),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(e,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new p(i,j,k=d.add(k,k))}add(a){m(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,n=c.a,o=d.mul(c.b,eH),q=d.mul(b,g),r=d.mul(e,h),s=d.mul(f,i),t=d.add(b,e),u=d.add(g,h);t=d.mul(t,u),u=d.add(q,r),t=d.sub(t,u),u=d.add(b,f);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(q,s),u=d.sub(u,v),v=d.add(e,f),j=d.add(h,i),v=d.mul(v,j),j=d.add(r,s),v=d.sub(v,j),l=d.mul(n,u),j=d.mul(o,s),l=d.add(j,l),j=d.sub(r,l),l=d.add(r,l),k=d.mul(j,l),r=d.add(q,q),r=d.add(r,q),s=d.mul(n,s),u=d.mul(o,u),r=d.add(r,s),s=d.sub(q,s),s=d.mul(n,s),u=d.add(u,s),q=d.mul(r,u),k=d.add(k,q),q=d.mul(v,u),j=d.mul(t,j),j=d.sub(j,q),q=d.mul(t,r),l=d.mul(v,l),new p(j,k,l=d.add(l,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(p.ZERO)}wNAF(a){return s.wNAFCached(this,a,p.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;d2("scalar",a,eE,e);let f=p.ZERO;if(a===eE)return f;if(this.is0()||a===eF)return this;if(!b||s.hasPrecomputes(this))return s.wNAFCachedUnsafe(this,a,p.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,m=this;for(;h>eE||j>eE;)h&eF&&(k=k.add(m)),j&eF&&(l=l.add(m)),m=m.double(),h>>=eF,j>>=eF;return g&&(k=k.negate()),i&&(l=l.negate()),l=new p(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(d2("scalar",a,eF,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=s.constTimeNegate(c,j),l=s.constTimeNegate(h,l),l=new p(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(m)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return p.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=p.BASE,e=(a,b)=>b!==eE&&b!==eF&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return n(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===eF)return!0;if(b)return b(p,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===eF?this:b?b(p,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return dO("isCompressed",a),this.assertValidity(),f(p,this,a)}toHex(a=!0){return dO("isCompressed",a),dT(this.toRawBytes(a))}}p.BASE=new p(c.Gx,c.Gy,d.ONE),p.ZERO=new p(d.ZERO,d.ONE,d.ZERO);let{endo:q,nBitLength:r}=c,s=(b=q?Math.ceil(r/2):r,{constTimeNegate:eu,hasPrecomputes:a=>1!==eA(a),unsafeLadder(a,b,c=p.ZERO){let d=a;for(;b>es;)b&et&&(c=c.add(d)),d=d.double(),b>>=et;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=ew(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let e=p.ZERO,f=p.BASE,g=ew(a,b);for(let a=0;a<g.windows;a++){let{nextN:b,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=ex(d,a,g);d=b,i?f=f.add(eu(k,c[l])):e=e.add(eu(j,c[h]))}return{p:e,f}},wNAFUnsafe(a,c,d,e=p.ZERO){let f=ew(a,b);for(let a=0;a<f.windows&&d!==es;a++){let{nextN:b,offset:g,isZero:h,isNeg:i}=ex(d,a,f);if(d=b,!h){let a=c[g];e=e.add(i?a.negate():a)}}return e},getPrecomputes(a,b,c){let d=ey.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&ey.set(b,c(d))),d},wNAFCached(a,b,c){let d=eA(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=eA(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){ev(c,b),ez.set(a,c),ey.delete(a)}});return{CURVE:c,ProjectivePoint:p,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:function(a){return d1(a,eF,c.n)}}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x);return(dO("isCompressed",c),c)?d_(Uint8Array.from([b.hasEvenY()?2:3]),f):d_(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===h&&(2===c||3===c)){let a,b=dW(e);if(!d1(b,eF,d.ORDER))throw Error("Point is not on curve");let f=m(b);try{a=d.sqrt(f)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&c)==1!=((a&eF)===eF)&&(a=d.neg(a)),{x:b,y:a}}if(b===i&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+i+", got "+b)}}),o=(a,b,c)=>dW(a.slice(b,c));class p{constructor(a,b,c){d2("r",a,eF,e),d2("s",b,eF,e),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){return new p(o(a=d$("compactSignature",a,2*f),0,f),o(a,f,2*f))}static fromDER(a){let{r:b,s:c}=eD.toSig(d$("DER",a));return new p(b,c)}assertValidity(){}addRecoveryBit(a){return new p(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,h=s(d$("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let i=2===g||3===g?b+c.n:b;if(i>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",m=k.fromHex(l+dT(dY(i,d.BYTES))),n=eh(i,e),o=j(-h*n),p=j(f*n),q=k.BASE.multiplyAndAddUnsafe(m,o,p);if(!q)throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>e>>eF}normalizeS(){return this.hasHighS()?new p(this.r,j(-this.s),this.recovery):this}toDERRawBytes(){return dV(this.toDERHex())}toDERHex(){return eD.hexFromSig(this)}toCompactRawBytes(){return dV(this.toCompactHex())}toCompactHex(){return dT(dY(this.r,f))+dT(dY(this.s,f))}}function q(a){if("bigint"==typeof a)return!1;if(a instanceof k)return!0;let b=d$("key",a).length,e=d.BYTES,g=e+1;if(!c.allowedPrivateKeyLengths&&f!==g)return b===g||b===2*e+1}let r=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=dW(a),c=8*a.length-g;return c>0?b>>BigInt(c):b},s=c.bits2int_modN||function(a){return j(r(a))},t=d3(g);function u(a){return d2("num < 2^"+g,a,eE,t),dY(a,f)}let v={lowS:c.lowS,prehash:!1},w={lowS:c.lowS,prehash:!1};return k.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return k.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(!0===q(a))throw Error("first arg must be private key");if(!1===q(b))throw Error("second arg must be public key");return k.fromHex(b).multiply(l(a)).toRawBytes(c)},sign:function(a,b,f=v){let{seed:g,k2sig:h}=function(a,b,f=v){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:h}=c,{lowS:i,prehash:m,extraEntropy:o}=f;null==i&&(i=!0),a=d$("msgHash",a),eC(f),m&&(a=d$("prehashed msgHash",g(a)));let q=s(a),t=l(b),w=[u(t),u(q)];if(null!=o&&!1!==o){let a=!0===o?h(d.BYTES):o;w.push(d$("extraEntropy",a))}return{seed:d_(...w),k2sig:function(a){var b;let c=r(a);if(!n(c))return;let d=eh(c,e),f=k.BASE.multiply(c).toAffine(),g=j(f.x);if(g===eE)return;let h=j(d*j(q+g*t));if(h===eE)return;let l=2*(f.x!==g)|Number(f.y&eF),m=h;return i&&h>e>>eF&&(m=(b=h)>e>>eF?j(-b):b,l^=1),new p(g,m,l)}}}(a,b,f);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=d4(a),e=d4(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=d4(0))=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return d_(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}})(c.hash.outputLen,c.nByteLength,c.hmac)(g,h)},verify:function(a,b,d,f=w){let g,h;b=d$("msgHash",b),d=d$("publicKey",d);let{lowS:i,prehash:l,format:m}=f;if(eC(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let n="string"==typeof a||dM(a),o=!n&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!n&&!o)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(o&&(h=new p(a.r,a.s)),n){try{"compact"!==m&&(h=p.fromDER(a))}catch(a){if(!(a instanceof eD.Err))throw a}h||"der"===m||(h=p.fromCompact(a))}g=k.fromHex(d)}catch(a){return!1}if(!h||i&&h.hasHighS())return!1;l&&(b=c.hash(b));let{r:q,s:r}=h,t=s(b),u=eh(r,e),v=j(t*u),x=j(q*u),y=k.BASE.multiplyAndAddUnsafe(g,v,x)?.toAffine();return!!y&&j(y.x)===q},ProjectivePoint:k,Signature:p,utils:{isValidPrivateKey(a){try{return l(a),!0}catch(a){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let a=er(c.n);return function(a,b,c=!1){let d=a.length,e=eq(b),f=er(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=ef(c?dX(a):dW(a),b-d9)+d9;return c?dZ(g,e):dY(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=k.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...q,...{hash:a,hmac:(b,...c)=>(0,dJ.hmac)(a,b,(0,dI.concatBytes)(...c)),randomBytes:dI.randomBytes}}))(r),create:e});eQ.ProjectivePoint;let eR=(f=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(a=>a.map(a=>BigInt(a))).map(a=>Array.from(a).reverse()),(a,b)=>{let[c,d,e,g]=f.map(b=>b.reduce((b,c)=>eP.add(eP.mul(b,a),c))),[h,i]=em(eP,[d,g],!0);return a=eP.mul(c,h),b=eP.mul(b,eP.mul(e,i)),{x:a,y:b}}),eS=function(a,b){if(el(a),!a.isValid(b.A)||!a.isValid(b.B)||!a.isValid(b.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let c=function(a,b){let c=a.ORDER,d=eE;for(let a=c-eF;a%eG===eE;a/=eG)d+=eF;let e=d,f=eG<<e-eF-eF,g=f*eG,h=(c-eF)/g,i=(h-eF)/eG,j=g-eF,k=a.pow(b,h),l=a.pow(b,(h+eF)/eG),m=(b,c)=>{let d=k,g=a.pow(c,j),h=a.sqr(g);h=a.mul(h,c);let m=a.mul(b,h);m=a.pow(m,i),m=a.mul(m,g),g=a.mul(m,c),h=a.mul(m,b);let n=a.mul(h,g);m=a.pow(n,f);let o=a.eql(m,a.ONE);g=a.mul(h,l),m=a.mul(n,d),h=a.cmov(g,h,o),n=a.cmov(m,n,o);for(let b=e;b>eF;b--){let c=b-eG;c=eG<<c-eF;let e=a.pow(n,c),f=a.eql(e,a.ONE);g=a.mul(h,d),d=a.mul(d,d),e=a.mul(n,d),h=a.cmov(g,h,f),n=a.cmov(e,n,f)}return{isValid:o,value:h}};if(a.ORDER%eI===eH){let c=(a.ORDER-eH)/eI,d=a.sqrt(a.neg(b));m=(b,e)=>{let f=a.sqr(e),g=a.mul(b,e);f=a.mul(f,g);let h=a.pow(f,c);h=a.mul(h,g);let i=a.mul(h,d),j=a.mul(a.sqr(h),e),k=a.eql(j,b),l=a.cmov(i,h,k);return{isValid:k,value:l}}}return m}(a,b.Z);if(!a.isOdd)throw Error("Fp.isOdd is not implemented!");return d=>{let e,f,g,h,i,j,k,l;e=a.sqr(d),e=a.mul(e,b.Z),f=a.sqr(e),f=a.add(f,e),g=a.add(f,a.ONE),g=a.mul(g,b.B),h=a.cmov(b.Z,a.neg(f),!a.eql(f,a.ZERO)),h=a.mul(h,b.A),f=a.sqr(g),j=a.sqr(h),i=a.mul(j,b.A),f=a.add(f,i),f=a.mul(f,g),j=a.mul(j,h),i=a.mul(j,b.B),f=a.add(f,i),k=a.mul(e,g);let{isValid:m,value:n}=c(f,j);l=a.mul(e,d),l=a.mul(l,n),k=a.cmov(k,g,m),l=a.cmov(l,n,m);let o=a.isOdd(d)===a.isOdd(l);l=a.cmov(a.neg(l),l,o);let p=em(a,[h],!0)[0];return{x:k=a.mul(k,p),y:l}}}(eP,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:eP.create(BigInt("-11"))});!function(a,b,c){if("function"!=typeof b)throw Error("mapToCurve() must be defined")}(eQ.ProjectivePoint,a=>{let{x:b,y:c}=eS(eP.create(a[0]));return eR(b,c)},(eP.ORDER,dH.sha256));class eT extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof eT){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof eT&&b.cause.docsPath||b.docsPath,e=`https://oxlib.sh${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d?["",c?`Details: ${c}`:void 0,d?`See: ${e}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=b.cause,this.details=c,this.docs=e,this.docsPath=d,this.shortMessage=a}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function eU(a,b){if(e2(a)>b)throw new e7({givenSize:e2(a),maxSize:b})}function eV(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new e9({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function eW(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let eX=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function eY(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}function eZ(a){return a instanceof Uint8Array?e$(a):Array.isArray(a)?e$(new Uint8Array(a)):a}function e$(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=eX[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(eU(d,b.size),e0(d,b.size)):d}function e_(a,b={}){var c;let d,{signed:e,size:f}=b,g=BigInt(a);f?d=e?(1n<<8n*BigInt(f)-1n)-1n:2n**(8n*BigInt(f))-1n:"number"==typeof a&&(d=BigInt(Number.MAX_SAFE_INTEGER));let h="bigint"==typeof d&&e?-d-1n:0;if(d&&g>d||g<h){let b="bigint"==typeof a?"n":"";throw new e4({max:d?`${d}${b}`:void 0,min:`${h}${b}`,signed:e,size:f,value:`${a}${b}`})}let i=(e&&g<0?(1n<<BigInt(8*f))+BigInt(g):g).toString(16),j=`0x${i}`;return f?(c=j,eV(c,{dir:"left",size:f})):j}function e0(a,b){return eV(a,{dir:"right",size:b})}function e1(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>e2(a)-1)throw new e8({offset:b,position:"start",size:e2(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&e2(a)!==c-b)throw new e8({offset:c,position:"end",size:e2(a)})}(f,b,c),f}function e2(a){return Math.ceil((a.length-2)/2)}function e3(a){return function(a,b={}){let{dir:c="left"}=b,d=a.replace("0x",""),e=0;for(let a=0;a<d.length-1;a++)if("0"===d["left"===c?a:d.length-a-1].toString())e++;else break;return"0"===(d="left"===c?d.slice(e):d.slice(0,d.length-e))?"0x":"right"===c&&d.length%2==1?`0x${d}0`:`0x${d}`}(a,{dir:"left"})}class e4 extends eT{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class e5 extends eT{constructor(a){super(`Value \`${"object"==typeof a?eW(a):a}\` of type \`${typeof a}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class e6 extends eT{constructor(a){super(`Value \`${a}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class e7 extends eT{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class e8 extends eT{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class e9 extends eT{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function fa(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}let fb=new TextEncoder;function fc(a){var b;return a instanceof Uint8Array?a:"string"==typeof a?fd(a):(b=a)instanceof Uint8Array?b:new Uint8Array(b)}function fd(a,b={}){let{size:c}=b,d=a;c&&(eU(a,c),d=e0(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=fa(e.charCodeAt(b++)),d=fa(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new eT(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=16*c+d}return g}class fe extends eT{constructor(a){super(`Value \`${"object"==typeof a?eW(a):a}\` of type \`${typeof a}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class ff extends eT{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class fg extends eT{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let fh=2n**256n-1n;function fi(a,b={}){let{recovered:c}=b;if(void 0===a.r||void 0===a.s||c&&void 0===a.yParity)throw new fD({signature:a});if(a.r<0n||a.r>fh)throw new fE({value:a.r});if(a.s<0n||a.s>fh)throw new fF({value:a.s});if("number"==typeof a.yParity&&0!==a.yParity&&1!==a.yParity)throw new fG({value:a.yParity})}function fj(a){return fk(e$(a))}function fk(a){if(130!==a.length&&132!==a.length)throw new fC({signature:a});let b=BigInt(e1(a,0,32)),c=BigInt(e1(a,32,64)),d=(()=>{let b=Number(`0x${a.slice(130)}`);if(!Number.isNaN(b))try{return fA(b)}catch{throw new fG({value:b})}})();return void 0===d?{r:b,s:c}:{r:b,s:c,yParity:d}}function fl(a){if(void 0!==a.r&&void 0!==a.s)return fm(a)}function fm(a){let b="string"==typeof a?fk(a):a instanceof Uint8Array?fj(a):"string"==typeof a.r?fq(a):a.v?fp(a):{r:a.r,s:a.s,...void 0!==a.yParity?{yParity:a.yParity}:{}};return fi(b),b}function fn(a){return fo(e$(a))}function fo(a){let{r:b,s:c}=eQ.Signature.fromDER(eZ(a).slice(2));return{r:b,s:c}}function fp(a){return{r:a.r,s:a.s,yParity:fA(a.v)}}function fq(a){let b=(()=>{let b=a.v?Number(a.v):void 0,c=a.yParity?Number(a.yParity):void 0;if("number"==typeof b&&"number"!=typeof c&&(c=fA(b)),"number"!=typeof c)throw new fG({value:a.yParity});return c})();return{r:BigInt(a.r),s:BigInt(a.s),yParity:b}}function fr(a){let[b,c,d]=a;return fm({r:"0x"===c?0n:BigInt(c),s:"0x"===d?0n:BigInt(d),yParity:"0x"===b?0:Number(b)})}function fs(a){return fd(ft(a))}function ft(a){fi(a);let b=a.r,c=a.s;return eY(e_(b,{size:32}),e_(c,{size:32}),"number"==typeof a.yParity?e_(fB(a.yParity),{size:1}):"0x")}function fu(a){return new eQ.Signature(a.r,a.s).toDERRawBytes()}function fv(a){let b=new eQ.Signature(a.r,a.s);return`0x${b.toDERHex()}`}function fw(a){return{r:a.r,s:a.s,v:fB(a.yParity)}}function fx(a){let{r:b,s:c,yParity:d}=a;return{r:e_(b,{size:32}),s:e_(c,{size:32}),yParity:0===d?"0x0":"0x1"}}function fy(a){let{r:b,s:c,yParity:d}=a;return[d?"0x01":"0x",0n===b?"0x":e3(e_(b)),0n===c?"0x":e3(e_(c))]}function fz(a,b={}){try{return fi(a,b),!0}catch{return!1}}function fA(a){if(0===a||27===a)return 0;if(1===a||28===a)return 1;if(a>=35)return+(a%2==0);throw new fH({value:a})}function fB(a){if(0===a)return 27;if(1===a)return 28;throw new fG({value:a})}class fC extends eT{constructor({signature:a}){super(`Value \`${a}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${e2(eZ(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class fD extends eT{constructor({signature:a}){super(`Signature \`${eW(a)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class fE extends eT{constructor({value:a}){super(`Value \`${a}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class fF extends eT{constructor({value:a}){super(`Value \`${a}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class fG extends eT{constructor({value:a}){super(`Value \`${a}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class fH extends eT{constructor({value:a}){super(`Value \`${a}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}a.s(["InvalidRError",()=>fE,"InvalidSError",()=>fF,"InvalidSerializedSizeError",()=>fC,"InvalidVError",()=>fH,"InvalidYParityError",()=>fG,"MissingPropertiesError",()=>fD,"assert",()=>fi,"extract",()=>fl,"from",()=>fm,"fromBytes",()=>fj,"fromDerBytes",()=>fn,"fromDerHex",()=>fo,"fromHex",()=>fk,"fromLegacy",()=>fp,"fromRpc",()=>fq,"fromTuple",()=>fr,"toBytes",()=>fs,"toDerBytes",()=>fu,"toDerHex",()=>fv,"toHex",()=>ft,"toLegacy",()=>fw,"toRpc",()=>fx,"toTuple",()=>fy,"vToYParity",()=>fA,"validate",()=>fz,"yParityToV",()=>fB],10909);var fI=a.i(10909),fI=fI;class fJ extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let fK={checksum:new fJ(8192)}.checksum;var fL=a.i(93953);function fM(a,b={}){let{as:c="string"==typeof a?"Hex":"Bytes"}=b,d=(0,fL.keccak_256)(fc(a));return"Bytes"===c?d:e$(d)}function fN(a,b={}){let{compressed:c}=b,{prefix:d,x:e,y:f}=a;if(!1===c||"bigint"==typeof e&&"bigint"==typeof f){if(4!==d)throw new fS({prefix:d,cause:new fU});return}if(!0===c||"bigint"==typeof e&&void 0===f){if(3!==d&&2!==d)throw new fS({prefix:d,cause:new fT});return}throw new fR({publicKey:a})}function fO(a){let b=(()=>{if(function(a,b={}){let{strict:c=!1}=b;try{return!function(a,b={}){let{strict:c=!1}=b;if(!a||"string"!=typeof a)throw new e5(a);if(c&&!/^0x[0-9a-fA-F]*$/.test(a)||!a.startsWith("0x"))throw new e6(a)}(a,{strict:c}),!0}catch{return!1}}(a))return fP(a);if(function(a){try{if(!(a instanceof Uint8Array)&&(!a||"object"!=typeof a||!("BYTES_PER_ELEMENT"in a)||1!==a.BYTES_PER_ELEMENT||"Uint8Array"!==a.constructor.name))throw new fe(a);return!0}catch{return!1}}(a))return fP(e$(a));let{prefix:b,x:c,y:d}=a;return"bigint"==typeof c&&"bigint"==typeof d?{prefix:b??4,x:c,y:d}:{prefix:b,x:c}})();return fN(b),b}function fP(a){if(132!==a.length&&130!==a.length&&68!==a.length)throw new fV({publicKey:a});if(130===a.length)return{prefix:4,x:BigInt(e1(a,0,32)),y:BigInt(e1(a,32,64))};if(132===a.length){let b=Number(e1(a,0,1));return{prefix:b,x:BigInt(e1(a,1,33)),y:BigInt(e1(a,33,65))}}return{prefix:Number(e1(a,0,1)),x:BigInt(e1(a,1,33))}}function fQ(a,b={}){fN(a);let{prefix:c,x:d,y:e}=a,{includePrefix:f=!0}=b;return eY(f?e_(c,{size:1}):"0x",e_(d,{size:32}),"bigint"==typeof e?e_(e,{size:32}):"0x")}class fR extends eT{constructor({publicKey:a}){super(`Value \`${eW(a)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class fS extends eT{constructor({prefix:a,cause:b}){super(`Prefix "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class fT extends eT{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class fU extends eT{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class fV extends eT{constructor({publicKey:a}){super(`Value \`${a}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${e2(eZ(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let fW=/^0x[a-fA-F0-9]{40}$/;function fX(a,b={}){let{strict:c=!0}=b;if(!fW.test(a))throw new fZ({address:a,cause:new f$});if(c){if(a.toLowerCase()===a)return;if(fY(a)!==a)throw new fZ({address:a,cause:new f_})}}function fY(a){if(fK.has(a))return fK.get(a);fX(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=fM(function(a,b={}){let{size:c}=b,d=fb.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new ff({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new fg({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return fK.set(a,e),e}class fZ extends eT{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class f$ extends eT{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class f_ extends eT{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function f0(a={}){let{as:b="Hex"}=a,c=f3({as:b}),d=f1({privateKey:c});return{privateKey:c,publicKey:d}}function f1(a){let{privateKey:b}=a;return fO(eQ.ProjectivePoint.fromPrivateKey(eZ(b).slice(2)))}function f2(a){let{as:b="Hex",privateKey:c,publicKey:d}=a,e=eQ.ProjectivePoint.fromHex(fQ(d).slice(2)).multiply(eQ.utils.normPrivateKeyToScalar(eZ(c).slice(2))).toRawBytes(!0);return"Hex"===b?e$(e):e}function f3(a={}){let{as:b="Hex"}=a,c=eQ.utils.randomPrivateKey();return"Hex"===b?e$(c):c}function f4(a){return function(a,b={}){let c=fM(`0x${fQ(a).slice(4)}`).substring(26);return function(a,b={}){let{checksum:c=!1}=b;return(fX(a),c)?fY(a):a}(`0x${c}`,b)}(f5(a))}function f5(a){let{payload:b,signature:c}=a,{r:d,s:e,yParity:f}=c;return fO(new eQ.Signature(BigInt(d),BigInt(e)).addRecoveryBit(f).recoverPublicKey(eZ(b).substring(2)))}function f6(a){let{extraEntropy:b=!1,hash:c,payload:d,privateKey:e}=a,{r:f,s:g,recovery:h}=eQ.sign(fc(d),fc(e),{extraEntropy:"boolean"==typeof b?b:eZ(b).slice(2),lowS:!0,...c?{prehash:!0}:{}});return{r:f,s:g,yParity:h}}function f7(a){let{address:b,hash:c,payload:d,publicKey:e,signature:f}=a;if(b){var g;return g=f4({payload:d,signature:f}),fX(b,{strict:!1}),fX(g,{strict:!1}),b.toLowerCase()===g.toLowerCase()}return eQ.verify(f,fc(d),function(a,b={}){return fd(fQ(a,b))}(e),...c?[{prehash:!0,lowS:!0}]:[])}a.s(["createKeyPair",()=>f0,"getPublicKey",()=>f1,"getSharedSecret",()=>f2,"noble",0,eQ,"randomPrivateKey",()=>f3,"recoverAddress",()=>f4,"recoverPublicKey",()=>f5,"sign",()=>f6,"verify",()=>f7],35496);var f8=a.i(35496),f8=f8;let f9=function(a){if(a.length>=255)throw TypeError("Alphabet too long");let b=new Uint8Array(256);for(let a=0;a<b.length;a++)b[a]=255;for(let c=0;c<a.length;c++){let d=a.charAt(c),e=d.charCodeAt(0);if(255!==b[e])throw TypeError(d+" is ambiguous");b[e]=c}let c=a.length,d=a.charAt(0),e=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;let f=0,g=0,h=0;for(;a[f]===d;)g++,f++;let i=(a.length-f)*e+1>>>0,j=new Uint8Array(i);for(;f<a.length;){let d=a.charCodeAt(f);if(d>255)return;let e=b[d];if(255===e)return;let g=0;for(let a=i-1;(0!==e||g<h)&&-1!==a;a--,g++)e+=c*j[a]>>>0,j[a]=e%256>>>0,e=e/256>>>0;if(0!==e)throw Error("Non-zero carry");h=g,f++}let k=i-h;for(;k!==i&&0===j[k];)k++;let l=new Uint8Array(g+(i-k)),m=g;for(;k!==i;)l[m++]=j[k++];return l}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";let e=0,g=0,h=0,i=b.length;for(;h!==i&&0===b[h];)h++,e++;let j=(i-h)*f+1>>>0,k=new Uint8Array(j);for(;h!==i;){let a=b[h],d=0;for(let b=j-1;(0!==a||d<g)&&-1!==b;b--,d++)a+=256*k[b]>>>0,k[b]=a%c>>>0,a=a/c>>>0;if(0!==a)throw Error("Non-zero carry");g=d,h++}let l=j-g;for(;l!==j&&0===k[l];)l++;let m=d.repeat(e);for(;l<j;++l)m+=a.charAt(k[l]);return m},decodeUnsafe:g,decode:function(a){let b=g(a);if(b)return b;throw Error("Non-base"+c+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function ga(a){return`${a<0?"-":""}0x${Math.abs(a).toString(16).padStart(2,"0")}`}class gb{constructor(a,b){this.type=a,this.data=b}}class gc extends Error{constructor(a){super(a),Object.setPrototypeOf(this,Object.create(gc.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:gc.name})}}function gd(a,b,c){let d=Math.floor(c/0x100000000);a.setUint32(b,d),a.setUint32(b+4,c)}function ge(a,b){return 0x100000000*a.getInt32(b)+a.getUint32(b+4)}let gf={type:-1,encode:function(a){if(!(a instanceof Date))return null;{let b,c,d,e;return function({sec:a,nsec:b}){if(a>=0&&b>=0&&a<=0x3ffffffff)if(0===b&&a<=0xffffffff){let b=new Uint8Array(4);return new DataView(b.buffer).setUint32(0,a),b}else{let c=a/0x100000000,d=new Uint8Array(8),e=new DataView(d.buffer);return e.setUint32(0,b<<2|3&c),e.setUint32(4,0|a),d}{let c=new Uint8Array(12),d=new DataView(c.buffer);return d.setUint32(0,b),gd(d,4,a),c}}((c=Math.floor((b=a.getTime())/1e3),e=Math.floor((d=(b-1e3*c)*1e6)/1e9),{sec:c+e,nsec:d-1e9*e}))}},decode:function(a){let b=function(a){let b=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:return{sec:b.getUint32(0),nsec:0};case 8:{let a=b.getUint32(0);return{sec:(3&a)*0x100000000+b.getUint32(4),nsec:a>>>2}}case 12:return{sec:ge(b,4),nsec:b.getUint32(0)};default:throw new gc(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${a.length}`)}}(a);return new Date(1e3*b.sec+b.nsec/1e6)}};class gg{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(gf)}register({type:a,encode:b,decode:c}){if(a>=0)this.encoders[a]=b,this.decoders[a]=c;else{let d=-1-a;this.builtInEncoders[d]=b,this.builtInDecoders[d]=c}}tryToEncode(a,b){for(let c=0;c<this.builtInEncoders.length;c++){let d=this.builtInEncoders[c];if(null!=d){let e=d(a,b);if(null!=e)return new gb(-1-c,e)}}for(let c=0;c<this.encoders.length;c++){let d=this.encoders[c];if(null!=d){let e=d(a,b);if(null!=e)return new gb(c,e)}}return a instanceof gb?a:null}decode(a,b,c){let d=b<0?this.builtInDecoders[-1-b]:this.decoders[b];return d?d(a,b,c):new gb(b,a)}}gg.defaultCodec=new gg;let gh=new TextEncoder;function gi(a,b,c){let d=b,e=d+c,f=[],g="";for(;d<e;){let b=a[d++];if((128&b)==0)f.push(b);else if((224&b)==192){let c=63&a[d++];f.push((31&b)<<6|c)}else if((240&b)==224){let c=63&a[d++],e=63&a[d++];f.push((31&b)<<12|c<<6|e)}else if((248&b)==240){let c=(7&b)<<18|(63&a[d++])<<12|(63&a[d++])<<6|63&a[d++];c>65535&&(c-=65536,f.push(c>>>10&1023|55296),c=56320|1023&c),f.push(c)}else f.push(b);f.length>=4096&&(g+=String.fromCharCode(...f),f.length=0)}return f.length>0&&(g+=String.fromCharCode(...f)),g}let gj=new TextDecoder;function gk(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}let gl="array",gm="map_key",gn="map_value",go=a=>{if("string"==typeof a||"number"==typeof a)return a;throw new gc("The type of key must be string or number but "+typeof a)};class gp{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(a){let b=this.getUninitializedStateFromPool();b.type=gl,b.position=0,b.size=a,b.array=Array(a)}pushMapState(a){let b=this.getUninitializedStateFromPool();b.type=gm,b.readCount=0,b.size=a,b.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(a){if(this.stack[this.stackHeadPosition]!==a)throw Error("Invalid stack state. Released state is not on top of the stack.");a.type===gl&&(a.size=0,a.array=void 0,a.position=0,a.type=void 0),(a.type===gm||a.type===gn)&&(a.size=0,a.map=void 0,a.readCount=0,a.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let gq=new DataView(new ArrayBuffer(0)),gr=new Uint8Array(gq.buffer);try{gq.getInt8(0)}catch(a){if(!(a instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let gs=RangeError("Insufficient data"),gt=new class{constructor(a=16,b=16){this.hit=0,this.miss=0,this.maxKeyLength=a,this.maxLengthPerKey=b,this.caches=[];for(let a=0;a<this.maxKeyLength;a++)this.caches.push([])}canBeCached(a){return a>0&&a<=this.maxKeyLength}find(a,b,c){let d=this.caches[c-1];a:for(let e of d){let d=e.bytes;for(let e=0;e<c;e++)if(d[e]!==a[b+e])continue a;return e.str}return null}store(a,b){let c=this.caches[a.length-1],d={bytes:a,str:b};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=d:c.push(d)}decode(a,b,c){let d=this.find(a,b,c);if(null!=d)return this.hit++,d;this.miss++;let e=gi(a,b,c),f=Uint8Array.prototype.slice.call(a,b,b+c);return this.store(f,e),e}};class gu{constructor(a){this.totalPos=0,this.pos=0,this.view=gq,this.bytes=gr,this.headByte=-1,this.stack=new gp,this.entered=!1,this.extensionCodec=a?.extensionCodec??gg.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.rawStrings=a?.rawStrings??!1,this.maxStrLength=a?.maxStrLength??0xffffffff,this.maxBinLength=a?.maxBinLength??0xffffffff,this.maxArrayLength=a?.maxArrayLength??0xffffffff,this.maxMapLength=a?.maxMapLength??0xffffffff,this.maxExtLength=a?.maxExtLength??0xffffffff,this.keyDecoder=a?.keyDecoder!==void 0?a.keyDecoder:gt,this.mapKeyConverter=a?.mapKeyConverter??go}clone(){return new gu({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(a){let b=gk(a);this.bytes=b,this.view=new DataView(b.buffer,b.byteOffset,b.byteLength),this.pos=0}appendBuffer(a){if(-1!==this.headByte||this.hasRemaining(1)){let b=this.bytes.subarray(this.pos),c=gk(a),d=new Uint8Array(b.length+c.length);d.set(b),d.set(c,b.length),this.setBuffer(d)}else this.setBuffer(a)}hasRemaining(a){return this.view.byteLength-this.pos>=a}createExtraByteError(a){let{view:b,pos:c}=this;return RangeError(`Extra ${b.byteLength-c} of ${b.byteLength} byte(s) found at buffer[${a}]`)}decode(a){if(this.entered)return this.clone().decode(a);try{this.entered=!0,this.reinitializeState(),this.setBuffer(a);let b=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return b}finally{this.entered=!1}}*decodeMulti(a){if(this.entered){let b=this.clone();yield*b.decodeMulti(a);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(a);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(a){if(this.entered)return this.clone().decodeAsync(a);try{let b;this.entered=!0;let c=!1;for await(let d of a){if(c)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(d);try{b=this.doDecodeSync(),c=!0}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return b}let{headByte:d,pos:e,totalPos:f}=this;throw RangeError(`Insufficient data in parsing ${ga(d)} at ${f} (${e} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(a){return this.decodeMultiAsync(a,!0)}decodeStream(a){return this.decodeMultiAsync(a,!1)}async *decodeMultiAsync(a,b){if(this.entered){let c=this.clone();yield*c.decodeMultiAsync(a,b);return}try{this.entered=!0;let c=b,d=-1;for await(let e of a){if(b&&0===d)throw this.createExtraByteError(this.totalPos);this.appendBuffer(e),c&&(d=this.readArraySize(),c=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--d;);}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){b:for(;;){let a,b=this.readHeadByte();if(b>=224)a=b-256;else if(b<192)if(b<128)a=b;else if(b<144){let c=b-128;if(0!==c){this.pushMapState(c),this.complete();continue}a={}}else if(b<160){let c=b-144;if(0!==c){this.pushArrayState(c),this.complete();continue}a=[]}else{let c=b-160;a=this.decodeString(c,0)}else if(192===b)a=null;else if(194===b)a=!1;else if(195===b)a=!0;else if(202===b)a=this.readF32();else if(203===b)a=this.readF64();else if(204===b)a=this.readU8();else if(205===b)a=this.readU16();else if(206===b)a=this.readU32();else if(207===b)a=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===b)a=this.readI8();else if(209===b)a=this.readI16();else if(210===b)a=this.readI32();else if(211===b)a=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===b){let b=this.lookU8();a=this.decodeString(b,1)}else if(218===b){let b=this.lookU16();a=this.decodeString(b,2)}else if(219===b){let b=this.lookU32();a=this.decodeString(b,4)}else if(220===b){let b=this.readU16();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(221===b){let b=this.readU32();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(222===b){let b=this.readU16();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(223===b){let b=this.readU32();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(196===b){let b=this.lookU8();a=this.decodeBinary(b,1)}else if(197===b){let b=this.lookU16();a=this.decodeBinary(b,2)}else if(198===b){let b=this.lookU32();a=this.decodeBinary(b,4)}else if(212===b)a=this.decodeExtension(1,0);else if(213===b)a=this.decodeExtension(2,0);else if(214===b)a=this.decodeExtension(4,0);else if(215===b)a=this.decodeExtension(8,0);else if(216===b)a=this.decodeExtension(16,0);else if(199===b){let b=this.lookU8();a=this.decodeExtension(b,1)}else if(200===b){let b=this.lookU16();a=this.decodeExtension(b,2)}else if(201===b){let b=this.lookU32();a=this.decodeExtension(b,4)}else throw new gc(`Unrecognized type byte: ${ga(b)}`);this.complete();let c=this.stack;for(;c.length>0;){let b=c.top();if(b.type===gl)if(b.array[b.position]=a,b.position++,b.position===b.size)a=b.array,c.release(b);else continue b;else if(b.type===gm){if("__proto__"===a)throw new gc("The key __proto__ is not allowed");b.key=this.mapKeyConverter(a),b.type=gn;continue b}else if(b.map[b.key]=a,b.readCount++,b.readCount===b.size)a=b.map,c.release(b);else{b.key=null,b.type=gm;continue b}}return a}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new gc(`Unrecognized array type byte: ${ga(a)}`)}}pushMapState(a){if(a>this.maxMapLength)throw new gc(`Max length exceeded: map length (${a}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(a)}pushArrayState(a){if(a>this.maxArrayLength)throw new gc(`Max length exceeded: array length (${a}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(a)}decodeString(a,b){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(a,b):this.decodeBinary(a,b)}decodeUtf8String(a,b){let c;if(a>this.maxStrLength)throw new gc(`Max length exceeded: UTF-8 byte length (${a}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+b+a)throw gs;let d=this.pos+b;return c=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(a)?this.keyDecoder.decode(this.bytes,d,a):function(a,b,c){let d;if(!(c>200))return gi(a,b,c);return d=a.subarray(b,b+c),gj.decode(d)}(this.bytes,d,a),this.pos+=b+a,c}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===gm}decodeBinary(a,b){if(a>this.maxBinLength)throw new gc(`Max length exceeded: bin length (${a}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(a+b))throw gs;let c=this.pos+b,d=this.bytes.subarray(c,c+a);return this.pos+=b+a,d}decodeExtension(a,b){if(a>this.maxExtLength)throw new gc(`Max length exceeded: ext length (${a}) > maxExtLength (${this.maxExtLength})`);let c=this.view.getInt8(this.pos+b),d=this.decodeBinary(a,b+1);return this.extensionCodec.decode(d,c,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let a=this.view.getUint8(this.pos);return this.pos++,a}readI8(){let a=this.view.getInt8(this.pos);return this.pos++,a}readU16(){let a=this.view.getUint16(this.pos);return this.pos+=2,a}readI16(){let a=this.view.getInt16(this.pos);return this.pos+=2,a}readU32(){let a=this.view.getUint32(this.pos);return this.pos+=4,a}readI32(){let a=this.view.getInt32(this.pos);return this.pos+=4,a}readU64(){var a,b;let c=(a=this.view,b=this.pos,0x100000000*a.getUint32(b)+a.getUint32(b+4));return this.pos+=8,c}readI64(){let a=ge(this.view,this.pos);return this.pos+=8,a}readU64AsBigInt(){let a=this.view.getBigUint64(this.pos);return this.pos+=8,a}readI64AsBigInt(){let a=this.view.getBigInt64(this.pos);return this.pos+=8,a}readF32(){let a=this.view.getFloat32(this.pos);return this.pos+=4,a}readF64(){let a=this.view.getFloat64(this.pos);return this.pos+=8,a}}class gv{constructor(a){this.entered=!1,this.extensionCodec=a?.extensionCodec??gg.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.maxDepth=a?.maxDepth??100,this.initialBufferSize=a?.initialBufferSize??2048,this.sortKeys=a?.sortKeys??!1,this.forceFloat32=a?.forceFloat32??!1,this.ignoreUndefined=a?.ignoreUndefined??!1,this.forceIntegerToFloat=a?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new gv({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(a){if(this.entered)return this.clone().encodeSharedRef(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(a){if(this.entered)return this.clone().encode(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(a,b){if(b>this.maxDepth)throw Error(`Too deep objects in depth ${b}`);null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.forceIntegerToFloat?this.encodeNumberAsFloat(a):this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.useBigInt64&&"bigint"==typeof a?this.encodeBigInt64(a):this.encodeObject(a,b)}ensureBufferSizeToWrite(a){let b=this.pos+a;this.view.byteLength<b&&this.resizeBuffer(2*b)}resizeBuffer(a){let b=new ArrayBuffer(a),c=new Uint8Array(b),d=new DataView(b);c.set(this.bytes),this.view=d,this.bytes=c}encodeNil(){this.writeU8(192)}encodeBoolean(a){!1===a?this.writeU8(194):this.writeU8(195)}encodeNumber(a){!this.forceIntegerToFloat&&Number.isSafeInteger(a)?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<0x100000000?(this.writeU8(206),this.writeU32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-0x80000000?(this.writeU8(210),this.writeI32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(211),this.writeI64(a)):this.encodeNumberAsFloat(a)}encodeNumberAsFloat(a){this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))}encodeBigInt64(a){a>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(a)):(this.writeU8(211),this.writeBigInt64(a))}writeStringHeader(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else if(a<0x100000000)this.writeU8(219),this.writeU32(a);else throw Error(`Too long string: ${a} bytes in UTF-8`)}encodeString(a){let b=function(a){let b=a.length,c=0,d=0;for(;d<b;){let e=a.charCodeAt(d++);if((0xffffff80&e)==0){c++;continue}if((0xfffff800&e)==0)c+=2;else{if(e>=55296&&e<=56319&&d<b){let b=a.charCodeAt(d);(64512&b)==56320&&(++d,e=((1023&e)<<10)+(1023&b)+65536)}(0xffff0000&e)==0?c+=3:c+=4}}return c}(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),function(a,b,c){if(a.length>50)gh.encodeInto(a,b.subarray(c));else!function(a,b,c){let d=a.length,e=c,f=0;for(;f<d;){let c=a.charCodeAt(f++);if((0xffffff80&c)==0){b[e++]=c;continue}if((0xfffff800&c)==0)b[e++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&f<d){let b=a.charCodeAt(f);(64512&b)==56320&&(++f,c=((1023&c)<<10)+(1023&b)+65536)}(0xffff0000&c)==0?b[e++]=c>>12&15|224:(b[e++]=c>>18&7|240,b[e++]=c>>12&63|128),b[e++]=c>>6&63|128}b[e++]=63&c|128}}(a,b,c)}(a,this.bytes,this.pos),this.pos+=b}encodeObject(a,b){let c=this.extensionCodec.tryToEncode(a,this.context);if(null!=c)this.encodeExtension(c);else if(Array.isArray(a))this.encodeArray(a,b);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else if("object"==typeof a)this.encodeMap(a,b);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(a)}`)}encodeBinary(a){let b=a.byteLength;if(b<256)this.writeU8(196),this.writeU8(b);else if(b<65536)this.writeU8(197),this.writeU16(b);else if(b<0x100000000)this.writeU8(198),this.writeU32(b);else throw Error(`Too large binary: ${b}`);let c=gk(a);this.writeU8a(c)}encodeArray(a,b){let c=a.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<0x100000000)this.writeU8(221),this.writeU32(c);else throw Error(`Too large array: ${c}`);for(let c of a)this.doEncode(c,b+1)}countWithoutUndefined(a,b){let c=0;for(let d of b)void 0!==a[d]&&c++;return c}encodeMap(a,b){let c=Object.keys(a);this.sortKeys&&c.sort();let d=this.ignoreUndefined?this.countWithoutUndefined(a,c):c.length;if(d<16)this.writeU8(128+d);else if(d<65536)this.writeU8(222),this.writeU16(d);else if(d<0x100000000)this.writeU8(223),this.writeU32(d);else throw Error(`Too large map object: ${d}`);for(let d of c){let c=a[d];this.ignoreUndefined&&void 0===c||(this.encodeString(d),this.doEncode(c,b+1))}}encodeExtension(a){if("function"==typeof a.data){let b=a.data(this.pos+6),c=b.length;if(c>=0x100000000)throw Error(`Too large extension object: ${c}`);this.writeU8(201),this.writeU32(c),this.writeI8(a.type),this.writeU8a(b);return}let b=a.data.length;if(1===b)this.writeU8(212);else if(2===b)this.writeU8(213);else if(4===b)this.writeU8(214);else if(8===b)this.writeU8(215);else if(16===b)this.writeU8(216);else if(b<256)this.writeU8(199),this.writeU8(b);else if(b<65536)this.writeU8(200),this.writeU16(b);else if(b<0x100000000)this.writeU8(201),this.writeU32(b);else throw Error(`Too large extension object: ${b}`);this.writeI8(a.type),this.writeU8a(a.data)}writeU8(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++}writeU8a(a){let b=a.length;this.ensureBufferSizeToWrite(b),this.bytes.set(a,this.pos),this.pos+=b}writeI8(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++}writeU16(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2}writeI16(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2}writeU32(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4}writeI32(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4}writeF32(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4}writeF64(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8}writeU64(a){var b,c;this.ensureBufferSizeToWrite(8),b=this.view,c=this.pos,b.setUint32(c,a/0x100000000),b.setUint32(c+4,a),this.pos+=8}writeI64(a){this.ensureBufferSizeToWrite(8),gd(this.view,this.pos,a),this.pos+=8}writeBigUint64(a){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,a),this.pos+=8}writeBigInt64(a){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,a),this.pos+=8}}function gw(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function gx(a,b){return!!Array.isArray(b)&&(0===b.length||(a?b.every(a=>"string"==typeof a):b.every(a=>Number.isSafeInteger(a))))}function gy(a){if("function"!=typeof a)throw Error("function expected");return!0}function gz(a,b){if("string"!=typeof b)throw Error(`${a}: string expected`);return!0}function gA(a){if(!Number.isSafeInteger(a))throw Error(`invalid integer: ${a}`)}function gB(a){if(!Array.isArray(a))throw Error("array expected")}function gC(a,b){if(!gx(!0,b))throw Error(`${a}: array of strings expected`)}function gD(a,b){if(!gx(!1,b))throw Error(`${a}: array of numbers expected`)}function gE(...a){let b=a=>a,c=(a,b)=>c=>a(b(c));return{encode:a.map(a=>a.encode).reduceRight(c,b),decode:a.map(a=>a.decode).reduce(c,b)}}function gF(a){let b="string"==typeof a?a.split(""):a,c=b.length;gC("alphabet",b);let d=new Map(b.map((a,b)=>[a,b]));return{encode:d=>(gB(d),d.map(d=>{if(!Number.isSafeInteger(d)||d<0||d>=c)throw Error(`alphabet.encode: digit index outside alphabet "${d}". Allowed: ${a}`);return b[d]})),decode:b=>(gB(b),b.map(b=>{gz("alphabet.decode",b);let c=d.get(b);if(void 0===c)throw Error(`Unknown letter: "${b}". Allowed: ${a}`);return c}))}}function gG(a=""){return gz("join",a),{encode:b=>(gC("join.decode",b),b.join(a)),decode:b=>(gz("join.decode",b),b.split(a))}}function gH(a,b,c){if(b<2)throw Error(`convertRadix: invalid from=${b}, base cannot be less than 2`);if(c<2)throw Error(`convertRadix: invalid to=${c}, base cannot be less than 2`);if(gB(a),!a.length)return[];let d=0,e=[],f=Array.from(a,a=>{if(gA(a),a<0||a>=b)throw Error(`invalid integer: ${a}`);return a}),g=f.length;for(;;){let a=0,h=!0;for(let e=d;e<g;e++){let g=f[e],i=b*a,j=i+g;if(!Number.isSafeInteger(j)||i/b!==a||j-g!==i)throw Error("convertRadix: carry overflow");let k=j/c;a=j%c;let l=Math.floor(k);if(f[e]=l,!Number.isSafeInteger(l)||l*c+a!==j)throw Error("convertRadix: carry overflow");h&&(l?h=!1:d=e)}if(e.push(a),h)break}for(let b=0;b<a.length-1&&0===a[b];b++)e.push(0);return e.reverse()}let gI=(a,b)=>0===b?a:gI(b,a%b),gJ=(a,b)=>a+(b-gI(a,b)),gK=(()=>{let a=[];for(let b=0;b<40;b++)a.push(2**b);return a})();function gL(a,b,c,d){if(gB(a),b<=0||b>32)throw Error(`convertRadix2: wrong from=${b}`);if(c<=0||c>32)throw Error(`convertRadix2: wrong to=${c}`);if(gJ(b,c)>32)throw Error(`convertRadix2: carry overflow from=${b} to=${c} carryBits=${gJ(b,c)}`);let e=0,f=0,g=gK[b],h=gK[c]-1,i=[];for(let d of a){if(gA(d),d>=g)throw Error(`convertRadix2: invalid data word=${d} from=${b}`);if(e=e<<b|d,f+b>32)throw Error(`convertRadix2: carry overflow pos=${f} from=${b}`);for(f+=b;f>=c;f-=c)i.push((e>>f-c&h)>>>0);let a=gK[f];if(void 0===a)throw Error("invalid carry");e&=a-1}if(e=e<<c-f&h,!d&&f>=b)throw Error("Excess padding");if(!d&&e>0)throw Error(`Non-zero padding: ${e}`);return d&&f>0&&i.push(e>>>0),i}let gM=gE(function(a,b=!1){gA(5),!1;if(gJ(8,5)>32||gJ(5,8)>32)throw Error("radix2: carry overflow");return{encode:a=>{if(!gw(a))throw Error("radix2.encode input should be Uint8Array");return gL(Array.from(a),8,5,!b)},decode:a=>(gD("radix2.decode",a),Uint8Array.from(gL(a,5,8,b)))}}(5),gF("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),function(a,b="="){return gA(5),gz("padding",b),{encode(a){for(gC("padding.encode",a);5*a.length%8;)a.push(b);return a},decode(a){gC("padding.decode",a);let c=a.length;if(5*c%8)throw Error("padding: invalid, string should have whole number of bytes");for(;c>0&&a[c-1]===b;c--)if((c-1)*5%8==0)throw Error("padding: invalid, string has too much padding");return a.slice(0,c)}}}(5),gG("")),gN="function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64;gA(58);function gO(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function gP(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?gO(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function gQ(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=gP(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return gO(c)}"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex||gy(a=>{if("string"!=typeof a||a.length%2!=0)throw TypeError(`hex.decode: expected string, got ${typeof a} with length ${a.length}`);return a.toLowerCase()});let gR=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}},gS=new Uint8Array(0),gT=a=>a.reduce((a,b)=>a+b.toString(16).padStart(2,"0"),""),gU=a=>{let b=a.match(/../g);return b?new Uint8Array(b.map(a=>parseInt(a,16))):gS},gV=(a,b)=>{if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0},gW=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")},gX=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),gY=a=>new TextEncoder().encode(a),gZ=a=>new TextDecoder().decode(a);a.s(["coerce",()=>gW,"empty",()=>gS,"equals",()=>gV,"fromHex",()=>gU,"fromString",()=>gY,"isBinary",()=>gX,"toHex",()=>gT,"toString",()=>gZ],8619);class g${constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class g_{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return g1(this,a)}}class g0{constructor(a){this.decoders=a}or(a){return g1(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let g1=(a,b)=>new g0({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class g2{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new g$(a,b,c),this.decoder=new g_(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let g3=({name:a,prefix:b,encode:c,decode:d})=>new g2(a,b,c,d),g4=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=gR(c,b);return g3({prefix:a,name:b,encode:d,decode:a=>gW(e(a))})},g5=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>g3({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)}),g6=g3({prefix:"\0",name:"identity",encode:a=>gZ(a),decode:a=>gY(a)});a.s(["identity",0,g6],36206);var g7=a.i(36206);let g8=g5({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});a.s(["base2",0,g8],12591);var g9=a.i(12591);let ha=g5({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});a.s(["base8",0,ha],93571);var hb=a.i(93571);let hc=g4({prefix:"9",name:"base10",alphabet:"0123456789"});a.s(["base10",0,hc],65715);var hd=a.i(65715);let he=g5({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),hf=g5({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});a.s(["base16",0,he,"base16upper",0,hf],67012);var hg=a.i(67012);let hh=g5({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hi=g5({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),hj=g5({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),hk=g5({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),hl=g5({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hm=g5({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hn=g5({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ho=g5({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),hp=g5({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});a.s(["base32",0,hh,"base32hex",0,hl,"base32hexpad",0,hn,"base32hexpadupper",0,ho,"base32hexupper",0,hm,"base32pad",0,hj,"base32padupper",0,hk,"base32upper",0,hi,"base32z",0,hp],25162);var hq=a.i(25162);let hr=g4({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hs=g4({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});a.s(["base36",0,hr,"base36upper",0,hs],79980);var ht=a.i(79980);let hu=g4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),hv=g4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});a.s(["base58btc",0,hu,"base58flickr",0,hv],95959);var hw=a.i(95959);let hx=g5({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),hy=g5({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hz=g5({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hA=g5({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});a.s(["base64",0,hx,"base64pad",0,hy,"base64url",0,hz,"base64urlpad",0,hA],84919);var hB=a.i(84919);let hC=Array.from(""),hD=hC.reduce((a,b,c)=>(a[c]=b,a),[]),hE=hC.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]),hF=g3({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=hD[b],"")},decode:function(a){let b=[];for(let c of a){let a=hE[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}});a.s(["base256emoji",0,hF],38253);var hG=a.i(38253),hH=a.i(54799);function hI(a,b,c){b=b||[];for(var d=c=c||0;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,hI.bytes=c-d+1,b}function hJ(a,b){var c,d=0,b=b||0,e=0,f=b,g=a.length;do{if(f>=g)throw hJ.bytes=0,RangeError("Could not decode varint");c=a[f++],d+=e<28?(127&c)<<e:(127&c)*Math.pow(2,e),e+=7}while(c>=128)return hJ.bytes=f-b,d}let hK=(a,b=0)=>[hJ(a,b),hJ.bytes],hL=(a,b,c=0)=>(hI(a,b,c),b),hM=a=>{var b;return(b=a)<128?1:b<16384?2:b<2097152?3:b<0x10000000?4:b<0x800000000?5:b<0x40000000000?6:b<0x2000000000000?7:b<0x100000000000000?8:b<0x8000000000000000?9:10};a.s(["decode",0,hK,"encodeTo",0,hL,"encodingLength",0,hM],3229);let hN=(a,b)=>{let c=b.byteLength,d=hM(a),e=d+hM(c),f=new Uint8Array(e+c);return hL(a,f,0),hL(c,f,d),f.set(b,e),new hQ(a,c,b,f)},hO=a=>{let b=gW(a),[c,d]=hK(b),[e,f]=hK(b.subarray(d)),g=b.subarray(d+f);if(g.byteLength!==e)throw Error("Incorrect length");return new hQ(c,e,g,b)},hP=(a,b)=>a===b||a.code===b.code&&a.size===b.size&&gV(a.bytes,b.bytes);class hQ{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}a.s(["Digest",()=>hQ,"create",0,hN,"decode",0,hO,"equals",0,hP],43442);let hR=({name:a,code:b,encode:c})=>new hS(a,b,c);class hS{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?hN(this.code,b):b.then(a=>hN(this.code,a))}throw Error("Unknown type, must be binary type")}}a.s(["Hasher",()=>hS,"from",0,hR],64955);let hT=hR({name:"sha2-256",code:18,encode:a=>gW(hH.default.createHash("sha256").update(a).digest())}),hU=hR({name:"sha2-512",code:19,encode:a=>gW(hH.default.createHash("sha512").update(a).digest())});a.s(["sha256",0,hT,"sha512",0,hU],9822);var hV=a.i(9822);a.s(["identity",0,{code:0,name:"identity",encode:gW,digest:a=>hN(0,gW(a))}],51817);var hW=a.i(51817);a.s(["code",0,85,"decode",0,a=>gW(a),"encode",0,a=>gW(a),"name",0,"raw"],8321),a.i(8321);let hX=new TextEncoder,hY=new TextDecoder;a.s(["code",0,512,"decode",0,a=>JSON.parse(hY.decode(a)),"encode",0,a=>hX.encode(JSON.stringify(a)),"name",0,"json"],54056),a.i(54056);class hZ{constructor(a,b,c,d){this.code=b,this.version=a,this.multihash=c,this.bytes=d,this.byteOffset=d.byteOffset,this.byteLength=d.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:h6,byteLength:h6,code:h5,version:h5,multihash:h5,bytes:h5,_baseCache:h6,asCID:h6})}toV0(){if(0===this.version)return this;{let{code:a,multihash:b}=this;if(a!==h1)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(b.code!==h2)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return hZ.createV0(b)}}toV1(){switch(this.version){case 0:{let{code:a,digest:b}=this.multihash,c=hN(a,b);return hZ.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(a){return a&&this.code===a.code&&this.version===a.version&&hP(this.multihash,a.multihash)}toString(a){let{bytes:b,version:c,_baseCache:d}=this;return 0===c?h_(b,d,a||hu.encoder):h0(b,d,a||hh.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(a){return h7(/^0\.0/,h8),!!(a&&(a[h4]||a.asCID===a))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(a){if(a instanceof hZ)return a;if(null!=a&&a.asCID===a){let{version:b,code:c,multihash:d,bytes:e}=a;return new hZ(b,c,d,e||h3(b,c,d.bytes))}if(null==a||!0!==a[h4])return null;{let{version:b,multihash:c,code:d}=a,e=hO(c);return hZ.create(b,d,e)}}static create(a,b,c){if("number"!=typeof b)throw Error("String codecs are no longer supported");switch(a){case 0:if(b===h1)return new hZ(a,b,c,c.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${h1}) block encoding`);case 1:{let d=h3(a,b,c.bytes);return new hZ(a,b,c,d)}default:throw Error("Invalid version")}}static createV0(a){return hZ.create(0,h1,a)}static createV1(a,b){return hZ.create(1,a,b)}static decode(a){let[b,c]=hZ.decodeFirst(a);if(c.length)throw Error("Incorrect length");return b}static decodeFirst(a){let b=hZ.inspectBytes(a),c=b.size-b.multihashSize,d=gW(a.subarray(c,c+b.multihashSize));if(d.byteLength!==b.multihashSize)throw Error("Incorrect length");let e=d.subarray(b.multihashSize-b.digestSize),f=new hQ(b.multihashCode,b.digestSize,e,d);return[0===b.version?hZ.createV0(f):hZ.createV1(b.codec,f),a.subarray(b.size)]}static inspectBytes(a){let b=0,c=()=>{let[c,d]=hK(a.subarray(b));return b+=d,c},d=c(),e=h1;if(18===d?(d=0,b=0):1===d&&(e=c()),0!==d&&1!==d)throw RangeError(`Invalid CID version ${d}`);let f=b,g=c(),h=c(),i=b+h;return{version:d,codec:e,multihashCode:g,digestSize:h,multihashSize:i-f,size:i}}static parse(a,b){let[c,d]=h$(a,b),e=hZ.decode(d);return e._baseCache.set(c,a),e}}let h$=(a,b)=>{switch(a[0]){case"Q":{let c=b||hu;return[hu.prefix,c.decode(`${hu.prefix}${a}`)]}case hu.prefix:{let c=b||hu;return[hu.prefix,c.decode(a)]}case hh.prefix:{let c=b||hh;return[hh.prefix,c.decode(a)]}default:if(null==b)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[a[0],b.decode(a)]}},h_=(a,b,c)=>{let{prefix:d}=c;if(d!==hu.prefix)throw Error(`Cannot string encode V0 in ${c.name} encoding`);let e=b.get(d);if(null!=e)return e;{let e=c.encode(a).slice(1);return b.set(d,e),e}},h0=(a,b,c)=>{let{prefix:d}=c,e=b.get(d);if(null!=e)return e;{let e=c.encode(a);return b.set(d,e),e}},h1=112,h2=18,h3=(a,b,c)=>{let d=hM(a),e=d+hM(b),f=new Uint8Array(e+c.byteLength);return hL(a,f,0),hL(b,f,d),f.set(c,e),f},h4=Symbol.for("@ipld/js-cid/CID"),h5={writable:!1,configurable:!1,enumerable:!0},h6={writable:!1,enumerable:!1,configurable:!1},h7=(a,b)=>{if(a.test("0.0.0-dev"))console.warn(b);else throw Error(b)},h8=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;a.i(3229),a.i(8619),a.i(64955),a.i(43442);let h9={...g7,...g9,...hb,...hd,...hg,...hq,...ht,...hw,...hB,...hG};function ia(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...hV,...hW});let ib=ia("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),ic=ia("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=gP((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),id={utf8:ib,"utf-8":ib,hex:h9.base16,latin1:ic,ascii:ic,binary:ic,...h9};function ie(a,b="utf8"){let c=id[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?gO(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function ig(a,b="utf8"){let c=id[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}let ih={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var ii=a.i(72696);function ij(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function ik(a){let[b,c,d]=a.split(":");return{namespace:b,reference:c,address:d}}function il(a,b=[]){let c=[];return Object.keys(a).forEach(d=>{if(b.length&&!b.includes(d))return;let e=a[d];c.push(...e.accounts)}),c}function im(a,b){return a.includes(":")?[a]:b.chains||[]}var io=Object.defineProperty,ip=Object.defineProperties,iq=Object.getOwnPropertyDescriptors,ir=Object.getOwnPropertySymbols,is=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,iu=(a,b,c)=>b in a?io(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,iv=(a,b)=>{for(var c in b||(b={}))is.call(b,c)&&iu(a,c,b[c]);if(ir)for(var c of ir(b))it.call(b,c)&&iu(a,c,b[c]);return a},iw=(a,b,c)=>iu(a,"symbol"!=typeof b?b+"":b,c);let ix="react-native",iy="node",iz="browser";function iA(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function iB(){return!(0,dF.getDocument)()&&!!(0,dF.getNavigator)()&&"ReactNative"===navigator.product}function iC(){return!iA()&&!!(0,dF.getNavigator)()&&!!(0,dF.getDocument)()}function iD(){return iB()?ix:iA()?iy:iC()?iz:"unknown"}function iE(){var b;try{return iB()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function iF(){return(0,dG.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function iG(b,c,d){var e;let f,g=function(){if(iD()===ix&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new dB:"undefined"!=typeof navigator?function(a){var b=""!==a&&dD.reduce(function(b,c){var d=c[0],e=c[1];if(b)return b;var f=e.exec(a);return!!f&&[d,f]},!1);if(!b)return null;var c=b[0],d=b[1];if("searchbot"===c)return new dA;var e=d[1]&&d[1].split(".").join("_").split("_").slice(0,3);e?e.length<3&&(e=dw(dw([],e,!0),function(a){for(var b=[],c=0;c<a;c++)b.push("0");return b}(3-e.length),!0)):e=[];var f=e.join("."),g=function(a){for(var b=0,c=dE.length;b<c;b++){var d=dE[b],e=d[0];if(d[1].exec(a))return e}return null}(a),h=dC.exec(a);return h&&h[1]?new dz(c,f,g,h[1]):new dx(c,f,g)}(navigator.userAgent):"undefined"!=typeof process&&process.version?new dy(process.version.slice(1)):null;if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),h=(f=iD())===iz?[f,(null==(e=(0,dF.getLocation)())?void 0:e.host)||"unknown"].join(":"):f;return[[b,c].join("-"),["js",d].join("-"),g,h].join("/")}function iH(a,b){return a.filter(a=>b.includes(a)).length===a.length}function iI(a){return Object.fromEntries(a.entries())}function iJ(a){return new Map(Object.entries(a))}function iK(a=M.FIVE_MINUTES,b){let c,d,e,f,g=(0,M.toMiliseconds)(a||M.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function iL(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function iM(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function iN(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}function iO(a,b){return(0,M.fromMiliseconds)((b||Date.now())+(0,M.toMiliseconds)(a))}function iP(a){return Date.now()>=(0,M.toMiliseconds)(a)}function iQ(a,b){return`${a}${b?`:${b}`:""}`}function iR(a=[],b=[]){return[...new Set([...a,...b])]}async function iS({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=iD();if(j===iz){let a;if(!(null!=(e=(0,dF.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===ix&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function iT(a,b){let c="";try{if(iC()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function iU(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function iV(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function iW(){return"u">typeof process&&"true"===process.env.IS_VITEST}function iX(a){return Buffer.from(a,"base64").toString("utf-8")}class iY{constructor({limit:a}){iw(this,"limit"),iw(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let iZ=BigInt(0x100000000-1),i$=BigInt(32);function i_(a,b=!1){return b?{h:Number(a&iZ),l:Number(a>>i$&iZ)}:{h:0|Number(a>>i$&iZ),l:0|Number(a&iZ)}}function i0(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=i_(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let i1=(a,b,c)=>a>>>c,i2=(a,b,c)=>a<<32-c|b>>>c,i3=(a,b,c)=>a>>>c|b<<32-c,i4=(a,b,c)=>a<<32-c|b>>>c,i5=(a,b,c)=>a<<64-c|b>>>c-32,i6=(a,b,c)=>a>>>c-32|b<<64-c;function i7(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let i8=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),i9=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,ja=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),jb=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,jc=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),jd=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,je="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function jf(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function jg(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function jh(a,...b){if(!jf(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function ji(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");jg(a.outputLen),jg(a.blockLen)}function jj(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function jk(a,b){jh(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function jl(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function jm(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function jn(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function jo(a,b){return a<<32-b|a>>>b}let jp=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function jq(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let jr=jp?a=>a:a=>jq(a),js=jp?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=jq(a[b]);return a},jt="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,ju=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function jv(a){if(jh(a),jt)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=ju[a[c]];return b}function jw(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function jx(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(jt)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=jw(a.charCodeAt(e)),f=jw(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function jy(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function jz(a){return"string"==typeof a&&(a=jy(a)),jh(a),a}function jA(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];jh(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class jB{}function jC(a){let b=b=>a().update(jz(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function jD(a=32){if(je&&"function"==typeof je.getRandomValues)return je.getRandomValues(new Uint8Array(a));if(je&&"function"==typeof je.randomBytes)return Uint8Array.from(je.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let jE=BigInt(0),jF=BigInt(1),jG=BigInt(2),jH=BigInt(7),jI=BigInt(256),jJ=BigInt(113),jK=[],jL=[],jM=[];for(let a=0,b=jF,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],jK.push(2*(5*d+c)),jL.push((a+1)*(a+2)/2%64);let e=jE;for(let a=0;a<7;a++)(b=(b<<jF^(b>>jH)*jJ)%jI)&jG&&(e^=jF<<(jF<<BigInt(a))-jF);jM.push(e)}let jN=i0(jM,!0),jO=jN[0],jP=jN[1],jQ=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,jR=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class jS extends jB{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,jg(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=jl(this.state)}clone(){return this._cloneInto()}keccak(){js(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=jQ(f,g,1)^c[d],i=jR(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=jL[c],f=jQ(b,e,d),g=jR(b,e,d),h=jK[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=jO[d],a[1]^=jP[d]}jm(c)}(this.state32,this.rounds),js(this.state32),this.posOut=0,this.pos=0}update(a){jj(this),jh(a=jz(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){jj(this,!1),jh(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return jg(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(jk(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,jm(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new jS(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let jT=jC(()=>new jS(136,1,32));class jU extends jB{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=jn(this.buffer)}update(a){jj(this),jh(a=jz(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=jn(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){jj(this),jk(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,jm(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=jn(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let jV=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),jW=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),jX=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),jY=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),jZ=new Uint32Array(64);class j$ extends jU{constructor(a=32){super(64,a,8,!1),this.A=0|jV[0],this.B=0|jV[1],this.C=0|jV[2],this.D=0|jV[3],this.E=0|jV[4],this.F=0|jV[5],this.G=0|jV[6],this.H=0|jV[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)jZ[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=jZ[a-15],c=jZ[a-2],d=jo(b,7)^jo(b,18)^b>>>3,e=jo(c,17)^jo(c,19)^c>>>10;jZ[a]=e+jZ[a-7]+d+jZ[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(jo(g,6)^jo(g,11)^jo(g,25))+((k=g)&h^~k&i)+jY[a]+jZ[a]|0,o=(jo(c,2)^jo(c,13)^jo(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){jm(jZ)}destroy(){this.set(0,0,0,0,0,0,0,0),jm(this.buffer)}}let j_=i0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),j0=j_[0],j1=j_[1],j2=new Uint32Array(80),j3=new Uint32Array(80);class j4 extends jU{constructor(a=64){super(128,a,16,!1),this.Ah=0|jX[0],this.Al=0|jX[1],this.Bh=0|jX[2],this.Bl=0|jX[3],this.Ch=0|jX[4],this.Cl=0|jX[5],this.Dh=0|jX[6],this.Dl=0|jX[7],this.Eh=0|jX[8],this.El=0|jX[9],this.Fh=0|jX[10],this.Fl=0|jX[11],this.Gh=0|jX[12],this.Gl=0|jX[13],this.Hh=0|jX[14],this.Hl=0|jX[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)j2[c]=a.getUint32(b),j3[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|j2[a-15],c=0|j3[a-15],d=i3(b,c,1)^i3(b,c,8)^i1(b,c,7),e=i4(b,c,1)^i4(b,c,8)^i2(b,c,7),f=0|j2[a-2],g=0|j3[a-2],h=i3(f,g,19)^i5(f,g,61)^i1(f,g,6),i=ja(e,i4(f,g,19)^i6(f,g,61)^i2(f,g,6),j3[a-7],j3[a-16]),j=jb(i,d,h,j2[a-7],j2[a-16]);j2[a]=0|j,j3[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=i3(k,l,14)^i3(k,l,18)^i5(k,l,41),s=i4(k,l,14)^i4(k,l,18)^i6(k,l,41),t=k&m^~k&o,u=jc(r,s,l&n^~l&p,j1[a],j3[a]),v=jd(u,q,b,t,j0[a],j2[a]),w=0|u,x=i3(c,d,28)^i5(c,d,34)^i5(c,d,39),y=i4(c,d,28)^i6(c,d,34)^i6(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=i7(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=i8(w,y,A);c=i9(B,v,x,z),d=0|B}({h:c,l:d}=i7(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=i7(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=i7(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=i7(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=i7(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=i7(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=i7(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=i7(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){jm(j2,j3)}destroy(){jm(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class j5 extends j4{constructor(){super(48),this.Ah=0|jW[0],this.Al=0|jW[1],this.Bh=0|jW[2],this.Bl=0|jW[3],this.Ch=0|jW[4],this.Cl=0|jW[5],this.Dh=0|jW[6],this.Dl=0|jW[7],this.Eh=0|jW[8],this.El=0|jW[9],this.Fh=0|jW[10],this.Fl=0|jW[11],this.Gh=0|jW[12],this.Gl=0|jW[13],this.Hh=0|jW[14],this.Hl=0|jW[15]}}let j6=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class j7 extends j4{constructor(){super(32),this.Ah=0|j6[0],this.Al=0|j6[1],this.Bh=0|j6[2],this.Bl=0|j6[3],this.Ch=0|j6[4],this.Cl=0|j6[5],this.Dh=0|j6[6],this.Dl=0|j6[7],this.Eh=0|j6[8],this.El=0|j6[9],this.Fh=0|j6[10],this.Fl=0|j6[11],this.Gh=0|j6[12],this.Gl=0|j6[13],this.Hh=0|j6[14],this.Hl=0|j6[15]}}let j8=jC(()=>new j$),j9=jC(()=>new j4),ka=jC(()=>new j5),kb=jC(()=>new j7),kc=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),kd=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),ke=new Uint32Array(32);function kf(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=ke[2*a],j=ke[2*a+1],k=ke[2*b],l=ke[2*b+1],m=ke[2*c],n=ke[2*c+1],o=ke[2*d],p=ke[2*d+1],q=i8(i,k,g);j=i9(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:o,Dl:p}),({h:n,l:m}=i7(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:i3(l,k,24),Bl:i4(l,k,24)}),ke[2*a]=i,ke[2*a+1]=j,ke[2*b]=k,ke[2*b+1]=l,ke[2*c]=m,ke[2*c+1]=n,ke[2*d]=o,ke[2*d+1]=p}function kg(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=ke[2*a],j=ke[2*a+1],k=ke[2*b],l=ke[2*b+1],m=ke[2*c],n=ke[2*c+1],o=ke[2*d],p=ke[2*d+1],q=i8(i,k,g);j=i9(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:i3(p,o,16),Dl:i4(p,o,16)}),({h:n,l:m}=i7(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:i5(l,k,63),Bl:i6(l,k,63)}),ke[2*a]=i,ke[2*a+1]=j,ke[2*b]=k,ke[2*b+1]=l,ke[2*c]=m,ke[2*c+1]=n,ke[2*d]=o,ke[2*d+1]=p}class kh extends jB{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,jg(a),jg(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=jl(this.buffer)}update(a){jj(this),jh(a=jz(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(js(d),this.compress(d,0,!1),js(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));js(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);js(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){jj(this),jk(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,jm(this.buffer.subarray(b)),js(c),this.compress(c,0,!0),js(c);let d=jl(a);this.get().forEach((a,b)=>d[b]=jr(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class ki extends kh{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|kd[0],this.v0h=0|kd[1],this.v1l=0|kd[2],this.v1h=0|kd[3],this.v2l=0|kd[4],this.v2h=0|kd[5],this.v3l=0|kd[6],this.v3h=0|kd[7],this.v4l=0|kd[8],this.v4h=0|kd[9],this.v5l=0|kd[10],this.v5h=0|kd[11],this.v6l=0|kd[12],this.v6h=0|kd[13],this.v7l=0|kd[14],this.v7h=0|kd[15],function(a,b={},c,d,e){if(jg(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=jz(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=jl(e=jz(e));this.v4l^=jr(a[0]),this.v4h^=jr(a[1]),this.v5l^=jr(a[2]),this.v5h^=jr(a[3])}if(void 0!==d){const a=jl(d=jz(d));this.v6l^=jr(a[0]),this.v6h^=jr(a[1]),this.v7l^=jr(a[2]),this.v7h^=jr(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:n,v7l:o,v7h:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|n,this.v7l=0|o,this.v7h=0|p}compress(a,b,c){this.get().forEach((a,b)=>ke[b]=a),ke.set(kd,16);let{h:d,l:e}=i_(BigInt(this.length));ke[24]=kd[8]^e,ke[25]=kd[9]^d,c&&(ke[28]=~ke[28],ke[29]=~ke[29]);let f=0;for(let c=0;c<12;c++)kf(0,4,8,12,a,b+2*kc[f++]),kg(0,4,8,12,a,b+2*kc[f++]),kf(1,5,9,13,a,b+2*kc[f++]),kg(1,5,9,13,a,b+2*kc[f++]),kf(2,6,10,14,a,b+2*kc[f++]),kg(2,6,10,14,a,b+2*kc[f++]),kf(3,7,11,15,a,b+2*kc[f++]),kg(3,7,11,15,a,b+2*kc[f++]),kf(0,5,10,15,a,b+2*kc[f++]),kg(0,5,10,15,a,b+2*kc[f++]),kf(1,6,11,12,a,b+2*kc[f++]),kg(1,6,11,12,a,b+2*kc[f++]),kf(2,7,8,13,a,b+2*kc[f++]),kg(2,7,8,13,a,b+2*kc[f++]),kf(3,4,9,14,a,b+2*kc[f++]),kg(3,4,9,14,a,b+2*kc[f++]);this.v0l^=ke[0]^ke[16],this.v0h^=ke[1]^ke[17],this.v1l^=ke[2]^ke[18],this.v1h^=ke[3]^ke[19],this.v2l^=ke[4]^ke[20],this.v2h^=ke[5]^ke[21],this.v3l^=ke[6]^ke[22],this.v3h^=ke[7]^ke[23],this.v4l^=ke[8]^ke[24],this.v4h^=ke[9]^ke[25],this.v5l^=ke[10]^ke[26],this.v5h^=ke[11]^ke[27],this.v6l^=ke[12]^ke[28],this.v6h^=ke[13]^ke[29],this.v7l^=ke[14]^ke[30],this.v7h^=ke[15]^ke[31],jm(ke)}destroy(){this.destroyed=!0,jm(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let kj=(s=a=>new ki(a),(g=(a,b)=>s(b).update(jz(a)).digest()).outputLen=(h=s({})).outputLen,g.blockLen=h.blockLen,g.create=a=>s(a),g);function kk(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(jT(c)).toString("hex")}async function kl(a,b,c,d,e,f){switch(c.t){case"eip191":var g,h,i;let j;return await (g=a,h=b,i=c.s,j=fI.fromHex(i),f8.recoverAddress({payload:kk(h),signature:j}).toLowerCase()===g.toLowerCase());case"eip1271":return await km(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function km(a,b,c,d,e,f){let g=ij(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:kk(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function kn(a){let b=new Uint8Array(j8(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return f9.encode(b)}function ko(a){var b;let c=(b=Buffer.from(a,"base64"),new gu(void 0).decode(b)).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=new gv(void 0).encodeSharedRef(c),e=Buffer.from("TX"),f=kb(Buffer.concat([e,Buffer.from(d)]));return gM.encode(f).replace(/=+$/,"")}function kp(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}var kq=Object.defineProperty,kr=Object.defineProperties,ks=Object.getOwnPropertyDescriptors,kt=Object.getOwnPropertySymbols,ku=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,kw=(a,b,c)=>b in a?kq(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let kx="did:pkh:",ky={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},kz=a=>a?.split(":"),kA=a=>{let b=a&&kz(a);if(b)return b[2]+":"+b[3]},kB=a=>{let b=a&&kz(a);if(b)return b.pop()};async function kC(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=kD(e,e.iss),g=kB(e.iss);return await kl(g,f,d,kA(e.iss),c)}let kD=(a,b)=>{let c=(a=>{let b=a&&kz(a);if(b)return a.includes(kx)?b[2]:b[0]})(b);if(!c)throw Error("Invalid issuer: "+b);let d=`${a.domain} wants you to sign in with your ${c?ky[c]||c:""} account:`,e=kB(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let f=a.statement||void 0,g=`URI: ${a.aud||a.uri}`,h=`Version: ${a.version}`,i=`Chain ID: ${(a=>{let b=a&&kz(a);if(b)return a.includes(kx)?b[3]:b[1]})(b)}`,j=`Nonce: ${a.nonce}`,k=`Issued At: ${a.iat}`,l=a.exp?`Expiration Time: ${a.exp}`:void 0,m=a.nbf?`Not Before: ${a.nbf}`:void 0,n=a.requestId?`Request ID: ${a.requestId}`:void 0,o=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,p=kJ(a.resources);return p&&(f=function(a="",b){kE(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(f,kG(p))),[d,e,"",f,"",g,h,i,j,k,l,m,n,o].filter(a=>null!=a).join(`
`)};function kE(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function kF(a){return kE(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function kG(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return kE(c),c}function kH(a){var b;let c=kG(a);kE(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function kI(a){let b=kG(a);kE(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function kJ(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function kK(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function kL(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function kM(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function kN(a,...b){if(!kK(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function kO(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function kP(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function kQ(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let kR=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function kS(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(kK(a))a=kV(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function kT(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function kU(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function kV(a){return Uint8Array.from(a)}let kW=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),kX=kW("expand 16-byte k"),kY=kW("expand 32-byte k"),kZ=kP(kX),k$=kP(kY);function k_(a,b){return a<<b|a>>>32-b}function k0(a){return a.byteOffset%4==0}let k1=0x100000000-1,k2=new Uint32Array,k3=(a,b)=>255&a[b++]|(255&a[b++])<<8;class k4{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,kN(a=kS(a),32);const b=k3(a,0),c=k3(a,2),d=k3(a,4),e=k3(a,6),f=k3(a,8),g=k3(a,10),h=k3(a,12),i=k3(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=k3(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=k3(a,b+0),q=k3(a,b+2),r=k3(a,b+4),s=k3(a,b+6),t=k3(a,b+8),u=k3(a,b+10),v=k3(a,b+12),w=k3(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;kQ(c)}update(a){kO(this),kN(a=kS(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){kQ(this.h,this.r,this.buffer,this.pad)}digestInto(a){kO(this),function(a,b){kN(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let k5=(t=a=>new k4(a),(i=(a,b)=>t(b).update(kS(a)).digest()).outputLen=(j=t(new Uint8Array(32))).outputLen,i.blockLen=j.blockLen,i.create=a=>t(a),i),k6=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return kM(e),kM(g),kL(f),kL(c),(b,h,i,j,k=0)=>{kN(b),kN(h),kN(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),kN(j),kM(k),k<0||k>=k1)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=kV(b)),p=k$;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=kZ,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);k0(h)||m.push(h=kV(h));let q=kP(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,kP(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=kP(j),l=k0(e)&&k0(f),m=l?kP(e):k2,n=l?kP(f):k2;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=k1)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,kP(h),i,j,k,g),kQ(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=k_(H^(v=v+z|0),16))|0,v=v+(z=k_(z^D,12))|0,D=D+(H=k_(H^v,8))|0,z=k_(z^D,7),E=E+(I=k_(I^(w=w+A|0),16))|0,w=w+(A=k_(A^E,12))|0,E=E+(I=k_(I^w,8))|0,A=k_(A^E,7),F=F+(J=k_(J^(x=x+B|0),16))|0,x=x+(B=k_(B^F,12))|0,F=F+(J=k_(J^x,8))|0,B=k_(B^F,7),G=G+(K=k_(K^(y=y+C|0),16))|0,y=y+(C=k_(C^G,12))|0,G=G+(K=k_(K^y,8))|0,C=k_(C^G,7),F=F+(K=k_(K^(v=v+A|0),16))|0,v=v+(A=k_(A^F,12))|0,F=F+(K=k_(K^v,8))|0,A=k_(A^F,7),G=G+(H=k_(H^(w=w+B|0),16))|0,w=w+(B=k_(B^G,12))|0,G=G+(H=k_(H^w,8))|0,B=k_(B^G,7),D=D+(I=k_(I^(x=x+C|0),16))|0,x=x+(C=k_(C^D,12))|0,D=D+(I=k_(I^x,8))|0,C=k_(C^D,7),E=E+(J=k_(J^(y=y+z|0),16))|0,y=y+(z=k_(z^E,12))|0,E=E+(J=k_(J^y,8))|0,z=k_(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),k7=new Uint8Array(16),k8=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(k7.subarray(c))},k9=new Uint8Array(32);function la(a,b,c,d,e){var f,g;let h,i,j=a(b,c,k9),k=k5.create(j);e&&k8(k,e),k8(k,d);let l=(f=d.length,g=e?e.length:0,kL(!0),kU(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),kU(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return kQ(j,l),m}let lb=((a,b)=>{function c(d,...e){if(kN(d),!kR)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?kN(b):kN(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&kN(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");kN(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,kN(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(kN(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=kT(f+16,e,!1)).set(d);let g=e.subarray(0,-16);k6(a,b,g,g,1);let h=la(k6,a,b,g,c);return e.set(h,f),kQ(h),e},decrypt(d,e){e=kT(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=la(k6,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),k6(a,b,e,e,1),kQ(h),e}}));class lc extends jB{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,ji(a);const c=jz(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),jm(e)}update(a){return jj(this),this.iHash.update(a),this}digestInto(a){jj(this),jh(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let ld=(a,b,c)=>new lc(a,b).update(c).digest();ld.create=(a,b)=>new lc(a,b);let le=Uint8Array.from([0]),lf=Uint8Array.of(),lg=BigInt(0),lh=BigInt(1);function li(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function lj(a,b,c=""){let d=jf(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function lk(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function ll(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?lg:BigInt("0x"+a)}function lm(a){return jh(a),ll(jv(Uint8Array.from(a).reverse()))}function ln(a,b){return jx(a.toString(16).padStart(2*b,"0"))}function lo(a,b){return ln(a,b).reverse()}function lp(a,b,c){let d;if("string"==typeof b)try{d=jx(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(jf(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let lq=a=>"bigint"==typeof a&&lg<=a;function lr(a,b,c,d){if(!(lq(b)&&lq(c)&&lq(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function ls(a){let b;for(b=0;a>lg;a>>=lh,b+=1);return b}let lt=a=>(lh<<BigInt(a))-lh;function lu(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function lv(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let lw=BigInt(0),lx=BigInt(1),ly=BigInt(2),lz=BigInt(3),lA=BigInt(4),lB=BigInt(5),lC=BigInt(7),lD=BigInt(8),lE=BigInt(9),lF=BigInt(16);function lG(a,b){let c=a%b;return c>=lw?c:b+c}function lH(a,b,c){let d=a;for(;b-- >lw;)d*=d,d%=c;return d}function lI(a,b){if(a===lw)throw Error("invert: expected non-zero number");if(b<=lw)throw Error("invert: expected positive modulus, got "+b);let c=lG(a,b),d=b,e=lw,f=lx;for(;c!==lw;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==lx)throw Error("invert: does not exist");return lG(e,b)}function lJ(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function lK(a,b){let c=(a.ORDER+lx)/lA,d=a.pow(b,c);return lJ(a,d,b),d}function lL(a,b){let c=(a.ORDER-lB)/lD,d=a.mul(b,ly),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,ly),e),h=a.mul(f,a.sub(g,a.ONE));return lJ(a,h,b),h}function lM(a){if(a<lz)throw Error("sqrt is not defined for small field");let b=a-lx,c=0;for(;b%ly===lw;)b/=ly,c++;let d=ly,e=lR(a);for(;1===lP(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return lK;let f=e.pow(d,b),g=(b+lx)/ly;return function(a,d){if(a.is0(d))return d;if(1!==lP(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=lx<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let lN=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lO(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function lP(a,b){let c=(a.ORDER-lx)/ly,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function lQ(a,b){void 0!==b&&jg(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function lR(a,b,c=!1,d={}){let e;if(a<=lw)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=lQ(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:lt(j),ZERO:lw,ONE:lx,allowedLengths:i,create:b=>lG(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return lw<=b&&b<a},is0:a=>a===lw,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&lx)===lx,neg:b=>lG(-b,a),eql:(a,b)=>a===b,sqr:b=>lG(b*b,a),add:(b,c)=>lG(b+c,a),sub:(b,c)=>lG(b-c,a),mul:(b,c)=>lG(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<lw)throw Error("invalid exponent, negatives unsupported");if(c===lw)return a.ONE;if(c===lx)return b;let d=a.ONE,e=b;for(;c>lw;)c&lx&&(d=a.mul(d,e)),e=a.sqr(e),c>>=lx;return d})(l,a,b),div:(b,c)=>lG(b*lI(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>lI(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%lA===lz?lK:a%lD===lB?lL:a%lF===lE?(c=lR(a),f=(d=lM(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+lC)/lF,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),n=a.cmov(c,d,m);return lJ(a,n,b),n}):lM(a)),e(l,b)}),toBytes:a=>c?lo(a,k):ln(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?lm(b):ll(jv(b));if(h&&(e=lG(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>lO(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function lS(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function lT(a){let b=lS(a);return b+Math.ceil(b/2)}let lU=BigInt(0),lV=BigInt(1);function lW(a,b){let c=b.negate();return a?c:b}function lX(a,b){let c=lO(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function lY(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function lZ(a,b){lY(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:lt(a),maxNumber:e,shiftBy:BigInt(a)}}function l$(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=lV);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let l_=new WeakMap,l0=new WeakMap;function l1(a){return l0.get(a)||1}function l2(a){if(a!==lU)throw Error("invalid wNAF")}class l3{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>lU;)b&lV&&(c=c.add(d)),d=d.double(),b>>=lV;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=lZ(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=lZ(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=l$(c,a,f);c=g,i?e=e.add(lW(k,b[l])):d=d.add(lW(j,b[h]))}return l2(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=lZ(a,this.bits);for(let a=0;a<e.windows&&c!==lU;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=l$(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return l2(c),d}getPrecomputes(a,b,c){let d=l_.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),l_.set(b,d))),d}cached(a,b,c){let d=l1(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=l1(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){lY(b,this.bits),l0.set(a,b),l_.delete(a)}hasCache(a){return 1!==l1(a)}}function l4(a,b,c){if(!b)return lR(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return lu(b,lN.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),jy("HashToScalar-");let l5=BigInt(0),l6=BigInt(1),l7=BigInt(2),l8=BigInt(1),l9=BigInt(2),ma=BigInt(3),mb=BigInt(5),mc=BigInt(8),md=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),me={p:md,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:mc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},mf=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(lu(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||jD,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?l7**BigInt(254):l7**BigInt(447),n=m+(g?BigInt(8)*l7**BigInt(251)-l6:BigInt(4)*l7**BigInt(445)-l6)+l6,o=a=>lG(a,b),p=lo(o(k),j);function q(a,c){let f,h=function(a,c){lr("u",a,l5,b),lr("scalar",c,m,n);let d=l6,f=l5,g=a,h=l6,j=l5;for(let b=BigInt(i-1);b>=l5;b--){let e=c>>b&l6;j^=e,({x_2:d,x_3:g}=s(j,d,g)),({x_2:f,x_3:h}=s(j,f,h)),j=e;let i=d+f,k=o(i*i),m=d-f,n=o(m*m),p=k-n,q=g+h,r=o((g-h)*i),t=o(q*m),u=r+t,v=r-t;g=o(u*u),h=o(a*o(v*v)),d=o(k*n),f=o(p*(k+o(l*p)))}return{x_2:d,x_3:g}=s(j,d,g),{x_2:f,x_3:h}=s(j,f,h),o(d*e(f))}((f=lp("u coordinate",c,j),g&&(f[31]&=127),o(lm(f))),lm(d(lp("scalar",a,j))));if(h===l5)throw Error("invalid private or public key received");return lo(o(h),j)}function r(a){return q(a,p)}function s(a,b,c){let d=o(a*(b-c));return{x_2:b=o(b-d),x_3:c=o(c+d)}}let t={secretKey:j,publicKey:j,seed:j},u=(a=h(j))=>(jh(a,t.seed),a);return{keygen:function(a){let b=u(a);return{secretKey:b,publicKey:r(b)}},getSharedSecret:(a,b)=>q(a,b),getPublicKey:a=>r(a),scalarMult:q,scalarMultBase:r,utils:{randomSecretKey:u,randomPrivateKey:u},GuBytes:p.slice(),lengths:t}}({P:k=lR(me.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,i,j,l,m,n,o,p,{pow_p_5_8:q,b2:r}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),g=lH(f=a*a%md*a%md,l9,md)*f%md,h=lH(g,l8,md)*a%md,i=lH(h,mb,md)*h%md,j=lH(i,b,md)*i%md,l=lH(j,c,md)*j%md,m=lH(l,d,md)*l%md,n=lH(m,e,md)*m%md,o=lH(n,e,md)*m%md,p=lH(o,b,md)*i%md,{pow_p_5_8:lH(p,l9,md)*a%md,b2:f});return lG(lH(q,ma,k)*r,k)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),mg=(a,b)=>(a+(a>=0?b:-b)/mm)/b;function mh(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function mi(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return li(c.lowS,"lowS"),li(c.prehash,"prehash"),void 0!==c.format&&mh(c.format),c}let mj={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=mj;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=lk(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?lk(e.length/2|128):"";return lk(a)+f+e+b},decode(a,b){let{Err:c}=mj,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=mj;if(a<mk)throw new b("integer: negative integers are not allowed");let c=lk(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=mj;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return ll(jv(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=mj,e=lp("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=mj,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},mk=BigInt(0),ml=BigInt(1),mm=BigInt(2),mn=BigInt(3),mo=BigInt(4);function mp(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=lp("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function mq(a){return Uint8Array.of(a?2:3)}function mr(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function ms(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:lR(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){ji(b),lu(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||jD,e=c.hmac||((a,...c)=>ld(b,a,jA(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||jD,e=Object.assign(mr(a.Fp,c),{seed:lT(c.ORDER)});function f(a){try{return!!mp(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=lS(b),f=lT(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=lG(c?lm(a):ll(jv(a)),b-lx)+lx;return c?lo(g,e):ln(g,e)}(lj(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(mp(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=lp("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=mp(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>mp(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),o={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},p="compact";function q(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class r{constructor(a,b,c){this.r=q("r",a),this.s=q("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=p){var c,d;let e,f;if(c=a,mh(d=b),f=n.signature,lj(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=mj.toSig(lj(a));return new r(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new r(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(jx(a),b)}addRecoveryBit(a){return new r(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*mm<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(jA(mq((1&i)==0),k)),m=g.inv(j),n=t(lp("msgHash",b)),o=g.create(-n*m),p=g.create(e*m),q=a.BASE.multiplyUnsafe(o).add(l.multiplyUnsafe(p));if(q.is0())throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>h>>ml}toBytes(a=p){if(mh(a),"der"===a)return jx(mj.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return jA(Uint8Array.of(this.recovery),b,c)}return jA(b,c)}toHex(a){return jv(this.toBytes(a))}assertValidity(){}static fromCompact(a){return r.fromBytes(lp("sig",a),"compact")}static fromDER(a){return r.fromBytes(lp("sig",a),"der")}normalizeS(){return this.hasHighS()?new r(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return jv(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return jv(this.toBytes("compact"))}}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=ll(jv(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return g.create(s(a))},u=lt(i);function v(a){return lr("num < 2^"+i,a,mk,u),g.toBytes(a)}function w(a,c){return lj(a,void 0,"message"),c?lj(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=mi(e,o),k=t(b=w(b,i)),l=mp(g,c),m=[v(l),v(k)];if(null!=j&&!1!==j){let a=!0===j?d(n.secretKey):j;m.push(lp("extraEntropy",a))}return{seed:jA(...m),k2sig:function(b){let c=s(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===mk)return;let j=g.create(d*g.create(k+i*l));if(j===mk)return;let m=2*(e.x!==i)|Number(e.y&ml),n=j;return f&&j>h>>ml&&(n=g.neg(j),m^=1),new r(i,n,m)}}}(c=lp("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return jA(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=mi(e,o);if(d=lp("publicKey",d),c=w(lp("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||jf(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new r(a.r,a.s);else if(c){try{b=r.fromBytes(lp("sig",a),"der")}catch(a){if(!(a instanceof mj.Err))throw a}if(!b)try{b=r.fromBytes(lp("sig",a),"compact")}catch{return!1}}return b||!1}(b):r.fromBytes(lp("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=t(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),n=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!n.is0()&&g.create(n.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=mi(c,o);return b=w(b,d),r.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:r,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>lU))throw Error(`CURVE.${a} must be positive bigint`)}let e=l4(b.p,c.Fp,d),f=l4(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;lu(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=mr(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(li(c,"isCompressed"),c)?(k(),jA(mq(!d.isOdd(f)),g)):jA(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){lj(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=n(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!o(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function n(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function o(a,b){let c=d.sqr(b),e=n(a);return d.eql(c,e)}if(!o(f.Gx,f.Gy))throw Error("bad curve params: generator point");let p=d.mul(d.pow(f.a,mn),mo),q=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(p,q)))throw Error("bad curve params: a or b");function r(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function s(a){if(!(a instanceof x))throw Error("ProjectivePoint expected")}function t(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=mg(g*a,c),i=mg(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<mk,m=k<mk;l&&(j=-j),m&&(k=-k);let n=lt(Math.ceil(ls(c)/2))+ml;if(j<mk||j>=n||k<mk||k>=n)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let u=lv((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),v=lv(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!o(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function w(a,b,c,e,f){return c=new x(d.mul(c.X,a),c.Y,c.Z),b=lW(e,b),c=lW(f,c),b.add(c)}class x{constructor(a,b,c){this.X=r("x",a),this.Y=r("y",b,!0),this.Z=r("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof x)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?x.ZERO:new x(b,c,d.ONE)}static fromBytes(a){let b=x.fromAffine(m(lj(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return x.fromBytes(lp("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return z.createCache(this,a),b||this.multiply(mn),this}assertValidity(){v(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){s(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new x(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,mn),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(e,g);return o=d.add(o,o),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(c,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new x(i,j,k=d.add(k,k))}add(a){s(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,n=d.mul(f.b,mn),o=d.mul(b,g),p=d.mul(c,h),q=d.mul(e,i),r=d.add(b,c),t=d.add(g,h);r=d.mul(r,t),t=d.add(o,p),r=d.sub(r,t),t=d.add(b,e);let u=d.add(g,i);return t=d.mul(t,u),u=d.add(o,q),t=d.sub(t,u),u=d.add(c,e),j=d.add(h,i),u=d.mul(u,j),j=d.add(p,q),u=d.sub(u,j),l=d.mul(m,t),j=d.mul(n,q),l=d.add(j,l),j=d.sub(p,l),l=d.add(p,l),k=d.mul(j,l),p=d.add(o,o),p=d.add(p,o),q=d.mul(m,q),t=d.mul(n,t),p=d.add(p,q),q=d.sub(o,q),q=d.mul(m,q),t=d.add(t,q),o=d.mul(p,t),k=d.add(k,o),o=d.mul(u,t),j=d.mul(r,j),j=d.sub(j,o),o=d.mul(r,p),l=d.mul(u,l),new x(j,k,l=d.add(l,o))}subtract(a){return this.add(a.negate())}is0(){return this.equals(x.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>z.cached(this,a,a=>lX(x,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=t(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=w(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return lX(x,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===mk||this.is0())return x.ZERO;if(a===ml)return this;if(z.hasCache(this))return this.multiply(a);if(!c)return z.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=t(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>lU||d>lU;)c&lV&&(f=f.add(e)),d&lV&&(g=g.add(e)),e=e.double(),c>>=lV,d>>=lV;return{p1:f,p2:g}}(x,this,d,f);return w(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return u(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===ml||(a?a(x,this):z.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===ml?this:a?a(x,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return li(a,"isCompressed"),this.assertValidity(),l(x,this,a)}toHex(a=!0){return jv(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return lX(x,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=ls(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=lt(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(x,e,a,b)}static fromPrivateKey(a){return x.BASE.multiply(mp(e,a))}}x.BASE=new x(f.Gx,f.Gy,d.ONE),x.ZERO=new x(d.ZERO,d.ONE,d.ZERO),x.Fp=d,x.Fn=e;let y=e.BITS,z=new l3(x,b.endo?Math.ceil(y/2):y);return x.BASE.precompute(8),x}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,lQ(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let mt={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},mu={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},mv={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},mw=lR(mt.p),mx=lR(mu.p),my=lR(mv.p),mz=ms({...mt,Fp:mw,lowS:!1},j8);ms({...mu,Fp:mx,lowS:!1},ka),ms({...mv,Fp:my,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},j9);let mA="base10",mB="base16",mC="base64pad",mD="base64url",mE="utf8";function mF(){return ig(jD(32),mB)}function mG(a){return ig(j8(ie(a,mB)),mB)}function mH(a){return ig(j8(ie(a,mE)),mB)}function mI(a){return Number(ig(a,mA))}function mJ(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function mK(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function mL(a){if(2===mI(a.type))return ig(gQ([a.type,a.sealed]),mC);if(1===mI(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return ig(gQ([a.type,a.senderPublicKey,a.iv,a.sealed]),mC)}return ig(gQ([a.type,a.iv,a.sealed]),mC)}function mM(a){let b=ie((a.encoding||mC)===mD?mK(a.encoded):a.encoded,mC),c=b.slice(0,1);if(1===mI(c)){let a=b.slice(1,33),d=b.slice(33,45);return{type:c,sealed:b.slice(45),iv:d,senderPublicKey:a}}if(2===mI(c))return{type:c,sealed:b.slice(1),iv:jD(12)};let d=b.slice(1,13);return{type:c,sealed:b.slice(13),iv:d}}function mN(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function mO(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function mP(a){return a?.relay||{protocol:"irn"}}function mQ(a){let b=ih[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}var mR=Object.defineProperty,mS=Object.defineProperties,mT=Object.getOwnPropertyDescriptors,mU=Object.getOwnPropertySymbols,mV=Object.prototype.hasOwnProperty,mW=Object.prototype.propertyIsEnumerable,mX=(a,b,c)=>b in a?mR(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mY=(a,b)=>{for(var c in b||(b={}))mV.call(b,c)&&mX(a,c,b[c]);if(mU)for(var c of mU(b))mW.call(b,c)&&mX(a,c,b[c]);return a};function mZ(a){var b;if(!a.includes("wc:")){let b=iX(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=Object.fromEntries(new URLSearchParams("u">typeof d?a.substring(d):"").entries()),h="string"==typeof g.methods?g.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:g.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(g),methods:h,expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function m$(a){let b=new URLSearchParams;return Object.entries(mY(mY(mS(mY({},function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay)),mT({symKey:a.symKey})),a.expiryTimestamp&&{expiryTimestamp:a.expiryTimestamp.toString()}),a.methods&&{methods:a.methods.join(",")})).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,c])=>{void 0!==c&&b.append(a,String(c))}),`${a.protocol}:${a.topic}@${a.version}?${b}`}function m_(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var m0=Object.defineProperty,m1=Object.defineProperties,m2=Object.getOwnPropertyDescriptors,m3=Object.getOwnPropertySymbols,m4=Object.prototype.hasOwnProperty,m5=Object.prototype.propertyIsEnumerable,m6=(a,b,c)=>b in a?m0(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,m7=(a,b)=>{for(var c in b||(b={}))m4.call(b,c)&&m6(a,c,b[c]);if(m3)for(var c of m3(b))m5.call(b,c)&&m6(a,c,b[c]);return a},m8=(a,b)=>m1(a,m2(b));function m9(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function na(a){let b=[];return Object.values(a).forEach(a=>{b.push(...m9(a.accounts))}),[...new Set(b)]}function nb(a){return a.includes(":")}function nc(a){var b,c,d;let e={};if(!nj(a))return e;for(let[f,g]of Object.entries(a)){let a=nb(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=nb(f)?f.split(":")[0]:f;e[j]=m8(m7({},e[j]),{chains:iR(a,null==(b=e[j])?void 0:b.chains),methods:iR(h,null==(c=e[j])?void 0:c.methods),events:iR(i,null==(d=e[j])?void 0:d.events)})}return e}function nd(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=iR(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}let ne={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},nf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ng(a,b){let{message:c,code:d}=nf[a];return{message:b?`${c} ${b}`:c,code:d}}function nh(a,b){let{message:c,code:d}=ne[a];return{message:b?`${c} ${b}`:c,code:d}}function ni(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function nj(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function nk(a){return typeof a>"u"}function nl(a,b){return!!(b&&nk(a))||"string"==typeof a&&!!a.trim().length}function nm(a,b){return!!(b&&nk(a))||"number"==typeof a&&!isNaN(a)}function nn(a){return!!(nl(a,!1)&&a.includes(":"))&&2===a.split(":").length}function no(a){let b=!0;return ni(a)?a.length&&(b=a.every(a=>nl(a,!1))):b=!1,b}function np(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,no(a?.methods)?no(a?.events)||(e=nh("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=nh("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function nq(a,b){let c=null;if(a&&nj(a)){let d,e=np(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,ni(c)?c.forEach(a=>{f||function(a){if(nl(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&nn(a)}}return!1}(a)||(f=nh("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=nh("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=ng("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function nr(a){return nl(a.protocol,!0)}function ns(a){return"u">typeof a}function nt(a,b){return!(!nn(b)||!na(a).includes(b))}function nu(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=m9(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=nv(Object.keys(a)),n=nv(Object.keys(b)),o=m.filter(a=>!n.includes(a));return o.length&&(h=ng("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${o.toString()}
      Received: ${Object.keys(b).toString()}`)),iH(k,l)||(h=ng("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=m9(b[a].accounts);d.includes(a)||(h=ng("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||(iH(i[a].methods,j[a].methods)?iH(i[a].events,j[a].events)||(h=ng("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=ng("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function nv(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}function nw(){let a=iD();return new Promise(b=>{switch(a){case iz:b(iC()&&navigator?.onLine);break;case ix:b(nx());break;default:b(!0)}})}async function nx(){if(iB()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}let ny={};class nz{static get(a){return ny[a]}static set(a,b){ny[a]=b}static delete(a){delete ny[a]}}function nA(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}function nB({logger:a,name:b}){let c="string"==typeof a?a3({opts:{level:a,name:b}}).logger:a;return c.level="string"==typeof a?a:a.level,c}let nC="INTERNAL_ERROR",nD="SERVER_ERROR",nE=[-32700,-32600,-32601,-32602,-32603],nF={PARSE_ERROR:{code:-32700,message:"Parse error"},INVALID_REQUEST:{code:-32600,message:"Invalid Request"},METHOD_NOT_FOUND:{code:-32601,message:"Method not found"},INVALID_PARAMS:{code:-32602,message:"Invalid params"},[nC]:{code:-32603,message:"Internal error"},[nD]:{code:-32e3,message:"Server error"}};function nG(a){return Object.keys(nF).includes(a)?nF[a]:nF[nD]}var nH=a.i(42289);function nI(a=3){return Date.now()*Math.pow(10,a)+Math.floor(Math.random()*Math.pow(10,a))}function nJ(a=6){return BigInt(nI(a))}function nK(a,b,c){return{id:c||nI(),jsonrpc:"2.0",method:a,params:b}}function nL(a,b){return{id:a,jsonrpc:"2.0",result:b}}function nM(a,b,c){var d,e,f,g;let h;return{id:a,jsonrpc:"2.0",error:(d=b,e=c,void 0===d?nG(nC):("string"==typeof d&&(d=Object.assign(Object.assign({},nG(nD)),{message:d})),void 0!==e&&(d.data=e),f=d.code,nE.includes(f)&&(g=d.code,d=(h=Object.values(nF).find(a=>a.code===g))||nF[nD]),d))}}nH.isNode;class nN{}class nO extends nN{constructor(){super()}}class nP extends nO{constructor(a){super()}}function nQ(a){let b;return void 0!==(b=function(a){let b=a.match(RegExp(/^\w+:/,"gi"));if(b&&b.length)return b[0]}(a))&&RegExp("^wss?:").test(b)}function nR(a){return"object"==typeof a&&"id"in a&&"jsonrpc"in a&&"2.0"===a.jsonrpc}function nS(a){return nR(a)&&"method"in a}function nT(a){return nR(a)&&(nU(a)||nV(a))}function nU(a){return"result"in a}function nV(a){return"error"in a}class nW extends nP{constructor(a){super(a),this.events=new L.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(a),this.connection.connected&&this.registerEventListeners()}async connect(a=this.connection){await this.open(a)}async disconnect(){await this.close()}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async request(a,b){return this.requestStrict(nK(a.method,a.params||[],a.id||nJ().toString()),b)}async requestStrict(a,b){return new Promise(async(c,d)=>{if(!this.connection.connected)try{await this.open()}catch(a){d(a)}this.events.on(`${a.id}`,a=>{nV(a)?d(a.error):c(a.result)});try{await this.connection.send(a,b)}catch(a){d(a)}})}setConnection(a=this.connection){return a}onPayload(a){this.events.emit("payload",a),nT(a)?this.events.emit(`${a.id}`,a):this.events.emit("message",{type:a.method,data:a.params})}onClose(a){a&&3e3===a.code&&this.events.emit("error",Error(`WebSocket connection closed abnormally with code: ${a.code} ${a.reason?`(${a.reason})`:""}`)),this.events.emit("disconnect")}async open(a=this.connection){this.connection===a&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof a&&(await this.connection.open(a),a=this.connection),this.connection=this.setConnection(a),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",a=>this.onPayload(a)),this.connection.on("close",a=>this.onClose(a)),this.connection.on("error",a=>this.events.emit("error",a)),this.connection.on("register_error",a=>this.onClose()),this.hasRegisteredEventListeners=!0)}}let nX=a=>a.split("?")[0],nY="u">typeof WebSocket?WebSocket:"u">typeof a.g.WebSocket?a.g.WebSocket:"u">typeof self&&"u">typeof self.WebSocket?self.WebSocket:a.r(69084);class nZ{constructor(a){if(this.url=a,this.events=new L.EventEmitter,this.registering=!1,!nQ(a))throw Error(`Provided URL is not compatible with WebSocket connection: ${a}`);this.url=a}get connected(){return"u">typeof this.socket}get connecting(){return this.registering}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async open(a=this.url){await this.register(a)}async close(){return new Promise((a,b)=>{typeof this.socket>"u"?b(Error("Connection already closed")):(this.socket.onclose=b=>{this.onClose(b),a()},this.socket.close())})}async send(a){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ah(a))}catch(b){this.onError(a.id,b)}}register(b=this.url){if(!nQ(b))throw Error(`Provided URL is not compatible with WebSocket connection: ${b}`);if(this.registering){let a=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=a||this.events.listenerCount("open")>=a)&&this.events.setMaxListeners(a+1),new Promise((a,b)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),b(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return b(Error("WebSocket connection is missing or invalid"));a(this.socket)})})}return this.url=b,this.registering=!0,new Promise((c,d)=>{let e=(0,nH.isReactNative)()?void 0:{rejectUnauthorized:!RegExp("wss?://localhost(:d{2,5})?").test(b)},f=new nY(b,[],e);"u">typeof WebSocket||"u">typeof a.g.WebSocket||"u">typeof self&&"u">typeof self.WebSocket?f.onerror=a=>{d(this.emitError(a.error))}:f.on("error",a=>{d(this.emitError(a))}),f.onopen=()=>{this.onOpen(f),c(f)}})}onOpen(a){a.onmessage=a=>this.onPayload(a),a.onclose=a=>this.onClose(a),this.socket=a,this.registering=!1,this.events.emit("open")}onClose(a){this.socket=void 0,this.registering=!1,this.events.emit("close",a)}onPayload(a){if(typeof a.data>"u")return;let b="string"==typeof a.data?ag(a.data):a.data;this.events.emit("payload",b)}onError(a,b){let c=this.parseError(b),d=nM(a,c.message||c.toString());this.events.emit("payload",d)}parseError(a,b=this.url){var c;return c=nX(b),a.message.includes("getaddrinfo ENOTFOUND")||a.message.includes("connect ECONNREFUSED")?Error(`Unavailable WS RPC url at ${c}`):a}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(a){let b=this.parseError(Error(a?.message||`WebSocket connection failed for host: ${nX(this.url)}`));return this.events.emit("register_error",b),b}}let n$="core",n_=`wc@2:${n$}:`,n0={database:":memory:"},n1="client_ed25519_seed",n2=M.ONE_DAY,n3=M.SIX_HOURS,n4="wss://relay.walletconnect.org",n5="relayer_message",n6="relayer_message_ack",n7="relayer_connection_stalled",n8="relayer_publish",n9="payload",oa="connect",ob="disconnect",oc="error",od="2.23.1",oe="link_mode",of="relay",og="inbound",oh="WALLETCONNECT_LINK_MODE_APPS",oi="subscription_created",oj="subscription_deleted",ok=(M.THIRTY_DAYS,M.FIVE_SECONDS,M.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}}),ol="pairing_create",om="pairing_delete",on="history_created",oo="history_updated",op="history_deleted",oq="expirer_created",or="expirer_deleted",os="expirer_expired",ot=(M.ONE_DAY,"https://verify.walletconnect.org"),ou=`${ot}/v3`,ov=["https://verify.walletconnect.com",ot],ow="malformed_pairing_uri",ox="session_approve_started";var oy=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let oz=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class oA{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class oB{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return oD(this,a)}}class oC{constructor(a){this.decoders=a}or(a){return oD(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let oD=(a,b)=>new oC({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class oE{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new oA(a,b,c),this.decoder=new oB(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let oF=({name:a,prefix:b,encode:c,decode:d})=>new oE(a,b,c,d),oG=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=oy(c,b);return oF({prefix:a,name:b,encode:d,decode:a=>oz(e(a))})},oH=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>oF({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var oI=Object.freeze({__proto__:null,identity:oF({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),oJ=Object.freeze({__proto__:null,base2:oH({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),oK=Object.freeze({__proto__:null,base8:oH({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),oL=Object.freeze({__proto__:null,base10:oG({prefix:"9",name:"base10",alphabet:"0123456789"})}),oM=Object.freeze({__proto__:null,base16:oH({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:oH({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),oN=Object.freeze({__proto__:null,base32:oH({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:oH({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:oH({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:oH({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:oH({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:oH({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:oH({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:oH({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:oH({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),oO=Object.freeze({__proto__:null,base36:oG({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:oG({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),oP=Object.freeze({__proto__:null,base58btc:oG({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:oG({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),oQ=Object.freeze({__proto__:null,base64:oH({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:oH({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:oH({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:oH({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let oR=Array.from(""),oS=oR.reduce((a,b,c)=>(a[c]=b,a),[]),oT=oR.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var oU=Object.freeze({__proto__:null,base256emoji:oF({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=oS[b],"")},decode:function(a){let b=[];for(let c of a){let a=oT[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function oV(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,oV.bytes=c-d+1,b}var oW=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let oX=(a,b,c=0)=>(oV(a,b,c),b),oY=(a,b)=>{let c=b.byteLength,d=oW(a),e=d+oW(c),f=new Uint8Array(e+c);return oX(a,f,0),oX(c,f,d),f.set(b,e),new oZ(a,c,b,f)};class oZ{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let o$=({name:a,code:b,encode:c})=>new o_(a,b,c);class o_{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?oY(this.code,b):b.then(a=>oY(this.code,a))}throw Error("Unknown type, must be binary type")}}let o0=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var o1=Object.freeze({__proto__:null,sha256:o$({name:"sha2-256",code:18,encode:o0("SHA-256")}),sha512:o$({name:"sha2-512",code:19,encode:o0("SHA-512")})}),o2=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:oz,digest:a=>oY(0,oz(a))}});new TextEncoder,new TextDecoder;let o3={...oI,...oJ,...oK,...oL,...oM,...oN,...oO,...oP,...oQ,...oU};function o4(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function o5(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...o1,...o2});let o6=o5("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),o7=o5("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?o4(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),o8={utf8:o6,"utf-8":o6,hex:o3.base16,latin1:o7,ascii:o7,binary:o7,...o3};var o9=Object.defineProperty,pa=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?o9(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class pb{constructor(a,b){this.core=a,this.logger=b,pa(this,"keychain",new Map),pa(this,"name","keychain"),pa(this,"version","0.3"),pa(this,"initialized",!1),pa(this,"storagePrefix",n_),pa(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),pa(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),pa(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),pa(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=ng("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),pa(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=a2(b,this.name)}get context(){return a1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,iI(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?iJ(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}}var pc=Object.defineProperty,pd=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?pc(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class pe{constructor(a,b,c){this.core=a,this.logger=b,pd(this,"name","crypto"),pd(this,"keychain"),pd(this,"randomSessionIdentifier",mF()),pd(this,"initialized",!1),pd(this,"clientId"),pd(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),pd(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),pd(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let a=ds(du(await this.getClientSeed()).publicKey);return this.clientId=a,a}),pd(this,"generateKeyPair",()=>{let a,b;this.isInitialized();let c=(a=mf.utils.randomPrivateKey(),b=mf.getPublicKey(a),{privateKey:ig(a,mB),publicKey:ig(b,mB)});return this.setPrivateKey(c.publicKey,c.privateKey)}),pd(this,"signJWT",async a=>{this.isInitialized();let b=du(await this.getClientSeed()),c=this.randomSessionIdentifier;return await dv(c,a,n2,b)}),pd(this,"generateSharedKey",(a,b,c)=>{var d,e,f;let g;this.isInitialized();let h=(d=this.getPrivateKey(a),ig((g=mf.getSharedSecret(ie(d,mB),ie(b,mB)),e=void 0,function(a,b,c,d=32){ji(a),jg(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=lf);let g=new Uint8Array(f*e),h=ld.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)le[0]=a+1,i.update(0===a?lf:j).update(c).update(le).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),jm(j,le),g.slice(0,d)}(j8,(f=void 0,ji(j8),void 0===f&&(f=new Uint8Array(j8.outputLen)),ld(j8,jz(f),jz(g))),e,32)),mB));return this.setSymKey(h,c)}),pd(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||mG(a);return await this.keychain.set(c,a),c}),pd(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),pd(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),pd(this,"encode",async(a,b,c)=>{this.isInitialized();let d=mN(c),e=ah(b);if(2===d.type){var f;let a,b,d;return f=c?.encoding,a=ie("2",mA),b=jD(12),d=mL({type:a,sealed:ie(e,mE),iv:b}),f===mD?mJ(d):d}if(mO(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let g=this.getSymKey(a),{type:h,senderPublicKey:i}=d;return function(a){var b;let c=(b="u">typeof a.type?a.type:0,ie(`${b}`,mA));if(1===mI(c)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let d="u">typeof a.senderPublicKey?ie(a.senderPublicKey,mB):void 0,e="u">typeof a.iv?ie(a.iv,mB):jD(12),f=mL({type:c,sealed:lb(ie(a.symKey,mB),e).encrypt(ie(a.message,mE)),iv:e,senderPublicKey:d});return a.encoding===mD?mJ(f):f}({type:h,symKey:g,message:e,senderPublicKey:i,encoding:c?.encoding})}),pd(this,"decode",async(a,b,c)=>{let d;this.isInitialized();let e=mN({type:mI((d=mM({encoded:b,encoding:c?.encoding})).type),senderPublicKey:"u">typeof d.senderPublicKey?ig(d.senderPublicKey,mB):void 0,receiverPublicKey:c?.receiverPublicKey});if(2===e.type)return ag(function(a,b){let{sealed:c}=mM({encoded:a,encoding:b});return ig(c,mE)}(b,c?.encoding));if(mO(e)){let b=e.receiverPublicKey,c=e.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=function(a){let b=ie(a.symKey,mB),{sealed:c,iv:d}=mM({encoded:a.encoded,encoding:a.encoding}),e=lb(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return ig(e,mE)}({symKey:d,encoded:b,encoding:c?.encoding});return ag(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),pd(this,"getPayloadType",(a,b=mC)=>mI(mM({encoded:a,encoding:b}).type)),pd(this,"getPayloadSenderPublicKey",(a,b=mC)=>{let c=mM({encoded:a,encoding:b});return c.senderPublicKey?ig(c.senderPublicKey,mB):void 0}),this.core=a,this.logger=a2(b,this.name),this.keychain=c||new pb(this.core,this.logger)}get context(){return a1(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(n1)}catch{a=mF(),await this.keychain.set(n1,a)}return function(a,b="utf8"){let c=o8[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?o4(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}}var pf=Object.defineProperty,pg=Object.defineProperties,ph=Object.getOwnPropertyDescriptors,pi=Object.getOwnPropertySymbols,pj=Object.prototype.hasOwnProperty,pk=Object.prototype.propertyIsEnumerable,pl=(a,b,c)=>b in a?pf(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pm=(a,b,c)=>pl(a,"symbol"!=typeof b?b+"":b,c);class pn extends a9{constructor(a,b){super(a,b),this.logger=a,this.core=b,pm(this,"messages",new Map),pm(this,"messagesWithoutClientAck",new Map),pm(this,"name","messages"),pm(this,"version","0.3"),pm(this,"initialized",!1),pm(this,"storagePrefix",n_),pm(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),pm(this,"set",async(a,b,c)=>{this.isInitialized();let d=mH(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===og){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,pg(((a,b)=>{for(var c in b||(b={}))pj.call(b,c)&&pl(a,c,b[c]);if(pi)for(var c of pi(b))pk.call(b,c)&&pl(a,c,b[c]);return a})({},c),ph({[d]:b})))}return await this.persist(),d}),pm(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),pm(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),pm(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[mH(b)])),pm(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=mH(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),pm(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=a2(a,this.name),this.core=b}get context(){return a1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,iI(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,iI(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?iJ(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?iJ(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}}var po=Object.defineProperty,pp=Object.defineProperties,pq=Object.getOwnPropertyDescriptors,pr=Object.getOwnPropertySymbols,ps=Object.prototype.hasOwnProperty,pt=Object.prototype.propertyIsEnumerable,pu=(a,b,c)=>b in a?po(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pv=(a,b)=>{for(var c in b||(b={}))ps.call(b,c)&&pu(a,c,b[c]);if(pr)for(var c of pr(b))pt.call(b,c)&&pu(a,c,b[c]);return a},pw=(a,b,c)=>pu(a,"symbol"!=typeof b?b+"":b,c);class px extends ba{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,pw(this,"events",new L.EventEmitter),pw(this,"name","publisher"),pw(this,"queue",new Map),pw(this,"publishTimeout",(0,M.toMiliseconds)(M.ONE_MINUTE)),pw(this,"initialPublishTimeout",(0,M.toMiliseconds)(15*M.ONE_SECOND)),pw(this,"needsTransportRestart",!1),pw(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||n3,j=c?.prompt||!1,k=c?.tag||0,l=c?.id||nJ().toString(),m=mQ(mP().protocol),n={id:l,method:c?.publishMethod||m.publish,params:pv({topic:a,message:b,ttl:i,prompt:j,tag:k,attestation:c?.attestation},c?.tvf)},o=`Failed to publish payload, please try again. id:${l} tag:${k}`;try{nk(null==(d=n.params)?void 0:d.prompt)&&(null==(e=n.params)||delete e.prompt),nk(null==(f=n.params)?void 0:f.tag)&&(null==(g=n.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=n.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(n8,b),a())};this.relayer.events.on(n8,b);let d=iL(new Promise((a,b)=>{this.rpcPublish(n,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${k}`);try{await d,this.events.removeListener(n8,b)}catch(a){this.queue.set(l,{request:n,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:a,message:b,opts:c}}),await iL(h,this.publishTimeout,o)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(l)}}),pw(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:h={}}=a,{attestation:i,tvf:j,publishMethod:k,prompt:l,tag:m,ttl:n=M.FIVE_MINUTES}=h,o=h.id||nJ().toString(),p=mQ(mP().protocol),q=k||p.publish,r={id:o,method:q,params:pv(pp(pv({},g),pq({ttl:n,prompt:l,tag:m,attestation:i})),j)},s=`Failed to publish custom payload, please try again. id:${o} tag:${m}`;try{nk(null==(b=r.params)?void 0:b.prompt)&&(null==(c=r.params)||delete c.prompt),nk(null==(d=r.params)?void 0:d.tag)&&(null==(e=r.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=r.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(n8,b),a())};this.relayer.events.on(n8,b);let c=iL(new Promise((a,b)=>{this.rpcPublish(r,h).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${q} id:${o} tag:${m}`);try{await c,this.events.removeListener(n8,b)}catch(a){this.queue.set(o,{request:r,opts:h,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:o,payload:g,opts:h}}),await iL(a,this.publishTimeout,s)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=h?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(o)}}),pw(this,"on",(a,b)=>{this.events.on(a,b)}),pw(this,"once",(a,b)=>{this.events.once(a,b)}),pw(this,"off",(a,b)=>{this.events.off(a,b)}),pw(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=a2(b,this.name),this.registerEventListeners()}get context(){return a1(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(n8,pv(pv({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,pp(pv({},a),pq({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Q,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(n7);return}this.checkQueue()}),this.relayer.on(n6,a=>{this.removeRequestFromQueue(a.id.toString())})}}var py=Object.defineProperty,pz=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?py(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class pA{constructor(){pz(this,"map",new Map),pz(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),pz(this,"get",a=>this.map.get(a)||[]),pz(this,"exists",(a,b)=>this.get(a).includes(b)),pz(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),pz(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var pB=Object.defineProperty,pC=Object.defineProperties,pD=Object.getOwnPropertyDescriptors,pE=Object.getOwnPropertySymbols,pF=Object.prototype.hasOwnProperty,pG=Object.prototype.propertyIsEnumerable,pH=(a,b,c)=>b in a?pB(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pI=(a,b)=>{for(var c in b||(b={}))pF.call(b,c)&&pH(a,c,b[c]);if(pE)for(var c of pE(b))pG.call(b,c)&&pH(a,c,b[c]);return a},pJ=(a,b,c)=>pH(a,"symbol"!=typeof b?b+"":b,c);class pK extends bd{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,pJ(this,"subscriptions",new Map),pJ(this,"topicMap",new pA),pJ(this,"events",new L.EventEmitter),pJ(this,"name","subscription"),pJ(this,"version","0.3"),pJ(this,"pending",new Map),pJ(this,"cached",[]),pJ(this,"initialized",!1),pJ(this,"storagePrefix",n_),pJ(this,"subscribeTimeout",(0,M.toMiliseconds)(M.ONE_MINUTE)),pJ(this,"initialSubscribeTimeout",(0,M.toMiliseconds)(15*M.ONE_SECOND)),pJ(this,"clientId"),pJ(this,"batchSubscribeTopicsLimit",500),pJ(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),pJ(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=mP(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),pJ(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),pJ(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),pJ(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),pJ(this,"on",(a,b)=>{this.events.on(a,b)}),pJ(this,"once",(a,b)=>{this.events.once(a,b)}),pJ(this,"off",(a,b)=>{this.events.off(a,b)}),pJ(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),pJ(this,"start",async()=>{await this.onConnect()}),pJ(this,"stop",async()=>{await this.onDisconnect()}),pJ(this,"restart",async()=>{await this.restore(),await this.onRestart()}),pJ(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),pJ(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Q,async()=>{await this.checkPending()}),this.events.on(oi,async a=>{this.logger.info(`Emitting ${oi}`),this.logger.debug({type:"event",event:oi,data:a}),await this.persist()}),this.events.on(oj,async a=>{this.logger.info(`Emitting ${oj}`),this.logger.debug({type:"event",event:oj,data:a}),await this.persist()})}),this.relayer=a,this.logger=a2(b,this.name),this.clientId=""}get context(){return a1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=mP(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=nh("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==of||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:mQ(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let h=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===oe)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,M.toMiliseconds)(M.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(oi,c),b(d.id))};this.events.on(oi,c);try{let d=await iL(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(oi,c),b(d)}catch{}}),d=await iL(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&h)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(n7),h)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:mQ(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await iL(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(n7)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:mQ(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await iL(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(n7)}return b}rpcUnsubscribe(a,b,c){let d={method:mQ(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,pC(pI({},b),pD({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,pI({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,pI({},b)),this.topicMap.set(b.topic,a),this.events.emit(oi,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=ng("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(oj,pC(pI({},c),pD({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=ng("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>pC(pI({},a),pD({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){var b;if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let c=await this.rpcBatchFetchMessages(a);c&&c.messages&&(await (b=(0,M.toMiliseconds)(M.ONE_SECOND),new Promise(a=>setTimeout(a,b))),await this.relayer.handleBatchMessageEvents(c.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return mH(a+await this.getClientId())}}var pL=Object.defineProperty,pM=Object.getOwnPropertySymbols,pN=Object.prototype.hasOwnProperty,pO=Object.prototype.propertyIsEnumerable,pP=(a,b,c)=>b in a?pL(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pQ=(a,b)=>{for(var c in b||(b={}))pN.call(b,c)&&pP(a,c,b[c]);if(pM)for(var c of pM(b))pO.call(b,c)&&pP(a,c,b[c]);return a},pR=(a,b,c)=>pP(a,"symbol"!=typeof b?b+"":b,c);class pS extends bb{constructor(b){var c;super(b),pR(this,"protocol","wc"),pR(this,"version",2),pR(this,"core"),pR(this,"logger"),pR(this,"events",new L.EventEmitter),pR(this,"provider"),pR(this,"messages"),pR(this,"subscriber"),pR(this,"publisher"),pR(this,"name","relayer"),pR(this,"transportExplicitlyClosed",!1),pR(this,"initialized",!1),pR(this,"connectionAttemptInProgress",!1),pR(this,"relayUrl"),pR(this,"projectId"),pR(this,"packageName"),pR(this,"bundleId"),pR(this,"hasExperiencedNetworkDisruption",!1),pR(this,"pingTimeout"),pR(this,"heartBeatTimeout",(0,M.toMiliseconds)(M.THIRTY_SECONDS+M.FIVE_SECONDS)),pR(this,"reconnectTimeout"),pR(this,"connectPromise"),pR(this,"reconnectInProgress",!1),pR(this,"requestsInFlight",[]),pR(this,"connectTimeout",(0,M.toMiliseconds)(15*M.ONE_SECOND)),pR(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||nJ().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),pR(this,"resetPingTimeout",()=>{iA()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),pR(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),pR(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),pR(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),pR(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),pR(this,"registerProviderListeners",()=>{this.provider.on(n9,this.onPayloadHandler),this.provider.on(oa,this.onConnectHandler),this.provider.on(ob,this.onDisconnectHandler),this.provider.on(oc,this.onProviderErrorHandler)}),this.core=b.core,this.logger=nB({logger:null!=(c=b.logger)?c:"error",name:this.name}),this.messages=new pn(this.logger,b.core),this.subscriber=new pK(this,this.logger),this.publisher=new px(this,this.logger),this.projectId=b?.projectId,this.relayUrl=b?.relayUrl||n4,iB()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"?this.packageName=iE():iB()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"&&(this.bundleId=iE()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return a1(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:of},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(oi,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(oi,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,pQ({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await iL(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await nw())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=iO(M.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(n5,a),await this.recordMessageEvent(a,og)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(ob,c),await iL(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(ob,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(ob,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(ob,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,M.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(iA())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new nW(new nZ(function({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){var j,k;let l,m=c.split("?"),n=iG(a,b,d),o=(j=m[1]||"",k={auth:e,ua:n,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0},l=new URLSearchParams(j),Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,b])=>{null!=b&&l.set(a,String(b))}),l.toString());return m[0]+"?"+o}({sdkVersion:od,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),nS(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:of,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pQ({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else nT(a)&&this.events.emit(n6,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,og),this.events.emit(n5,a))}async acknowledgePayload(a){let b=nL(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(n9,this.onPayloadHandler),this.provider.off(oa,this.onConnectHandler),this.provider.off(ob,this.onDisconnectHandler),this.provider.off(oc,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let b=await nw();(function(b){var c,d;switch(iD()){case iz:c=b,!iB()&&iC()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case ix:d=b,iB()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected))}})(async a=>{b!==a&&(b=a,a?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Q,async()=>{var a;if(!this.transportExplicitlyClosed&&!this.connected&&(!(iC()&&(0,dF.getDocument)())||(null==(a=(0,dF.getDocument)())?void 0:a.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,M.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function pT(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function pU(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let pV="[object Arguments]",pW="[object Object]";function pX(){}function pY(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var pZ=Object.defineProperty,p$=Object.getOwnPropertySymbols,p_=Object.prototype.hasOwnProperty,p0=Object.prototype.propertyIsEnumerable,p1=(a,b,c)=>b in a?pZ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,p2=(a,b)=>{for(var c in b||(b={}))p_.call(b,c)&&p1(a,c,b[c]);if(p$)for(var c of p$(b))p0.call(b,c)&&p1(a,c,b[c]);return a},p3=(a,b,c)=>p1(a,"symbol"!=typeof b?b+"":b,c);class p4 extends bc{constructor(a,b,c,d=n_,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,p3(this,"map",new Map),p3(this,"version","0.3"),p3(this,"cached",[]),p3(this,"initialized",!1),p3(this,"getKey"),p3(this,"storagePrefix",n_),p3(this,"recentlyDeleted",[]),p3(this,"recentlyDeletedLimit",200),p3(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{var b;this.getKey&&null!==a&&!nk(a)?this.map.set(this.getKey(a),a):(null==(b=a?.proposer)?void 0:b.publicKey)?this.map.set(a.id,a):a?.topic&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),p3(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),p3(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),p3(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=pU(c),h=pU(d);if(g===pV&&(g=pW),h===pV&&(h=pW),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case pW:{if(!(b(c.constructor,d.constructor,e,f)||pY(c)&&pY(d)))return!1;let g=[...Object.keys(c),...pT(c)],h=[...Object.keys(d),...pT(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,pX)})):this.values)),p3(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=p2(p2({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),p3(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=a2(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return a1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=ng("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=ng("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=ng("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}}var p5=Object.defineProperty,p6=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?p5(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class p7{constructor(a,b){this.core=a,this.logger=b,p6(this,"name","pairing"),p6(this,"version","0.3"),p6(this,"events",new L.default),p6(this,"pairings"),p6(this,"initialized",!1),p6(this,"storagePrefix",n_),p6(this,"ignoredPayloadTypes",[1]),p6(this,"registeredMethods",[]),p6(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),p6(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),p6(this,"create",async a=>{this.isInitialized();let b=mF(),c=await this.core.crypto.setSymKey(b),d=iO(M.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=m$({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(ol,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),p6(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=mZ(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let i=g||iO(M.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(ol,j),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),j}),p6(this,"activate",async({topic:a})=>{this.isInitialized();let b=iO(M.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),p6(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=iK();this.events.once(iQ("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),p6(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),p6(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),p6(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),p6(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",nh("USER_DISCONNECTED")),await this.deletePairing(b))}),p6(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return m$({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),p6(this,"sendRequest",async(a,b,c)=>{let d=nK(b,c),e=await this.core.crypto.encode(a,d),f=ok[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),p6(this,"sendResult",async(a,b,c)=>{let d=nL(a,c),e=await this.core.crypto.encode(b,d),f=ok[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),p6(this,"sendError",async(a,b,c)=>{let d=nM(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=ok[f]?ok[f].res:ok.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),p6(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,nh("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),p6(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>iP(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),p6(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),p6(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),p6(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),p6(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{nU(b)?this.events.emit(iQ("pairing_ping",c),{}):nV(b)&&this.events.emit(iQ("pairing_ping",c),{error:b.error})},500)}),p6(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(om,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),p6(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=nh("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),p6(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(nh("WC_METHOD_UNSUPPORTED",a))}),p6(this,"isValidPair",(a,b)=>{var c;if(!ns(a)){let{message:c}=ng("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(ow),Error(c)}if(!function(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(nl(a,!1)){if(b(a))return!0;let c=iX(a);return b(c)}}catch{}return!1}(a.uri)){let{message:c}=ng("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(ow),Error(c)}let d=mZ(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=ng("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(ow),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=ng("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(ow),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,M.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=ng("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),p6(this,"isValidPing",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),p6(this,"isValidDisconnect",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),p6(this,"isValidPairingTopic",async a=>{if(!nl(a,!1)){let{message:b}=ng("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=ng("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(iP(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=ng("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=a2(b,this.name),this.pairings=new p4(this.core,this.logger,this.name,this.storagePrefix)}get context(){return a1(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(n5,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==oe&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);nS(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):nT(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(os,async a=>{let{topic:b}=iN(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var p8=Object.defineProperty,p9=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?p8(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class qa extends a8{constructor(a,b){super(a,b),this.core=a,this.logger=b,p9(this,"records",new Map),p9(this,"events",new L.EventEmitter),p9(this,"name","history"),p9(this,"version","0.3"),p9(this,"cached",[]),p9(this,"initialized",!1),p9(this,"storagePrefix",n_),p9(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),p9(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:iO(M.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(on,d)}),p9(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=nV(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(oo,b))}),p9(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),p9(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(op,c)))}),this.persist()}),p9(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),p9(this,"on",(a,b)=>{this.events.on(a,b)}),p9(this,"once",(a,b)=>{this.events.once(a,b)}),p9(this,"off",(a,b)=>{this.events.off(a,b)}),p9(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=a2(b,this.name)}get context(){return a1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:nK(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=ng("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=ng("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(on,a=>{this.logger.info(`Emitting ${on}`),this.logger.debug({type:"event",event:on,record:a})}),this.events.on(oo,a=>{this.logger.info(`Emitting ${oo}`),this.logger.debug({type:"event",event:oo,record:a})}),this.events.on(op,a=>{this.logger.info(`Emitting ${op}`),this.logger.debug({type:"event",event:op,record:a})}),this.core.heartbeat.on(Q,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,M.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(op,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}}var qb=Object.defineProperty,qc=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?qb(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class qd extends be{constructor(a,b){super(a,b),this.core=a,this.logger=b,qc(this,"expirations",new Map),qc(this,"events",new L.EventEmitter),qc(this,"name","expirer"),qc(this,"version","0.3"),qc(this,"cached",[]),qc(this,"initialized",!1),qc(this,"storagePrefix",n_),qc(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),qc(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),qc(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(oq,{target:c,expiration:d})}),qc(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),qc(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(or,{target:b,expiration:c})}}),qc(this,"on",(a,b)=>{this.events.on(a,b)}),qc(this,"once",(a,b)=>{this.events.once(a,b)}),qc(this,"off",(a,b)=>{this.events.off(a,b)}),qc(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=a2(b,this.name)}get context(){return a1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return iM("topic",a);if("number"==typeof a)return iM("id",a);let{message:b}=ng("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=ng("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=ng("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,M.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(os,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(Q,()=>this.checkExpirations()),this.events.on(oq,a=>{this.logger.info(`Emitting ${oq}`),this.logger.debug({type:"event",event:oq,data:a}),this.persist()}),this.events.on(os,a=>{this.logger.info(`Emitting ${os}`),this.logger.debug({type:"event",event:os,data:a}),this.persist()}),this.events.on(or,a=>{this.logger.info(`Emitting ${or}`),this.logger.debug({type:"event",event:or,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}}var qe=Object.defineProperty,qf=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?qe(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class qg extends bf{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,qf(this,"name","verify-api"),qf(this,"abortController"),qf(this,"isDevEnv"),qf(this,"verifyUrlV3",ou),qf(this,"storagePrefix",n_),qf(this,"version",2),qf(this,"publicKey"),qf(this,"fetchPromise"),qf(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,M.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),qf(this,"register",async a=>{if(!iC()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,dF.getDocument)(),b=this.startAbortTimer(5*M.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if(dt(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(a){this.logger.warn(a)}return""}),qf(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if(dt(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),qf(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*M.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),qf(this,"getVerifyUrl",a=>{let b=a||ot;return ov.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${ot}`),b=ot),b}),qf(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(M.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),qf(this,"persistPublicKey",async a=>{this.logger.debug(a,"persisting public key to local storage"),await this.store.setItem(this.storeKey,a),this.publicKey=a}),qf(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),qf(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),qf(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),qf(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),qf(this,"validateAttestation",(a,b)=>{let c=function(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(mK(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=j8(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),gQ([new Uint8Array([4]),c,d]));if(!mz.verify(gQ([i,j]),k,l))throw Error("Invalid signature");return dt(a).payload}(a,b.publicKey),d={hasExpired:(0,M.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=a2(b,this.name),this.abortController=new AbortController,this.isDevEnv=iW(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return a1(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,M.toMiliseconds)(a))}}var qh=Object.defineProperty,qi=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?qh(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class qj extends bg{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,qi(this,"context","echo"),qi(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=a2(b,this.context)}}var qk=Object.defineProperty,ql=Object.getOwnPropertySymbols,qm=Object.prototype.hasOwnProperty,qn=Object.prototype.propertyIsEnumerable,qo=(a,b,c)=>b in a?qk(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,qp=(a,b)=>{for(var c in b||(b={}))qm.call(b,c)&&qo(a,c,b[c]);if(ql)for(var c of ql(b))qn.call(b,c)&&qo(a,c,b[c]);return a},qq=(a,b,c)=>qo(a,"symbol"!=typeof b?b+"":b,c);class qr extends bh{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,qq(this,"context","event-client"),qq(this,"storagePrefix",n_),qq(this,"storageVersion",.1),qq(this,"events",new Map),qq(this,"shouldPersist",!1),qq(this,"init",async()=>{if(!iW())try{let a={eventId:iV(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:iG(this.core.relayer.protocol,this.core.relayer.version,od)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),qq(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=iV(),g=this.core.projectId||"",h=qp({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),qq(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return qp(qp({},d),this.setMethods(d.eventId))}),qq(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),qq(this,"setEventListeners",()=>{this.core.heartbeat.on(Q,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,M.fromMiliseconds)(Date.now())-(0,M.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),qq(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),qq(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),qq(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),qq(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),qq(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,qp(qp({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),qq(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),qq(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${od}${b}`,{method:"POST",body:JSON.stringify(a)})}),qq(this,"getAppDomain",()=>iF().url),this.logger=a2(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var qs=Object.defineProperty,qt=Object.getOwnPropertySymbols,qu=Object.prototype.hasOwnProperty,qv=Object.prototype.propertyIsEnumerable,qw=(a,b,c)=>b in a?qs(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,qx=(a,b)=>{for(var c in b||(b={}))qu.call(b,c)&&qw(a,c,b[c]);if(qt)for(var c of qt(b))qv.call(b,c)&&qw(a,c,b[c]);return a},qy=(a,b,c)=>qw(a,"symbol"!=typeof b?b+"":b,c);class qz extends a6{constructor(a){var b;super(a),qy(this,"protocol","wc"),qy(this,"version",2),qy(this,"name",n$),qy(this,"relayUrl"),qy(this,"projectId"),qy(this,"customStoragePrefix"),qy(this,"events",new L.EventEmitter),qy(this,"logger"),qy(this,"heartbeat"),qy(this,"relayer"),qy(this,"crypto"),qy(this,"storage"),qy(this,"history"),qy(this,"expirer"),qy(this,"pairing"),qy(this,"verify"),qy(this,"echoClient"),qy(this,"linkModeSupportedApps"),qy(this,"eventClient"),qy(this,"initialized",!1),qy(this,"logChunkController"),qy(this,"on",(a,b)=>this.events.on(a,b)),qy(this,"once",(a,b)=>this.events.once(a,b)),qy(this,"off",(a,b)=>this.events.off(a,b)),qy(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),qy(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:oe};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const c=this.getGlobalCore(a?.customStoragePrefix);if(c)try{return this.customStoragePrefix=c.customStoragePrefix,this.logger=c.logger,this.heartbeat=c.heartbeat,this.crypto=c.crypto,this.history=c.history,this.expirer=c.expirer,this.storage=c.storage,this.relayer=c.relayer,this.pairing=c.pairing,this.verify=c.verify,this.echoClient=c.echoClient,this.linkModeSupportedApps=c.linkModeSupportedApps,this.eventClient=c.eventClient,this.initialized=c.initialized,this.logChunkController=c.logChunkController,c}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||n4,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const{logger:d,chunkLoggerController:e}=a3({opts:function(a){return aW(a0({},a),aX({level:a?.level||"info"}))}({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:n$}),maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=e,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=a2(d,this.name),this.heartbeat=new R,this.crypto=new pe(this,this.logger,a?.keychain),this.history=new qa(this,this.logger),this.expirer=new qd(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new aq(qx(qx({},n0),a?.storageOptions)),this.relayer=new pS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new p7(this,this.logger),this.verify=new qg(this,this.logger,this.storage),this.echoClient=new qj(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new qr(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new qz(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return a1(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(oh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(oh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(a,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let qA="client",qB=`wc@2:${qA}:`,qC="WALLETCONNECT_DEEPLINK_CHOICE",qD=(M.THIRTY_DAYS,"Proposal expired"),qE=M.SEVEN_DAYS,qF={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},qG={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},qH="IDLE",qI="ACTIVE",qJ={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},qK=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],qL="wc@1.5:auth:",qM=`${qL}:PUB_KEY`;var qN=Object.defineProperty,qO=Object.defineProperties,qP=Object.getOwnPropertyDescriptors,qQ=Object.getOwnPropertySymbols,qR=Object.prototype.hasOwnProperty,qS=Object.prototype.propertyIsEnumerable,qT=(a,b,c)=>b in a?qN(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,qU=(a,b)=>{for(var c in b||(b={}))qR.call(b,c)&&qT(a,c,b[c]);if(qQ)for(var c of qQ(b))qS.call(b,c)&&qT(a,c,b[c]);return a},qV=(a,b,c)=>qT(a,"symbol"!=typeof b?b+"":b,c);class qW extends bl{constructor(b){super(b),qV(this,"name","engine"),qV(this,"events",new L.default),qV(this,"initialized",!1),qV(this,"requestQueue",{state:qH,queue:[]}),qV(this,"sessionRequestQueue",{state:qH,queue:[]}),qV(this,"emittedSessionRequests",new iY({limit:500})),qV(this,"requestQueueDelay",M.ONE_SECOND),qV(this,"expectedPairingMethodMap",new Map),qV(this,"recentlyDeletedMap",new Map),qV(this,"recentlyDeletedLimit",200),qV(this,"relayMessageCache",[]),qV(this,"pendingSessions",new Map),qV(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(qF)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,M.toMiliseconds)(this.requestQueueDelay)))}),qV(this,"connect",async a=>{var b;this.isInitialized(),await this.confirmOnlineStateOrThrow();let c=qO(qU({},a),qP({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(c),c.optionalNamespaces=function(a,b){var c,d,e,f,g,h;let i=nc(a),j=nc(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:iR(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:iR(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:iR(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}(c.requiredNamespaces,c.optionalNamespaces),c.requiredNamespaces={};let{pairingTopic:d,requiredNamespaces:e,optionalNamespaces:f,sessionProperties:g,scopedProperties:h,relays:i,authentication:j,walletPay:k}=c,l=(null==(b=j?.[0])?void 0:b.ttl)||qF.wc_sessionPropose.req.ttl||M.FIVE_MINUTES;this.validateRequestExpiry(l);let m=d,n,o=!1;try{if(m){let a=this.client.core.pairing.pairings.get(m);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),o=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${m}) failed`),a}if(!m||!o){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});m=a,n=b}if(!m){let{message:a}=ng("NO_MATCHING_KEY",`connect() pairing topic: ${m}`);throw Error(a)}let p=await this.client.core.crypto.generateKeyPair(),q=iO(l),r=qU(qO(qU(qU({requiredNamespaces:e,optionalNamespaces:f,relays:i??[{protocol:"irn"}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:q,pairingTopic:m},g&&{sessionProperties:g}),h&&{scopedProperties:h}),qP({id:nI()})),(j||k)&&{requests:{authentication:j?.map(a=>{let{domain:b,chains:c,nonce:d,uri:e,exp:f,nbf:g,type:h,statement:i,requestId:j,resources:k,signatureTypes:l}=a;return{domain:b,chains:c,nonce:d,type:h??"caip122",aud:e,version:"1",iat:new Date().toISOString(),exp:f,nbf:g,statement:i,requestId:j,resources:k,signatureTypes:l}}),walletPay:k}}),s=iQ("session_connect",r.id),{reject:t,resolve:u,done:v}=iK(l,qD),w=({id:a})=>{a===r.id&&(this.client.events.off("proposal_expire",w),this.pendingSessions.delete(r.id),this.events.emit(s,{error:{message:qD,code:0}}))};return this.client.events.on("proposal_expire",w),this.events.once(s,({error:a,session:b})=>{this.client.events.off("proposal_expire",w),a?t(a):b&&u(b)}),await this.setProposal(r.id,r),await this.sendProposeSession({proposal:r,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:r.id}}}).catch(a=>{throw this.deleteProposal(r.id),a}),{uri:n,approval:v}}),qV(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),qV(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[ox]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k,proposalRequestsResponses:l}=a,m=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:n,proposer:o,requiredNamespaces:p,optionalNamespaces:q}=m,r=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:n});r||(r=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:ox,properties:{topic:n,trace:[ox,"session_namespaces_validation_success"]}}));let s=await this.client.core.crypto.generateKeyPair(),t=o.publicKey,u=await this.client.core.crypto.generateSharedKey(s,t),v=qO(qU(qU(qU({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:s,metadata:this.client.metadata},expiry:iO(qE)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k}),qP({proposalRequestsResponses:l}));r.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(u,{transportType:of,internal:{skipSubscribe:!0}})}catch(a){throw r.setError("subscribe_session_topic_failure"),a}r.addTrace("subscribe_session_topic_success");let w=qO(qU({},v),qP({topic:u,requiredNamespaces:p,optionalNamespaces:q,pairingTopic:n,acknowledged:!1,self:v.controller,peer:{publicKey:o.publicKey,metadata:o.metadata},controller:s,transportType:of,authentication:l?.authentication,walletPayResult:l?.walletPay}));await this.client.session.set(u,w),r.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:u,proposal:m,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:s},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:qU({correlationId:f},this.getTVFApproveParams(w))}}),r.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(u,nh("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(u),a}return this.client.core.eventClient.deleteEvent({eventId:r.eventId}),await this.client.core.pairing.updateMetadata({topic:n,metadata:o.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:n}),await this.setExpiry(u,iO(qE)),{topic:u,acknowledged:()=>Promise.resolve(this.client.session.get(u))}}),qV(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:qF.wc_sessionPropose.reject}),await this.deleteProposal(c)}),qV(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=iK(M.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),g=nI(),h=nJ().toString(),i=this.client.session.get(b).namespaces;return this.events.once(iQ("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),qV(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=nI(),{done:d,resolve:e,reject:f}=iK(M.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(iQ("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,iO(qE)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),qV(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=qF.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===of&&await this.confirmOnlineStateOrThrow();let g=nI(),h=nJ().toString(),{done:i,resolve:j,reject:k}=iK(e,"Request expired. Please try again.");this.events.once(iQ("session_request",g),({error:a,result:b})=>{a?k(a):j(b)});let l="wc_sessionRequest",m=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(m)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:{request:qO(qU({},c),qP({expiryTimestamp:iO(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:m}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let n={request:qO(qU({},c),qP({expiryTimestamp:iO(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:n,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,n)}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await iT(this.client.core.storage,qC);await iS({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),qV(this,"respond",async a=>{var b,c;this.isInitialized();let d=this.client.core.eventClient.createEvent({properties:{topic:a?.topic||(null==(c=null==(b=a?.response)?void 0:b.id)?void 0:c.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_validation_failure"),a}d.addTrace("session_request_response_validation_success");let{topic:e,response:f}=a,{id:g}=f,h=this.client.session.get(e);h.transportType===of&&await this.confirmOnlineStateOrThrow();let i=this.getAppLinkIfEnabled(h.peer.metadata,h.transportType);try{d.addTrace("session_request_response_publish_started"),nU(f)?await this.sendResult({id:g,topic:e,result:f.result,throwOnFailedPublish:!0,appLink:i}):nV(f)&&await this.sendError({id:g,topic:e,error:f.error,appLink:i}),this.cleanupAfterResponse(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_publish_failure"),a}}),qV(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=nI(),c=nJ().toString(),{done:d,resolve:e,reject:f}=iK(M.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(iQ("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),qV(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=nJ().toString(),f=nI();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),qV(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:nh("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=ng("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),qV(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(function(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!iH(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=m9(d),i=c[b];iH(im(b,i),h)&&iH(i.methods,e)&&iH(i.events,g)||(f=!1)}),f)})(b,a)))),qV(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),qV(this,"authenticate",async(a,b)=>{var c,d,e,f,g;let h;this.isInitialized(),this.isValidAuthenticate(a);let i=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),j=i?oe:of;j===of&&await this.confirmOnlineStateOrThrow();let{chains:k,statement:l="",uri:m,domain:n,nonce:o,type:p,exp:q,nbf:r,methods:s=[],expiry:t}=a,u=[...a.resources||[]],{topic:v,uri:w}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:j});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:w}});let x=await this.client.core.crypto.generateKeyPair(),y=mG(x);if(await Promise.all([this.client.auth.authKeys.set(qM,{responseTopic:y,publicKey:x}),this.client.auth.pairingTopics.set(y,{topic:y,pairingTopic:v})]),await this.client.core.relayer.subscribe(y,{transportType:j}),this.client.logger.info(`sending request to new pairing topic: ${v}`),s.length>0){let a,b,{namespace:c}=ij(k[0]),h=kF(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(c,"request",s));kJ(u)&&(d=h,e=u.pop(),h=kF((f=kG(d),g=kG(e),kE(f),kE(g),a=Object.keys(f.att).concat(Object.keys(g.att)).sort((a,b)=>a.localeCompare(b)),b={att:{}},a.forEach(a=>{var c,d;Object.keys((null==(c=f.att)?void 0:c[a])||{}).concat(Object.keys((null==(d=g.att)?void 0:d[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(c=>{var d,e;b.att[a]=kr(((a,b)=>{for(var c in b||(b={}))ku.call(b,c)&&kw(a,c,b[c]);if(kt)for(var c of kt(b))kv.call(b,c)&&kw(a,c,b[c]);return a})({},b.att[a]),ks({[c]:(null==(d=f.att[a])?void 0:d[c])||(null==(e=g.att[a])?void 0:e[c])}))})}),b))),u.push(h)}let z=t&&t>qF.wc_sessionAuthenticate.req.ttl?t:qF.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:p??"caip122",chains:k,statement:l,aud:m,domain:n,version:"1",nonce:o,iat:new Date().toISOString(),exp:q,nbf:r,resources:u},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:iO(z)},B={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:k,methods:[...new Set(["personal_sign",...s])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:iO(qF.wc_sessionPropose.req.ttl),id:nI()},{done:C,resolve:D,reject:E}=iK(z,"Request expired"),F=nI(),G=iQ("session_connect",B.id),H=iQ("session_request",F),I=async({error:a,session:b})=>{this.events.off(H,J),a?E(a):b&&D({session:b})},J=async a=>{var c,d,e;let f;if(await this.deletePendingAuthRequest(F,{message:"fulfilled",code:0}),a.error){let b=nh("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(G,I),E(a.error.message))}await this.deleteProposal(B.id),this.events.off(G,I);let{cacaos:g,responder:h}=a.result,i=[],k=[];for(let a of g){await kC({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),E(nh("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=kJ(b.resources),d=[kA(b.iss)],e=kB(b.iss);if(c){let a=kH(c),b=kI(c);i.push(...a),d.push(...b)}for(let a of d)k.push(`${a}:${e}`)}let l=await this.client.core.crypto.generateSharedKey(x,h.publicKey);i.length>0&&(f={topic:l,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:h,controller:h.publicKey,expiry:iO(qE),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:nd([...new Set(i)],[...new Set(k)]),transportType:j},await this.client.core.relayer.subscribe(l,{transportType:j}),await this.client.session.set(l,f),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:h.metadata}),f=this.client.session.get(l)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=h.metadata.redirect)&&d.linkMode&&null!=(e=h.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.session.update(l,{transportType:oe})),D({auths:g,session:f})};this.events.once(G,I),this.events.once(H,J);try{if(i){let a=nK("wc_sessionAuthenticate",A,F);this.client.core.history.set(v,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:mD});h=m_(b,v,c)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:A,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:F}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:B,expiry:qF.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(a){throw this.events.off(G,I),this.events.off(H,J),a}return await this.setProposal(B.id,B),await this.setAuthRequest(F,{request:qO(qU({},A),qP({verifyContext:{}})),pairingTopic:v,transportType:j}),{uri:h??w,response:C}}),qV(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||of;g===of&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=mG(h),k={type:1,receiverPublicKey:h,senderPublicKey:i},l=[],m=[];for(let a of d){if(!await kC({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=nh("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:k}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=kJ(b.resources),f=[kA(b.iss)],g=kB(b.iss);if(d){let a=kH(d),b=kI(d);l.push(...a),f.push(...b)}for(let a of f)m.push(`${a}:${g}`)}let n=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),l?.length>0){b={topic:n,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:iO(qE),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:nd([...new Set(l)],[...new Set(m)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(n,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(n,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:k,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),qV(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===of&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=mG(e);await this.sendError({id:b,topic:g,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:qF.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),qV(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return kD(b,c)}),qV(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),qV(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),qV(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,nh("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(qC).catch(a=>this.client.logger.warn(a)),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=qH),await Promise.all(this.getPendingSessionRequests().filter(a=>a.topic===c).map(a=>this.deletePendingSessionRequest(a.id,nh("USER_DISCONNECTED")))),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),qV(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,nh("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),qV(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=qH,this.client.events.emit("session_request_expire",{id:a}))}),qV(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),qV(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),qV(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,iO(qF.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),qV(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=of}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),qV(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||iO(qF.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),qV(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:k,appLink:l,tvf:m,publishOpts:n={}}=b,o=nK(f,g,j),p=!!l;try{let a=p?mD:mC;c=await this.client.core.crypto.encode(e,o,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(qK.includes(f)){let a=mH(JSON.stringify(o)),b=mH(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let q=qU(qU({},qF[f].req),n);if(q.attestation=d,h&&(q.ttl=h),i&&(q.id=i),this.client.core.history.set(e,o),p){let b=m_(l,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a;q.tvf=qO(qU({},m),qP({correlationId:o.id})),k?(a=qU({},q.internal),q.internal=qO(a,qP({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(e,c,q)):this.client.core.relayer.publish(e,c,q).catch(a=>this.client.logger.error(a))}return o.id}),qV(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=nK("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:mC}),f=mH(JSON.stringify(d)),g=mH(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:qO(qU({},c),qP({publishMethod:"wc_proposeSession",attestation:h}))})}),qV(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=nL(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:mC}),i=nK("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:mC});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:qO(qU({},f),qP({publishMethod:"wc_approveSession"}))})}),qV(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:k}=b,l=nL(f,h),m=k&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=m?mD:mC;c=await this.client.core.crypto.encode(g,l,(a=qU({},j||{}),b={encoding:d},qO(a,qP(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{e=this.getTVFParams(f,a.params,h)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(m){let b=m_(k,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a,b=qF[d.request.method].res;b.tvf=qO(qU({},e),qP({correlationId:f})),i?(a=qU({},b.internal),b.internal=qO(a,qP({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(g,c,b)):this.client.core.relayer.publish(g,c,b).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(l)}),qV(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,k=nM(e,g),l=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=l?mD:mC;c=await this.client.core.crypto.encode(f,k,(a=qU({},h||{}),b={encoding:d},qO(a,qP(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(l){let b=m_(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||qF[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(k)}),qV(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;iP(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{iP(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),qV(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),qV(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),qV(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===qI)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=qI;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=qH}),qV(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),qV(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),qV(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=ng("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),qV(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),qV(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(qU({},c.params));let h=f.expiryTimestamp||iO(qF.wc_sessionPropose.req.ttl),i=qU({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:mH(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:qF.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),qV(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if(nU(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if(nV(b)){await this.deleteProposal(d);let a=iQ("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),qV(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l,proposalRequestsResponses:m}=b.params,n=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!n)return this.client.logger.error(`Pending session not found for topic ${a}`);let o=this.client.proposal.get(n.proposalId),p=(c=qU(qU(qU({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:n.pairingTopic,requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,controller:g.publicKey,self:{publicKey:n.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),e={transportType:of,authentication:m?.authentication,walletPayResult:m?.walletPay},qO(c,qP(e)));await this.client.session.set(p.topic,p),await this.setExpiry(p.topic,p.expiry),await this.client.core.pairing.updateMetadata({topic:n.pairingTopic,metadata:p.peer.metadata}),this.pendingSessions.delete(n.proposalId),this.deleteProposal(n.proposalId,!1),this.cleanupDuplicatePairings(p),await this.sendResult({id:b.id,topic:a,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:p}),this.events.emit(iQ("session_connect",n.proposalId),{session:p})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),qV(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;nU(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(iQ("session_approve",c),{})):nV(b)&&(await this.client.session.delete(a,nh("USER_DISCONNECTED")),this.events.emit(iQ("session_approve",c),{error:b.error}))}),qV(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=nz.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:nh("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(qU({topic:a},c));try{nz.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw nz.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),qV(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),qV(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=iQ("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);nU(b)?this.events.emit(iQ("session_update",c),{}):nV(b)&&this.events.emit(iQ("session_update",c),{error:b.error})}),qV(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,iO(qE)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),qV(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=iQ("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);nU(b)?this.events.emit(iQ("session_extend",c),{}):nV(b)&&this.events.emit(iQ("session_extend",c),{error:b.error})}),qV(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),qV(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=iQ("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);nU(b)?this.events.emit(iQ("session_ping",c),{}):nV(b)&&this.events.emit(iQ("session_ping",c),{error:b.error})},500)}),qV(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{await this.isValidDisconnect({topic:a,reason:b.params}),this.cleanupPendingSentRequestsForTopic({topic:a,error:nh("USER_DISCONNECTED")}),await this.deleteSession({topic:a,id:c})}catch(a){this.client.logger.error(a)}}),qV(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:k}=f;try{await this.isValidRequest(qU({topic:e},k));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:mH(JSON.stringify(nK("wc_sessionRequest",k,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),l={id:j,topic:e,params:k,verifyContext:f};await this.setPendingSessionRequest(l),i===oe&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(l):(this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),qV(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=iQ("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);nU(b)?this.events.emit(iQ("session_request",c),{result:b.result}):nV(b)&&this.events.emit(iQ("session_request",c),{error:b.error})}),qV(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=nz.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(qU({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),nz.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),qV(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),nU(b)?this.events.emit(iQ("session_request",c),{result:b.result}):nV(b)&&this.events.emit(iQ("session_request",c),{error:b.error})}),qV(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:mH(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),k={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:k,pairingTopic:c,transportType:g}),g===oe&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:qF.wc_sessionAuthenticate.autoReject,appLink:e})}}),qV(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),qV(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=qH,this.processSessionRequestQueue()},(0,M.toMiliseconds)(this.requestQueueDelay))}),qV(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{this.events.emit(iQ("session_request",a.request.id),{error:b})})}),qV(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===qI)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),qV(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=qI,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),qV(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:nK("wc_sessionPropose",qO(qU({},b),qP({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),qV(this,"isValidConnect",async a=>{let b;if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=a;if(nk(c)||await this.isValidPairingTopic(c),b=!1,h?h&&ni(h)&&h.length&&h.forEach(a=>{b=nr(a)}):b=!0,!b){let{message:a}=ng("MISSING_OR_INVALID",`connect() relays: ${h}`);throw Error(a)}if(d&&!nk(d)&&0!==nj(d)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(d,"requiredNamespaces")}if(e&&!nk(e)&&0!==nj(e)&&this.validateNamespaces(e,"optionalNamespaces"),f&&!nk(f)&&this.validateSessionProps(f,"sessionProperties"),g&&!nk(g)){this.validateSessionProps(g,"scopedProperties");let a=Object.keys(d||{}).concat(Object.keys(e||{}));if(!Object.keys(g).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(g)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),qV(this,"validateNamespaces",(a,b)=>{let c=function(a,b,c){let d=null;if(a&&nj(a)){let e,f=np(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=im(a,d),g=`${b} ${c}`,h=null,ni(f)&&f.length?f.forEach(a=>{h||nn(a)||(h=nh("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):nn(a)||(h=nh("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=ng("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}(a,"connect()",b);if(c)throw Error(c.message)}),qV(this,"isValidApprove",async a=>{if(!ns(a))throw Error(ng("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=nq(c,"approve()");if(h)throw Error(h.message);let i=nu(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!nl(d,!0)){let{message:a}=ng("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(e&&!nk(e)&&this.validateSessionProps(e,"sessionProperties"),f&&!nk(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),qV(this,"isValidReject",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!c||"object"!=typeof c||!c.code||!nm(c.code,!1)||!c.message||!nl(c.message,!1)){let{message:a}=ng("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),qV(this,"isValidSessionSettleRequest",a=>{let b;if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:c,controller:d,namespaces:e,expiry:f}=a;if(!nr(c)){let{message:a}=ng("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let g=(b=null,nl(d?.publicKey,!1)||(b=ng("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),b);if(g)throw Error(g.message);let h=nq(e,"onSessionSettleRequest()");if(h)throw Error(h.message);if(iP(f)){let{message:a}=ng("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),qV(this,"isValidUpdate",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=nq(c,"update()");if(e)throw Error(e.message);let f=nu(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),qV(this,"isValidExtend",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),qV(this,"isValidRequest",async a=>{var b;let c;if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:d,request:e,chainId:f,expiry:g}=a;this.checkRecentlyDeleted(d),await this.isValidSessionTopic(d);let{namespaces:h}=this.client.session.get(d);if(!nt(h,f)){let{message:a}=ng("MISSING_OR_INVALID",`request() chainId: ${f}`);throw Error(a)}if(nk(e)||!nl(e.method,!1)){let{message:a}=ng("MISSING_OR_INVALID",`request() ${JSON.stringify(e)}`);throw Error(a)}if(!(nl(b=e.method,!1)&&(c=[],Object.values(h).forEach(a=>{m9(a.accounts).includes(f)&&c.push(...a.methods)}),c).includes(b))){let{message:a}=ng("MISSING_OR_INVALID",`request() method: ${e.method}`);throw Error(a)}this.validateRequestExpiry(g)}),qV(this,"isValidRespond",async a=>{var b;if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(nk(d)||nk(d.result)&&nk(d.error)||!nm(d.id,!1)||!nl(d.jsonrpc,!1)){let{message:a}=ng("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}let e=this.client.pendingRequest.get(d.id);if(e.topic!==c){let{message:a}=ng("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${d.id}, expected topic: ${e.topic}, received topic: ${c}`);throw Error(a)}}),qV(this,"isValidPing",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),qV(this,"isValidEmit",async a=>{var b;let c;if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:d,event:e,chainId:f}=a;await this.isValidSessionTopic(d);let{namespaces:g}=this.client.session.get(d);if(!nt(g,f)){let{message:a}=ng("MISSING_OR_INVALID",`emit() chainId: ${f}`);throw Error(a)}if(nk(e)||!nl(e.name,!1)||!(nl(b=e.name,!1)&&(c=[],Object.values(g).forEach(a=>{m9(a.accounts).includes(f)&&c.push(...a.events)}),c).includes(b))){let{message:a}=ng("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(e)}`);throw Error(a)}}),qV(this,"isValidDisconnect",async a=>{if(!ns(a)){let{message:b}=ng("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),qV(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!nl(c,!1))throw Error("uri is required parameter");if(!nl(d,!1))throw Error("domain is required parameter");if(!nl(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>ij(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=ij(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),qV(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||ot,validation:"UNKNOWN",origin:e.url||""}};try{if(f===oe){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),qV(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=ng("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),qV(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),qV(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),qV(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=ng("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),qV(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,g,h,i,j,k,l;return!!b&&c===oe&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(g=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:g.universal)!==void 0&&(null==(i=null==(h=this.client.metadata)?void 0:h.redirect)?void 0:i.universal)!==""&&(null==(j=b?.redirect)?void 0:j.universal)!==void 0&&(null==(k=b?.redirect)?void 0:k.universal)!==""&&(null==(l=b?.redirect)?void 0:l.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),qV(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),qV(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=iU(a,"topic")||"",c=decodeURIComponent(iU(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:oe}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),qV(this,"registerLinkModeListeners",async()=>{var b;if(iW()||iB()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),qV(this,"getTVFApproveParams",a=>{try{var b,c;let d,e,f=na(a.namespaces),g=(b=a.namespaces,d=[],Object.values(b).forEach(a=>{d.push(...a.methods)}),[...new Set(d)]),h=(c=a.namespaces,e=[],Object.values(c).forEach(a=>{e.push(...a.events)}),[...new Set(e)]),i=a.sessionProperties,j=a.scopedProperties;return{approvedChains:f,approvedMethods:g,approvedEvents:h,sessionProperties:i,scopedProperties:j}}catch(a){return this.client.logger.warn(a,"Error getting TVF approve params"),{}}}),qV(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn(a,"Error getting TVF params")}return g}),qV(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),qV(this,"extractTxHashesFromResult",(a,b)=>{var c,d,e,f,g;try{if(!b)return[];let h=a.method,i=qJ[h];if("sui_signTransaction"===h){let a,c,d,f;return[(e=b.transactionBytes,a=new Uint8Array(Buffer.from(e,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),(d=new Uint8Array(c.length+a.length)).set(c),d.set(a,c.length),f=kj(d,{dkLen:32}),f9.encode(f))]}if("near_signTransaction"===h)return[kn(b)];if("near_signTransactions"===h)return b.map(a=>kn(a));if("xrpl_signTransactionFor"===h||"xrpl_signTransaction"===h)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===h){let c,e,f,g;return[(d={transaction:a.params.transactionPayload,signature:b.signature},f=Uint8Array.from(Buffer.from(d.signature,"hex")),g=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=nA(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,g=f9.decode(e)[0],42===g?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):nA(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),n=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(n.length+1),i,...n])}({publicKey:function(a){let b=f9.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(d.transaction.address),signature:f,payload:d.transaction}),c=nA(Buffer.from(g).toString("hex")),e=(0,ii.blake2b)(c,void 0,32),"0x"+Buffer.from(e).toString("hex"))]}if("algo_signTxn"===h)return ni(b)?b.map(a=>ko(a)):[ko(b)];if("cosmos_signDirect"===h){let a,c,d,e,f;return[(a=Buffer.from(b.signed.bodyBytes,"base64"),c=Buffer.from(b.signed.authInfoBytes,"base64"),d=Buffer.from(b.signature.signature,"base64"),(e=[]).push(Buffer.from([10])),e.push(kp(a.length)),e.push(a),e.push(Buffer.from([18])),e.push(kp(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(kp(d.length)),e.push(d),f=j8(Buffer.concat(e)),Buffer.from(f).toString("hex").toUpperCase())]}if("wallet_sendCalls"===h){let a=[];try{if("string"==typeof b)return a.push(b),a;if("object"!=typeof b)return a;null!=b&&b.id&&a.push(b.id);let c=null==(g=null==(f=b?.capabilities)?void 0:f.caip345)?void 0:g.transactionHashes;c&&a.push(...c)}catch(a){console.warn("getWalletSendCallsHashes failed: ",a)}return a}if("string"==typeof b)return[b];let j=b[i.key];if(ni(j))return"solana_signAllTransactions"===h?j.map(a=>(function(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return f9.encode(e)})(a)):j;if("string"==typeof j)return[j]}catch(a){this.client.logger.warn(a,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn(a,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:a}=ng("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(n5,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(qM)?this.client.auth.authKeys.get(qM):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===oe?mD:mC});nS(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:mH(c)})):nT(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e})),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${c}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(os,async a=>{let{topic:b,id:c}=iN(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,ng("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,ng("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(ol,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(om,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!nl(a,!1)){let{message:b}=ng("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=ng("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(iP(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=ng("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!nl(a,!1)){let{message:b}=ng("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=ng("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(iP(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=ng("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=ng("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(nl(a,!1)){let{message:b}=ng("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=ng("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if("number"!=typeof a){let{message:b}=ng("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=ng("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(iP(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=ng("EXPIRED",`proposal id: ${a}`);throw Error(b)}}validateRequestExpiry(a){if(a&&(!nm(a,!1)||!(a<=qG.max)||!(a>=qG.min))){let{message:b}=ng("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${qG.min} and ${qG.max}`);throw Error(b)}}}class qX extends p4{constructor(a,b){super(a,b,"proposal",qB),this.core=a,this.logger=b}}class qY extends p4{constructor(a,b){super(a,b,"session",qB),this.core=a,this.logger=b}}class qZ extends p4{constructor(a,b){super(a,b,"request",qB,a=>a.id),this.core=a,this.logger=b}}class q$ extends p4{constructor(a,b){super(a,b,"authKeys",qL,()=>qM),this.core=a,this.logger=b}}class q_ extends p4{constructor(a,b){super(a,b,"pairingTopics",qL),this.core=a,this.logger=b}}class q0 extends p4{constructor(a,b){super(a,b,"requests",qL,a=>a.id),this.core=a,this.logger=b}}var q1=Object.defineProperty,q2=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?q1(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class q3{constructor(a,b){this.core=a,this.logger=b,q2(this,"authKeys"),q2(this,"pairingTopics"),q2(this,"requests"),this.authKeys=new q$(this.core,this.logger),this.pairingTopics=new q_(this.core,this.logger),this.requests=new q0(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var q4=Object.defineProperty,q5=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?q4(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class q6 extends bk{constructor(a){super(a),q5(this,"protocol","wc"),q5(this,"version",2),q5(this,"name",qA),q5(this,"metadata"),q5(this,"core"),q5(this,"logger"),q5(this,"events",new L.EventEmitter),q5(this,"engine"),q5(this,"session"),q5(this,"proposal"),q5(this,"pendingRequest"),q5(this,"auth"),q5(this,"signConfig"),q5(this,"on",(a,b)=>this.events.on(a,b)),q5(this,"once",(a,b)=>this.events.once(a,b)),q5(this,"off",(a,b)=>this.events.off(a,b)),q5(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),q5(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),q5(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),q5(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),q5(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||qA,this.metadata=function(a){var b,c;let d=iF();try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=iv(iv({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},ip(e,iq(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}(a?.metadata),this.signConfig=a?.signConfig;const b=nB({logger:a?.logger||"error",name:this.name});this.logger=b,this.core=a?.core||new qz(a),this.session=new qY(this.core,this.logger),this.proposal=new qX(this.core,this.logger),this.pendingRequest=new qZ(this.core,this.logger),this.engine=new qW(this),this.auth=new q3(this.core,this.logger)}static async init(a){let b=new q6(a);return await b.initialize(),b}get context(){return a1(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var q7=a.i(59353),q8=a.i(7054),q9=a.i(22215),ra=a.i(66259);let rb=a=>{if("number"==typeof a)return`0x${a.toString(16)}`;if("string"==typeof a)return a.startsWith("0x")?a:`0x${parseInt(a,10).toString(16)}`;throw Error(`Invalid chainId: ${a}`)};var rc=a.i(33711),rd=a.i(62738);async function re(a){if(a.session.length){let b=a.session.keys.length-1;return a.session.get(a.session.keys[b])}return null}async function rf(a,b,c,d){let e=await re(a);if(!e)throw q9.providerErrors.disconnected();return a.request({topic:e.topic,chainId:b,request:{method:c,params:b.startsWith("solana:")?(0,H.default)((0,H.default)({},d),{},{pubkey:e.self.publicKey}):d}})}async function rg(a){let b=await re(a);if(!b)throw q9.providerErrors.disconnected();let c=il(b.namespaces);if(c&&c.length)return[...new Set(c.map(a=>ik(a).address))];throw rd.WalletLoginError.connectionError("Failed to get accounts")}async function rh({connector:a,chainId:b,newChainId:c}){await rf(a,`eip155:${b}`,"wallet_switchEthereumChain",[{chainId:c}])}async function ri({connector:a,chainId:b,chainConfig:c}){if(!c)throw q9.providerErrors.custom({message:"Chain config is required",code:4902});let d=rb(c.chainId),e=(0,H.default)((0,H.default)({},c),{},{chainId:d});await rf(a,`eip155:${b}`,"wallet_addEthereumChain",[e])}var rj=a.i(30861),rk=a.i(24648),rl=a.i(46187),rm=a.i(76832),rn=a.i(84699),ro=a.i(72568);class rp extends rn.BaseProvider{constructor({config:a,state:b,connector:c}){super({config:{chain:a.chain,chains:a.chains,skipLookupNetwork:!!a.skipLookupNetwork},state:(0,H.default)((0,H.default)({},b||{}),{},{chainId:"loading",accounts:[]})}),(0,I.default)(this,"connector",null),this.connector=c||null}async enable(){if(!this.connector)throw q9.providerErrors.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});return await this.setupProvider(this.connector),this._providerEngineProxy.request({method:"eth_accounts"})}async setupProvider(a){this.onConnectorStateUpdate(a),await this.setupEngine(a,this.config.chain.chainId)}async switchChain({chainId:a}){if(!this.connector)throw q9.providerErrors.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});if(!this.getChain(a))throw rd.WalletLoginError.connectionError("Chain config is not available");let b=parseInt(this.getCurrentChainId(),16);await rh({connector:this.connector,chainId:b,newChainId:a}),await this.setupEngine(this.connector,a),this.lookupNetwork(this.connector,a),this.update({chainId:a})}async addChain(a){if(!this.connector)throw q9.providerErrors.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});let b=parseInt(this.getCurrentChainId(),16);await ri({connector:this.connector,chainId:b,chainConfig:a})}async lookupNetwork(a,b){return b}async setupEngine(a,b){let c=this.getChain(b);if(c.chainNamespace===w.CHAIN_NAMESPACES.EIP155)await this.setupEthEngine(a,b);else if(c.chainNamespace===w.CHAIN_NAMESPACES.SOLANA)await this.setupSolEngine(a,b);else throw Error(`Unsupported chainNamespace: ${c.chainNamespace}`);this.emit("chainChanged",b),this.emit("connect",{chainId:b}),this.update({chainId:b})}async setupEthEngine(a,b){let c=this.getChain(b),d=function({connector:a,chainId:b}){return{getPrivateKey:async()=>{throw q9.rpcErrors.methodNotSupported()},getPublicKey:async()=>{throw q9.rpcErrors.methodNotSupported()},getAccounts:async b=>rg(a),processTransaction:async(c,d)=>await rf(a,`eip155:${b}`,q7.EVM_METHOD_TYPES.ETH_TRANSACTION,[c]),processSignTransaction:async(c,d)=>await rf(a,`eip155:${b}`,"eth_signTransaction",[c]),processEthSignMessage:async(c,d)=>await rf(a,`eip155:${b}`,q7.EVM_METHOD_TYPES.ETH_SIGN,[c.from,c.data]),processPersonalMessage:async(c,d)=>await rf(a,`eip155:${b}`,q7.EVM_METHOD_TYPES.PERSONAL_SIGN,[c.data,c.from]),processTypedMessageV4:async c=>await rf(a,`eip155:${b}`,q7.EVM_METHOD_TYPES.ETH_SIGN_TYPED_DATA_V4,[c.from,c.data])}}({connector:a,chainId:parseInt(b,16)}),e=await rg(a);this.update({accounts:e||[]});let f=function(a){let{getAccounts:b,getPrivateKey:c,getPublicKey:d,processTransaction:e,processSignTransaction:f,processEthSignMessage:g,processTypedMessageV4:h,processPersonalMessage:i}=a;return(0,ra.mergeMiddleware)([(0,rj.createScaffoldMiddleware)({eth_syncing:!1}),function({getAccounts:a,getPrivateKey:b,getPublicKey:c,processEthSignMessage:d,processPersonalMessage:e,processTransaction:f,processSignTransaction:g,processTypedMessageV4:h}){if(!a)throw Error("opts.getAccounts is required");async function i(b,c){if("string"==typeof b&&b.length>0){let d=(await a(c)).map(a=>a.toLowerCase()),e=b.toLowerCase();if(d.includes(e))return e}throw q9.rpcErrors.invalidParams({message:"Invalid parameters: must provide an Ethereum address."})}async function j(b,c){c.result=await a(b)}async function k(a,b){if(!f)throw q9.rpcErrors.methodNotSupported();let c=a.params[0]||{from:""};c.from=await i(c.from,a),b.result=await f(c,a)}async function l(a,b){if(!g)throw q9.rpcErrors.methodNotSupported();let c=a.params[0]||{from:""};c.from=await i(c.from,a),b.result=await g(c,a)}async function m(a,b){if(!d)throw q9.rpcErrors.methodNotSupported();let c=a.params,e=a.params[2]||{};if(Array.isArray(a.params)){if(2!==a.params.length)throw Error(`WalletMiddleware - incorrect params for ${a.method} method. expected [address, message]`);let b=a.params;c={from:b[0],data:b[1]}}c=(0,H.default)((0,H.default)({},e),c),b.result=await d(c,a)}async function n(a,b){if(!h)throw q9.rpcErrors.methodNotSupported();if(!(null!=a&&a.params))throw Error("WalletMiddleware - missing params");let c=a.params;if(Array.isArray(a.params)){if(2!==a.params.length)throw Error(`WalletMiddleware - incorrect params for ${a.method} method. expected [address, typedData]`);let b=a.params;c={from:b[0],data:b[1]}}b.result=await h(c,a)}async function o(a,b){if(!e)throw q9.rpcErrors.methodNotSupported();let c=a.params,d=a.params[2]||{};if(Array.isArray(a.params)){if(!(a.params.length>=2))throw Error(`WalletMiddleware - incorrect params for ${a.method} method. expected [message, address]`);let b=a.params;if("object"==typeof b[0]){let{challenge:a,address:d}=b[0];c={from:d,data:a}}else{let a=b[0];c={from:b[1],data:a}}}c=(0,H.default)((0,H.default)({},d),c),b.result=await e(c,a)}async function p(a,c){if(!b)throw q9.rpcErrors.methodNotSupported();c.result=await b(a)}async function q(a,b){if(!c)throw q9.rpcErrors.methodNotSupported();b.result=await c(a)}return(0,rj.createScaffoldMiddleware)({eth_accounts:(0,rj.createAsyncMiddleware)(j),eth_requestAccounts:(0,rj.createAsyncMiddleware)(j),eth_private_key:(0,rj.createAsyncMiddleware)(p),eth_public_key:(0,rj.createAsyncMiddleware)(q),public_key:(0,rj.createAsyncMiddleware)(q),private_key:(0,rj.createAsyncMiddleware)(p),eth_sendTransaction:(0,rj.createAsyncMiddleware)(k),eth_signTransaction:(0,rj.createAsyncMiddleware)(l),eth_sign:(0,rj.createAsyncMiddleware)(m),eth_signTypedData_v4:(0,rj.createAsyncMiddleware)(n),personal_sign:(0,rj.createAsyncMiddleware)(o)})}({getAccounts:b,getPrivateKey:c,getPublicKey:d,processTransaction:e,processEthSignMessage:g,processSignTransaction:f,processTypedMessageV4:h,processPersonalMessage:i})])}(d),g=this.getEthChainSwitchMiddleware(),h=new ra.JRPCEngine,{networkMiddleware:i}=function(a){let{chainId:b,rpcTarget:c}=a,d=(0,rk.createFetchMiddleware)({rpcTarget:c});return{networkMiddleware:(0,ra.mergeMiddleware)([(a,c,d,e)=>"eth_chainId"===a.method?(c.result=b,e()):d(),(b,c,d,e)=>"eth_provider_config"===b.method?(c.result=a,e()):d(),d]),fetchMiddleware:d}}(c);h.push(f),h.push(g),h.push(i);let j=(0,ra.providerFromEngine)(h);this.updateProviderEngineProxy(j)}async setupSolEngine(a,b){let c=this.getChain(b),d=function({connector:a,chainId:b}){return{requestAccounts:async b=>rg(a),getPrivateKey:async()=>{throw q9.rpcErrors.methodNotSupported()},getSecretKey:async()=>{throw q9.rpcErrors.methodNotSupported()},getPublicKey:async()=>{throw q9.rpcErrors.methodNotSupported()},getAccounts:async b=>rg(a),signAllTransactions:async a=>{throw q9.rpcErrors.methodNotSupported()},signAndSendTransaction:async a=>{throw q9.rpcErrors.methodNotSupported()},signMessage:async c=>(await rf(a,`solana:${v.SOLANA_CAIP_CHAIN_MAP[b]}`,q7.SOLANA_METHOD_TYPES.SIGN_MESSAGE,{message:rc.bs58.encode(Buffer.from(c.params.data,"utf-8"))})).signature,signTransaction:async c=>{if(0===(await rg(a)).length)throw q9.providerErrors.disconnected();return(await rf(a,`solana:${v.SOLANA_CAIP_CHAIN_MAP[b]}`,q7.SOLANA_METHOD_TYPES.SIGN_TRANSACTION,{transaction:c.params.message})).signature}}}({connector:a,chainId:b}),e=await rg(a);this.update({accounts:e||[]});let f=(0,rl.createSolanaMiddleware)(d),g=new ra.JRPCEngine,{networkMiddleware:h}=(0,rm.createSolanaJsonRpcClient)(c);g.push(f),g.push(h);let i=(0,ra.providerFromEngine)(g);this.updateProviderEngineProxy(i)}getEthChainSwitchMiddleware(){return function({switchChain:a,addChain:b}){async function c(b,c){var d;let e=null!=(d=b.params)&&d.length?b.params[0]:void 0;if(!e)throw q9.rpcErrors.invalidParams("Missing chainId");c.result=await a(e)}async function d(a,c){var d;let e=null!=(d=a.params)&&d.length?a.params[0]:void 0;if(!e)throw q9.rpcErrors.invalidParams("Missing chainConfig");c.result=await b(e)}return(0,rj.createScaffoldMiddleware)({wallet_switchEthereumChain:(0,rj.createAsyncMiddleware)(c),wallet_addEthereumChain:(0,rj.createAsyncMiddleware)(d)})}({switchChain:async a=>{let{chainId:b}=a;await this.switchChain({chainId:b})},addChain:async a=>{await this.addChain(a)}})}connectedTopic(){var a,b;if(!this.connector)throw rd.WalletLoginError.notConnectedError("Wallet connect connector is not connected");if(null!=(a=this.connector)&&null!=(a=a.session)&&a.length){let a=this.connector.session.keys.length-1;return null==(b=this.connector.session.get(this.connector.session.keys[a]))?void 0:b.topic}}checkIfAccountAllowed(a){if(!this.connector||!this.connectedTopic())return!1;let b=il(this.connector.session.get(this.connectedTopic()).namespaces),c=!1;for(let e of b){var d;if((null==(d=ik(e).address)?void 0:d.toLowerCase())===(null==a?void 0:a.toLowerCase())){c=!0;break}}return c}async onConnectorStateUpdate(a){a.events.on("session_event",async b=>{if(ro.log.debug("session_event data",b),!this.provider)throw rd.WalletLoginError.notConnectedError("Wallet connect connector is not connected");let{event:c}=b.params,{name:d,data:e}=c||{};if("accountsChanged"===d&&null!=e&&e.length&&this.state.accounts[0]!==e[0]&&this.checkIfAccountAllowed(e[0])&&(this.update({accounts:e}),this.emit("accountsChanged",e)),"chainChanged"===c.name){if(!e)return;let b=rb(e),{currentChain:c}=this;b&&c.chainId!==b&&await this.setupEngine(a,b)}})}getCurrentChainId(){let a=this.state.chainId;return a&&"loading"!==a?a:this.config.chains[0].chainId}}(0,I.default)(rp,"getProviderInstance",async a=>{let b=new rp({config:{chain:a.chain,chains:a.chains,skipLookupNetwork:a.skipLookupNetwork}});return await b.setupProvider(a.connector),b});var rq=a.i(62556),rr=a.i(35443),rs=a.i(78801),rt=a.i(9290),ru=a.i(63179),rv=a.i(54176),rw=a.i(1582);class rx extends rq.BaseConnector{constructor(a){var b,c,d,e,f;super(a),(0,I.default)(this,"name",rr.WALLET_CONNECTORS.WALLET_CONNECT_V2),(0,I.default)(this,"connectorNamespace",rs.CONNECTOR_NAMESPACES.MULTICHAIN),(0,I.default)(this,"currentChainNamespace",w.CHAIN_NAMESPACES.OTHER),(0,I.default)(this,"type",rt.CONNECTOR_CATEGORY.EXTERNAL),(0,I.default)(this,"connectorOptions",void 0),(0,I.default)(this,"status",rt.CONNECTOR_STATUS.NOT_READY),(0,I.default)(this,"connectorData",{uri:""}),(0,I.default)(this,"connector",null),(0,I.default)(this,"activeSession",null),(0,I.default)(this,"wcProvider",null),(0,I.default)(this,"analytics",void 0),this.connectorOptions=(0,H.default)({},a);const{qrcodeModal:g,walletConnectInitOptions:h}=(null==a?void 0:a.connectorSettings)||{};this.connectorOptions=(0,H.default)((0,H.default)({},this.connectorOptions),{},{connectorSettings:null!=(b=null==(c=this.connectorOptions)?void 0:c.connectorSettings)?b:{},loginSettings:null!=(d=null==(e=this.connectorOptions)?void 0:e.loginSettings)?d:{}}),this.analytics=a.analytics,g&&(this.connectorOptions.connectorSettings.qrcodeModal=g),h&&(this.connectorOptions.connectorSettings.walletConnectInitOptions=(0,H.default)((0,H.default)({},null!=(f=this.connectorOptions.connectorSettings.walletConnectInitOptions)?f:{}),h));const{loginSettings:i}=a;i&&(this.connectorOptions.loginSettings=(0,H.default)((0,H.default)({},this.connectorOptions.loginSettings||{}),i))}get connected(){return!!this.activeSession}get provider(){return this.status!==rt.CONNECTOR_STATUS.NOT_READY&&this.wcProvider?this.wcProvider:null}set provider(a){throw Error("Not implemented")}async init(a){var b;let c=this.coreOptions.chains.find(b=>b.chainId===a.chainId);super.checkInitializationRequirements({chainConfig:c});let d=null==(b=this.connectorOptions.connectorSettings)||null==(b=b.walletConnectInitOptions)?void 0:b.projectId,e=this.coreOptions.chains.filter(a=>a.chainNamespace===w.CHAIN_NAMESPACES.EIP155||a.chainNamespace===w.CHAIN_NAMESPACES.SOLANA);if(0===e.length)throw rd.WalletInitializationError.invalidParams("No supported chains found");let f=await G(e,d);this.connectorOptions.loginSettings&&0!==Object.keys(this.connectorOptions.loginSettings).length||(this.connectorOptions.loginSettings=f.loginSettings),this.connectorOptions.connectorSettings=(0,q8.default)(f.connectorSettings||{},this.connectorOptions.connectorSettings||{});let{connectorSettings:g}=this.connectorOptions;if(this.connector=await q6.init(null==g?void 0:g.walletConnectInitOptions),this.wcProvider=new rp({config:{chain:c,chains:this.coreOptions.chains},connector:this.connector}),this.emit(rt.CONNECTOR_EVENTS.READY,rr.WALLET_CONNECTORS.WALLET_CONNECT_V2),this.status=rt.CONNECTOR_STATUS.READY,ro.log.debug("initializing wallet connect v2 connector"),a.autoConnect)if(await this.checkForPersistedSession(),this.connected){this.rehydrated=!0;try{await this.onConnectHandler({chain:c,getIdentityToken:a.getIdentityToken})}catch(a){ro.log.error("wallet auto connect",a),this.emit(rt.CONNECTOR_EVENTS.REHYDRATION_ERROR,a)}}else this.status=rt.CONNECTOR_STATUS.NOT_READY,this.emit(rt.CONNECTOR_EVENTS.CACHE_CLEAR)}async connect({chainId:a,getIdentityToken:b}){super.checkConnectionRequirements();let c=this.coreOptions.chains.find(b=>b.chainId===a);if(!c)throw rd.WalletLoginError.connectionError("Chain config is not available");if(!this.connector)throw rd.WalletInitializationError.notReady("Wallet connector is not ready yet");let d=!this.connected&&!this.rehydrated,e=Date.now(),f={connector:this.name,connector_type:this.type,is_injected:this.isInjected,is_wallet_connect:!0,chain_id:(0,ru.getCaipChainId)(c),chain_name:null==c?void 0:c.displayName,chain_namespace:null==c?void 0:c.chainNamespace};try{let a=()=>{if(d){var a,b,c;let{name:d,url:g,redirect:h}=(null==(a=this.activeSession)||null==(a=a.peer)?void 0:a.metadata)||{},{native:i,universal:j,linkMode:k}=h||{};f=(0,H.default)((0,H.default)({},f),{},{connector:d||this.name,wallet_url:g,redirect_native:i,redirect_universal:j,redirect_link_mode_enabled:k}),null==(b=this.analytics)||b.track(rv.ANALYTICS_EVENTS.CONNECTION_STARTED,f),null==(c=this.analytics)||c.track(rv.ANALYTICS_EVENTS.CONNECTION_COMPLETED,(0,H.default)((0,H.default)({},f),{},{duration:Date.now()-e}))}};if(this.connected)return await this.onConnectHandler({chain:c,getIdentityToken:b}),this.provider;return this.status!==rt.CONNECTOR_STATUS.CONNECTING&&await this.createNewSession({chainConfig:c,trackCompletionEvents:a,getIdentityToken:b}),this.provider}catch(a){if(ro.log.error("Wallet connect v2 connector error while connecting",a),this.status=rt.CONNECTOR_STATUS.READY,this.rehydrated=!0,this.emit(rt.CONNECTOR_EVENTS.ERRORED,a),d){var g,h;null==(g=this.analytics)||g.track(rv.ANALYTICS_EVENTS.CONNECTION_STARTED,f),null==(h=this.analytics)||h.track(rv.ANALYTICS_EVENTS.CONNECTION_FAILED,(0,H.default)((0,H.default)((0,H.default)({},f),(0,J.getErrorAnalyticsProperties)(a)),{},{duration:Date.now()-e}))}throw a instanceof rd.Web3AuthError?a:rd.WalletLoginError.connectionError(`Failed to login with wallet connect: ${(null==a?void 0:a.message)||""}`,a)}}async switchChain(a,b=!1){if(super.checkSwitchChainRequirements(a,b),!this.wcProvider)throw rd.WalletInitializationError.notReady("Wallet Connect provider is not ready yet");try{await this.wcProvider.switchChain({chainId:a.chainId})}catch(a){throw ro.log.error("error while switching chain",a),a}}async getUserInfo(){if(!this.canAuthorize)throw rd.WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(a={cleanup:!1,sessionRemovedByWallet:!1}){var b,c;let{cleanup:d}=a;if(!this.connector||!this.connected||!(null!=(b=this.activeSession)&&b.topic))throw rd.WalletLoginError.notConnectedError("Not connected with wallet");a.sessionRemovedByWallet||await this.connector.disconnect({topic:null==(c=this.activeSession)?void 0:c.topic,reason:nh("USER_DISCONNECTED")}),this.rehydrated=!1,d?(this.connector=null,this.status=rt.CONNECTOR_STATUS.NOT_READY,this.wcProvider=null):this.status=rt.CONNECTOR_STATUS.READY,this.activeSession=null,this.emit(rt.CONNECTOR_EVENTS.DISCONNECTED)}async getIdentityToken(){if(!this.provider||!this.canAuthorize)throw rd.WalletLoginError.notConnectedError();this.status=rt.CONNECTOR_STATUS.AUTHORIZING,this.emit(rt.CONNECTOR_EVENTS.AUTHORIZING,{connector:rr.WALLET_CONNECTORS.WALLET_CONNECT_V2});let{chainId:a}=this.provider,b=this.coreOptions.chains.find(b=>b.chainId===a);if(!b)throw rd.WalletLoginError.connectionError("Chain config is not available");let{chainNamespace:c}=b,d=await this.provider.request({method:c===w.CHAIN_NAMESPACES.EIP155?q7.EVM_METHOD_TYPES.GET_ACCOUNTS:q7.SOLANA_METHOD_TYPES.GET_ACCOUNTS});if(d&&d.length>0){let b=(0,rw.getSavedToken)(d[0],this.name);if(b&&!(0,rw.checkIfTokenIsExpired)(b))return this.status=rt.CONNECTOR_STATUS.AUTHORIZED,this.emit(rt.CONNECTOR_EVENTS.AUTHORIZED,{connector:rr.WALLET_CONNECTORS.WALLET_CONNECT_V2,identityTokenInfo:{idToken:b}}),{idToken:b};let e={domain:window.location.origin,uri:window.location.href,address:d[0],chainId:parseInt(a,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:new Date().toISOString()},f=await (0,K.signChallenge)(e,c),g=await this._getSignedMessage(f,d,c),h=await (0,K.verifySignedChallenge)(c,g,f,this.name,this.coreOptions.sessionTime,this.coreOptions.clientId,this.coreOptions.web3AuthNetwork);return(0,rw.saveToken)(d[0],this.name,h),this.status=rt.CONNECTOR_STATUS.AUTHORIZED,this.emit(rt.CONNECTOR_EVENTS.AUTHORIZED,{connector:rr.WALLET_CONNECTORS.WALLET_CONNECT_V2,identityTokenInfo:{idToken:h}}),{idToken:h}}throw rd.WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first")}async enableMFA(){throw Error("Method Not implemented")}async manageMFA(){throw Error("Method Not implemented")}cleanupPendingPairings(){if(!this.connector)throw rd.WalletInitializationError.notReady("Wallet connector is not ready yet");let a=this.connector.pairing.getAll({active:!1});ni(a)&&a.forEach(a=>{this.connector&&this.connector.pairing.delete(a.topic,nh("USER_DISCONNECTED"))})}async checkForPersistedSession(){if(!this.connector)throw rd.WalletInitializationError.notReady("Wallet connector is not ready yet");if(this.connector.session.length){let a=this.connector.session.keys.length-1;this.activeSession=this.connector.session.get(this.connector.session.keys[a])}return this.activeSession}async createNewSession({forceNewSession:a=!1,chainConfig:b,trackCompletionEvents:c,getIdentityToken:d}){var e,f,g,h;try{if(!this.connector)throw rd.WalletInitializationError.notReady("Wallet connector is not ready yet");if(!this.connectorOptions.loginSettings||0===Object.keys(this.connectorOptions.loginSettings).length)throw rd.WalletInitializationError.notReady("login settings are not set yet");this.status=rt.CONNECTOR_STATUS.CONNECTING,this.emit(rt.CONNECTOR_EVENTS.CONNECTING,{connector:rr.WALLET_CONNECTORS.WALLET_CONNECT_V2}),a&&null!=(e=this.activeSession)&&e.topic&&await this.connector.disconnect({topic:null==(g=this.activeSession)?void 0:g.topic,reason:nh("USER_DISCONNECTED")});let{uri:h,approval:i}=await this.connector.connect(this.connectorOptions.loginSettings),j=null==(f=this.connectorOptions)||null==(f=f.connectorSettings)?void 0:f.qrcodeModal;if(h)if(j)try{await j.openModal({uri:h}),ro.log.debug("EVENT","QR Code Modal closed"),this.status=rt.CONNECTOR_STATUS.READY,this.emit(rt.CONNECTOR_EVENTS.READY,rr.WALLET_CONNECTORS.WALLET_CONNECT_V2)}catch(a){ro.log.error("unable to open qr code modal",a)}else this.updateConnectorData({uri:h});ro.log.info("awaiting session approval from wallet");let k=await i();this.activeSession=k,await this.onConnectHandler({chain:b,trackCompletionEvents:c,getIdentityToken:d}),j&&j.closeModal()}catch(a){if(null!=(h=a.message)&&h.toLowerCase().includes("proposal expired")){if(ro.log.info("current connector status: ",this.status),this.status===rt.CONNECTOR_STATUS.CONNECTING)return ro.log.info("retrying to create new wallet connect session since proposal expired"),this.createNewSession({forceNewSession:!0,chainConfig:b,getIdentityToken:d});if(this.status===rt.CONNECTOR_STATUS.READY)return void ro.log.info("ignoring proposal expired error since some other connector is connected")}throw ro.log.error("error while creating new wallet connect session",a),this.emit(rt.CONNECTOR_EVENTS.ERRORED,a),a}}async onConnectHandler({chain:a,trackCompletionEvents:b,getIdentityToken:c}){var d;let e;if(!this.connector||!this.wcProvider)throw rd.WalletInitializationError.notReady("Wallet connect connector is not ready yet");this.subscribeEvents(),null!=(d=this.connectorOptions.connectorSettings)&&d.qrcodeModal&&(this.wcProvider=new rp({config:{chain:a,chains:this.coreOptions.chains,skipLookupNetwork:!0},connector:this.connector})),await this.wcProvider.setupProvider(this.connector),this.cleanupPendingPairings(),this.status=rt.CONNECTOR_STATUS.CONNECTED,b&&b(),this.emit(rt.CONNECTOR_EVENTS.CONNECTED,{connector:rr.WALLET_CONNECTORS.WALLET_CONNECT_V2,reconnected:this.rehydrated,provider:this.provider,identityTokenInfo:e}),c&&(e=await this.getIdentityToken())}subscribeEvents(){if(!this.connector)throw rd.WalletInitializationError.notReady("Wallet connector is not ready yet");this.connector.events.on("session_update",({topic:a,params:b})=>{if(!this.connector)return;let{namespaces:c}=b,d=this.connector.session.get(a),e=(0,H.default)((0,H.default)({},d),{},{namespaces:c});this.activeSession=e}),this.connector.events.on("session_delete",()=>{this.disconnect({sessionRemovedByWallet:!0})}),this.connector.events.on("session_expire",({topic:a})=>{var b;ro.log.info("Session expired event received for topic:",a),(null==(b=this.activeSession)?void 0:b.topic)===a&&this.disconnect({sessionRemovedByWallet:!0}).catch(a=>{ro.log.error("Failed to disconnect expired session",a)})})}async _getSignedMessage(a,b,c){return await this.provider.request({method:c===w.CHAIN_NAMESPACES.EIP155?q7.EVM_METHOD_TYPES.PERSONAL_SIGN:q7.SOLANA_METHOD_TYPES.SIGN_MESSAGE,params:c===w.CHAIN_NAMESPACES.EIP155?[a,b[0]]:{data:a}})}}let ry=a=>({coreOptions:b,projectConfig:c,analytics:d})=>{var e;let f=(null==a||null==(e=a.walletConnectInitOptions)?void 0:e.projectId)||(null==c?void 0:c.walletConnectProjectId);return new rx({connectorSettings:(0,H.default)((0,H.default)({},a),{},{walletConnectInitOptions:(0,H.default)((0,H.default)({},null==a?void 0:a.walletConnectInitOptions),{},{projectId:f})}),coreOptions:b,analytics:d})};a.s(["DEFAULT_EIP155_METHODS",()=>x,"DEFAULT_EIP_155_EVENTS",()=>z,"DEFAULT_SOLANA_EVENTS",()=>A,"DEFAULT_SOLANA_METHODS",()=>y,"WalletConnectV2Provider",()=>rp,"getNamespacesFromChains",()=>C,"getRequiredNamespaces",()=>F,"getSupportedEventsByNamespace",()=>E,"getSupportedMethodsByNamespace",()=>D,"getWalletConnectV2Settings",()=>G,"walletConnectV2Connector",()=>ry],49386)}];

//# sourceMappingURL=node_modules_f39ae917._.js.map