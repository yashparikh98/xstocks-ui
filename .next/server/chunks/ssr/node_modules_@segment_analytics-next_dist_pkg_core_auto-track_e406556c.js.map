{"version":3,"sources":["../../../../node_modules/%40segment/analytics-next/src/core/auto-track.ts"],"sourcesContent":["import { Analytics } from './analytics'\nimport { EventProperties, Options } from './events'\nimport { pTimeout } from './callback'\n\n// Check if a user is opening the link in a new tab\nfunction userNewTab(event: Event): boolean {\n  const typedEvent = event as Event & {\n    ctrlKey: boolean\n    shiftKey: boolean\n    metaKey: boolean\n    button: number\n  }\n  if (\n    typedEvent.ctrlKey ||\n    typedEvent.shiftKey ||\n    typedEvent.metaKey ||\n    (typedEvent.button && typedEvent.button == 1)\n  ) {\n    return true\n  }\n  return false\n}\n\n// Check if the link opens in new tab\nfunction linkNewTab(element: HTMLAnchorElement, href: string | null): boolean {\n  if (element.target === '_blank' && href) {\n    return true\n  }\n  return false\n}\n\nexport interface JQueryShim<TElement = HTMLElement> {\n  toArray(): TElement[]\n}\n\nexport function link(\n  this: Analytics,\n  links: Element | Array<Element> | JQueryShim | null,\n  event: string | Function,\n  properties?: EventProperties | Function,\n  options?: Options\n): Analytics {\n  let elements: Array<Element> = []\n  // always arrays, handles jquery\n  if (!links) {\n    return this\n  }\n  if (links instanceof Element) {\n    elements = [links]\n  } else if ('toArray' in links) {\n    elements = links.toArray()\n  } else {\n    elements = links\n  }\n\n  elements.forEach((el: Element) => {\n    el.addEventListener(\n      'click',\n      (elementEvent: Event) => {\n        const ev = event instanceof Function ? event(el) : event\n        const props =\n          properties instanceof Function ? properties(el) : properties\n        const href =\n          el.getAttribute('href') ||\n          el.getAttributeNS('http://www.w3.org/1999/xlink', 'href') ||\n          el.getAttribute('xlink:href') ||\n          el.getElementsByTagName('a')[0]?.getAttribute('href')\n\n        const trackEvent = pTimeout(\n          this.track(ev, props, options ?? {}),\n          this.settings.timeout ?? 500\n        )\n\n        if (\n          !linkNewTab(el as HTMLAnchorElement, href) &&\n          !userNewTab(elementEvent)\n        ) {\n          if (href) {\n            elementEvent.preventDefault\n              ? elementEvent.preventDefault()\n              : (elementEvent.returnValue = false)\n            trackEvent\n              .catch(console.error)\n              .then(() => {\n                window.location.href = href\n              })\n              .catch(console.error)\n          }\n        }\n      },\n      false\n    )\n  })\n\n  return this\n}\n\nexport type LinkArgs = Parameters<typeof link>\n\nexport function form(\n  this: Analytics,\n  forms: HTMLFormElement | Array<HTMLFormElement> | null,\n  event: string | Function,\n  properties?: EventProperties | Function,\n  options?: Options\n): Analytics {\n  // always arrays, handles jquery\n  if (!forms) return this\n  if (forms instanceof HTMLFormElement) forms = [forms]\n\n  const elements = forms\n\n  elements.forEach((el) => {\n    if (!(el instanceof Element))\n      throw new TypeError('Must pass HTMLElement to trackForm/trackSubmit.')\n    const handler = (elementEvent: Event): void => {\n      elementEvent.preventDefault\n        ? elementEvent.preventDefault()\n        : (elementEvent.returnValue = false)\n\n      const ev = event instanceof Function ? event(el) : event\n      const props = properties instanceof Function ? properties(el) : properties\n\n      const trackEvent = pTimeout(\n        this.track(ev, props, options ?? {}),\n        this.settings.timeout ?? 500\n      )\n\n      trackEvent\n        .catch(console.error)\n        .then(() => {\n          el.submit()\n        })\n        .catch(console.error)\n    }\n\n    // Support the events happening through jQuery or Zepto instead of through\n    // the normal DOM API, because `el.submit` doesn't bubble up events...\n\n    const $ = (window as any).jQuery || (window as any).Zepto\n    if ($) {\n      $(el).submit(handler)\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-misused-promises\n      el.addEventListener('submit', handler, false)\n    }\n  })\n\n  return this\n}\n\nexport type FormArgs = Parameters<typeof form>\n"],"names":[],"mappings":"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"}