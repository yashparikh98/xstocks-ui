module.exports=[34116,(a,b,c)=>{b.exports=function(a){if(null==a)throw TypeError("Cannot destructure "+a)},b.exports.__esModule=!0,b.exports.default=b.exports},70611,(a,b,c)=>{b.exports=i,i.default=i,i.stable=l,i.stableStringify=l;var d="[...]",e="[Circular]",f=[],g=[];function h(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function i(a,b,c,i){void 0===i&&(i=h()),function a(b,c,f,g,h,i,k){if(i+=1,"object"==typeof b&&null!==b){for(l=0;l<g.length;l++)if(g[l]===b)return void j(e,b,c,h);if(void 0!==k.depthLimit&&i>k.depthLimit||void 0!==k.edgesLimit&&f+1>k.edgesLimit)return void j(d,b,c,h);if(g.push(b),Array.isArray(b))for(l=0;l<b.length;l++)a(b[l],l,l,g,b,i,k);else{var l,m=Object.keys(b);for(l=0;l<m.length;l++){var n=m[l];a(b[n],n,l,g,b,i,k)}}g.pop()}}(a,"",0,[],void 0,0,i);try{k=0===g.length?JSON.stringify(a,b,c):JSON.stringify(a,m(b),c)}catch(a){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==f.length;){var k,l=f.pop();4===l.length?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}}return k}function j(a,b,c,d){var e=Object.getOwnPropertyDescriptor(d,c);void 0!==e.get?e.configurable?(Object.defineProperty(d,c,{value:a}),f.push([d,c,b,e])):g.push([b,c,a]):(d[c]=a,f.push([d,c,b]))}function k(a,b){return a<b?-1:+(a>b)}function l(a,b,c,i){void 0===i&&(i=h());var l,n=function a(b,c,g,h,i,l,m){if(l+=1,"object"==typeof b&&null!==b){for(n=0;n<h.length;n++)if(h[n]===b)return void j(e,b,c,i);try{if("function"==typeof b.toJSON)return}catch(a){return}if(void 0!==m.depthLimit&&l>m.depthLimit||void 0!==m.edgesLimit&&g+1>m.edgesLimit)return void j(d,b,c,i);if(h.push(b),Array.isArray(b))for(n=0;n<b.length;n++)a(b[n],n,n,h,b,l,m);else{var n,o={},p=Object.keys(b).sort(k);for(n=0;n<p.length;n++){var q=p[n];a(b[q],q,n,h,b,l,m),o[q]=b[q]}if(void 0===i)return o;f.push([i,c,b]),i[c]=o}h.pop()}}(a,"",0,[],void 0,0,i)||a;try{l=0===g.length?JSON.stringify(n,b,c):JSON.stringify(n,m(b),c)}catch(a){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==f.length;){var o=f.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return l}function m(a){return a=void 0!==a?a:function(a,b){return b},function(b,c){if(g.length>0)for(var d=0;d<g.length;d++){var e=g[d];if(e[1]===b&&e[0]===c){c=e[2],g.splice(d,1);break}}return a.call(this,b,c)}}},59352,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;a.s([],60753),a.i(60753);var s,t,u,v,w,x,y=a.i(95851),z=a.i(41415),A=a.i(27699);function B(a,b,c){try{Reflect.apply(a,b,c)}catch(a){setTimeout(()=>{throw a})}}class C extends A.EventEmitter{emit(a,...b){let c="error"===a,d=this._events;if(void 0!==d)c=c&&void 0===d.error;else if(!c)return!1;if(c){let a;if(b.length>0&&([a]=b),a instanceof Error)throw a;let c=Error(`Unhandled error.${a?` (${a.message})`:""}`);throw c.context=a,c}let e=d[a];if(void 0===e)return!1;if("function"==typeof e)B(e,this,b);else{let a=e.length,c=function(a){let b=a.length,c=Array(b);for(let d=0;d<b;d+=1)c[d]=a[d];return c}(e);for(let d=0;d<a;d+=1)B(c[d],this,b)}return!0}}class D extends C{constructor({config:a={},state:b={}}){super(),(0,z.default)(this,"defaultConfig",{}),(0,z.default)(this,"defaultState",{}),(0,z.default)(this,"disabled",!1),(0,z.default)(this,"name","BaseController"),(0,z.default)(this,"initialConfig",void 0),(0,z.default)(this,"initialState",void 0),(0,z.default)(this,"internalConfig",this.defaultConfig),(0,z.default)(this,"internalState",this.defaultState),this.initialState=b,this.initialConfig=a}get config(){return this.internalConfig}get state(){return this.internalState}configure(a,b=!1,c=!0){if(c)for(let c in this.internalConfig=b?a:Object.assign(this.internalConfig,a),this.internalConfig)void 0!==this.internalConfig[c]&&(this[c]=this.internalConfig[c]);else for(let b in a)void 0!==this.internalConfig[b]&&(this.internalConfig[b]=a[b],this[b]=a[b])}update(a,b=!1){this.internalState=b?(0,y.default)({},a):(0,y.default)((0,y.default)({},this.internalState),a),this.emit("store",this.internalState)}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}}Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let E=Error("request for lock canceled");class F{constructor(a,b=E){this._value=a,this._cancelError=b,this._queue=[],this._weightedWaiters=[]}acquire(a=1,b=0){if(a<=0)throw Error(`invalid weight ${a}: must be positive`);return new Promise((c,d)=>{let e={resolve:c,reject:d,weight:a,priority:b},f=G(this._queue,a=>b<=a.priority);-1===f&&a<=this._value?this._dispatchItem(e):this._queue.splice(f+1,0,e)})}runExclusive(a){var b,c,d,e;return b=this,c=arguments,d=void 0,e=function*(a,b=1,c=0){let[d,e]=yield this.acquire(b,c);try{return yield a(d)}finally{e()}},new(d||(d=Promise))(function(a,f){function g(a){try{i(e.next(a))}catch(a){f(a)}}function h(a){try{i(e.throw(a))}catch(a){f(a)}}function i(b){var c;b.done?a(b.value):((c=b.value)instanceof d?c:new d(function(a){a(c)})).then(g,h)}i((e=e.apply(b,c||[])).next())})}waitForUnlock(a=1,b=0){if(a<=0)throw Error(`invalid weight ${a}: must be positive`);return this._couldLockImmediately(a,b)?Promise.resolve():new Promise(c=>{var d,e;let f;this._weightedWaiters[a-1]||(this._weightedWaiters[a-1]=[]),d=this._weightedWaiters[a-1],e={resolve:c,priority:b},f=G(d,a=>e.priority<=a.priority),d.splice(f+1,0,e)})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(a){this._value=a,this._dispatchQueue()}release(a=1){if(a<=0)throw Error(`invalid weight ${a}: must be positive`);this._value+=a,this._dispatchQueue()}cancel(){this._queue.forEach(a=>a.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(a){let b=this._value;this._value-=a.weight,a.resolve([b,this._newReleaser(a.weight)])}_newReleaser(a){let b=!1;return()=>{b||(b=!0,this.release(a))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let a=this._value;a>0;a--){let b=this._weightedWaiters[a-1];b&&(b.forEach(a=>a.resolve()),this._weightedWaiters[a-1]=[])}else{let a=this._queue[0].priority;for(let b=this._value;b>0;b--){let c=this._weightedWaiters[b-1];if(!c)continue;let d=c.findIndex(b=>b.priority<=a);(-1===d?c:c.splice(0,d)).forEach(a=>a.resolve())}}}_couldLockImmediately(a,b){return(0===this._queue.length||this._queue[0].priority<b)&&a<=this._value}}function G(a,b){for(let c=a.length-1;c>=0;c--)if(b(a[c]))return c;return -1}class H{constructor(a){this._semaphore=new F(1,a)}acquire(){var a,b,c,d;return a=this,b=arguments,c=void 0,d=function*(a=0){let[,b]=yield this._semaphore.acquire(1,a);return b},new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}runExclusive(a,b=0){return this._semaphore.runExclusive(()=>a(),1,b)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(a=0){return this._semaphore.waitForUnlock(1,a)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}async function I(a){let b=Object.keys(a);return(await Promise.all(b.map(b=>Promise.resolve(a[b])))).reduce((a,c,d)=>(a[b[d]]=c,a),{})}function J(a,b,c){for(let d in b){let e=b[d],f=c?c[d]:null;f&&function(a,b,c){let d=b.split("|").map(a=>a.trim());for(let c=0;c<d.length;c++)switch(b){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof a===b)return}let e=Error(`invalid value for type ${b}`);throw e.code="INVALID_ARGUMENT",e.argument=`value.${c}`,e.value=a,e}(e,f,d),Object.defineProperty(a,d,{enumerable:!0,value:e,writable:!1})}}function K(a,b){if(null==a)return"null";if(null==b&&(b=new Set),"object"==typeof a){if(b.has(a))return"[Circular]";b.add(a)}if(Array.isArray(a))return"[ "+a.map(a=>K(a,b)).join(", ")+" ]";if(a instanceof Uint8Array){let b="0123456789abcdef",c="0x";for(let d=0;d<a.length;d++)c+=b[a[d]>>4],c+=b[15&a[d]];return c}if("object"==typeof a&&"function"==typeof a.toJSON)return K(a.toJSON(),b);switch(typeof a){case"boolean":case"number":case"symbol":return a.toString();case"bigint":return BigInt(a).toString();case"string":return JSON.stringify(a);case"object":{let c=Object.keys(a);return c.sort(),"{ "+c.map(c=>`${K(c,b)}: ${K(a[c],b)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function L(a,b){return a&&a.code===b}function M(a){return L(a,"CALL_EXCEPTION")}function N(a,b,c){let d,e=a;{let d=[];if(c){if("message"in c||"code"in c||"name"in c)throw Error(`value will overwrite populated values: ${K(c)}`);for(let a in c){if("shortMessage"===a)continue;let b=c[a];d.push(a+"="+K(b))}}d.push(`code=${b}`),d.push("version=6.16.0"),d.length&&(a+=" ("+d.join(", ")+")")}switch(b){case"INVALID_ARGUMENT":d=TypeError(a);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":d=RangeError(a);break;default:d=Error(a)}return J(d,{code:b}),c&&Object.assign(d,c),null==d.shortMessage&&J(d,{shortMessage:e}),d}function O(a,b,c,d){if(!a)throw N(b,c,d)}function P(a,b,c,d){O(a,b,"INVALID_ARGUMENT",{argument:c,value:d})}function Q(a,b,c){null==c&&(c=""),c&&(c=": "+c),O(a>=b,"missing argument"+c,"MISSING_ARGUMENT",{count:a,expectedCount:b}),O(a<=b,"too many arguments"+c,"UNEXPECTED_ARGUMENT",{count:a,expectedCount:b})}let R=["NFD","NFC","NFKD","NFKC"].reduce((a,b)=>{try{if("test"!=="test".normalize(b))throw Error("bad");if("NFD"===b){let a=String.fromCharCode(233).normalize("NFD"),b=String.fromCharCode(101,769);if(a!==b)throw Error("broken")}a.push(b)}catch(a){}return a},[]);function S(a,b,c){if(null==c&&(c=""),a!==b){let a=c,b="new";c&&(a+=".",b+=" "+c),O(!1,`private constructor; use ${a}from* methods`,"UNSUPPORTED_OPERATION",{operation:b})}}function T(a,b,c){if(a instanceof Uint8Array)return c?new Uint8Array(a):a;if("string"==typeof a&&a.length%2==0&&a.match(/^0x[0-9a-f]*$/i)){let b=new Uint8Array((a.length-2)/2),c=2;for(let d=0;d<b.length;d++)b[d]=parseInt(a.substring(c,c+2),16),c+=2;return b}P(!1,"invalid BytesLike value",b||"value",a)}function U(a,b){return T(a,b,!1)}function V(a,b){return T(a,b,!0)}function W(a,b){return"string"==typeof a&&!!a.match(/^0x[0-9A-Fa-f]*$/)&&("number"!=typeof b||a.length===2+2*b)&&(!0!==b||a.length%2==0)}function X(a){return W(a,!0)||a instanceof Uint8Array}let Y="0123456789abcdef";function Z(a){let b=U(a),c="0x";for(let a=0;a<b.length;a++){let d=b[a];c+=Y[(240&d)>>4]+Y[15&d]}return c}function $(a){return"0x"+a.map(a=>Z(a).substring(2)).join("")}function _(a){return W(a,!0)?(a.length-2)/2:U(a).length}function aa(a,b,c){let d=U(a);return null!=c&&c>d.length&&O(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:d,length:d.length,offset:c}),Z(d.slice(null==b?0:b,null==c?d.length:c))}function ab(a,b,c){let d=U(a);O(b>=d.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(d),length:b,offset:b+1});let e=new Uint8Array(b);return e.fill(0),c?e.set(d,b-d.length):e.set(d,0),Z(e)}function ac(a,b){return ab(a,b,!0)}let ad=BigInt(0),ae=BigInt(1);function af(a,b){let c=ah(a,"value"),d=BigInt(al(b,"width")),e=ae<<d-ae;return c<ad?(O((c=-c)<=e,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:a}),(~c&(ae<<d)-ae)+ae):(O(c<e,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:a}),c)}function ag(a,b){return ai(a,"value")&(ae<<BigInt(al(b,"bits")))-ae}function ah(a,b){switch(typeof a){case"bigint":return a;case"number":return P(Number.isInteger(a),"underflow",b||"value",a),P(a>=-0x1fffffffffffff&&a<=0x1fffffffffffff,"overflow",b||"value",a),BigInt(a);case"string":try{if(""===a)throw Error("empty string");if("-"===a[0]&&"-"!==a[1])return-BigInt(a.substring(1));return BigInt(a)}catch(c){P(!1,`invalid BigNumberish string: ${c.message}`,b||"value",a)}}P(!1,"invalid BigNumberish value",b||"value",a)}function ai(a,b){let c=ah(a,b);return O(c>=ad,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:a}),c}let aj="0123456789abcdef";function ak(a){if(a instanceof Uint8Array){let b="0x0";for(let c of a)b+=aj[c>>4],b+=aj[15&c];return BigInt(b)}return ah(a)}function al(a,b){switch(typeof a){case"bigint":return P(a>=-0x1fffffffffffff&&a<=0x1fffffffffffff,"overflow",b||"value",a),Number(a);case"number":return P(Number.isInteger(a),"underflow",b||"value",a),P(a>=-0x1fffffffffffff&&a<=0x1fffffffffffff,"overflow",b||"value",a),a;case"string":try{if(""===a)throw Error("empty string");return al(BigInt(a),b)}catch(c){P(!1,`invalid numeric string: ${c.message}`,b||"value",a)}}P(!1,"invalid numeric value",b||"value",a)}function am(a,b){let c=ai(a,"value"),d=c.toString(16);if(null==b)d.length%2&&(d="0"+d);else{let e=al(b,"width");if(0===e&&c===ad)return"0x";for(O(2*e>=d.length,`value exceeds width (${e} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:a});d.length<2*e;)d="0"+d}return"0x"+d}function an(a,b){let c=ai(a,"value");if(c===ad)return new Uint8Array(null!=b?al(b,"width"):0);let d=c.toString(16);if(d.length%2&&(d="0"+d),null!=b){let c=al(b,"width");for(;d.length<2*c;)d="00"+d;O(2*c===d.length,`value exceeds width (${c} bytes)`,"NUMERIC_FAULT",{operation:"toBeArray",fault:"overflow",value:a})}let e=new Uint8Array(d.length/2);for(let a=0;a<e.length;a++){let b=2*a;e[a]=parseInt(d.substring(b,b+2),16)}return e}function ao(a){let b=Z(X(a)?a:an(a)).substring(2);for(;b.startsWith("0");)b=b.substring(1);return""===b&&(b="0"),"0x"+b}let ap=new Uint8Array(32),aq=["then"],ar={},as=new WeakMap;function at(a){return as.get(a)}function au(a,b){let c=Error(`deferred error during ABI decoding triggered accessing ${a}`);throw c.error=b,c}class av extends Array{#a;constructor(...a){var b,c;const d=a[0];let e=a[1],f=(a[2]||[]).slice(),g=!0;d!==ar&&(e=a,f=[],g=!1),super(e.length),e.forEach((a,b)=>{this[b]=a});const h=f.reduce((a,b)=>("string"==typeof b&&a.set(b,(a.get(b)||0)+1),a),new Map);if(b=Object.freeze(e.map((a,b)=>{let c=f[b];return null!=c&&1===h.get(c)?c:null})),as.set(this,b),this.#a=[],null==this.#a&&this.#a,!g)return;Object.freeze(this);const i=new Proxy(this,{get:(a,b,c)=>{if("string"==typeof b){if(b.match(/^[0-9]+$/)){let c=al(b,"%index");if(c<0||c>=this.length)throw RangeError("out of result range");let d=a[c];return d instanceof Error&&au(`index ${c}`,d),d}if(aq.indexOf(b)>=0)return Reflect.get(a,b,c);let d=a[b];if(d instanceof Function)return function(...b){return d.apply(this===c?a:this,b)};if(!(b in a))return a.getValue.apply(this===c?a:this,[b])}return Reflect.get(a,b,c)}});return c=at(this),as.set(i,c),i}toArray(a){let b=[];return this.forEach((c,d)=>{c instanceof Error&&au(`index ${d}`,c),a&&c instanceof av&&(c=c.toArray(a)),b.push(c)}),b}toObject(a){let b=at(this);return b.reduce((c,d,e)=>(O(null!=d,`value at index ${e} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),function a(b,c,d){return b.indexOf(null)>=0?c.map((b,c)=>b instanceof av?a(at(b),b,d):b):b.reduce((b,e,f)=>{let g=c.getValue(e);return e in b||(d&&g instanceof av&&(g=a(at(g),g,d)),b[e]=g),b},{})}(b,this,a)),{})}slice(a,b){null==a&&(a=0),a<0&&(a+=this.length)<0&&(a=0),null==b&&(b=this.length),b<0&&(b+=this.length)<0&&(b=0),b>this.length&&(b=this.length);let c=at(this),d=[],e=[];for(let f=a;f<b;f++)d.push(this[f]),e.push(c[f]);return new av(ar,d,e)}filter(a,b){let c=at(this),d=[],e=[];for(let f=0;f<this.length;f++){let g=this[f];g instanceof Error&&au(`index ${f}`,g),a.call(b,g,f,this)&&(d.push(g),e.push(c[f]))}return new av(ar,d,e)}map(a,b){let c=[];for(let d=0;d<this.length;d++){let e=this[d];e instanceof Error&&au(`index ${d}`,e),c.push(a.call(b,e,d,this))}return c}getValue(a){let b=at(this).indexOf(a);if(-1===b)return;let c=this[b];return c instanceof Error&&au(`property ${JSON.stringify(a)}`,c.error),c}static fromItems(a,b){return new av(ar,a,b)}}function aw(a){let b=an(a);return O(b.length<=32,"value out-of-bounds","BUFFER_OVERRUN",{buffer:b,length:32,offset:b.length}),32!==b.length&&(b=V($([ap.slice(b.length%32),b]))),b}class ax{name;type;localName;dynamic;constructor(a,b,c,d){J(this,{name:a,type:b,localName:c,dynamic:d},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(a,b){P(!1,a,this.localName,b)}}class ay{#b;#c;constructor(){this.#b=[],this.#c=0}get data(){return $(this.#b)}get length(){return this.#c}#d(a){return this.#b.push(a),this.#c+=a.length,a.length}appendWriter(a){return this.#d(V(a.data))}writeBytes(a){let b=V(a),c=b.length%32;return c&&(b=V($([b,ap.slice(c)]))),this.#d(b)}writeValue(a){return this.#d(aw(a))}writeUpdatableValue(){let a=this.#b.length;return this.#b.push(ap),this.#c+=32,b=>{this.#b[a]=aw(b)}}}class az{allowLoose;#b;#e;#f;#g;#h;constructor(a,b,c){J(this,{allowLoose:!!b}),this.#b=V(a),this.#f=0,this.#g=null,this.#h=null!=c?c:1024,this.#e=0}get data(){return Z(this.#b)}get dataLength(){return this.#b.length}get consumed(){return this.#e}get bytes(){return new Uint8Array(this.#b)}#i(a){if(this.#g)return this.#g.#i(a);this.#f+=a,O(this.#h<1||this.#f<=this.#h*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#h} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:V(this.#b),offset:this.#e,length:a,info:{bytesRead:this.#f,dataLength:this.dataLength}})}#j(a,b,c){let d=32*Math.ceil(b/32);return this.#e+d>this.#b.length&&(this.allowLoose&&c&&this.#e+b<=this.#b.length?d=b:O(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:V(this.#b),length:this.#b.length,offset:this.#e+d})),this.#b.slice(this.#e,this.#e+d)}subReader(a){let b=new az(this.#b.slice(this.#e+a),this.allowLoose,this.#h);return b.#g=this,b}readBytes(a,b){let c=this.#j(0,a,!!b);return this.#i(a),this.#e+=c.length,c.slice(0,a)}readValue(){return ak(this.readBytes(32))}readIndex(){return al(ak(this.readBytes(32)))}}function aA(a){if(!Number.isSafeInteger(a)||a<0)throw Error(`Wrong positive integer: ${a}`)}function aB(a,...b){if(!(a instanceof Uint8Array))throw Error("Expected Uint8Array");if(b.length>0&&!b.includes(a.length))throw Error(`Expected Uint8Array of length ${b}, not of length=${a.length}`)}function aC(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function aD(a,b){aB(a);let c=b.outputLen;if(a.length<c)throw Error(`digestInto() expects output buffer of length at least ${c}`)}let aE=BigInt(0x100000000-1),aF=BigInt(32);var aG=a.i(66680);let aH=aG&&"object"==typeof aG&&"webcrypto"in aG?aG.webcrypto:void 0,aI=a=>new DataView(a.buffer,a.byteOffset,a.byteLength),aJ=(a,b)=>a<<32-b|a>>>b;if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");function aK(a){if("string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error(`utf8ToBytes expected string, got ${typeof a}`);return new Uint8Array(new TextEncoder().encode(a))}(a)),!(a instanceof Uint8Array))throw Error(`expected Uint8Array, got ${typeof a}`);return a}class aL{clone(){return this._cloneInto()}}function aM(a){let b=b=>a().update(aK(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function aN(a=32){if(aH&&"function"==typeof aH.getRandomValues)return aH.getRandomValues(new Uint8Array(a));throw Error("crypto.getRandomValues must be defined")}let[aO,aP,aQ]=[[],[],[]],aR=BigInt(0),aS=BigInt(1),aT=BigInt(2),aU=BigInt(7),aV=BigInt(256),aW=BigInt(113);for(let a=0,b=aS,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],aO.push(2*(5*d+c)),aP.push((a+1)*(a+2)/2%64);let e=aR;for(let a=0;a<7;a++)(b=(b<<aS^(b>>aU)*aW)%aV)&aT&&(e^=aS<<(aS<<BigInt(a))-aS);aQ.push(e)}let[aX,aY]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&aE),l:Number(a>>aF&aE)}:{h:0|Number(a>>aF&aE),l:0|Number(a&aE)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(aQ,!0),aZ=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,a$=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class a_ extends aL{constructor(a,b,c,d=!1,e=24){if(super(),this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,aA(c),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(a=>new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4)))(this.state)}keccak(){!function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=aZ(f,g,1)^c[d],i=a$(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=aP[c],f=aZ(b,e,d),g=a$(b,e,d),h=aO[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=aX[d],a[1]^=aY[d]}c.fill(0)}(this.state32,this.rounds),this.posOut=0,this.pos=0}update(a){aC(this);let{blockLen:b,state:c}=this,d=(a=aK(a)).length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){aC(this,!1),aB(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return aA(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(aD(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new a_(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let a0=aM(()=>new a_(136,1,32)),a1=!1,a2=function(a){return a0(a)},a3=a2;function a4(a){let b=U(a,"data");return Z(a3(b))}a4._=a2,a4.lock=function(){a1=!0},a4.register=function(a){if(a1)throw TypeError("keccak256 is locked");a3=a},Object.freeze(a4);let a5=BigInt(0),a6=BigInt(36);function a7(a){let b=(a=a.toLowerCase()).substring(2).split(""),c=new Uint8Array(40);for(let a=0;a<40;a++)c[a]=b[a].charCodeAt(0);let d=U(a4(c));for(let a=0;a<40;a+=2)d[a>>1]>>4>=8&&(b[a]=b[a].toUpperCase()),(15&d[a>>1])>=8&&(b[a+1]=b[a+1].toUpperCase());return"0x"+b.join("")}let a8={};for(let a=0;a<10;a++)a8[String(a)]=String(a);for(let a=0;a<26;a++)a8[String.fromCharCode(65+a)]=String(10+a);let a9=function(){let a={};for(let b=0;b<36;b++)a["0123456789abcdefghijklmnopqrstuvwxyz"[b]]=BigInt(b);return a}();function ba(a){if(P("string"==typeof a,"invalid address","address",a),a.match(/^(0x)?[0-9a-fA-F]{40}$/)){a.startsWith("0x")||(a="0x"+a);let b=a7(a);return P(!a.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||b===a,"bad address checksum","address",a),b}if(a.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){P(a.substring(2,4)===function(a){let b=(a=(a=a.toUpperCase()).substring(4)+a.substring(0,2)+"00").split("").map(a=>a8[a]).join("");for(;b.length>=15;){let a=b.substring(0,15);b=parseInt(a,10)%97+b.substring(a.length)}let c=String(98-parseInt(b,10)%97);for(;c.length<2;)c="0"+c;return c}(a),"bad icap checksum","address",a);let b=(function(a){a=a.toLowerCase();let b=a5;for(let c=0;c<a.length;c++)b=b*a6+a9[a[c]];return b})(a.substring(4)).toString(16);for(;b.length<40;)b="0"+b;return a7("0x"+b)}P(!1,"invalid address","address",a)}let bb={};function bc(a,b){let c=!1;return b<0&&(c=!0,b*=-1),new bf(bb,`${c?"":"u"}int${b}`,a,{signed:c,width:b})}function bd(a,b){return new bf(bb,`bytes${b||""}`,a,{size:b})}let be=Symbol.for("_ethers_typed");class bf{type;value;#k;_typedSymbol;constructor(a,b,c,d){null==d&&(d=null),S(bb,a,"Typed"),J(this,{_typedSymbol:be,type:b,value:c}),this.#k=d,this.format()}format(){if("array"===this.type||"dynamicArray"===this.type)throw Error("");return"tuple"===this.type?`tuple(${this.value.map(a=>a.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return"string"===this.type}get tupleName(){if("tuple"!==this.type)throw TypeError("not a tuple");return this.#k}get arrayLength(){if("array"!==this.type)throw TypeError("not an array");return!0===this.#k?-1:!1===this.#k?this.value.length:null}static from(a,b){return new bf(bb,a,b)}static uint8(a){return bc(a,8)}static uint16(a){return bc(a,16)}static uint24(a){return bc(a,24)}static uint32(a){return bc(a,32)}static uint40(a){return bc(a,40)}static uint48(a){return bc(a,48)}static uint56(a){return bc(a,56)}static uint64(a){return bc(a,64)}static uint72(a){return bc(a,72)}static uint80(a){return bc(a,80)}static uint88(a){return bc(a,88)}static uint96(a){return bc(a,96)}static uint104(a){return bc(a,104)}static uint112(a){return bc(a,112)}static uint120(a){return bc(a,120)}static uint128(a){return bc(a,128)}static uint136(a){return bc(a,136)}static uint144(a){return bc(a,144)}static uint152(a){return bc(a,152)}static uint160(a){return bc(a,160)}static uint168(a){return bc(a,168)}static uint176(a){return bc(a,176)}static uint184(a){return bc(a,184)}static uint192(a){return bc(a,192)}static uint200(a){return bc(a,200)}static uint208(a){return bc(a,208)}static uint216(a){return bc(a,216)}static uint224(a){return bc(a,224)}static uint232(a){return bc(a,232)}static uint240(a){return bc(a,240)}static uint248(a){return bc(a,248)}static uint256(a){return bc(a,256)}static uint(a){return bc(a,256)}static int8(a){return bc(a,-8)}static int16(a){return bc(a,-16)}static int24(a){return bc(a,-24)}static int32(a){return bc(a,-32)}static int40(a){return bc(a,-40)}static int48(a){return bc(a,-48)}static int56(a){return bc(a,-56)}static int64(a){return bc(a,-64)}static int72(a){return bc(a,-72)}static int80(a){return bc(a,-80)}static int88(a){return bc(a,-88)}static int96(a){return bc(a,-96)}static int104(a){return bc(a,-104)}static int112(a){return bc(a,-112)}static int120(a){return bc(a,-120)}static int128(a){return bc(a,-128)}static int136(a){return bc(a,-136)}static int144(a){return bc(a,-144)}static int152(a){return bc(a,-152)}static int160(a){return bc(a,-160)}static int168(a){return bc(a,-168)}static int176(a){return bc(a,-176)}static int184(a){return bc(a,-184)}static int192(a){return bc(a,-192)}static int200(a){return bc(a,-200)}static int208(a){return bc(a,-208)}static int216(a){return bc(a,-216)}static int224(a){return bc(a,-224)}static int232(a){return bc(a,-232)}static int240(a){return bc(a,-240)}static int248(a){return bc(a,-248)}static int256(a){return bc(a,-256)}static int(a){return bc(a,-256)}static bytes1(a){return bd(a,1)}static bytes2(a){return bd(a,2)}static bytes3(a){return bd(a,3)}static bytes4(a){return bd(a,4)}static bytes5(a){return bd(a,5)}static bytes6(a){return bd(a,6)}static bytes7(a){return bd(a,7)}static bytes8(a){return bd(a,8)}static bytes9(a){return bd(a,9)}static bytes10(a){return bd(a,10)}static bytes11(a){return bd(a,11)}static bytes12(a){return bd(a,12)}static bytes13(a){return bd(a,13)}static bytes14(a){return bd(a,14)}static bytes15(a){return bd(a,15)}static bytes16(a){return bd(a,16)}static bytes17(a){return bd(a,17)}static bytes18(a){return bd(a,18)}static bytes19(a){return bd(a,19)}static bytes20(a){return bd(a,20)}static bytes21(a){return bd(a,21)}static bytes22(a){return bd(a,22)}static bytes23(a){return bd(a,23)}static bytes24(a){return bd(a,24)}static bytes25(a){return bd(a,25)}static bytes26(a){return bd(a,26)}static bytes27(a){return bd(a,27)}static bytes28(a){return bd(a,28)}static bytes29(a){return bd(a,29)}static bytes30(a){return bd(a,30)}static bytes31(a){return bd(a,31)}static bytes32(a){return bd(a,32)}static address(a){return new bf(bb,"address",a)}static bool(a){return new bf(bb,"bool",!!a)}static bytes(a){return new bf(bb,"bytes",a)}static string(a){return new bf(bb,"string",a)}static array(a,b){throw Error("not implemented yet")}static tuple(a,b){throw Error("not implemented yet")}static overrides(a){return new bf(bb,"overrides",Object.assign({},a))}static isTyped(a){return a&&"object"==typeof a&&"_typedSymbol"in a&&a._typedSymbol===be}static dereference(a,b){if(bf.isTyped(a)){if(a.type!==b)throw Error(`invalid type: expecetd ${b}, got ${a.type}`);return a.value}return a}}class bg extends ax{constructor(a){super("address","address",a,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(a,b){let c=bf.dereference(b,"string");try{c=ba(c)}catch(a){return this._throwError(a.message,b)}return a.writeValue(c)}decode(a){return ba(am(a.readValue(),20))}}class bh extends ax{coder;constructor(a){super(a.name,a.type,"_",a.dynamic),this.coder=a}defaultValue(){return this.coder.defaultValue()}encode(a,b){return this.coder.encode(a,b)}decode(a){return this.coder.decode(a)}}function bi(a,b,c){let d=[];if(Array.isArray(c))d=c;else if(c&&"object"==typeof c){let a={};d=b.map(b=>{let d=b.localName;return O(d,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:b},value:c}),O(!a[d],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:b},value:c}),a[d]=!0,c[d]})}else P(!1,"invalid tuple value","tuple",c);P(b.length===d.length,"types/value length mismatch","tuple",c);let e=new ay,f=new ay,g=[];b.forEach((a,b)=>{let c=d[b];if(a.dynamic){let b=f.length;a.encode(f,c);let d=e.writeUpdatableValue();g.push(a=>{d(a+b)})}else a.encode(e,c)}),g.forEach(a=>{a(e.length)});let h=a.appendWriter(e);return h+a.appendWriter(f)}function bj(a,b){let c=[],d=[],e=a.subReader(0);return b.forEach(b=>{let f=null;if(b.dynamic){let c=a.readIndex(),d=e.subReader(c);try{f=b.decode(d)}catch(a){if(L(a,"BUFFER_OVERRUN"))throw a;(f=a).baseType=b.name,f.name=b.localName,f.type=b.type}}else try{f=b.decode(a)}catch(a){if(L(a,"BUFFER_OVERRUN"))throw a;(f=a).baseType=b.name,f.name=b.localName,f.type=b.type}if(void 0==f)throw Error("investigate");c.push(f),d.push(b.localName||null)}),av.fromItems(c,d)}class bk extends ax{coder;length;constructor(a,b,c){super("array",a.type+"["+(b>=0?b:"")+"]",c,-1===b||a.dynamic),J(this,{coder:a,length:b})}defaultValue(){let a=this.coder.defaultValue(),b=[];for(let c=0;c<this.length;c++)b.push(a);return b}encode(a,b){let c=bf.dereference(b,"array");Array.isArray(c)||this._throwError("expected array value",c);let d=this.length;-1===d&&(d=c.length,a.writeValue(c.length)),Q(c.length,d,"coder array"+(this.localName?" "+this.localName:""));let e=[];for(let a=0;a<c.length;a++)e.push(this.coder);return bi(a,e,c)}decode(a){let b=this.length;-1===b&&O(32*(b=a.readIndex())<=a.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:a.bytes,offset:32*b,length:a.dataLength});let c=[];for(let a=0;a<b;a++)c.push(new bh(this.coder));return bj(a,c)}}class bl extends ax{constructor(a){super("bool","bool",a,!1)}defaultValue(){return!1}encode(a,b){let c=bf.dereference(b,"bool");return a.writeValue(+!!c)}decode(a){return!!a.readValue()}}class bm extends ax{constructor(a,b){super(a,a,b,!0)}defaultValue(){return"0x"}encode(a,b){b=V(b);let c=a.writeValue(b.length);return c+a.writeBytes(b)}decode(a){return a.readBytes(a.readIndex(),!0)}}class bn extends bm{constructor(a){super("bytes",a)}decode(a){return Z(super.decode(a))}}class bo extends ax{size;constructor(a,b){let c="bytes"+String(a);super(c,c,b,!1),J(this,{size:a},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+2*this.size)}encode(a,b){let c=V(bf.dereference(b,this.type));return c.length!==this.size&&this._throwError("incorrect data length",b),a.writeBytes(c)}decode(a){return Z(a.readBytes(this.size))}}let bp=new Uint8Array([]);class bq extends ax{constructor(a){super("null","",a,!1)}defaultValue(){return null}encode(a,b){return null!=b&&this._throwError("not null",b),a.writeBytes(bp)}decode(a){return a.readBytes(0),null}}let br=BigInt(0),bs=BigInt(1),bt=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class bu extends ax{size;signed;constructor(a,b,c){const d=(b?"int":"uint")+8*a;super(d,d,c,!1),J(this,{size:a,signed:b},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(a,b){let c=ah(bf.dereference(b,this.type)),d=ag(bt,256);if(this.signed){let a=ag(d,8*this.size-1);(c>a||c<-(a+bs))&&this._throwError("value out-of-bounds",b),c=af(c,256)}else(c<br||c>ag(d,8*this.size))&&this._throwError("value out-of-bounds",b);return a.writeValue(c)}decode(a){var b,c;let d,e,f=ag(a.readValue(),8*this.size);return this.signed&&(b=f,c=8*this.size,d=ai(b,"value"),O(d>>(e=BigInt(al(c,"width")))===ad,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:b}),f=d>>e-ae?-((~d&(ae<<e)-ae)+ae):d),f}}function bv(a,b,c,d,e){if("BAD_PREFIX"===a||"UNEXPECTED_CONTINUE"===a){let a=0;for(let d=b+1;d<c.length&&c[d]>>6==2;d++)a++;return a}return"OVERRUN"===a?c.length-b-1:0}let bw=Object.freeze({error:function(a,b,c,d,e){P(!1,`invalid codepoint at offset ${b}; ${a}`,"bytes",c)},ignore:bv,replace:function(a,b,c,d,e){return"OVERLONG"===a?(P("number"==typeof e,"invalid bad code point for replacement","badCodepoint",e),d.push(e),0):(d.push(65533),bv(a,b,c,d,e))}});function bx(a,b){(P("string"==typeof a,"invalid string value","str",a),null!=b)&&(O(R.indexOf(b)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:b}}),a=a.normalize(b));let c=[];for(let b=0;b<a.length;b++){let d=a.charCodeAt(b);if(d<128)c.push(d);else if(d<2048)c.push(d>>6|192),c.push(63&d|128);else if((64512&d)==55296){b++;let e=a.charCodeAt(b);P(b<a.length&&(64512&e)==56320,"invalid surrogate pair","str",a);let f=65536+((1023&d)<<10)+(1023&e);c.push(f>>18|240),c.push(f>>12&63|128),c.push(f>>6&63|128),c.push(63&f|128)}else c.push(d>>12|224),c.push(d>>6&63|128),c.push(63&d|128)}return new Uint8Array(c)}function by(a,b){return(function(a,b){null==b&&(b=bw.error);let c=U(a,"bytes"),d=[],e=0;for(;e<c.length;){let a=c[e++];if(a>>7==0){d.push(a);continue}let f=null,g=null;if((224&a)==192)f=1,g=127;else if((240&a)==224)f=2,g=2047;else if((248&a)==240)f=3,g=65535;else{(192&a)==128?e+=b("UNEXPECTED_CONTINUE",e-1,c,d):e+=b("BAD_PREFIX",e-1,c,d);continue}if(e-1+f>=c.length){e+=b("OVERRUN",e-1,c,d);continue}let h=a&(1<<8-f-1)-1;for(let a=0;a<f;a++){let a=c[e];if((192&a)!=128){e+=b("MISSING_CONTINUE",e,c,d),h=null;break}h=h<<6|63&a,e++}if(null!==h){if(h>1114111){e+=b("OUT_OF_RANGE",e-1-f,c,d,h);continue}if(h>=55296&&h<=57343){e+=b("UTF16_SURROGATE",e-1-f,c,d,h);continue}if(h<=g){e+=b("OVERLONG",e-1-f,c,d,h);continue}d.push(h)}}return d})(a,b).map(a=>a<=65535?String.fromCharCode(a):String.fromCharCode(((a-=65536)>>10&1023)+55296,(1023&a)+56320)).join("")}class bz extends bm{constructor(a){super("string",a)}defaultValue(){return""}encode(a,b){return super.encode(a,bx(bf.dereference(b,"string")))}decode(a){return by(super.decode(a))}}class bA extends ax{coders;constructor(a,b){let c=!1;const d=[];a.forEach(a=>{a.dynamic&&(c=!0),d.push(a.type)}),super("tuple","tuple("+d.join(",")+")",b,c),J(this,{coders:Object.freeze(a.slice())})}defaultValue(){let a=[];this.coders.forEach(b=>{a.push(b.defaultValue())});let b=this.coders.reduce((a,b)=>{let c=b.localName;return c&&(a[c]||(a[c]=0),a[c]++),a},{});return this.coders.forEach((c,d)=>{let e=c.localName;e&&1===b[e]&&("length"===e&&(e="_length"),null==a[e]&&(a[e]=a[d]))}),Object.freeze(a)}encode(a,b){let c=bf.dereference(b,"tuple");return bi(a,this.coders,c)}decode(a){return bj(a,this.coders)}}function bB(a){return a4(bx(a))}function bC(a){let b=new Set;return a.forEach(a=>b.add(a)),Object.freeze(b)}let bD=bC("external public payable override".split(" ")),bE="constant external internal payable private public pure view override",bF=bC(bE.split(" ")),bG="constructor error event fallback function receive struct",bH=bC(bG.split(" ")),bI="calldata memory storage payable indexed",bJ=bC(bI.split(" ")),bK=bC([bG,bI,"tuple returns",bE].join(" ").split(" ")),bL={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},bM=RegExp("^(\\s*)"),bN=RegExp("^([0-9]+)"),bO=RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),bP=RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),bQ=RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");class bR{#e;#l;get offset(){return this.#e}get length(){return this.#l.length-this.#e}constructor(a){this.#e=0,this.#l=a.slice()}clone(){return new bR(this.#l)}reset(){this.#e=0}#m(a=0,b=0){return new bR(this.#l.slice(a,b).map(b=>Object.freeze(Object.assign({},b,{match:b.match-a,linkBack:b.linkBack-a,linkNext:b.linkNext-a}))))}popKeyword(a){let b=this.peek();if("KEYWORD"!==b.type||!a.has(b.text))throw Error(`expected keyword ${b.text}`);return this.pop().text}popType(a){if(this.peek().type!==a){let b=this.peek();throw Error(`expected ${a}; got ${b.type} ${JSON.stringify(b.text)}`)}return this.pop().text}popParen(){let a=this.peek();if("OPEN_PAREN"!==a.type)throw Error("bad start");let b=this.#m(this.#e+1,a.match+1);return this.#e=a.match+1,b}popParams(){let a=this.peek();if("OPEN_PAREN"!==a.type)throw Error("bad start");let b=[];for(;this.#e<a.match-1;){let a=this.peek().linkNext;b.push(this.#m(this.#e+1,a)),this.#e=a}return this.#e=a.match+1,b}peek(){if(this.#e>=this.#l.length)throw Error("out-of-bounds");return this.#l[this.#e]}peekKeyword(a){let b=this.peekType("KEYWORD");return null!=b&&a.has(b)?b:null}peekType(a){if(0===this.length)return null;let b=this.peek();return b.type===a?b.text:null}pop(){let a=this.peek();return this.#e++,a}toString(){let a=[];for(let b=this.#e;b<this.#l.length;b++){let c=this.#l[b];a.push(`${c.type}:${c.text}`)}return`<TokenString ${a.join(" ")}>`}}function bS(a){let b=[],c=b=>{let c=f<a.length?JSON.stringify(a[f]):"$EOI";throw Error(`invalid token ${c} at ${f}: ${b}`)},d=[],e=[],f=0;for(;f<a.length;){let g=a.substring(f),h=g.match(bM);h&&(f+=h[1].length,g=a.substring(f));let i={depth:d.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:f,value:-1};b.push(i);let j=bL[g[0]]||"";if(j){if(i.type=j,i.text=g[0],f++,"OPEN_PAREN"===j)d.push(b.length-1),e.push(b.length-1);else if("CLOSE_PAREN"==j)0===d.length&&c("no matching open bracket"),i.match=d.pop(),b[i.match].match=b.length-1,i.depth--,i.linkBack=e.pop(),b[i.linkBack].linkNext=b.length-1;else if("COMMA"===j)i.linkBack=e.pop(),b[i.linkBack].linkNext=b.length-1,e.push(b.length-1);else if("OPEN_BRACKET"===j)i.type="BRACKET";else if("CLOSE_BRACKET"===j){let a=b.pop().text;if(b.length>0&&"NUMBER"===b[b.length-1].type){let c=b.pop().text;a=c+a,b[b.length-1].value=al(c)}if(0===b.length||"BRACKET"!==b[b.length-1].type)throw Error("missing opening bracket");b[b.length-1].text+=a}continue}if(h=g.match(bO)){if(i.text=h[1],f+=i.text.length,bK.has(i.text)){i.type="KEYWORD";continue}if(i.text.match(bQ)){i.type="TYPE";continue}i.type="ID";continue}if(h=g.match(bN)){i.text=h[1],i.type="NUMBER",f+=i.text.length;continue}throw Error(`unexpected token ${JSON.stringify(g[0])} at position ${f}`)}return new bR(b.map(a=>Object.freeze(a)))}function bT(a,b){let c=[];for(let d in b.keys())a.has(d)&&c.push(d);if(c.length>1)throw Error(`conflicting types: ${c.join(", ")}`)}function bU(a,b){if(b.peekKeyword(bH)){let c=b.pop().text;if(c!==a)throw Error(`expected ${a}, got ${c}`)}return b.popType("ID")}function bV(a,b){let c=new Set;for(;;){let d=a.peekType("KEYWORD");if(null==d||b&&!b.has(d))break;if(a.pop(),c.has(d))throw Error(`duplicate keywords: ${JSON.stringify(d)}`);c.add(d)}return Object.freeze(c)}function bW(a){let b=bV(a,bF);return(bT(b,bC("constant payable nonpayable".split(" "))),bT(b,bC("pure view payable nonpayable".split(" "))),b.has("view"))?"view":b.has("pure")?"pure":b.has("payable")?"payable":b.has("nonpayable")?"nonpayable":b.has("constant")?"view":"nonpayable"}function bX(a,b){return a.popParams().map(a=>b9.from(a,b))}function bY(a){if(a.peekType("AT")){if(a.pop(),a.peekType("NUMBER"))return ah(a.pop().text);throw Error("invalid gas")}return null}function bZ(a){if(a.length)throw Error(`unexpected tokens at offset ${a.offset}: ${a.toString()}`)}let b$=new RegExp(/^(.*)\[([0-9]*)\]$/);function b_(a){let b=a.match(bQ);if(P(b,"invalid type","type",a),"uint"===a)return"uint256";if("int"===a)return"int256";if(b[2]){let c=parseInt(b[2]);P(0!==c&&c<=32,"invalid bytes length","type",a)}else if(b[3]){let c=parseInt(b[3]);P(0!==c&&c<=256&&c%8==0,"invalid numeric width","type",a)}return a}let b0={},b1=Symbol.for("_ethers_internal"),b2="_ParamTypeInternal",b3="_ErrorInternal",b4="_EventInternal",b5="_ConstructorInternal",b6="_FallbackInternal",b7="_FunctionInternal",b8="_StructInternal";class b9{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(a,b,c,d,e,f,g,h){if(S(a,b0,"ParamType"),Object.defineProperty(this,b1,{value:b2}),f&&(f=Object.freeze(f.slice())),"array"===d){if(null==g||null==h)throw Error("")}else if(null!=g||null!=h)throw Error("");if("tuple"===d){if(null==f)throw Error("")}else if(null!=f)throw Error("");J(this,{name:b,type:c,baseType:d,indexed:e,components:f,arrayLength:g,arrayChildren:h})}format(a){if(null==a&&(a="sighash"),"json"===a){let b=this.name||"";if(this.isArray()){let a=JSON.parse(this.arrayChildren.format("json"));return a.name=b,a.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(a)}let c={type:"tuple"===this.baseType?"tuple":this.type,name:b};return"boolean"==typeof this.indexed&&(c.indexed=this.indexed),this.isTuple()&&(c.components=this.components.map(b=>JSON.parse(b.format(a)))),JSON.stringify(c)}let b="";return this.isArray()?(b+=this.arrayChildren.format(a),b+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?b+="("+this.components.map(b=>b.format(a)).join("full"===a?", ":",")+")":b+=this.type,"sighash"!==a&&(!0===this.indexed&&(b+=" indexed"),"full"===a&&this.name&&(b+=" "+this.name)),b}isArray(){return"array"===this.baseType}isTuple(){return"tuple"===this.baseType}isIndexable(){return null!=this.indexed}walk(a,b){if(this.isArray()){if(!Array.isArray(a))throw Error("invalid array value");if(-1!==this.arrayLength&&a.length!==this.arrayLength)throw Error("array is wrong length");let c=this;return a.map(a=>c.arrayChildren.walk(a,b))}if(this.isTuple()){if(!Array.isArray(a))throw Error("invalid tuple value");if(a.length!==this.components.length)throw Error("array is wrong length");let c=this;return a.map((a,d)=>c.components[d].walk(a,b))}return b(this.type,a)}#n(a,b,c,d){if(this.isArray()){if(!Array.isArray(b))throw Error("invalid array value");if(-1!==this.arrayLength&&b.length!==this.arrayLength)throw Error("array is wrong length");let e=this.arrayChildren,f=b.slice();f.forEach((b,d)=>{e.#n(a,b,c,a=>{f[d]=a})}),d(f);return}if(this.isTuple()){let e,f=this.components;if(Array.isArray(b))e=b.slice();else{if(null==b||"object"!=typeof b)throw Error("invalid tuple value");e=f.map(a=>{if(!a.name)throw Error("cannot use object value with unnamed components");if(!(a.name in b))throw Error(`missing value for component ${a.name}`);return b[a.name]})}if(e.length!==this.components.length)throw Error("array is wrong length");e.forEach((b,d)=>{f[d].#n(a,b,c,a=>{e[d]=a})}),d(e);return}let e=c(this.type,b);e.then?a.push(async function(){d(await e)}()):d(e)}async walkAsync(a,b){let c=[],d=[a];return this.#n(c,a,b,a=>{d[0]=a}),c.length&&await Promise.all(c),d[0]}static from(a,b){if(b9.isParamType(a))return a;if("string"==typeof a)try{return b9.from(bS(a),b)}catch(b){P(!1,"invalid param type","obj",a)}else if(a instanceof bR){let c="",d="",e=null;bV(a,bC(["tuple"])).has("tuple")||a.peekType("OPEN_PAREN")?(d="tuple",e=a.popParams().map(a=>b9.from(a)),c=`tuple(${e.map(a=>a.format()).join(",")})`):d=c=b_(a.popType("TYPE"));let f=null,g=null;for(;a.length&&a.peekType("BRACKET");){let b=a.pop();f=new b9(b0,"",c,d,null,e,g,f),g=b.value,c+=b.text,d="array",e=null}let h=null;if(bV(a,bJ).has("indexed")){if(!b)throw Error("");h=!0}let i=a.peekType("ID")?a.pop().text:"";if(a.length)throw Error("leftover tokens");return new b9(b0,i,c,d,h,e,g,f)}let c=a.name;P(!c||"string"==typeof c&&c.match(bP),"invalid name","obj.name",c);let d=a.indexed;null!=d&&(P(b,"parameter cannot be indexed","obj.indexed",a.indexed),d=!!d);let e=a.type,f=e.match(b$);if(f){let b=parseInt(f[2]||"-1"),g=b9.from({type:f[1],components:a.components});return new b9(b0,c||"",e,"array",d,null,b,g)}if("tuple"===e||e.startsWith("tuple(")||e.startsWith("(")){let b=null!=a.components?a.components.map(a=>b9.from(a)):null;return new b9(b0,c||"",e,"tuple",d,b,null,null)}return new b9(b0,c||"",e=b_(a.type),e,d,null,null,null)}static isParamType(a){return a&&a[b1]===b2}}class ca{type;inputs;constructor(a,b,c){S(a,b0,"Fragment"),J(this,{type:b,inputs:c=Object.freeze(c.slice())})}static from(a){if("string"==typeof a){try{ca.from(JSON.parse(a))}catch(a){}return ca.from(bS(a))}if(a instanceof bR)switch(a.peekKeyword(bH)){case"constructor":return cf.from(a);case"error":return cd.from(a);case"event":return ce.from(a);case"fallback":case"receive":return cg.from(a);case"function":return ch.from(a);case"struct":return ci.from(a)}else if("object"==typeof a){switch(a.type){case"constructor":return cf.from(a);case"error":return cd.from(a);case"event":return ce.from(a);case"fallback":case"receive":return cg.from(a);case"function":return ch.from(a);case"struct":return ci.from(a)}O(!1,`unsupported type: ${a.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}P(!1,"unsupported frgament object","obj",a)}static isConstructor(a){return cf.isFragment(a)}static isError(a){return cd.isFragment(a)}static isEvent(a){return ce.isFragment(a)}static isFunction(a){return ch.isFragment(a)}static isStruct(a){return ci.isFragment(a)}}class cb extends ca{name;constructor(a,b,c,d){super(a,b,d),P("string"==typeof c&&c.match(bP),"invalid identifier","name",c),d=Object.freeze(d.slice()),J(this,{name:c})}}function cc(a,b){return"("+b.map(b=>b.format(a)).join("full"===a?", ":",")+")"}class cd extends cb{constructor(a,b,c){super(a,"error",b,c),Object.defineProperty(this,b1,{value:b3})}get selector(){return bB(this.format("sighash")).substring(0,10)}format(a){if(null==a&&(a="sighash"),"json"===a)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(b=>JSON.parse(b.format(a)))});let b=[];return"sighash"!==a&&b.push("error"),b.push(this.name+cc(a,this.inputs)),b.join(" ")}static from(a){if(cd.isFragment(a))return a;if("string"==typeof a)return cd.from(bS(a));if(a instanceof bR){let b=bU("error",a),c=bX(a);return bZ(a),new cd(b0,b,c)}return new cd(b0,a.name,a.inputs?a.inputs.map(b9.from):[])}static isFragment(a){return a&&a[b1]===b3}}class ce extends cb{anonymous;constructor(a,b,c,d){super(a,"event",b,c),Object.defineProperty(this,b1,{value:b4}),J(this,{anonymous:d})}get topicHash(){return bB(this.format("sighash"))}format(a){if(null==a&&(a="sighash"),"json"===a)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(b=>JSON.parse(b.format(a)))});let b=[];return"sighash"!==a&&b.push("event"),b.push(this.name+cc(a,this.inputs)),"sighash"!==a&&this.anonymous&&b.push("anonymous"),b.join(" ")}static getTopicHash(a,b){return new ce(b0,a,b=(b||[]).map(a=>b9.from(a)),!1).topicHash}static from(a){if(ce.isFragment(a))return a;if("string"==typeof a)try{return ce.from(bS(a))}catch(b){P(!1,"invalid event fragment","obj",a)}else if(a instanceof bR){let b=bU("event",a),c=bX(a,!0),d=!!bV(a,bC(["anonymous"])).has("anonymous");return bZ(a),new ce(b0,b,c,d)}return new ce(b0,a.name,a.inputs?a.inputs.map(a=>b9.from(a,!0)):[],!!a.anonymous)}static isFragment(a){return a&&a[b1]===b4}}class cf extends ca{payable;gas;constructor(a,b,c,d,e){super(a,b,c),Object.defineProperty(this,b1,{value:b5}),J(this,{payable:d,gas:e})}format(a){if(O(null!=a&&"sighash"!==a,"cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),"json"===a)return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map(b=>JSON.parse(b.format(a)))});let b=[`constructor${cc(a,this.inputs)}`];return this.payable&&b.push("payable"),null!=this.gas&&b.push(`@${this.gas.toString()}`),b.join(" ")}static from(a){if(cf.isFragment(a))return a;if("string"==typeof a)try{return cf.from(bS(a))}catch(b){P(!1,"invalid constuctor fragment","obj",a)}else if(a instanceof bR){bV(a,bC(["constructor"]));let b=bX(a),c=!!bV(a,bD).has("payable"),d=bY(a);return bZ(a),new cf(b0,"constructor",b,c,d)}return new cf(b0,"constructor",a.inputs?a.inputs.map(b9.from):[],!!a.payable,null!=a.gas?a.gas:null)}static isFragment(a){return a&&a[b1]===b5}}class cg extends ca{payable;constructor(a,b,c){super(a,"fallback",b),Object.defineProperty(this,b1,{value:b6}),J(this,{payable:c})}format(a){let b=0===this.inputs.length?"receive":"fallback";return"json"===a?JSON.stringify({type:b,stateMutability:this.payable?"payable":"nonpayable"}):`${b}()${this.payable?" payable":""}`}static from(a){if(cg.isFragment(a))return a;if("string"==typeof a)try{return cg.from(bS(a))}catch(b){P(!1,"invalid fallback fragment","obj",a)}else if(a instanceof bR){let b=a.toString();if(P(a.peekKeyword(bC(["fallback","receive"])),"type must be fallback or receive","obj",b),"receive"===a.popKeyword(bC(["fallback","receive"]))){let b=bX(a);return P(0===b.length,"receive cannot have arguments","obj.inputs",b),bV(a,bC(["payable"])),bZ(a),new cg(b0,[],!0)}let c=bX(a);c.length?P(1===c.length&&"bytes"===c[0].type,"invalid fallback inputs","obj.inputs",c.map(a=>a.format("minimal")).join(", ")):c=[b9.from("bytes")];let d=bW(a);if(P("nonpayable"===d||"payable"===d,"fallback cannot be constants","obj.stateMutability",d),bV(a,bC(["returns"])).has("returns")){let b=bX(a);P(1===b.length&&"bytes"===b[0].type,"invalid fallback outputs","obj.outputs",b.map(a=>a.format("minimal")).join(", "))}return bZ(a),new cg(b0,c,"payable"===d)}return"receive"===a.type?new cg(b0,[],!0):"fallback"===a.type?new cg(b0,[b9.from("bytes")],"payable"===a.stateMutability):void P(!1,"invalid fallback description","obj",a)}static isFragment(a){return a&&a[b1]===b6}}class ch extends cb{constant;outputs;stateMutability;payable;gas;constructor(a,b,c,d,e,f){super(a,"function",b,d),Object.defineProperty(this,b1,{value:b7}),J(this,{constant:"view"===c||"pure"===c,gas:f,outputs:e=Object.freeze(e.slice()),payable:"payable"===c,stateMutability:c})}get selector(){return bB(this.format("sighash")).substring(0,10)}format(a){if(null==a&&(a="sighash"),"json"===a)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map(b=>JSON.parse(b.format(a))),outputs:this.outputs.map(b=>JSON.parse(b.format(a)))});let b=[];return"sighash"!==a&&b.push("function"),b.push(this.name+cc(a,this.inputs)),"sighash"!==a&&("nonpayable"!==this.stateMutability&&b.push(this.stateMutability),this.outputs&&this.outputs.length&&(b.push("returns"),b.push(cc(a,this.outputs))),null!=this.gas&&b.push(`@${this.gas.toString()}`)),b.join(" ")}static getSelector(a,b){return new ch(b0,a,"view",b=(b||[]).map(a=>b9.from(a)),[],null).selector}static from(a){if(ch.isFragment(a))return a;if("string"==typeof a)try{return ch.from(bS(a))}catch(b){P(!1,"invalid function fragment","obj",a)}else if(a instanceof bR){let b=bU("function",a),c=bX(a),d=bW(a),e=[];bV(a,bC(["returns"])).has("returns")&&(e=bX(a));let f=bY(a);return bZ(a),new ch(b0,b,d,c,e,f)}let b=a.stateMutability;return null==b&&(b="payable","boolean"==typeof a.constant?(b="view",!a.constant&&(b="payable","boolean"!=typeof a.payable||a.payable||(b="nonpayable"))):"boolean"!=typeof a.payable||a.payable||(b="nonpayable")),new ch(b0,a.name,b,a.inputs?a.inputs.map(b9.from):[],a.outputs?a.outputs.map(b9.from):[],null!=a.gas?a.gas:null)}static isFragment(a){return a&&a[b1]===b7}}class ci extends cb{constructor(a,b,c){super(a,"struct",b,c),Object.defineProperty(this,b1,{value:b8})}format(){throw Error("@TODO")}static from(a){if("string"==typeof a)try{return ci.from(bS(a))}catch(b){P(!1,"invalid struct fragment","obj",a)}else if(a instanceof bR){let b=bU("struct",a),c=bX(a);return bZ(a),new ci(b0,b,c)}return new ci(b0,a.name,a.inputs?a.inputs.map(b9.from):[])}static isFragment(a){return a&&a[b1]===b8}}let cj=new Map;cj.set(0,"GENERIC_PANIC"),cj.set(1,"ASSERT_FALSE"),cj.set(17,"OVERFLOW"),cj.set(18,"DIVIDE_BY_ZERO"),cj.set(33,"ENUM_RANGE_ERROR"),cj.set(34,"BAD_STORAGE_DATA"),cj.set(49,"STACK_UNDERFLOW"),cj.set(50,"ARRAY_RANGE_ERROR"),cj.set(65,"OUT_OF_MEMORY"),cj.set(81,"UNINITIALIZED_FUNCTION_CALL");let ck=new RegExp(/^bytes([0-9]*)$/),cl=new RegExp(/^(u?int)([0-9]*)$/),cm=null,cn=1024;class co{#o(a){if(a.isArray())return new bk(this.#o(a.arrayChildren),a.arrayLength,a.name);if(a.isTuple())return new bA(a.components.map(a=>this.#o(a)),a.name);switch(a.baseType){case"address":return new bg(a.name);case"bool":return new bl(a.name);case"string":return new bz(a.name);case"bytes":return new bn(a.name);case"":return new bq(a.name)}let b=a.type.match(cl);if(b){let c=parseInt(b[2]||"256");return P(0!==c&&c<=256&&c%8==0,"invalid "+b[1]+" bit length","param",a),new bu(c/8,"int"===b[1],a.name)}if(b=a.type.match(ck)){let c=parseInt(b[1]);return P(0!==c&&c<=32,"invalid bytes length","param",a),new bo(c,a.name)}P(!1,"invalid type","type",a.type)}getDefaultValue(a){return new bA(a.map(a=>this.#o(b9.from(a))),"_").defaultValue()}encode(a,b){Q(b.length,a.length,"types/values length mismatch");let c=new bA(a.map(a=>this.#o(b9.from(a))),"_"),d=new ay;return c.encode(d,b),d.data}decode(a,b,c){return new bA(a.map(a=>this.#o(b9.from(a))),"_").decode(new az(b,c,cn))}static _setDefaultMaxInflation(a){P("number"==typeof a&&Number.isInteger(a),"invalid defaultMaxInflation factor","value",a),cn=a}static defaultAbiCoder(){return null==cm&&(cm=new co),cm}static getBuiltinCallException(a,b,c){return function(a,b,c,d){let e="missing revert data",f=null,g=null;if(c){e="execution reverted";let a=U(c);if(c=Z(c),0===a.length)e+=" (no data present; likely require(false) occurred",f="require(false)";else if(a.length%32!=4)e+=" (could not decode reason; invalid data length)";else if("0x08c379a0"===Z(a.slice(0,4)))try{f=d.decode(["string"],a.slice(4))[0],g={signature:"Error(string)",name:"Error",args:[f]},e+=`: ${JSON.stringify(f)}`}catch(a){e+=" (could not decode reason; invalid string data)"}else if("0x4e487b71"===Z(a.slice(0,4)))try{let b=Number(d.decode(["uint256"],a.slice(4))[0]);g={signature:"Panic(uint256)",name:"Panic",args:[b]},f=`Panic due to ${cj.get(b)||"UNKNOWN"}(${b})`,e+=`: ${f}`}catch(a){e+=" (could not decode panic code)"}else e+=" (unknown custom error)"}let h={to:b.to?ba(b.to):null,data:b.data||"0x"};return b.from&&(h.from=ba(b.from)),N(e,"CALL_EXCEPTION",{action:a,data:c,reason:f,transaction:h,invocation:null,revert:g})}(a,b,c,co.defaultAbiCoder())}}function cp(a){return a&&"function"==typeof a.getAddress}async function cq(a,b){let c=await b;return(null==c||"0x0000000000000000000000000000000000000000"===c)&&(O("string"!=typeof a,"unconfigured name","UNCONFIGURED_NAME",{value:a}),P(!1,"invalid AddressLike value; did not resolve to a value address","target",a)),ba(c)}function cr(a,b){return"string"==typeof a?a.match(/^0x[0-9a-f]{40}$/i)?ba(a):(O(null!=b,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),cq(a,b.resolveName(a))):cp(a)?cq(a,a.getAddress()):a&&"function"==typeof a.then?cq(a,a):void P(!1,"unsupported addressable value","target",a)}let cs=new Uint8Array(32);cs.fill(0);let ct=BigInt(-1),cu=BigInt(0),cv=BigInt(1),cw=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),cx=am(cv,32),cy=am(cu,32),cz={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},cA=["name","version","chainId","verifyingContract","salt"];function cB(a){return function(b){return P("string"==typeof b,`invalid domain value for ${JSON.stringify(a)}`,`domain.${a}`,b),b}}let cC={name:cB("name"),version:cB("version"),chainId:function(a){let b=ah(a,"domain.chainId");return(P(b>=0,"invalid chain ID","domain.chainId",a),Number.isSafeInteger(b))?Number(b):ao(b)},verifyingContract:function(a){try{return ba(a).toLowerCase()}catch(a){}P(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",a)},salt:function(a){let b=U(a,"domain.salt");return P(32===b.length,'invalid domain value "salt"',"domain.salt",a),Z(b)}};function cD(a){{let b=a.match(/^(u?)int(\d+)$/);if(b){let c=""===b[1],d=parseInt(b[2]);P(d%8==0&&0!==d&&d<=256&&b[2]===String(d),"invalid numeric width","type",a);let e=ag(cw,c?d-1:d),f=c?(e+cv)*ct:cu;return function(b){let d=ah(b,"value");return P(d>=f&&d<=e,`value out-of-bounds for ${a}`,"value",d),am(c?af(d,256):d,32)}}}{let b=a.match(/^bytes(\d+)$/);if(b){let c=parseInt(b[1]);return P(0!==c&&c<=32&&b[1]===String(c),"invalid bytes width","type",a),function(b){let d,e;return P(U(b).length===c,`invalid length for ${a}`,"value",b),(e=(d=U(b)).length%32)?$([d,cs.slice(e)]):Z(d)}}}switch(a){case"address":return function(a){return ac(ba(a),32)};case"bool":return function(a){return a?cx:cy};case"bytes":return function(a){return a4(a)};case"string":return function(a){return bB(a)}}return null}function cE(a,b){return`${a}(${b.map(({name:a,type:b})=>b+" "+a).join(",")})`}function cF(a){let b=a.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return b?{base:b[1],index:b[2]+b[4],array:{base:b[1],prefix:b[1]+b[2],count:b[5]?parseInt(b[5]):-1}}:{base:a}}class cG{primaryType;#p;get types(){return JSON.parse(this.#p)}#q;#r;constructor(a){this.#q=new Map,this.#r=new Map;const b=new Map,c=new Map,d=new Map,e={};for(const f in Object.keys(a).forEach(f=>{e[f]=a[f].map(({name:b,type:c})=>{let{base:d,index:e}=cF(c);return"int"!==d||a.int||(d="int256"),"uint"!==d||a.uint||(d="uint256"),{name:b,type:d+(e||"")}}),b.set(f,new Set),c.set(f,[]),d.set(f,new Set)}),this.#p=JSON.stringify(e),e){const d=new Set;for(const g of e[f]){P(!d.has(g.name),`duplicate variable name ${JSON.stringify(g.name)} in ${JSON.stringify(f)}`,"types",a),d.add(g.name);const e=cF(g.type).base;P(e!==f,`circular type reference to ${JSON.stringify(e)}`,"types",a),cD(e)||(P(c.has(e),`unknown type ${JSON.stringify(e)}`,"types",a),c.get(e).push(f),b.get(f).add(e))}}const f=Array.from(c.keys()).filter(a=>0===c.get(a).length);for(const[g,h]of(P(0!==f.length,"missing primary type","types",a),P(1===f.length,`ambiguous primary types or unused types: ${f.map(a=>JSON.stringify(a)).join(", ")}`,"types",a),J(this,{primaryType:f[0]}),!function e(f,g){for(let h of(P(!g.has(f),`circular type reference to ${JSON.stringify(f)}`,"types",a),g.add(f),b.get(f)))if(c.has(h))for(let a of(e(h,g),g))d.get(a).add(h);g.delete(f)}(this.primaryType,new Set),d)){const a=Array.from(h);a.sort(),this.#q.set(g,cE(g,e[g])+a.map(a=>cE(a,e[a])).join(""))}}getEncoder(a){let b=this.#r.get(a);return b||(b=this.#s(a),this.#r.set(a,b)),b}#s(a){{let b=cD(a);if(b)return b}let b=cF(a).array;if(b){let a=b.prefix,c=this.getEncoder(a);return d=>{P(-1===b.count||b.count===d.length,`array length mismatch; expected length ${b.count}`,"value",d);let e=d.map(c);return this.#q.has(a)&&(e=e.map(a4)),a4($(e))}}let c=this.types[a];if(c){let b=bB(this.#q.get(a));return a=>{let d=c.map(({name:b,type:c})=>{let d=this.getEncoder(c)(a[b]);return this.#q.has(c)?a4(d):d});return d.unshift(b),$(d)}}P(!1,`unknown type: ${a}`,"type",a)}encodeType(a){let b=this.#q.get(a);return P(b,`unknown type: ${JSON.stringify(a)}`,"name",a),b}encodeData(a,b){return this.getEncoder(a)(b)}hashStruct(a,b){return a4(this.encodeData(a,b))}encode(a){return this.encodeData(this.primaryType,a)}hash(a){return this.hashStruct(this.primaryType,a)}_visit(a,b,c){if(cD(a))return c(a,b);let d=cF(a).array;if(d)return P(-1===d.count||d.count===b.length,`array length mismatch; expected length ${d.count}`,"value",b),b.map(a=>this._visit(d.prefix,a,c));let e=this.types[a];if(e)return e.reduce((a,{name:d,type:e})=>(a[d]=this._visit(e,b[d],c),a),{});P(!1,`unknown type: ${a}`,"type",a)}visit(a,b){return this._visit(this.primaryType,a,b)}static from(a){return new cG(a)}static getPrimaryType(a){return cG.from(a).primaryType}static hashStruct(a,b,c){return cG.from(b).hashStruct(a,c)}static hashDomain(a){let b=[];for(let c in a){if(null==a[c])continue;let d=cz[c];P(d,`invalid typed-data domain key: ${JSON.stringify(c)}`,"domain",a),b.push({name:c,type:d})}return b.sort((a,b)=>cA.indexOf(a.name)-cA.indexOf(b.name)),cG.hashStruct("EIP712Domain",{EIP712Domain:b},a)}static encode(a,b,c){return $(["0x1901",cG.hashDomain(a),cG.from(b).hash(c)])}static hash(a,b,c){return a4(cG.encode(a,b,c))}static async resolveNames(a,b,c,d){for(let b in a=Object.assign({},a))null==a[b]&&delete a[b];let e={};a.verifyingContract&&!W(a.verifyingContract,20)&&(e[a.verifyingContract]="0x");let f=cG.from(b);for(let a in f.visit(c,(a,b)=>("address"!==a||W(b,20)||(e[b]="0x"),b)),e)e[a]=await d(a);return a.verifyingContract&&e[a.verifyingContract]&&(a.verifyingContract=e[a.verifyingContract]),c=f.visit(c,(a,b)=>"address"===a&&e[b]?e[b]:b),{domain:a,value:c}}static getPayload(a,b,c){cG.hashDomain(a);let d={},e=[];cA.forEach(b=>{let c=a[b];null!=c&&(d[b]=cC[b](c),e.push({name:b,type:cz[b]}))});let f=cG.from(b),g=Object.assign({},b=f.types);return P(null==g.EIP712Domain,"types must not contain EIP712Domain type","types.EIP712Domain",b),g.EIP712Domain=e,f.encode(c),{types:g,domain:d,primaryType:f.primaryType,message:f.visit(c,(a,b)=>{if(a.match(/^bytes(\d*)/))return Z(U(b));if(a.match(/^u?int/))return ah(b).toString();switch(a){case"address":return b.toLowerCase();case"bool":return!!b;case"string":return P("string"==typeof b,"invalid string","value",b),b}P(!1,"unsupported type","type",a)})}}}function cH(a,b){return{address:ba(a),storageKeys:b.map((a,b)=>(P(W(a,32),"invalid slot",`storageKeys[${b}]`,a),a.toLowerCase()))}}function cI(a){if(Array.isArray(a))return a.map((b,c)=>Array.isArray(b)?(P(2===b.length,"invalid slot set",`value[${c}]`,b),cH(b[0],b[1])):(P(null!=b&&"object"==typeof b,"invalid address-slot set","value",a),cH(b.address,b.storageKeys)));P(null!=a&&"object"==typeof a,"invalid access list","value",a);let b=Object.keys(a).map(b=>{let c=a[b].reduce((a,b)=>(a[b]=!0,a),{});return cH(b,Object.keys(c).sort())});return b.sort((a,b)=>a.address.localeCompare(b.address)),b}let cJ="0x0000000000000000000000000000000000000000000000000000000000000000",cK=BigInt(0),cL=BigInt(1),cM=BigInt(2),cN=BigInt(27),cO=BigInt(28),cP=BigInt(35),cQ=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),cR=cQ/cM,cS=Symbol.for("nodejs.util.inspect.custom"),cT={};function cU(a){return ac(an(a),32)}class cV{#t;#u;#v;#w;get r(){return this.#t}set r(a){P(32===_(a),"invalid r","value",a),this.#t=Z(a)}get s(){return P(8>parseInt(this.#u.substring(0,3)),"non-canonical s; use ._s","s",this.#u),this.#u}set s(a){P(32===_(a),"invalid s","value",a),this.#u=Z(a)}get _s(){return this.#u}isValid(){return BigInt(this.#u)<=cR}get v(){return this.#v}set v(a){let b=al(a,"value");P(27===b||28===b,"invalid v","v",a),this.#v=b}get networkV(){return this.#w}get legacyChainId(){let a=this.networkV;return null==a?null:cV.getChainId(a)}get yParity(){return+(27!==this.v)}get yParityAndS(){let a=U(this.s);return this.yParity&&(a[0]|=128),Z(a)}get compactSerialized(){return $([this.r,this.yParityAndS])}get serialized(){return $([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(a,b,c,d){S(a,cT,"Signature"),this.#t=b,this.#u=c,this.#v=d,this.#w=null}getCanonical(){if(this.isValid())return this;let a=cQ-BigInt(this._s),b=55-this.v,c=new cV(cT,this.r,cU(a),b);return this.networkV&&(c.#w=this.networkV),c}clone(){let a=new cV(cT,this.r,this._s,this.v);return this.networkV&&(a.#w=this.networkV),a}toJSON(){let a=this.networkV;return{_type:"signature",networkV:null!=a?a.toString():null,r:this.r,s:this._s,v:this.v}}[cS](){return this.toString()}toString(){return this.isValid()?`Signature { r: ${this.r}, s: ${this._s}, v: ${this.v} }`:`Signature { r: ${this.r}, s: ${this._s}, v: ${this.v}, valid: false }`}static getChainId(a){let b=ah(a,"v");return b==cN||b==cO?cK:(P(b>=cP,"invalid EIP-155 v","v",a),(b-cP)/cM)}static getChainIdV(a,b){return ah(a)*cM+BigInt(35+b-27)}static getNormalizedV(a){let b=ah(a);return b===cK||b===cN?27:b===cL||b===cO?28:(P(b>=cP,"invalid v","v",a),b&cL?27:28)}static from(a){function b(b,c){P(b,c,"signature",a)}if(null==a)return new cV(cT,cJ,cJ,27);if("string"==typeof a){let c=U(a,"signature");if(64===c.length){let a=Z(c.slice(0,32)),b=c.slice(32,64),d=128&b[0]?28:27;return b[0]&=127,new cV(cT,a,Z(b),d)}if(65===c.length){let a=Z(c.slice(0,32)),b=Z(c.slice(32,64)),d=cV.getNormalizedV(c[64]);return new cV(cT,a,b,d)}b(!1,"invalid raw signature length")}if(a instanceof cV)return a.clone();let c=a.r;b(null!=c,"missing r");let d=cU(c),e=function(a,c){if(null!=a)return cU(a);if(null!=c){b(W(c,32),"invalid yParityAndS");let a=U(c);return a[0]&=127,Z(a)}b(!1,"missing s")}(a.s,a.yParityAndS),{networkV:f,v:g}=function(a,c,d){if(null!=a){let b=ah(a);return{networkV:b>=cP?b:void 0,v:cV.getNormalizedV(b)}}if(null!=c)return b(W(c,32),"invalid yParityAndS"),{v:128&U(c)[0]?28:27};if(null!=d){switch(al(d,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}b(!1,"invalid yParity")}b(!1,"missing v")}(a.v,a.yParityAndS,a.yParity),h=new cV(cT,d,e,g);return f&&(h.#w=f),b(null==a.yParity||al(a.yParity,"sig.yParity")===h.yParity,"yParity mismatch"),b(null==a.yParityAndS||a.yParityAndS===h.yParityAndS,"yParityAndS mismatch"),h}}function cW(a){return{address:ba(a.address),nonce:ah(null!=a.nonce?a.nonce:0),chainId:ah(null!=a.chainId?a.chainId:0),signature:cV.from(a.signature)}}var cX=a.i(21517),cY=a.i(24836),cZ=a.i(6461);function c$(a){return async function(b,c){O(null==c||!c.cancelled,"request cancelled before sending","CANCELLED");let d=b.url.split(":")[0].toLowerCase();O("http"===d||"https"===d,`unsupported protocol ${d}`,"UNSUPPORTED_OPERATION",{info:{protocol:d},operation:"request"}),O("https"===d||!b.credentials||b.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let e={method:b.method,headers:Object.assign({},b.headers)};a&&a.agent&&(e.agent=a.agent);let f=null;try{e.abort=(f=new AbortController).signal}catch(a){console.log(a)}let g=("http"===d?cX.default:cY.default).request(b.url,e);g.setTimeout(b.timeout);let h=b.body;return h&&g.write(Buffer.from(h)),g.end(),new Promise((a,d)=>{c&&c.addListener(()=>{f&&f.abort(),d(N("request cancelled","CANCELLED"))}),g.on("timeout",()=>{d(N("request timeout","TIMEOUT"))}),g.once("response",e=>{let f=e.statusCode||0,g=e.statusMessage||"",h=Object.keys(e.headers||{}).reduce((a,b)=>{let c=e.headers[b]||"";return Array.isArray(c)&&(c=c.join(", ")),a[b]=c,a},{}),i=null;e.on("data",a=>{if(c)try{c.checkSignal()}catch(a){return d(a)}if(null==i)i=a;else{let b=new Uint8Array(i.length+a.length);b.set(i,0),b.set(a,i.length),i=b}}),e.on("end",()=>{try{"gzip"===h["content-encoding"]&&i&&(i=U((0,cZ.gunzipSync)(i))),a({statusCode:f,statusMessage:g,headers:h,body:i})}catch(a){d(N("bad response data","SERVER_ERROR",{request:b,info:{response:e,error:a}}))}}),e.on("error",a=>{a.response={statusCode:f,statusMessage:g,headers:h,body:i},d(a)})}),g.on("error",a=>{d(a)})})}}c$({});let c_=c$(),c0=RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),c1=RegExp("^ipfs://(ipfs/)?(.*)$","i"),c2=!1;async function c3(a,b){try{var c,d;let b=a.match(c0);if(!b)throw Error("invalid data");return new da(200,"OK",{"content-type":b[1]||"text/plain"},b[2]?(c=b[3],V(Buffer.from(c,"base64"))):(d=b[3],bx(d.replace(/%([0-9a-f][0-9a-f])/gi,(a,b)=>String.fromCharCode(parseInt(b,16))))))}catch(b){return new da(599,"BAD REQUEST (invalid data: URI)",{},null,new c9(a))}}function c4(a){return async function(b,c){try{let c=b.match(c1);if(!c)throw Error("invalid link");return new c9(`${a}${c[2]}`)}catch(a){return new da(599,"BAD REQUEST (invalid IPFS URI)",{},null,new c9(b))}}}let c5={data:c3,ipfs:c4("https://gateway.ipfs.io/ipfs/")},c6=new WeakMap;class c7{#x;#y;constructor(a){this.#x=[],this.#y=!1,c6.set(a,()=>{if(!this.#y){for(let a of(this.#y=!0,this.#x))setTimeout(()=>{a()},0);this.#x=[]}})}addListener(a){O(!this.#y,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#x.push(a)}get cancelled(){return this.#y}checkSignal(){O(!this.cancelled,"cancelled","CANCELLED",{})}}function c8(a){if(null==a)throw Error("missing signal; should not happen");return a.checkSignal(),a}class c9{#z;#A;#B;#C;#D;#E;#F;#G;#H;#I;#J;#K;#L;#M;#N;get url(){return this.#E}set url(a){this.#E=String(a)}get body(){return null==this.#F?null:new Uint8Array(this.#F)}set body(a){if(null==a)this.#F=void 0,this.#G=void 0;else if("string"==typeof a)this.#F=bx(a),this.#G="text/plain";else if(a instanceof Uint8Array)this.#F=a,this.#G="application/octet-stream";else if("object"==typeof a)this.#F=bx(JSON.stringify(a)),this.#G="application/json";else throw Error("invalid body")}hasBody(){return null!=this.#F}get method(){return this.#C?this.#C:this.hasBody()?"POST":"GET"}set method(a){null==a&&(a=""),this.#C=String(a).toUpperCase()}get headers(){var a;let b=Object.assign({},this.#B);return this.#H&&(b.authorization=`Basic ${a=bx(this.#H),Buffer.from(U(a)).toString("base64")}`),this.allowGzip&&(b["accept-encoding"]="gzip"),null==b["content-type"]&&this.#G&&(b["content-type"]=this.#G),this.body&&(b["content-length"]=String(this.body.length)),b}getHeader(a){return this.headers[a.toLowerCase()]}setHeader(a,b){this.#B[String(a).toLowerCase()]=String(b)}clearHeaders(){this.#B={}}[Symbol.iterator](){let a=this.headers,b=Object.keys(a),c=0;return{next:()=>{if(c<b.length){let d=b[c++];return{value:[d,a[d]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#H||null}setCredentials(a,b){P(!a.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#H=`${a}:${b}`}get allowGzip(){return this.#A}set allowGzip(a){this.#A=!!a}get allowInsecureAuthentication(){return!!this.#z}set allowInsecureAuthentication(a){this.#z=!!a}get timeout(){return this.#D}set timeout(a){P(a>=0,"timeout must be non-zero","timeout",a),this.#D=a}get preflightFunc(){return this.#I||null}set preflightFunc(a){this.#I=a}get processFunc(){return this.#J||null}set processFunc(a){this.#J=a}get retryFunc(){return this.#K||null}set retryFunc(a){this.#K=a}get getUrlFunc(){return this.#N||c_}set getUrlFunc(a){this.#N=a}constructor(a){this.#E=String(a),this.#z=!1,this.#A=!0,this.#B={},this.#C="",this.#D=3e5,this.#M={slotInterval:250,maxAttempts:12},this.#N=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#F?Z(this.#F):"null"}>`}setThrottleParams(a){null!=a.slotInterval&&(this.#M.slotInterval=a.slotInterval),null!=a.maxAttempts&&(this.#M.maxAttempts=a.maxAttempts)}async #O(a,b,c,d,e){var f;if(a>=this.#M.maxAttempts)return e.makeServerError("exceeded maximum retry limit");O(db()<=b,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:d}),c>0&&await (f=c,new Promise(a=>setTimeout(a,f)));let g=this.clone(),h=(g.url.split(":")[0]||"").toLowerCase();if(h in c5){let a=await c5[h](g.url,c8(d.#L));if(a instanceof da){let b=a;if(this.processFunc){c8(d.#L);try{b=await this.processFunc(g,b)}catch(a){(null==a.throttle||"number"!=typeof a.stall)&&b.makeServerError("error in post-processing function",a).assertOk()}}return b}g=a}this.preflightFunc&&(g=await this.preflightFunc(g));let i=await this.getUrlFunc(g,c8(d.#L)),j=new da(i.statusCode,i.statusMessage,i.headers,i.body,d);if(301===j.statusCode||302===j.statusCode){try{let c=j.headers.location||"";return g.redirect(c).#O(a+1,b,0,d,j)}catch(a){}return j}if(429===j.statusCode&&(null==this.retryFunc||await this.retryFunc(g,j,a))){let c=j.headers["retry-after"],e=this.#M.slotInterval*Math.trunc(Math.random()*Math.pow(2,a));return"string"==typeof c&&c.match(/^[1-9][0-9]*$/)&&(e=parseInt(c)),g.clone().#O(a+1,b,e,d,j)}if(this.processFunc){c8(d.#L);try{j=await this.processFunc(g,j)}catch(e){(null==e.throttle||"number"!=typeof e.stall)&&j.makeServerError("error in post-processing function",e).assertOk();let c=this.#M.slotInterval*Math.trunc(Math.random()*Math.pow(2,a));return e.stall>=0&&(c=e.stall),g.clone().#O(a+1,b,c,d,j)}}return j}send(){return O(null==this.#L,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#L=new c7(this),this.#O(0,db()+this.timeout,0,this,new da(0,"",{},null,this))}cancel(){O(null!=this.#L,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});let a=c6.get(this);if(!a)throw Error("missing signal; should not happen");a()}redirect(a){let b=this.url.split(":")[0].toLowerCase(),c=a.split(":")[0].toLowerCase();O("GET"===this.method&&("https"!==b||"http"!==c)&&a.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(a)})`});let d=new c9(a);return d.method="GET",d.allowGzip=this.allowGzip,d.timeout=this.timeout,d.#B=Object.assign({},this.#B),this.#F&&(d.#F=new Uint8Array(this.#F)),d.#G=this.#G,d}clone(){let a=new c9(this.url);return a.#C=this.#C,this.#F&&(a.#F=this.#F),a.#G=this.#G,a.#B=Object.assign({},this.#B),a.#H=this.#H,this.allowGzip&&(a.allowGzip=!0),a.timeout=this.timeout,this.allowInsecureAuthentication&&(a.allowInsecureAuthentication=!0),a.#I=this.#I,a.#J=this.#J,a.#K=this.#K,a.#M=Object.assign({},this.#M),a.#N=this.#N,a}static lockConfig(){c2=!0}static getGateway(a){return c5[a.toLowerCase()]||null}static registerGateway(a,b){if("http"===(a=a.toLowerCase())||"https"===a)throw Error(`cannot intercept ${a}; use registerGetUrl`);if(c2)throw Error("gateways locked");c5[a]=b}static registerGetUrl(a){if(c2)throw Error("gateways locked");c_=a}static createGetUrlFunc(a){return c$(a)}static createDataGateway(){return c3}static createIpfsGatewayFunc(a){return c4(a)}}class da{#P;#Q;#B;#F;#R;#S;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#F?Z(this.#F):"null"}>`}get statusCode(){return this.#P}get statusMessage(){return this.#Q}get headers(){return Object.assign({},this.#B)}get body(){return null==this.#F?null:new Uint8Array(this.#F)}get bodyText(){try{return null==this.#F?"":by(this.#F)}catch(a){O(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch(a){O(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){let a=this.headers,b=Object.keys(a),c=0;return{next:()=>{if(c<b.length){let d=b[c++];return{value:[d,a[d]],done:!1}}return{value:void 0,done:!0}}}}constructor(a,b,c,d,e){this.#P=a,this.#Q=b,this.#B=Object.keys(c).reduce((a,b)=>(a[b.toLowerCase()]=String(c[b]),a),{}),this.#F=null==d?null:new Uint8Array(d),this.#R=e||null,this.#S={message:""}}makeServerError(a,b){let c;a?c=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${a})`:(a=`${this.statusCode} ${this.statusMessage}`,c=`CLIENT ESCALATED SERVER ERROR (${a})`);let d=new da(599,c,this.headers,this.body,this.#R||void 0);return d.#S={message:a,error:b},d}throwThrottleError(a,b){null==b?b=-1:P(Number.isInteger(b)&&b>=0,"invalid stall timeout","stall",b);let c=Error(a||"throttling requests");throw J(c,{stall:b,throttle:!0}),c}getHeader(a){return this.headers[a.toLowerCase()]}hasBody(){return null!=this.#F}get request(){return this.#R}ok(){return""===this.#S.message&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:a,error:b}=this.#S;""===a&&(a=`server response ${this.statusCode} ${this.statusMessage}`);let c=null;this.request&&(c=this.request.url);let d=null;try{this.#F&&(d=by(this.#F))}catch(a){}O(!1,a,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:b,info:{requestUrl:c,responseBody:d,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}}function db(){return new Date().getTime()}let dc="0x0000000000000000000000000000000000000000";class dd{fragment;name;signature;topic;args;constructor(a,b,c){const d=a.name,e=a.format();J(this,{fragment:a,name:d,signature:e,topic:b,args:c})}}class de{fragment;name;args;signature;selector;value;constructor(a,b,c,d){const e=a.name,f=a.format();J(this,{fragment:a,name:e,args:c,signature:f,selector:b,value:d})}}class df{fragment;name;args;signature;selector;constructor(a,b,c){const d=a.name,e=a.format();J(this,{fragment:a,name:d,args:c,signature:e,selector:b})}}class dg{hash;_isIndexed;static isIndexed(a){return!!(a&&a._isIndexed)}constructor(a){J(this,{hash:a,_isIndexed:!0})}}let dh={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},di={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:a=>`reverted with reason string ${JSON.stringify(a)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:a=>{let b="unknown panic code";return a>=0&&a<=255&&dh[a.toString()]&&(b=dh[a.toString()]),`reverted with panic code 0x${a.toString(16)} (${b})`}}};class dj{fragments;deploy;fallback;receive;#T;#U;#V;#W;constructor(a){let b=[];b="string"==typeof a?JSON.parse(a):a,this.#V=new Map,this.#T=new Map,this.#U=new Map;const c=[];for(const a of b)try{c.push(ca.from(a))}catch(b){console.log(`[Warning] Invalid Fragment ${JSON.stringify(a)}:`,b.message)}J(this,{fragments:Object.freeze(c)});let d=null,e=!1;this.#W=this.getAbiCoder(),this.fragments.forEach((a,b)=>{let c;switch(a.type){case"constructor":if(this.deploy)return void console.log("duplicate definition - constructor");J(this,{deploy:a});return;case"fallback":0===a.inputs.length?e=!0:(P(!d||a.payable!==d.payable,"conflicting fallback fragments",`fragments[${b}]`,a),e=(d=a).payable);return;case"function":c=this.#V;break;case"event":c=this.#U;break;case"error":c=this.#T;break;default:return}let f=a.format();c.has(f)||c.set(f,a)}),this.deploy||J(this,{deploy:cf.from("constructor()")}),J(this,{fallback:d,receive:e})}format(a){let b=a?"minimal":"full";return this.fragments.map(a=>a.format(b))}formatJson(){return JSON.stringify(this.fragments.map(a=>a.format("json")).map(a=>JSON.parse(a)))}getAbiCoder(){return co.defaultAbiCoder()}#X(a,b,c){if(W(a)){let b=a.toLowerCase();for(let a of this.#V.values())if(b===a.selector)return a;return null}if(-1===a.indexOf("(")){let d=[];for(let[b,c]of this.#V)b.split("(")[0]===a&&d.push(c);if(b){let a=b.length>0?b[b.length-1]:null,c=b.length,e=!0;bf.isTyped(a)&&"overrides"===a.type&&(e=!1,c--);for(let a=d.length-1;a>=0;a--){let b=d[a].inputs.length;b===c||e&&b===c-1||d.splice(a,1)}for(let a=d.length-1;a>=0;a--){let c=d[a].inputs;for(let e=0;e<b.length;e++)if(bf.isTyped(b[e])){if(e>=c.length){if("overrides"===b[e].type)continue;d.splice(a,1);break}if(b[e].type!==c[e].baseType){d.splice(a,1);break}}}}if(1===d.length&&b&&b.length!==d[0].inputs.length){let a=b[b.length-1];(null==a||Array.isArray(a)||"object"!=typeof a)&&d.splice(0,1)}if(0===d.length)return null;if(d.length>1&&c){let b=d.map(a=>JSON.stringify(a.format())).join(", ");P(!1,`ambiguous function description (i.e. matches ${b})`,"key",a)}return d[0]}let d=this.#V.get(ch.from(a).format());return d||null}getFunctionName(a){let b=this.#X(a,null,!1);return P(b,"no matching function","key",a),b.name}hasFunction(a){return!!this.#X(a,null,!1)}getFunction(a,b){return this.#X(a,b||null,!0)}forEachFunction(a){let b=Array.from(this.#V.keys());b.sort((a,b)=>a.localeCompare(b));for(let c=0;c<b.length;c++){let d=b[c];a(this.#V.get(d),c)}}#Y(a,b,c){if(W(a)){let b=a.toLowerCase();for(let a of this.#U.values())if(b===a.topicHash)return a;return null}if(-1===a.indexOf("(")){let d=[];for(let[b,c]of this.#U)b.split("(")[0]===a&&d.push(c);if(b){for(let a=d.length-1;a>=0;a--)d[a].inputs.length<b.length&&d.splice(a,1);for(let a=d.length-1;a>=0;a--){let c=d[a].inputs;for(let e=0;e<b.length;e++)if(bf.isTyped(b[e])&&b[e].type!==c[e].baseType){d.splice(a,1);break}}}if(0===d.length)return null;if(d.length>1&&c){let b=d.map(a=>JSON.stringify(a.format())).join(", ");P(!1,`ambiguous event description (i.e. matches ${b})`,"key",a)}return d[0]}let d=this.#U.get(ce.from(a).format());return d||null}getEventName(a){let b=this.#Y(a,null,!1);return P(b,"no matching event","key",a),b.name}hasEvent(a){return!!this.#Y(a,null,!1)}getEvent(a,b){return this.#Y(a,b||null,!0)}forEachEvent(a){let b=Array.from(this.#U.keys());b.sort((a,b)=>a.localeCompare(b));for(let c=0;c<b.length;c++){let d=b[c];a(this.#U.get(d),c)}}getError(a,b){if(W(a)){let b=a.toLowerCase();if(di[b])return cd.from(di[b].signature);for(let a of this.#T.values())if(b===a.selector)return a;return null}if(-1===a.indexOf("(")){let b=[];for(let[c,d]of this.#T)c.split("(")[0]===a&&b.push(d);if(0===b.length)return"Error"===a?cd.from("error Error(string)"):"Panic"===a?cd.from("error Panic(uint256)"):null;if(b.length>1){let c=b.map(a=>JSON.stringify(a.format())).join(", ");P(!1,`ambiguous error description (i.e. ${c})`,"name",a)}return b[0]}if("Error(string)"===(a=cd.from(a).format()))return cd.from("error Error(string)");if("Panic(uint256)"===a)return cd.from("error Panic(uint256)");let c=this.#T.get(a);return c||null}forEachError(a){let b=Array.from(this.#T.keys());b.sort((a,b)=>a.localeCompare(b));for(let c=0;c<b.length;c++){let d=b[c];a(this.#T.get(d),c)}}_decodeParams(a,b){return this.#W.decode(a,b)}_encodeParams(a,b){return this.#W.encode(a,b)}encodeDeploy(a){return this._encodeParams(this.deploy.inputs,a||[])}decodeErrorResult(a,b){if("string"==typeof a){let b=this.getError(a);P(b,"unknown error","fragment",a),a=b}return P(aa(b,0,4)===a.selector,`data signature does not match error ${a.name}.`,"data",b),this._decodeParams(a.inputs,aa(b,4))}encodeErrorResult(a,b){if("string"==typeof a){let b=this.getError(a);P(b,"unknown error","fragment",a),a=b}return $([a.selector,this._encodeParams(a.inputs,b||[])])}decodeFunctionData(a,b){if("string"==typeof a){let b=this.getFunction(a);P(b,"unknown function","fragment",a),a=b}return P(aa(b,0,4)===a.selector,`data signature does not match function ${a.name}.`,"data",b),this._decodeParams(a.inputs,aa(b,4))}encodeFunctionData(a,b){if("string"==typeof a){let b=this.getFunction(a);P(b,"unknown function","fragment",a),a=b}return $([a.selector,this._encodeParams(a.inputs,b||[])])}decodeFunctionResult(a,b){if("string"==typeof a){let b=this.getFunction(a);P(b,"unknown function","fragment",a),a=b}let c="invalid length for result data",d=V(b);if(d.length%32==0)try{return this.#W.decode(a.outputs,d)}catch(a){c="could not decode result data"}O(!1,c,"BAD_DATA",{value:Z(d),info:{method:a.name,signature:a.format()}})}makeError(a,b){let c=U(a,"data"),d=co.getBuiltinCallException("call",b,c);if(d.message.startsWith("execution reverted (unknown custom error)")){let a=Z(c.slice(0,4)),b=this.getError(a);if(b)try{let a=this.#W.decode(b.inputs,c.slice(4));d.revert={name:b.name,signature:b.format(),args:a},d.reason=d.revert.signature,d.message=`execution reverted: ${d.reason}`}catch(a){d.message="execution reverted (coult not decode custom error)"}}let e=this.parseTransaction(b);return e&&(d.invocation={method:e.name,signature:e.signature,args:e.args}),d}encodeFunctionResult(a,b){if("string"==typeof a){let b=this.getFunction(a);P(b,"unknown function","fragment",a),a=b}return Z(this.#W.encode(a.outputs,b||[]))}encodeFilterTopics(a,b){if("string"==typeof a){let b=this.getEvent(a);P(b,"unknown event","eventFragment",a),a=b}O(b.length<=a.inputs.length,`too many arguments for ${a.format()}`,"UNEXPECTED_ARGUMENT",{count:b.length,expectedCount:a.inputs.length});let c=[];a.anonymous||c.push(a.topicHash);let d=(a,b)=>{if("string"===a.type)return bB(b);if("bytes"===a.type)return a4(Z(b));if("bool"===a.type&&"boolean"==typeof b)b=b?"0x01":"0x00";else if(a.type.match(/^u?int/))b=am(b);else if(a.type.match(/^bytes/))b=ab(b,32,!1);else"address"===a.type&&this.#W.encode(["address"],[b]);return ac(Z(b),32)};for(b.forEach((b,e)=>{let f=a.inputs[e];f.indexed?null==b?c.push(null):"array"===f.baseType||"tuple"===f.baseType?P(!1,"filtering with tuples or arrays not supported","contract."+f.name,b):Array.isArray(b)?c.push(b.map(a=>d(f,a))):c.push(d(f,b)):P(null==b,"cannot filter non-indexed parameters; must be null","contract."+f.name,b)});c.length&&null===c[c.length-1];)c.pop();return c}encodeEventLog(a,b){if("string"==typeof a){let b=this.getEvent(a);P(b,"unknown event","eventFragment",a),a=b}let c=[],d=[],e=[];return a.anonymous||c.push(a.topicHash),P(b.length===a.inputs.length,"event arguments/values mismatch","values",b),a.inputs.forEach((a,f)=>{let g=b[f];if(a.indexed)if("string"===a.type)c.push(bB(g));else if("bytes"===a.type)c.push(a4(g));else if("tuple"===a.baseType||"array"===a.baseType)throw Error("not implemented");else c.push(this.#W.encode([a.type],[g]));else d.push(a),e.push(g)}),{data:this.#W.encode(d,e),topics:c}}decodeEventLog(a,b,c){if("string"==typeof a){let b=this.getEvent(a);P(b,"unknown event","eventFragment",a),a=b}if(null!=c&&!a.anonymous){let b=a.topicHash;P(W(c[0],32)&&c[0].toLowerCase()===b,"fragment/topic mismatch","topics[0]",c[0]),c=c.slice(1)}let d=[],e=[],f=[];a.inputs.forEach((a,b)=>{a.indexed?"string"===a.type||"bytes"===a.type||"tuple"===a.baseType||"array"===a.baseType?(d.push(b9.from({type:"bytes32",name:a.name})),f.push(!0)):(d.push(a),f.push(!1)):(e.push(a),f.push(!1))});let g=null!=c?this.#W.decode(d,$(c)):null,h=this.#W.decode(e,b,!0),i=[],j=[],k=0,l=0;return a.inputs.forEach((a,b)=>{let c=null;if(a.indexed)if(null==g)c=new dg(null);else if(f[b])c=new dg(g[l++]);else try{c=g[l++]}catch(a){c=a}else try{c=h[k++]}catch(a){c=a}i.push(c),j.push(a.name||null)}),av.fromItems(i,j)}parseTransaction(a){let b=U(a.data,"tx.data"),c=ah(null!=a.value?a.value:0,"tx.value"),d=this.getFunction(Z(b.slice(0,4)));if(!d)return null;let e=this.#W.decode(d.inputs,b.slice(4));return new de(d,d.selector,e,c)}parseCallResult(a){throw Error("@TODO")}parseLog(a){let b=this.getEvent(a.topics[0]);return!b||b.anonymous?null:new dd(b,b.topicHash,this.decodeEventLog(b,a.data,a.topics))}parseError(a){let b=Z(a),c=this.getError(aa(b,0,4));if(!c)return null;let d=this.#W.decode(c.inputs,aa(b,4));return new df(c,c.selector,d)}static from(a){return a instanceof dj?a:new dj("string"==typeof a?JSON.parse(a):"function"==typeof a.formatJson?a.formatJson():"function"==typeof a.format?a.format("json"):a)}}let dk=BigInt(0);function dl(a){return null==a?null:a}function dm(a){return null==a?null:a.toString()}class dn{gasPrice;maxFeePerGas;maxPriorityFeePerGas;constructor(a,b,c){J(this,{gasPrice:dl(a),maxFeePerGas:dl(b),maxPriorityFeePerGas:dl(c)})}toJSON(){let{gasPrice:a,maxFeePerGas:b,maxPriorityFeePerGas:c}=this;return{_type:"FeeData",gasPrice:dm(a),maxFeePerGas:dm(b),maxPriorityFeePerGas:dm(c)}}}function dp(a){let b={};for(let c of(a.to&&(b.to=a.to),a.from&&(b.from=a.from),a.data&&(b.data=Z(a.data)),"chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/)))c in a&&null!=a[c]&&(b[c]=ah(a[c],`request.${c}`));for(let c of"type,nonce".split(/,/))c in a&&null!=a[c]&&(b[c]=al(a[c],`request.${c}`));return a.accessList&&(b.accessList=cI(a.accessList)),a.authorizationList&&(b.authorizationList=a.authorizationList.slice()),"blockTag"in a&&(b.blockTag=a.blockTag),"enableCcipRead"in a&&(b.enableCcipRead=!!a.enableCcipRead),"customData"in a&&(b.customData=a.customData),"blobVersionedHashes"in a&&a.blobVersionedHashes&&(b.blobVersionedHashes=a.blobVersionedHashes.slice()),"kzg"in a&&(b.kzg=a.kzg),"blobWrapperVersion"in a&&(b.blobWrapperVersion=a.blobWrapperVersion),"blobs"in a&&a.blobs&&(b.blobs=a.blobs.map(a=>X(a)?Z(a):Object.assign({},a))),b}class dq{provider;number;hash;timestamp;parentHash;parentBeaconBlockRoot;nonce;difficulty;gasLimit;gasUsed;stateRoot;receiptsRoot;blobGasUsed;excessBlobGas;miner;prevRandao;extraData;baseFeePerGas;#Z;constructor(a,b){this.#Z=a.transactions.map(a=>"string"!=typeof a?new dt(a,b):a),J(this,{provider:b,hash:dl(a.hash),number:a.number,timestamp:a.timestamp,parentHash:a.parentHash,parentBeaconBlockRoot:a.parentBeaconBlockRoot,nonce:a.nonce,difficulty:a.difficulty,gasLimit:a.gasLimit,gasUsed:a.gasUsed,blobGasUsed:a.blobGasUsed,excessBlobGas:a.excessBlobGas,miner:a.miner,prevRandao:dl(a.prevRandao),extraData:a.extraData,baseFeePerGas:dl(a.baseFeePerGas),stateRoot:a.stateRoot,receiptsRoot:a.receiptsRoot})}get transactions(){return this.#Z.map(a=>"string"==typeof a?a:a.hash)}get prefetchedTransactions(){let a=this.#Z.slice();return 0===a.length?[]:(O("object"==typeof a[0],"transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),a)}toJSON(){let{baseFeePerGas:a,difficulty:b,extraData:c,gasLimit:d,gasUsed:e,hash:f,miner:g,prevRandao:h,nonce:i,number:j,parentHash:k,parentBeaconBlockRoot:l,stateRoot:m,receiptsRoot:n,timestamp:o,transactions:p}=this;return{_type:"Block",baseFeePerGas:dm(a),difficulty:dm(b),extraData:c,gasLimit:dm(d),gasUsed:dm(e),blobGasUsed:dm(this.blobGasUsed),excessBlobGas:dm(this.excessBlobGas),hash:f,miner:g,prevRandao:h,nonce:i,number:j,parentHash:k,timestamp:o,parentBeaconBlockRoot:l,stateRoot:m,receiptsRoot:n,transactions:p}}[Symbol.iterator](){let a=0,b=this.transactions;return{next:()=>a<this.length?{value:b[a++],done:!1}:{value:void 0,done:!0}}}get length(){return this.#Z.length}get date(){return null==this.timestamp?null:new Date(1e3*this.timestamp)}async getTransaction(a){let b;if("number"==typeof a)b=this.#Z[a];else{let c=a.toLowerCase();for(let a of this.#Z)if("string"==typeof a){if(a!==c)continue;b=a;break}else{if(a.hash!==c)continue;b=a;break}}if(null==b)throw Error("no such tx");return"string"==typeof b?await this.provider.getTransaction(b):b}getPrefetchedTransaction(a){let b=this.prefetchedTransactions;if("number"==typeof a)return b[a];for(let c of(a=a.toLowerCase(),b))if(c.hash===a)return c;P(!1,"no matching transaction","indexOrHash",a)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){var a;if(!this.isMined())throw Error("");return a=this,{orphan:"drop-block",hash:a.hash,number:a.number}}}class dr{provider;transactionHash;blockHash;blockNumber;removed;address;data;topics;index;transactionIndex;constructor(a,b){this.provider=b;const c=Object.freeze(a.topics.slice());J(this,{transactionHash:a.transactionHash,blockHash:a.blockHash,blockNumber:a.blockNumber,removed:a.removed,address:a.address,data:a.data,topics:c,index:a.index,transactionIndex:a.transactionIndex})}toJSON(){let{address:a,blockHash:b,blockNumber:c,data:d,index:e,removed:f,topics:g,transactionHash:h,transactionIndex:i}=this;return{_type:"log",address:a,blockHash:b,blockNumber:c,data:d,index:e,removed:f,topics:g,transactionHash:h,transactionIndex:i}}async getBlock(){let a=await this.provider.getBlock(this.blockHash);return O(!!a,"failed to find transaction","UNKNOWN_ERROR",{}),a}async getTransaction(){let a=await this.provider.getTransaction(this.transactionHash);return O(!!a,"failed to find transaction","UNKNOWN_ERROR",{}),a}async getTransactionReceipt(){let a=await this.provider.getTransactionReceipt(this.transactionHash);return O(!!a,"failed to find transaction receipt","UNKNOWN_ERROR",{}),a}removedEvent(){var a;return a=this,{orphan:"drop-log",log:{transactionHash:a.transactionHash,blockHash:a.blockHash,blockNumber:a.blockNumber,address:a.address,data:a.data,topics:Object.freeze(a.topics.slice()),index:a.index}}}}class ds{provider;to;from;contractAddress;hash;index;blockHash;blockNumber;logsBloom;gasUsed;blobGasUsed;cumulativeGasUsed;gasPrice;blobGasPrice;type;status;root;#$;constructor(a,b){this.#$=Object.freeze(a.logs.map(a=>new dr(a,b)));let c=dk;null!=a.effectiveGasPrice?c=a.effectiveGasPrice:null!=a.gasPrice&&(c=a.gasPrice),J(this,{provider:b,to:a.to,from:a.from,contractAddress:a.contractAddress,hash:a.hash,index:a.index,blockHash:a.blockHash,blockNumber:a.blockNumber,logsBloom:a.logsBloom,gasUsed:a.gasUsed,cumulativeGasUsed:a.cumulativeGasUsed,blobGasUsed:a.blobGasUsed,gasPrice:c,blobGasPrice:a.blobGasPrice,type:a.type,status:a.status,root:a.root})}get logs(){return this.#$}toJSON(){let{to:a,from:b,contractAddress:c,hash:d,index:e,blockHash:f,blockNumber:g,logsBloom:h,logs:i,status:j,root:k}=this;return{_type:"TransactionReceipt",blockHash:f,blockNumber:g,contractAddress:c,cumulativeGasUsed:dm(this.cumulativeGasUsed),from:b,gasPrice:dm(this.gasPrice),blobGasUsed:dm(this.blobGasUsed),blobGasPrice:dm(this.blobGasPrice),gasUsed:dm(this.gasUsed),hash:d,index:e,logs:i,logsBloom:h,root:k,status:j,to:a}}get length(){return this.logs.length}[Symbol.iterator](){let a=0;return{next:()=>a<this.length?{value:this.logs[a++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){let a=await this.provider.getBlock(this.blockHash);if(null==a)throw Error("TODO");return a}async getTransaction(){let a=await this.provider.getTransaction(this.hash);if(null==a)throw Error("TODO");return a}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return dv(this)}reorderedEvent(a){return O(!a||a.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),du(this,a)}}class dt{provider;blockNumber;blockHash;index;hash;type;to;from;nonce;gasLimit;gasPrice;maxPriorityFeePerGas;maxFeePerGas;maxFeePerBlobGas;data;value;chainId;signature;accessList;blobVersionedHashes;authorizationList;#_;constructor(a,b){this.provider=b,this.blockNumber=null!=a.blockNumber?a.blockNumber:null,this.blockHash=null!=a.blockHash?a.blockHash:null,this.hash=a.hash,this.index=a.index,this.type=a.type,this.from=a.from,this.to=a.to||null,this.gasLimit=a.gasLimit,this.nonce=a.nonce,this.data=a.data,this.value=a.value,this.gasPrice=a.gasPrice,this.maxPriorityFeePerGas=null!=a.maxPriorityFeePerGas?a.maxPriorityFeePerGas:null,this.maxFeePerGas=null!=a.maxFeePerGas?a.maxFeePerGas:null,this.maxFeePerBlobGas=null!=a.maxFeePerBlobGas?a.maxFeePerBlobGas:null,this.chainId=a.chainId,this.signature=a.signature,this.accessList=null!=a.accessList?a.accessList:null,this.blobVersionedHashes=null!=a.blobVersionedHashes?a.blobVersionedHashes:null,this.authorizationList=null!=a.authorizationList?a.authorizationList:null,this.#_=-1}toJSON(){let{blockNumber:a,blockHash:b,index:c,hash:d,type:e,to:f,from:g,nonce:h,data:i,signature:j,accessList:k,blobVersionedHashes:l}=this;return{_type:"TransactionResponse",accessList:k,blockNumber:a,blockHash:b,blobVersionedHashes:l,chainId:dm(this.chainId),data:i,from:g,gasLimit:dm(this.gasLimit),gasPrice:dm(this.gasPrice),hash:d,maxFeePerGas:dm(this.maxFeePerGas),maxPriorityFeePerGas:dm(this.maxPriorityFeePerGas),maxFeePerBlobGas:dm(this.maxFeePerBlobGas),nonce:h,signature:j,to:f,index:c,type:e,value:dm(this.value)}}async getBlock(){let a=this.blockNumber;if(null==a){let b=await this.getTransaction();b&&(a=b.blockNumber)}if(null==a)return null;let b=this.provider.getBlock(a);if(null==b)throw Error("TODO");return b}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(null==this.blockNumber){let{tx:a,blockNumber:b}=await I({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return null==a||null==a.blockNumber?0:b-a.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(a,b){let c=null==a?1:a,d=null==b?0:b,e=this.#_,f=-1,g=-1===e,h=async()=>{if(g)return null;let{blockNumber:a,nonce:b}=await I({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(b<this.nonce){e=a;return}if(g)return null;let d=await this.getTransaction();if(!d||null==d.blockNumber)for(-1===f&&(f=e-3)<this.#_&&(f=this.#_);f<=a;){if(g)return null;let b=await this.provider.getBlock(f,!0);if(null==b)break;for(let a of b)if(a===this.hash)return;for(let d=0;d<b.length;d++){let f=await b.getTransaction(d);if(f.from===this.from&&f.nonce===this.nonce){if(g)return null;let b=await this.provider.getTransactionReceipt(f.hash);if(null==b||a-b.blockNumber+1<c)return;let d="replaced";f.data===this.data&&f.to===this.to&&f.value===this.value?d="repriced":"0x"===f.data&&f.from===f.to&&f.value===dk&&(d="cancelled"),O(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:"replaced"===d||"cancelled"===d,reason:d,replacement:f.replaceableTransaction(e),hash:f.hash,receipt:b})}}f++}},i=a=>{if(null==a||0!==a.status)return a;O(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:a.to,from:a.from,data:""},receipt:a})},j=await this.provider.getTransactionReceipt(this.hash);if(0===c)return i(j);if(j){if(1===c||await j.confirmations()>=c)return i(j)}else if(await h(),0===c)return null;let k=new Promise((a,b)=>{let f=[],j=()=>{f.forEach(a=>a())};if(f.push(()=>{g=!0}),d>0){let a=setTimeout(()=>{j(),b(N("wait for transaction timeout","TIMEOUT"))},d);f.push(()=>{clearTimeout(a)})}let k=async d=>{if(await d.confirmations()>=c){j();try{a(i(d))}catch(a){b(a)}}};if(f.push(()=>{this.provider.off(this.hash,k)}),this.provider.on(this.hash,k),e>=0){let a=async()=>{try{await h()}catch(a){if(L(a,"TRANSACTION_REPLACED")){j(),b(a);return}}g||this.provider.once("block",a)};f.push(()=>{this.provider.off("block",a)}),this.provider.once("block",a)}});return await k}isMined(){return null!=this.blockHash}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}removedEvent(){return O(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),dv(this)}reorderedEvent(a){return O(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),O(!a||a.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),du(this,a)}replaceableTransaction(a){P(Number.isInteger(a)&&a>=0,"invalid startBlock","startBlock",a);let b=new dt(this,this.provider);return b.#_=a,b}}function du(a,b){return{orphan:"reorder-transaction",tx:a,other:b}}function dv(a){return{orphan:"drop-transaction",tx:a}}class dw{filter;emitter;#aa;constructor(a,b,c){this.#aa=b,J(this,{emitter:a,filter:c})}async removeListener(){null!=this.#aa&&await this.emitter.off(this.filter,this.#aa)}}class dx extends dr{interface;fragment;args;constructor(a,b,c){super(a,a.provider),J(this,{args:b.decodeEventLog(c,a.data,a.topics),fragment:c,interface:b})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class dy extends dr{error;constructor(a,b){super(a,a.provider),J(this,{error:b})}}class dz extends ds{#ab;constructor(a,b,c){super(c,b),this.#ab=a}get logs(){return super.logs.map(a=>{let b=a.topics.length?this.#ab.getEvent(a.topics[0]):null;if(b)try{return new dx(a,this.#ab,b)}catch(b){return new dy(a,b)}return a})}}class dA extends dt{#ab;constructor(a,b,c){super(c,b),this.#ab=a}async wait(a,b){let c=await super.wait(a,b);return null==c?null:new dz(this.#ab,this.provider,c)}}class dB extends dw{log;constructor(a,b,c,d){super(a,b,c),J(this,{log:d})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class dC extends dB{constructor(a,b,c,d,e){super(a,b,c,new dx(e,a.interface,d)),J(this,{args:a.interface.decodeEventLog(d,this.log.data,this.log.topics),fragment:d})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}let dD=BigInt(0);function dE(a){return a&&"function"==typeof a.call}function dF(a){return a&&"function"==typeof a.estimateGas}function dG(a){return a&&"function"==typeof a.resolveName}function dH(a){return a&&"function"==typeof a.sendTransaction}function dI(a){if(null!=a){if(dG(a))return a;if(a.provider)return a.provider}}class dJ{#ac;fragment;constructor(a,b,c){if(J(this,{fragment:b}),b.inputs.length<c.length)throw Error("too many arguments");const d=dK(a.runner,"resolveName"),e=dG(d)?d:null;this.#ac=async function(){let d=await Promise.all(b.inputs.map((a,b)=>null==c[b]?null:a.walkAsync(c[b],(a,b)=>"address"===a?Array.isArray(b)?Promise.all(b.map(a=>cr(a,e))):cr(b,e):b)));return a.interface.encodeFilterTopics(b,d)}()}getTopicFilter(){return this.#ac}}function dK(a,b){return null==a?null:"function"==typeof a[b]?a:a.provider&&"function"==typeof a.provider[b]?a.provider:null}function dL(a){return null==a?null:a.provider||null}async function dM(a,b){let c=bf.dereference(a,"overrides");P("object"==typeof c,"invalid overrides parameter","overrides",a);let d=dp(c);return P(null==d.to||(b||[]).indexOf("to")>=0,"cannot override to","overrides.to",d.to),P(null==d.data||(b||[]).indexOf("data")>=0,"cannot override data","overrides.data",d.data),d.from&&(d.from=d.from),d}async function dN(a,b,c){let d=dK(a,"resolveName"),e=dG(d)?d:null;return await Promise.all(b.map((a,b)=>a.walkAsync(c[b],(a,b)=>(b=bf.dereference(b,a),"address"===a)?cr(b,e):b)))}let dO=Symbol.for("_ethersInternal_contract"),dP=new WeakMap;function dQ(a){return dP.get(a[dO])}async function dR(a,b){let c,d=null;if(Array.isArray(b)){let d=function(b){if(W(b,32))return b;let c=a.interface.getEvent(b);return P(c,"unknown fragment","name",b),c.topicHash};c=b.map(a=>null==a?null:Array.isArray(a)?a.map(d):d(a))}else if("*"===b)c=[null];else if("string"==typeof b)W(b,32)?c=[b]:(P(d=a.interface.getEvent(b),"unknown fragment","event",b),c=[d.topicHash]);else b&&"object"==typeof b&&"getTopicFilter"in b&&"function"==typeof b.getTopicFilter&&b.fragment?c=await b.getTopicFilter():"fragment"in b?c=[(d=b.fragment).topicHash]:P(!1,"unknown event name","event",b);return{fragment:d,tag:(c=c.map(a=>{if(null==a)return null;if(Array.isArray(a)){let b=Array.from(new Set(a.map(a=>a.toLowerCase())).values());return 1===b.length?b[0]:(b.sort(),b)}return a.toLowerCase()})).map(a=>null==a?"null":Array.isArray(a)?a.join("|"):a).join("&"),topics:c}}async function dS(a,b){let{subs:c}=dQ(a);return c.get((await dR(a,b)).tag)||null}async function dT(a,b,c){let d=dL(a.runner);O(d,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:b});let{fragment:e,tag:f,topics:g}=await dR(a,c),{addr:h,subs:i}=dQ(a),j=i.get(f);if(!j){let b={address:h||a,topics:g},k=b=>{let d=e;if(null==d)try{d=a.interface.getEvent(b.topics[0])}catch(a){}if(d){let f=d,g=e?a.interface.decodeEventLog(e,b.data,b.topics):[];dW(a,c,g,d=>new dC(a,d,c,f,b))}else dW(a,c,[],d=>new dB(a,d,c,b))},l=[];j={tag:f,listeners:[],start:()=>{l.length||l.push(d.on(b,k))},stop:async()=>{if(0==l.length)return;let a=l;l=[],await Promise.all(a),d.off(b,k)}},i.set(f,j)}return j}let dU=Promise.resolve();async function dV(a,b,c,d){await dU;let e=await dS(a,b);if(!e)return!1;let f=e.listeners.length;return e.listeners=e.listeners.filter(({listener:b,once:e})=>{let f=Array.from(c);d&&f.push(d(e?null:b));try{b.call(a,...f)}catch(a){}return!e}),0===e.listeners.length&&(e.stop(),dQ(a).subs.delete(e.tag)),f>0}async function dW(a,b,c,d){try{await dU}catch(a){}let e=dV(a,b,c,d);return dU=e,await e}let dX=["then"];class dY{target;interface;runner;filters;[dO];fallback;constructor(a,b,c,d){var e;let f;P("string"==typeof a||cp(a),"invalid value for Contract target","target",a),null==c&&(c=null);const g=dj.from(b);J(this,{target:a,runner:c,interface:g}),Object.defineProperty(this,dO,{value:{}});let h=null,i=null;if(d){const a=dL(c);i=new dA(this.interface,a,d)}let j=new Map;if("string"==typeof a)if(W(a))h=a,f=Promise.resolve(a);else{const b=dK(c,"resolveName");if(!dG(b))throw N("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});f=b.resolveName(a).then(b=>{if(null==b)throw N("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:a});return dQ(this).addr=b,b})}else f=a.getAddress().then(a=>{if(null==a)throw Error("TODO");return dQ(this).addr=a,a});return e={addrPromise:f,addr:h,deployTx:i,subs:j},dP.set(this[dO],e),J(this,{filters:new Proxy({},{get:(a,b,c)=>{if("symbol"==typeof b||dX.indexOf(b)>=0)return Reflect.get(a,b,c);try{return this.getEvent(b)}catch(a){if(!L(a,"INVALID_ARGUMENT")||"key"!==a.argument)throw a}},has:(a,b)=>dX.indexOf(b)>=0?Reflect.has(a,b):Reflect.has(a,b)||this.interface.hasEvent(String(b))})}),J(this,{fallback:g.receive||g.fallback?function(a){let b=async function(b){let c=await dM(b,["data"]);c.to=await a.getAddress(),c.from&&(c.from=await cr(c.from,dI(a.runner)));let d=a.interface,e=ah(c.value||dD,"overrides.value")===dD,f="0x"===(c.data||"0x");return!d.fallback||d.fallback.payable||!d.receive||f||e||P(!1,"cannot send data to receive or send value to non-payable fallback","overrides",b),P(d.fallback||f,"cannot send data to receive-only contract","overrides.data",c.data),P(d.receive||d.fallback&&d.fallback.payable||e,"cannot send value to non-payable fallback","overrides.value",c.value),P(d.fallback||f,"cannot send data to receive-only contract","overrides.data",c.data),c},c=async function(c){let d=dK(a.runner,"call");O(dE(d),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});let e=await b(c);try{return await d.call(e)}catch(b){if(M(b)&&b.data)throw a.interface.makeError(b.data,e);throw b}},d=async function(c){let d=a.runner;O(dH(d),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});let e=await d.sendTransaction(await b(c)),f=dL(a.runner);return new dA(a.interface,f,e)},e=async function(c){let d=dK(a.runner,"estimateGas");return O(dF(d),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await d.estimateGas(await b(c))},f=async a=>await d(a);return J(f,{_contract:a,estimateGas:e,populateTransaction:b,send:d,staticCall:c}),f}(this):null}),new Proxy(this,{get:(a,b,c)=>{if("symbol"==typeof b||b in a||dX.indexOf(b)>=0)return Reflect.get(a,b,c);try{return a.getFunction(b)}catch(a){if(!L(a,"INVALID_ARGUMENT")||"key"!==a.argument)throw a}},has:(a,b)=>"symbol"==typeof b||b in a||dX.indexOf(b)>=0?Reflect.has(a,b):a.interface.hasFunction(b)})}connect(a){return new dY(this.target,this.interface,a)}attach(a){return new dY(a,this.interface,this.runner)}async getAddress(){return await dQ(this).addrPromise}async getDeployedCode(){let a=dL(this.runner);O(a,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});let b=await a.getCode(await this.getAddress());return"0x"===b?null:b}async waitForDeployment(){let a=this.deploymentTransaction();if(a)return await a.wait(),this;if(null!=await this.getDeployedCode())return this;let b=dL(this.runner);return O(null!=b,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((a,c)=>{let d=async()=>{try{let c=await this.getDeployedCode();if(null!=c)return a(this);b.once("block",d)}catch(a){c(a)}};d()})}deploymentTransaction(){return dQ(this).deployTx}getFunction(a){var b,c;let d,e,f,g,h,i,j;return"string"!=typeof a&&(a=a.format()),b=this,c=a,d=function(...a){let d=b.interface.getFunction(c,a);return O(d,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:c,args:a}}),d},e=async function(...a){let c=d(...a),e={};if(c.inputs.length+1===a.length&&(e=await dM(a.pop())).from&&(e.from=await cr(e.from,dI(b.runner))),c.inputs.length!==a.length)throw Error("internal error: fragment inputs doesn't match arguments; should not happen");let f=await dN(b.runner,c.inputs,a);return Object.assign({},e,await I({to:b.getAddress(),data:b.interface.encodeFunctionData(c,f)}))},f=async function(...a){let b=await i(...a);return 1===b.length?b[0]:b},g=async function(...a){let c=b.runner;O(dH(c),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});let d=await c.sendTransaction(await e(...a)),f=dL(b.runner);return new dA(b.interface,f,d)},h=async function(...a){let c=dK(b.runner,"estimateGas");return O(dF(c),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await c.estimateGas(await e(...a))},i=async function(...a){let c=dK(b.runner,"call");O(dE(c),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});let f=await e(...a),g="0x";try{g=await c.call(f)}catch(a){if(M(a)&&a.data)throw b.interface.makeError(a.data,f);throw a}let h=d(...a);return b.interface.decodeFunctionResult(h,g)},J(j=async(...a)=>d(...a).constant?await f(...a):await g(...a),{name:b.interface.getFunctionName(c),_contract:b,_key:c,getFragment:d,estimateGas:h,populateTransaction:e,send:g,staticCall:f,staticCallResult:i}),Object.defineProperty(j,"fragment",{configurable:!1,enumerable:!0,get:()=>{let a=b.interface.getFunction(c);return O(a,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:c}}),a}}),j}getEvent(a){var b,c;let d,e;return"string"!=typeof a&&(a=a.format()),b=this,c=a,d=function(...a){let d=b.interface.getEvent(c,a);return O(d,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:c,args:a}}),d},J(e=function(...a){return new dJ(b,d(...a),a)},{name:b.interface.getEventName(c),_contract:b,_key:c,getFragment:d}),Object.defineProperty(e,"fragment",{configurable:!1,enumerable:!0,get:()=>{let a=b.interface.getEvent(c);return O(a,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:c}}),a}}),e}async queryTransaction(a){throw Error("@TODO")}async queryFilter(a,b,c){null==b&&(b=0),null==c&&(c="latest");let{addr:d,addrPromise:e}=dQ(this),f=d||await e,{fragment:g,topics:h}=await dR(this,a),i={address:f,topics:h,fromBlock:b,toBlock:c},j=dL(this.runner);return O(j,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await j.getLogs(i)).map(a=>{let b=g;if(null==b)try{b=this.interface.getEvent(a.topics[0])}catch(a){}if(b)try{return new dx(a,this.interface,b)}catch(b){return new dy(a,b)}return new dr(a,j)})}async on(a,b){let c=await dT(this,"on",a);return c.listeners.push({listener:b,once:!1}),c.start(),this}async once(a,b){let c=await dT(this,"once",a);return c.listeners.push({listener:b,once:!0}),c.start(),this}async emit(a,...b){return await dW(this,a,b,null)}async listenerCount(a){if(a){let b=await dS(this,a);return b?b.listeners.length:0}let{subs:b}=dQ(this),c=0;for(let{listeners:a}of b.values())c+=a.length;return c}async listeners(a){if(a){let b=await dS(this,a);return b?b.listeners.map(({listener:a})=>a):[]}let{subs:b}=dQ(this),c=[];for(let{listeners:a}of b.values())c=c.concat(a.map(({listener:a})=>a));return c}async off(a,b){let c=await dS(this,a);if(!c)return this;if(b){let a=c.listeners.map(({listener:a})=>a).indexOf(b);a>=0&&c.listeners.splice(a,1)}return(null==b||0===c.listeners.length)&&(c.stop(),dQ(this).subs.delete(c.tag)),this}async removeAllListeners(a){if(a){let b=await dS(this,a);if(!b)return this;b.stop(),dQ(this).subs.delete(b.tag)}else{let{subs:a}=dQ(this);for(let{tag:b,stop:c}of a.values())c(),a.delete(b)}return this}async addListener(a,b){return await this.on(a,b)}async removeListener(a,b){return await this.off(a,b)}static buildClass(a){return class extends dY{constructor(b,c=null){super(b,a,c)}}}static from(a,b,c){return null==c&&(c=null),new this(a,b,c)}}function dZ(){return dY}class d$ extends dZ(){}let d_=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]);function d0(a){var b;let c;return b=function(a){let b=0;function c(){return a[b++]<<8|a[b++]}let d=c(),e=1,f=[0,1];for(let a=1;a<d;a++)f.push(e+=c());let g=c(),h=b;b+=g;let i=0,j=0;function k(){return 0==i&&(j=j<<8|a[b++],i=8),j>>--i&1}let l=0x80000000-1,m=0;for(let a=0;a<31;a++)m=m<<1|k();let n=[],o=0,p=0x80000000;for(;;){let a=Math.floor(((m-o+1)*e-1)/p),b=0,c=d;for(;c-b>1;){let d=b+c>>>1;a<f[d]?c=d:b=d}if(0==b)break;n.push(b);let g=o+Math.floor(p*f[b]/e),h=o+Math.floor(p*f[b+1]/e)-1;for(;((g^h)&0x40000000)==0;)m=m<<1&l|k(),g=g<<1&l,h=h<<1&l|1;for(;g&~h&0x20000000;)m=0x40000000&m|m<<1&l>>>1|k(),g=g<<1^0x40000000,h=(0x40000000^h)<<1|0x40000001;o=g,p=1+h-g}let q=d-4;return n.map(b=>{switch(b-q){case 3:return q+65792+(a[h++]<<16|a[h++]<<8|a[h++]);case 2:return q+256+(a[h++]<<8|a[h++]);case 1:return q+a[h++];default:return b-1}})}(function(a){let b=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((a,c)=>b[a.charCodeAt(0)]=c);let c=a.length,d=new Uint8Array(6*c>>3);for(let e=0,f=0,g=0,h=0;e<c;e++)h=h<<6|b[a.charCodeAt(e)],(g+=6)>=8&&(d[f++]=h>>(g-=8));return d}(a)),c=0,()=>b[c++]}function d1(a,b=0){let c=[];for(;;){let d=a(),e=a();if(!e)break;b+=d;for(let a=0;a<e;a++)c.push(b+a);b+=e+1}return c}function d2(a){return d4(()=>{let b=d1(a);if(b.length)return b})}function d3(a){let b=[];for(;;){let c=a();if(0==c)break;b.push(function(a,b){let c=1+b(),d=b(),e=d4(b);return d5(e.length,1+a,b).flatMap((a,b)=>{let[f,...g]=a;return Array(e[b]).fill().map((a,b)=>{let e=b*d;return[f+b*c,g.map(a=>a+e)]})})}(c,a))}for(;;){var c,d;let e=a()-1;if(e<0)break;b.push((c=e,d5(1+(d=a)(),1+c,d).map(a=>[a[0],a.slice(1)])))}return b.flat()}function d4(a){let b=[];for(;;){let c=a(b.length);if(!c)break;b.push(c)}return b}function d5(a,b,c){let d=Array(a).fill().map(()=>[]);for(let e=0;e<b;e++)(function(a,b){let c=Array(a);for(let e=0,f=0;e<a;e++){var d;c[e]=f+=1&(d=b())?~d>>1:d>>1}return c})(a,c).forEach((a,b)=>d[b].push(a));return d}function d6(a){return`{${a.toString(16).toUpperCase().padStart(2,"0")}}`}function d7(a){let b=a.length;if(b<4096)return String.fromCodePoint(...a);let c=[];for(let d=0;d<b;)c.push(String.fromCodePoint(...a.slice(d,d+=4096)));return c.join("")}function d8(a,b){let c=a.length,d=c-b.length;for(let e=0;0==d&&e<c;e++)d=a[e]-b[e];return d}let d9=55204;function ea(a){return a>>24&255}function eb(a){return 0xffffff&a}function ec(a){return a>=44032&&a<d9}function ed(a){b||function(){let a=d0("AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g");for(let[f,g]of(b=new Map(d2(a).flatMap((a,b)=>a.map(a=>[a,b+1<<24]))),c=new Set(d1(a)),d=new Map,e=new Map,d3(a))){if(!c.has(f)&&2==g.length){let[a,b]=g,c=e.get(a);c||(c=new Map,e.set(a,c)),c.set(b,f)}d.set(f,g.reverse())}}();let f=[],g=[],h=!1;function i(a){let c=b.get(a);c&&(h=!0,a|=c),f.push(a)}for(let b of a)for(;;){if(b<128)f.push(b);else if(ec(b)){let a=b-44032,c=a/588|0,d=a%588/28|0,e=a%28;i(4352+c),i(4449+d),e>0&&i(4519+e)}else{let a=d.get(b);a?g.push(...a):i(b)}if(!g.length)break;b=g.pop()}if(h&&f.length>1){let a=ea(f[0]);for(let b=1;b<f.length;b++){let c=ea(f[b]);if(0==c||a<=c){a=c;continue}let d=b-1;for(;;){let b=f[d+1];if(f[d+1]=f[d],f[d]=b,!d||(a=ea(f[--d]))<=c)break}a=ea(f[b])}}return f}function ee(a){return function(a){let b=[],c=[],d=-1,f=0;for(let g of a){let a=ea(g),h=eb(g);if(-1==d)0==a?d=h:b.push(h);else if(f>0&&f>=a)0==a?(b.push(d,...c),c.length=0,d=h):c.push(h),f=a;else{let g=function(a,b){if(a>=4352&&a<4371&&b>=4449&&b<4470)return 44032+(a-4352)*588+(b-4449)*28;{if(ec(a)&&b>4519&&b<4547&&(a-44032)%28==0)return a+(b-4519);let c=e.get(a);return c&&(c=c.get(b))?c:-1}}(d,h);g>=0?d=g:0==f&&0==a?(b.push(d),d=h):(c.push(h),f=a)}}return d>=0&&b.push(d,...c),b}(ed(a))}let ef=a=>Array.from(a);function eg(a,b){return a.P.has(b)||a.Q.has(b)}class eh extends Array{get is_emoji(){return!0}}function ei(){let a,b;if(f)return;let c=d0("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"),d=()=>new Set(d1(c)),e=(a,b)=>b.forEach(b=>a.add(b));f=new Map(d3(c)),g=d(),h=d1(c),i=new Set(d1(c).map(a=>h[a])),h=new Set(h),j=d(),d();let q=d2(c),r=c(),s=()=>{let a=new Set;return d1(c).forEach(b=>e(a,q[b])),e(a,d1(c)),a};k=d4(a=>{let b=d4(c).map(a=>a+96);if(b.length){let d=a>=r;b[0]-=32,b=d7(b),d&&(b=`Restricted[${b}]`);let e=s();return{N:b,P:e,Q:s(),M:!c(),R:d}}}),l=d(),m=new Map;let t=d1(c).concat(ef(l)).sort((a,b)=>a-b);for(let{V:a,M:b}of(t.forEach((a,b)=>{let d=c(),e=t[b]=d?t[b-d]:{V:[],M:new Map};e.V.push(a),l.has(a)||m.set(a,e)}),new Set(m.values()))){let c=[];for(let b of a){let a=k.filter(a=>eg(a,b)),d=c.find(({G:b})=>a.some(a=>b.has(a)));d||(d={G:new Set,V:[]},c.push(d)),d.V.push(b),e(d.G,a)}let d=c.flatMap(a=>ef(a.G));for(let{G:a,V:e}of c){let c=new Set(d.filter(b=>!a.has(b)));for(let a of e)b.set(a,c)}}n=new Set;let u=new Set,v=a=>n.has(a)?u.add(a):n.add(a);for(let a of k){for(let b of a.P)v(b);for(let b of a.Q)v(b)}for(let a of n)m.has(a)||u.has(a)||m.set(a,1);for(let d of(e(n,ed(n).map(eb)),o=(a=[],b=d1(c),function b({S:c,B:d},e,f){if(!(4&c)||f!==e[e.length-1])for(let g of(2&c&&(f=e[e.length-1]),1&c&&a.push(e),d))for(let a of g.Q)b(g,[...e,a],f)}(function a(d){return{S:c(),B:d4(()=>{let d=d1(c).map(a=>b[a]);if(d.length)return a(d)}),Q:d}}([]),[]),a).map(a=>eh.from(a)).sort(d8),p=new Map,o)){let a=[p];for(let b of d){let c=a.map(a=>{let c=a.get(b);return c||(c=new Map,a.set(b,c)),c});65039===b?a.push(...c):a=c}for(let b of a)b.V=d}}function ej(a){return(em(a)?"":`${ek(el([a]))} `)+d6(a)}function ek(a){return`"${a}"\u200E`}function el(a,b=1/0,c=d6){var d;let e=[];d=a[0],ei(),h.has(d)&&e.push(""),a.length>b&&(b>>=1,a=[...a.slice(0,b),8230,...a.slice(-b)]);let f=0,g=a.length;for(let b=0;b<g;b++){let d=a[b];em(d)&&(e.push(d7(a.slice(f,b))),e.push(c(d)),f=b+1)}return e.push(d7(a.slice(f,g))),e.join("")}function em(a){return ei(),j.has(a)}function en(a){return Error(`disallowed character: ${ej(a)}`)}function eo(a,b){let c=ej(b),d=k.find(a=>a.P.has(b));return d&&(c=`${d.N} ${c}`),Error(`illegal mixture: ${a.N} + ${c}`)}function ep(a){return Error(`illegal placement: ${a}`)}function eq(a){return a.filter(a=>65039!=a)}let er=new Uint8Array(32);function es(a){return P(0!==a.length,"invalid ENS name; empty component","comp",a),a}function et(a){let b=bx(function(a){try{var b;if(0===a.length)throw Error("empty label");return(b=function(a,b,c){if(!a)return[];ei();let d=0;return a.split(".").map(a=>{let e=function(a){let b=[];for(let c=0,d=a.length;c<d;){let d=a.codePointAt(c);c+=d<65536?1:2,b.push(d)}return b}(a),j={input:e,offset:d};d+=e.length+1;try{let a,d=j.tokens=function(a,b,c){let d=[],e=[];for(a=a.slice().reverse();a.length;){let h=function(a,b){let c,d=p,e=a.length;for(;e&&(d=d.get(a[--e]));){let{V:b}=d;b&&(c=b,a.length=e)}return c}(a);if(h)e.length&&(d.push(b(e)),e=[]),d.push(c(h));else{let b=a.pop();if(n.has(b))e.push(b);else{let a=f.get(b);if(a)e.push(...a);else if(!g.has(b))throw en(b)}}}return e.length&&d.push(b(e)),d}(e,b,c),l=d.length;if(!l)throw Error("empty label");let o=j.output=d.flat();for(let a=o.lastIndexOf(95);a>0;)if(95!==o[--a])throw Error("underscore allowed only at start");if(!(j.emoji=l>1||d[0].is_emoji)&&o.every(a=>a<128)){if(o.length>=4&&45==o[2]&&45==o[3])throw Error(`invalid label extension: "${d7(o.slice(0,4))}"`);a="ASCII"}else{let b=d.flatMap(a=>a.is_emoji?[]:a);if(b.length){if(h.has(o[0]))throw ep("leading combining mark");for(let a=1;a<l;a++){let b=d[a];if(!b.is_emoji&&h.has(b[0]))throw ep(`emoji + combining mark: "${d7(d[a-1])} + ${el([b[0]])}"`)}!function(a){let b=a[0],c=d_.get(b);if(c)throw ep(`leading ${c}`);let d=a.length,e=-1;for(let f=1;f<d;f++){b=a[f];let d=d_.get(b);if(d){if(e==f)throw ep(`${c} + ${d}`);e=f+1,c=d}}if(e==d)throw ep(`trailing ${c}`)}(o);let c=ef(new Set(b)),[e]=function(a){let b=k;for(let c of a){let a=b.filter(a=>eg(a,c));if(!a.length)if(k.some(a=>eg(a,c)))throw eo(b[0],c);else throw en(c);if(b=a,1==a.length)break}return b}(c);(function(a,b){for(let c of b)if(!eg(a,c))throw eo(a,c);if(a.M){let a=ed(b).map(eb);for(let b=1,c=a.length;b<c;b++)if(i.has(a[b])){let d=b+1;for(let e;d<c&&i.has(e=a[d]);d++)for(let c=b;c<d;c++)if(a[c]==e)throw Error(`duplicate non-spacing marks: ${ej(e)}`);if(d-b>4)throw Error(`excessive non-spacing marks: ${ek(el(a.slice(b-1,d)))} (${d-b}/4)`);b=d}}})(e,b),function(a,b){let c,d=[];for(let a of b){let b=m.get(a);if(1===b)return;if(b){let d=b.M.get(a);if(!(c=c?c.filter(a=>d.has(a)):ef(d)).length)return}else d.push(a)}if(c){for(let b of c)if(d.every(a=>eg(b,a)))throw Error(`whole-script confusable: ${a.N}/${b.N}`)}}(e,c),a=e.N}else a="Emoji"}j.type=a}catch(a){j.error=a}return j})}(a,ee,eq)).map(({input:a,error:c,output:d})=>{if(c){let d=c.message;throw Error(1==b.length?d:`Invalid label ${ek(el(a,63))}: ${d}`)}return d7(d)}).join(".")}catch(b){P(!1,`invalid ENS name (${b.message})`,"name",a)}}(a)),c=[];if(0===a.length)return c;let d=0;for(let a=0;a<b.length;a++)46===b[a]&&(c.push(es(b.slice(d,a))),d=a+1);return P(d<b.length,"invalid ENS name; empty component","name",a),c.push(es(b.slice(d))),c}function eu(a){P("string"==typeof a,"invalid ENS name; not a string","name",a),P(a.length,"invalid ENS name (empty label)","name",a);let b=er,c=et(a);for(;c.length;)b=a4($([b,a4(c.pop())]));return Z(b)}er.fill(0);var ev=a.i(54799);let ew=function(a){return(0,ev.createHash)("sha256").update(a).digest()},ex=function(a){return(0,ev.createHash)("sha512").update(a).digest()},ey=ew,ez=ex,eA=!1,eB=!1;function eC(a){let b=U(a,"data");return Z(ey(b))}function eD(a){let b=U(a,"data");return Z(ez(b))}eC._=ew,eC.lock=function(){eA=!0},eC.register=function(a){if(eA)throw Error("sha256 is locked");ey=a},Object.freeze(eC),eD._=ex,eD.lock=function(){eB=!0},eD.register=function(a){if(eB)throw Error("sha512 is locked");ez=a},Object.freeze(eC);class eE extends aL{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=aI(this.buffer)}update(a){aC(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=aK(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=aI(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){aC(this),aD(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;!function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=aI(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let eF=(a,b,c)=>a&b^~a&c,eG=(a,b,c)=>a&b^a&c^b&c,eH=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),eI=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),eJ=new Uint32Array(64);class eK extends eE{constructor(){super(64,32,8,!1),this.A=0|eI[0],this.B=0|eI[1],this.C=0|eI[2],this.D=0|eI[3],this.E=0|eI[4],this.F=0|eI[5],this.G=0|eI[6],this.H=0|eI[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)eJ[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=eJ[a-15],c=eJ[a-2],d=aJ(b,7)^aJ(b,18)^b>>>3,e=aJ(c,17)^aJ(c,19)^c>>>10;eJ[a]=e+eJ[a-7]+d+eJ[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){let b=j+(aJ(g,6)^aJ(g,11)^aJ(g,25))+eF(g,h,i)+eH[a]+eJ[a]|0,k=(aJ(c,2)^aJ(c,13)^aJ(c,22))+eG(c,d,e)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+k|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){eJ.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let eL=aM(()=>new eK),eM=BigInt(0),eN=BigInt(1),eO=BigInt(2),eP=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function eQ(a){if(!(a instanceof Uint8Array))throw Error("Uint8Array expected");let b="";for(let c=0;c<a.length;c++)b+=eP[a[c]];return b}function eR(a){let b=a.toString(16);return 1&b.length?`0${b}`:b}function eS(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return BigInt(""===a?"0":`0x${a}`)}function eT(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length;if(b%2)throw Error("padded hex string expected, got unpadded hex of length "+b);let c=new Uint8Array(b/2);for(let b=0;b<c.length;b++){let d=2*b,e=Number.parseInt(a.slice(d,d+2),16);if(Number.isNaN(e)||e<0)throw Error("Invalid byte sequence");c[b]=e}return c}function eU(a){return eS(eQ(a))}function eV(a){if(!(a instanceof Uint8Array))throw Error("Uint8Array expected");return eS(eQ(Uint8Array.from(a).reverse()))}function eW(a,b){return eT(a.toString(16).padStart(2*b,"0"))}function eX(a,b){return eW(a,b).reverse()}function eY(a){return eT(eR(a))}function eZ(a,b,c){let d;if("string"==typeof b)try{d=eT(b)}catch(c){throw Error(`${a} must be valid hex string, got "${b}". Cause: ${c}`)}else if(b instanceof Uint8Array)d=Uint8Array.from(b);else throw Error(`${a} must be hex string or Uint8Array`);let e=d.length;if("number"==typeof c&&e!==c)throw Error(`${a} expected ${c} bytes, got ${e}`);return d}function e$(...a){let b=new Uint8Array(a.reduce((a,b)=>a+b.length,0)),c=0;return a.forEach(a=>{if(!(a instanceof Uint8Array))throw Error("Uint8Array expected");b.set(a,c),c+=a.length}),b}function e_(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function e0(a){if("string"!=typeof a)throw Error(`utf8ToBytes expected string, got ${typeof a}`);return new Uint8Array(new TextEncoder().encode(a))}function e1(a){let b;for(b=0;a>eM;a>>=eN,b+=1);return b}function e2(a,b){return a>>BigInt(b)&eN}let e3=a=>(eO<<BigInt(a-1))-eN,e4=a=>new Uint8Array(a);function e5(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=e4(a),e=e4(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=e4())=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return e$(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}}let e6={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||a instanceof Uint8Array,isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function e7(a,b,c={}){let d=(b,c,d)=>{let e=e6[c];if("function"!=typeof e)throw Error(`Invalid validator "${c}", expected function`);let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error(`Invalid param ${String(b)}=${f} (${typeof f}), expected ${c}`)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}a.s(["bitGet",()=>e2,"bitLen",()=>e1,"bitMask",0,e3,"bitSet",0,(a,b,c)=>a|(c?eN:eM)<<BigInt(b),"bytesToHex",()=>eQ,"bytesToNumberBE",()=>eU,"bytesToNumberLE",()=>eV,"concatBytes",()=>e$,"createHmacDrbg",()=>e5,"ensureBytes",()=>eZ,"equalBytes",()=>e_,"hexToBytes",()=>eT,"hexToNumber",()=>eS,"numberToBytesBE",()=>eW,"numberToBytesLE",()=>eX,"numberToHexUnpadded",()=>eR,"numberToVarBytesBE",()=>eY,"utf8ToBytes",()=>e0,"validateObject",()=>e7],10272);let e8=BigInt(0),e9=BigInt(1),fa=BigInt(2),fb=BigInt(3),fc=BigInt(4),fd=BigInt(5),fe=BigInt(8);function ff(a,b){let c=a%b;return c>=e8?c:b+c}function fg(a,b,c){let d=a;for(;b-- >e8;)d*=d,d%=c;return d}function fh(a,b){if(a===e8||b<=e8)throw Error(`invert: expected positive integers, got n=${a} mod=${b}`);let c=ff(a,b),d=b,e=e8,f=e9,g=e9,h=e8;for(;c!==e8;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==e9)throw Error("invert: does not exist");return ff(e,b)}BigInt(9),BigInt(16);let fi=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fj(a){return e7(a,fi.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function fk(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function fl(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function fm(a){let b=fl(a);return b+Math.ceil(b/2)}var fn=a.i(10272);let fo=BigInt(0),fp=BigInt(1);function fq(a){return fj(a.Fp),e7(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...fk(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}let{bytesToNumberBE:fr,hexToBytes:fs}=fn,ft={Err:class extends Error{constructor(a=""){super(a)}},_parseInt(a){let{Err:b}=ft;if(a.length<2||2!==a[0])throw new b("Invalid signature integer tag");let c=a[1],d=a.subarray(2,c+2);if(!c||d.length!==c)throw new b("Invalid signature integer: wrong length");if(128&d[0])throw new b("Invalid signature integer: negative");if(0===d[0]&&!(128&d[1]))throw new b("Invalid signature integer: unnecessary leading zero");return{d:fr(d),l:a.subarray(c+2)}},toSig(a){let{Err:b}=ft,c="string"==typeof a?fs(a):a;if(!(c instanceof Uint8Array))throw Error("ui8a expected");let d=c.length;if(d<2||48!=c[0])throw new b("Invalid signature tag");if(c[1]!==d-2)throw new b("Invalid signature: incorrect length");let{d:e,l:f}=ft._parseInt(c.subarray(2)),{d:g,l:h}=ft._parseInt(f);if(h.length)throw new b("Invalid signature: left bytes after parsing");return{r:e,s:g}},hexFromSig(a){let b=a=>8&Number.parseInt(a[0],16)?"00"+a:a,c=a=>{let b=a.toString(16);return 1&b.length?`0${b}`:b},d=b(c(a.s)),e=b(c(a.r)),f=d.length/2,g=e.length/2,h=c(f),i=c(g);return`30${c(g+f+4)}02${i}${e}02${h}${d}`}},fu=BigInt(0),fv=BigInt(1),fw=BigInt(2),fx=BigInt(3),fy=BigInt(4);class fz extends aL{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,function(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.wrapConstructor");aA(a.outputLen),aA(a.blockLen)}(a);const c=aK(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),e.fill(0)}update(a){return aC(this),this.iHash.update(a),this}digestInto(a){aC(this),aB(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let fA=(a,b,c)=>new fz(a,b).update(c).digest();fA.create=(a,b)=>new fz(a,b);let fB=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),fC=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),fD=BigInt(1),fE=BigInt(2),fF=(a,b)=>(a+b/fE)/b,fG=function(a,b,c=!1,d={}){if(a<=e8)throw Error(`Expected Field ORDER > 0, got ${a}`);let{nBitLength:e,nByteLength:f}=fk(a,b);if(f>2048)throw Error("Field lengths over 2048 bytes are not supported");let g=function(a){if(a%fc===fb){let b=(a+e9)/fc;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%fe===fd){let b=(a-fd)/fe;return function(a,c){let d=a.mul(c,fa),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,fa),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-e9)/fa;for(b=a-e9,c=0;b%fa===e8;b/=fa,c++);for(d=fa;d<a&&function(a,b,c){if(c<=e8||b<e8)throw Error("Expected power/modulo > 0");if(c===e9)return e8;let d=e9;for(;b>e8;)b&e9&&(d=d*a%c),a=a*a%c,b>>=e9;return d}(d,e,a)!==a-e9;d++);if(1===c){let b=(a+e9)/fc;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+e9)/fa;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,e9<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a),h=Object.freeze({ORDER:a,BITS:e,BYTES:f,MASK:e3(e),ZERO:e8,ONE:e9,create:b=>ff(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error(`Invalid field element: expected bigint, got ${typeof b}`);return e8<=b&&b<a},is0:a=>a===e8,isOdd:a=>(a&e9)===e9,neg:b=>ff(-b,a),eql:(a,b)=>a===b,sqr:b=>ff(b*b,a),add:(b,c)=>ff(b+c,a),sub:(b,c)=>ff(b-c,a),mul:(b,c)=>ff(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<e8)throw Error("Expected power > 0");if(c===e8)return a.ONE;if(c===e9)return b;let d=a.ONE,e=b;for(;c>e8;)c&e9&&(d=a.mul(d,e)),e=a.sqr(e),c>>=e9;return d})(h,a,b),div:(b,c)=>ff(b*fh(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>fh(b,a),sqrt:d.sqrt||(a=>g(h,a)),invertBatch:a=>{let b,c,d;return b=Array(a.length),c=a.reduce((a,c,d)=>h.is0(c)?a:(b[d]=a,h.mul(a,c)),h.ONE),d=h.inv(c),a.reduceRight((a,c,d)=>h.is0(c)?a:(b[d]=h.mul(a,b[d]),h.mul(a,c)),d),b},cmov:(a,b,c)=>c?b:a,toBytes:a=>c?eX(a,f):eW(a,f),fromBytes:a=>{if(a.length!==f)throw Error(`Fp.fromBytes: expected ${f}, got ${a.length}`);return c?eV(a):eU(a)}});return Object.freeze(h)}(fB,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%fB,j=i*i*a%fB,k=fg(j,b,fB)*j%fB,l=fg(k,b,fB)*j%fB,m=fg(l,fE,fB)*i%fB,n=fg(m,d,fB)*m%fB,o=fg(n,e,fB)*n%fB,p=fg(o,g,fB)*o%fB,q=fg(p,h,fB)*p%fB,r=fg(q,g,fB)*o%fB,s=fg(r,b,fB)*j%fB,t=fg(s,f,fB)*n%fB,u=fg(t,c,fB)*i%fB,v=fg(u,fE,fB);if(!fG.eql(fG.sqr(v),a))throw Error("Cannot find square root");return v}}),fH=(s={a:BigInt(0),b:BigInt(7),Fp:fG,n:fC,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-fD*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=fF(b*a,fC),g=fF(-c*a,fC),h=ff(a-f*b-g*d,fC),i=ff(-f*c-g*b,fC),j=h>e,k=i>e;if(j&&(h=fC-h),k&&(i=fC-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},Object.freeze({...(q=a=>(function(a){let b,c=(b=fq(a),fn.validateObject(b,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e}=c,f=d.BYTES+1,g=2*d.BYTES+1;function h(a){return ff(a,e)}let{ProjectivePoint:i,normPrivateKeyToScalar:j,weierstrassEquation:k,isWithinCurveOrder:l}=function(a){var b;let c,d,e=function(a){let b=fq(a);fn.validateObject(b,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...b})}(a),{Fp:f}=e,g=e.toBytes||((a,b,c)=>{let d=b.toAffine();return fn.concatBytes(Uint8Array.from([4]),f.toBytes(d.x),f.toBytes(d.y))}),h=e.fromBytes||(a=>{let b=a.subarray(1);return{x:f.fromBytes(b.subarray(0,f.BYTES)),y:f.fromBytes(b.subarray(f.BYTES,2*f.BYTES))}});function i(a){let{a:b,b:c}=e,d=f.sqr(a),g=f.mul(d,a);return f.add(f.add(g,f.mul(a,b)),c)}if(!f.eql(f.sqr(e.Gy),i(e.Gx)))throw Error("bad generator point: equation left != right");function j(a){return"bigint"==typeof a&&fu<a&&a<e.n}function k(a){if(!j(a))throw Error("Expected valid bigint: 0 < bigint < curve.n")}function l(a){let b,{allowedPrivateKeyLengths:c,nByteLength:d,wrapPrivateKey:f,n:g}=e;if(c&&"bigint"!=typeof a){if(a instanceof Uint8Array&&(a=fn.bytesToHex(a)),"string"!=typeof a||!c.includes(a.length))throw Error("Invalid key");a=a.padStart(2*d,"0")}try{b="bigint"==typeof a?a:fn.bytesToNumberBE(eZ("private key",a,d))}catch(b){throw Error(`private key must be ${d} bytes, hex or bigint, not ${typeof a}`)}return f&&(b=ff(b,g)),k(b),b}let m=new Map;function n(a){if(!(a instanceof o))throw Error("ProjectivePoint expected")}class o{constructor(a,b,c){if(this.px=a,this.py=b,this.pz=c,null==a||!f.isValid(a))throw Error("x required");if(null==b||!f.isValid(b))throw Error("y required");if(null==c||!f.isValid(c))throw Error("z required")}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!f.isValid(b)||!f.isValid(c))throw Error("invalid affine point");if(a instanceof o)throw Error("projective point not allowed");let d=a=>f.eql(a,f.ZERO);return d(b)&&d(c)?o.ZERO:new o(b,c,f.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=f.invertBatch(a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(o.fromAffine)}static fromHex(a){let b=o.fromAffine(h(eZ("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return o.BASE.multiply(l(a))}_setWindowSize(a){this._WINDOW_SIZE=a,m.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!f.is0(this.py))return;throw Error("bad point: ZERO")}let{x:a,y:b}=this.toAffine();if(!f.isValid(a)||!f.isValid(b))throw Error("bad point: x or y not FE");let c=f.sqr(b),d=i(a);if(!f.eql(c,d))throw Error("bad point: equation left != right");if(!this.isTorsionFree())throw Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:a}=this.toAffine();if(f.isOdd)return!f.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){n(a);let{px:b,py:c,pz:d}=this,{px:e,py:g,pz:h}=a,i=f.eql(f.mul(b,h),f.mul(e,d)),j=f.eql(f.mul(c,h),f.mul(g,d));return i&&j}negate(){return new o(this.px,f.neg(this.py),this.pz)}double(){let{a,b}=e,c=f.mul(b,fx),{px:d,py:g,pz:h}=this,i=f.ZERO,j=f.ZERO,k=f.ZERO,l=f.mul(d,d),m=f.mul(g,g),n=f.mul(h,h),p=f.mul(d,g);return p=f.add(p,p),k=f.mul(d,h),k=f.add(k,k),i=f.mul(a,k),j=f.mul(c,n),j=f.add(i,j),i=f.sub(m,j),j=f.add(m,j),j=f.mul(i,j),i=f.mul(p,i),k=f.mul(c,k),n=f.mul(a,n),p=f.sub(l,n),p=f.mul(a,p),p=f.add(p,k),k=f.add(l,l),l=f.add(k,l),l=f.add(l,n),l=f.mul(l,p),j=f.add(j,l),n=f.mul(g,h),n=f.add(n,n),l=f.mul(n,p),i=f.sub(i,l),k=f.mul(n,m),k=f.add(k,k),new o(i,j,k=f.add(k,k))}add(a){n(a);let{px:b,py:c,pz:d}=this,{px:g,py:h,pz:i}=a,j=f.ZERO,k=f.ZERO,l=f.ZERO,m=e.a,p=f.mul(e.b,fx),q=f.mul(b,g),r=f.mul(c,h),s=f.mul(d,i),t=f.add(b,c),u=f.add(g,h);t=f.mul(t,u),u=f.add(q,r),t=f.sub(t,u),u=f.add(b,d);let v=f.add(g,i);return u=f.mul(u,v),v=f.add(q,s),u=f.sub(u,v),v=f.add(c,d),j=f.add(h,i),v=f.mul(v,j),j=f.add(r,s),v=f.sub(v,j),l=f.mul(m,u),j=f.mul(p,s),l=f.add(j,l),j=f.sub(r,l),l=f.add(r,l),k=f.mul(j,l),r=f.add(q,q),r=f.add(r,q),s=f.mul(m,s),u=f.mul(p,u),r=f.add(r,s),s=f.sub(q,s),s=f.mul(m,s),u=f.add(u,s),q=f.mul(r,u),k=f.add(k,q),q=f.mul(v,u),j=f.mul(t,j),j=f.sub(j,q),q=f.mul(t,r),l=f.mul(v,l),new o(j,k,l=f.add(l,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(o.ZERO)}wNAF(a){return q.wNAFCached(this,m,a,a=>{let b=f.invertBatch(a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(o.fromAffine)})}multiplyUnsafe(a){let b=o.ZERO;if(a===fu)return b;if(k(a),a===fv)return this;let{endo:c}=e;if(!c)return q.unsafeLadder(this,a);let{k1neg:d,k1:g,k2neg:h,k2:i}=c.splitScalar(a),j=b,l=b,m=this;for(;g>fu||i>fu;)g&fv&&(j=j.add(m)),i&fv&&(l=l.add(m)),m=m.double(),g>>=fv,i>>=fv;return d&&(j=j.negate()),h&&(l=l.negate()),l=new o(f.mul(l.px,c.beta),l.py,l.pz),j.add(l)}multiply(a){let b,c;k(a);let{endo:d}=e;if(d){let{k1neg:e,k1:g,k2neg:h,k2:i}=d.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=q.constTimeNegate(e,j),l=q.constTimeNegate(h,l),l=new o(f.mul(l.px,d.beta),l.py,l.pz),b=j.add(l),c=k.add(m)}else{let{p:d,f:e}=this.wNAF(a);b=d,c=e}return o.normalizeZ([b,c])[0]}multiplyAndAddUnsafe(a,b,c){let d=o.BASE,e=(a,b)=>b!==fu&&b!==fv&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){let{px:b,py:c,pz:d}=this,e=this.is0();null==a&&(a=e?f.ONE:f.inv(d));let g=f.mul(b,a),h=f.mul(c,a),i=f.mul(d,a);if(e)return{x:f.ZERO,y:f.ZERO};if(!f.eql(i,f.ONE))throw Error("invZ was invalid");return{x:g,y:h}}isTorsionFree(){let{h:a,isTorsionFree:b}=e;if(a===fv)return!0;if(b)return b(o,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=e;return a===fv?this:b?b(o,this):this.multiplyUnsafe(e.h)}toRawBytes(a=!0){return this.assertValidity(),g(o,this,a)}toHex(a=!0){return fn.bytesToHex(this.toRawBytes(a))}}o.BASE=new o(e.Gx,e.Gy,f.ONE),o.ZERO=new o(f.ZERO,f.ONE,f.ZERO);let p=e.nBitLength,q=(b=e.endo?Math.ceil(p/2):p,c=(a,b)=>{let c=b.negate();return a?c:b},d=a=>({windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}),{constTimeNegate:c,unsafeLadder(a,b){let c=o.ZERO,d=a;for(;b>fo;)b&fp&&(c=c.add(d)),d=d.double(),b>>=fp;return c},precomputeWindow(a,b){let{windows:c,windowSize:e}=d(b),f=[],g=a,h=g;for(let a=0;a<c;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,b,e){let{windows:f,windowSize:g}=d(a),h=o.ZERO,i=o.BASE,j=BigInt(2**a-1),k=2**a,l=BigInt(a);for(let a=0;a<f;a++){let d=a*g,f=Number(e&j);e>>=l,f>g&&(f-=k,e+=fp);let m=d+Math.abs(f)-1,n=a%2!=0,o=f<0;0===f?i=i.add(c(n,b[d])):h=h.add(c(o,b[m]))}return{p:h,f:i}},wNAFCached(a,b,c,d){let e=a._WINDOW_SIZE||1,f=b.get(a);return f||(f=this.precomputeWindow(a,e),1!==e&&b.set(a,d(f))),this.wNAF(e,f,c)}});return{CURVE:e,ProjectivePoint:o,normPrivateKeyToScalar:l,weierstrassEquation:i,isWithinCurveOrder:j}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x),g=fn.concatBytes;return c?g(Uint8Array.from([b.hasEvenY()?2:3]),f):g(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===f&&(2===c||3===c)){let a=fn.bytesToNumberBE(e);if(!(fu<a&&a<d.ORDER))throw Error("Point is not on curve");let b=k(a),f=d.sqrt(b);return(1&c)==1!=((f&fv)===fv)&&(f=d.neg(f)),{x:a,y:f}}if(b===g&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error(`Point of length ${b} was invalid. Expected ${f} compressed bytes or ${g} uncompressed bytes`)}}),m=a=>fn.bytesToHex(fn.numberToBytesBE(a,c.nByteLength)),n=(a,b,c)=>fn.bytesToNumberBE(a.slice(b,c));class o{constructor(a,b,c){this.r=a,this.s=b,this.recovery=c,this.assertValidity()}static fromCompact(a){let b=c.nByteLength;return new o(n(a=eZ("compactSignature",a,2*b),0,b),n(a,b,2*b))}static fromDER(a){let{r:b,s:c}=ft.toSig(eZ("DER",a));return new o(b,c)}assertValidity(){if(!l(this.r))throw Error("r must be 0 < r < CURVE.n");if(!l(this.s))throw Error("s must be 0 < s < CURVE.n")}addRecoveryBit(a){return new o(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,j=r(eZ("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let k=2===g||3===g?b+c.n:b;if(k>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",n=i.fromHex(l+m(k)),o=fh(k,e),p=h(-j*o),q=h(f*o),s=i.BASE.multiplyAndAddUnsafe(n,p,q);if(!s)throw Error("point at infinify");return s.assertValidity(),s}hasHighS(){return this.s>e>>fv}normalizeS(){return this.hasHighS()?new o(this.r,h(-this.s),this.recovery):this}toDERRawBytes(){return fn.hexToBytes(this.toDERHex())}toDERHex(){return ft.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return fn.hexToBytes(this.toCompactHex())}toCompactHex(){return m(this.r)+m(this.s)}}function p(a){let b=a instanceof Uint8Array,c="string"==typeof a,d=(b||c)&&a.length;return b?d===f||d===g:c?d===2*f||d===2*g:a instanceof i}let q=c.bits2int||function(a){let b=fn.bytesToNumberBE(a),d=8*a.length-c.nBitLength;return d>0?b>>BigInt(d):b},r=c.bits2int_modN||function(a){return h(q(a))},s=fn.bitMask(c.nBitLength);function t(a){if("bigint"!=typeof a)throw Error("bigint expected");if(!(fu<=a&&a<s))throw Error(`bigint expected < 2^${c.nBitLength}`);return fn.numberToBytesBE(a,c.nByteLength)}let u={lowS:c.lowS,prehash:!1},v={lowS:c.lowS,prehash:!1};return i.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return i.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(p(a))throw Error("first arg must be private key");if(!p(b))throw Error("second arg must be public key");return i.fromHex(b).multiply(j(a)).toRawBytes(c)},sign:function(a,b,f=u){let{seed:g,k2sig:k}=function(a,b,f=u){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:k}=c,{lowS:m,prehash:n,extraEntropy:p}=f;null==m&&(m=!0),a=eZ("msgHash",a),n&&(a=eZ("prehashed msgHash",g(a)));let s=r(a),v=j(b),w=[t(v),t(s)];if(null!=p){let a=!0===p?k(d.BYTES):p;w.push(eZ("extraEntropy",a))}return{seed:fn.concatBytes(...w),k2sig:function(a){var b;let c=q(a);if(!l(c))return;let d=fh(c,e),f=i.BASE.multiply(c).toAffine(),g=h(f.x);if(g===fu)return;let j=h(d*h(s+g*v));if(j===fu)return;let k=2*(f.x!==g)|Number(f.y&fv),n=j;return m&&j>e>>fv&&(n=(b=j)>e>>fv?h(-b):b,k^=1),new o(g,n,k)}}}(a,b,f);return fn.createHmacDrbg(c.hash.outputLen,c.nByteLength,c.hmac)(g,k)},verify:function(a,b,d,f=v){let g,j;if(b=eZ("msgHash",b),d=eZ("publicKey",d),"strict"in f)throw Error("options.strict was renamed to lowS");let{lowS:k,prehash:l}=f;try{if("string"==typeof a||a instanceof Uint8Array)try{j=o.fromDER(a)}catch(b){if(!(b instanceof ft.Err))throw b;j=o.fromCompact(a)}else if("object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s){let{r:b,s:c}=a;j=new o(b,c)}else throw Error("PARSE");g=i.fromHex(d)}catch(a){if("PARSE"===a.message)throw Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(k&&j.hasHighS())return!1;l&&(b=c.hash(b));let{r:m,s:n}=j,p=r(b),q=fh(n,e),s=h(p*q),t=h(m*q),u=i.BASE.multiplyAndAddUnsafe(g,s,t)?.toAffine();return!!u&&h(u.x)===m},ProjectivePoint:i,Signature:o,utils:{isValidPrivateKey(a){try{return j(a),!0}catch(a){return!1}},normPrivateKeyToScalar:j,randomPrivateKey:()=>{let a=fm(c.n);return function(a,b,c=!1){let d=a.length,e=fl(b),f=fm(b);if(d<16||d<f||d>1024)throw Error(`expected ${f}-1024 bytes of input, got ${d}`);let g=ff(c?eU(a):eV(a),b-e9)+e9;return c?eX(g,e):eW(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=i.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...s,hash:a,hmac:(b,...c)=>fA(a,b,function(...a){let b=new Uint8Array(a.reduce((a,b)=>a+b.length,0)),c=0;return a.forEach(a=>{if(!(a instanceof Uint8Array))throw Error("Uint8Array expected");b.set(a,c),c+=a.length}),b}(...c)),randomBytes:aN}))(eL),create:q})),fI=BigInt(0);fH.ProjectivePoint;let fJ=(r=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(a=>a.map(a=>BigInt(a))).map(a=>Array.from(a).reverse()),(a,b)=>{let[c,d,e,f]=r.map(b=>b.reduce((b,c)=>fG.add(fG.mul(b,a),c)));return a=fG.div(c,d),b=fG.mul(b,fG.div(e,f)),{x:a,y:b}}),fK=function(a,b){if(fj(a),!a.isValid(b.A)||!a.isValid(b.B)||!a.isValid(b.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let c=function(a,b){let c=a.ORDER,d=fu;for(let a=c-fv;a%fw===fu;a/=fw)d+=fv;let e=d,f=fw<<e-fv-fv,g=f*fw,h=(c-fv)/g,i=(h-fv)/fw,j=g-fv,k=a.pow(b,h),l=a.pow(b,(h+fv)/fw),m=(b,c)=>{let d=k,g=a.pow(c,j),h=a.sqr(g);h=a.mul(h,c);let m=a.mul(b,h);m=a.pow(m,i),m=a.mul(m,g),g=a.mul(m,c),h=a.mul(m,b);let n=a.mul(h,g);m=a.pow(n,f);let o=a.eql(m,a.ONE);g=a.mul(h,l),m=a.mul(n,d),h=a.cmov(g,h,o),n=a.cmov(m,n,o);for(let b=e;b>fv;b--){let c=b-fw;c=fw<<c-fv;let e=a.pow(n,c),f=a.eql(e,a.ONE);g=a.mul(h,d),d=a.mul(d,d),e=a.mul(n,d),h=a.cmov(g,h,f),n=a.cmov(e,n,f)}return{isValid:o,value:h}};if(a.ORDER%fy===fx){let c=(a.ORDER-fx)/fy,d=a.sqrt(a.neg(b));m=(b,e)=>{let f=a.sqr(e),g=a.mul(b,e);f=a.mul(f,g);let h=a.pow(f,c);h=a.mul(h,g);let i=a.mul(h,d),j=a.mul(a.sqr(h),e),k=a.eql(j,b),l=a.cmov(i,h,k);return{isValid:k,value:l}}}return m}(a,b.Z);if(!a.isOdd)throw Error("Fp.isOdd is not implemented!");return d=>{let e,f,g,h,i,j,k,l;e=a.sqr(d),e=a.mul(e,b.Z),f=a.sqr(e),f=a.add(f,e),g=a.add(f,a.ONE),g=a.mul(g,b.B),h=a.cmov(b.Z,a.neg(f),!a.eql(f,a.ZERO)),h=a.mul(h,b.A),f=a.sqr(g),j=a.sqr(h),i=a.mul(j,b.A),f=a.add(f,i),f=a.mul(f,g),j=a.mul(j,h),i=a.mul(j,b.B),f=a.add(f,i),k=a.mul(e,g);let{isValid:m,value:n}=c(f,j);l=a.mul(e,d),l=a.mul(l,n),k=a.cmov(k,g,m),l=a.cmov(l,n,m);let o=a.isOdd(d)===a.isOdd(l);return l=a.cmov(a.neg(l),l,o),{x:k=a.div(k,h),y:l}}}(fG,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:fG.create(BigInt("-11"))});!function(a,b,c){if("function"!=typeof b)throw Error("mapToCurve() must be defined")}(fH.ProjectivePoint,a=>{let{x:b,y:c}=fK(fG.create(a[0]));return fJ(b,c)},fG.ORDER);class fL{#ad;constructor(a){P(32===_(a),"invalid private key","privateKey","[REDACTED]"),this.#ad=Z(a)}get privateKey(){return this.#ad}get publicKey(){return fL.computePublicKey(this.#ad)}get compressedPublicKey(){return fL.computePublicKey(this.#ad,!0)}sign(a){P(32===_(a),"invalid digest length","digest",a);let b=fH.sign(V(a),V(this.#ad),{lowS:!0});return cV.from({r:am(b.r,32),s:am(b.s,32),v:b.recovery?28:27})}computeSharedSecret(a){let b=fL.computePublicKey(a);return Z(fH.getSharedSecret(V(this.#ad),U(b),!1))}static computePublicKey(a,b){let c=U(a,"key");if(32===c.length)return Z(fH.getPublicKey(c,!!b));if(64===c.length){let a=new Uint8Array(65);a[0]=4,a.set(c,1),c=a}return Z(fH.ProjectivePoint.fromHex(c).toRawBytes(b))}static recoverPublicKey(a,b){P(32===_(a),"invalid digest length","digest",a);let c=cV.from(b),d=fH.Signature.fromCompact(V($([c.r,c.s]))),e=(d=d.addRecoveryBit(c.yParity)).recoverPublicKey(V(a));return P(null!=e,"invalid signature for digest","signature",b),"0x"+e.toHex(!1)}static addPoints(a,b,c){let d=fH.ProjectivePoint.fromHex(fL.computePublicKey(a).substring(2)),e=fH.ProjectivePoint.fromHex(fL.computePublicKey(b).substring(2));return"0x"+d.add(e).toHex(!!c)}}function fM(a,b,c){let d=0;for(let e=0;e<c;e++)d=256*d+a[b+e];return d}function fN(a,b,c,d){let e=[];for(;c<b+1+d;){let f=fO(a,c);e.push(f.result),O((c+=f.consumed)<=b+1+d,"child data too short","BUFFER_OVERRUN",{buffer:a,length:d,offset:b})}return{consumed:1+d,result:e}}function fO(a,b){O(0!==a.length,"data too short","BUFFER_OVERRUN",{buffer:a,length:0,offset:1});let c=b=>{O(b<=a.length,"data short segment too short","BUFFER_OVERRUN",{buffer:a,length:a.length,offset:b})};if(a[b]>=248){let d=a[b]-247;c(b+1+d);let e=fM(a,b+1,d);return c(b+1+d+e),fN(a,b,b+1+d,d+e)}if(a[b]>=192){let d=a[b]-192;return c(b+1+d),fN(a,b,b+1,d)}if(a[b]>=184){let d=a[b]-183;c(b+1+d);let e=fM(a,b+1,d);c(b+1+d+e);let f=Z(a.slice(b+1+d,b+1+d+e));return{consumed:1+d+e,result:f}}if(a[b]>=128){let d=a[b]-128;c(b+1+d);let e=Z(a.slice(b+1,b+1+d));return{consumed:1+d,result:e}}return{consumed:1,result:function(a){let b=a.toString(16);for(;b.length<2;)b="0"+b;return"0x"+b}(a[b])}}function fP(a){let b=U(a,"data"),c=fO(b,0);return P(c.consumed===b.length,"unexpected junk after rlp payload","data",a),c.result}function fQ(a){let b=[];for(;a;)b.unshift(255&a),a>>=8;return b}let fR="0123456789abcdef";function fS(a){let b="0x";for(let c of function a(b){if(Array.isArray(b)){let c=[];if(b.forEach(function(b){c=c.concat(a(b))}),c.length<=55)return c.unshift(192+c.length),c;let d=fQ(c.length);return d.unshift(247+d.length),d.concat(c)}let c=Array.prototype.slice.call(U(b,"object"));if(1===c.length&&c[0]<=127)return c;if(c.length<=55)return c.unshift(128+c.length),c;let d=fQ(c.length);return d.unshift(183+d.length),d.concat(c)}(a))b+=fR[c>>4],b+=fR[15&c];return b}let fT=BigInt(0),fU=BigInt(2),fV=BigInt(27),fW=BigInt(28),fX=BigInt(35),fY=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),fZ=Symbol.for("nodejs.util.inspect.custom");function f$(a,b){let c=a.toString(16);for(;c.length<2;)c="0"+c;return"0x"+(c+=eC(b).substring(4))}function f_(a){return"0x"===a?null:ba(a)}function f0(a,b){try{return cI(a)}catch(c){P(!1,c.message,b,a)}}function f1(a,b){return"0x"===a?0:al(a,b)}function f2(a,b){if("0x"===a)return fT;let c=ah(a,b);return P(c<=fY,"value exceeds uint size",b,c),c}function f3(a,b){let c=ah(a,"value"),d=an(c);return P(d.length<=32,"value too large",`tx.${b}`,c),d}function f4(a){return cI(a).map(a=>[a.address,a.storageKeys])}function f5(a,b){let c;try{if(c=f1(b[0],"yParity"),0!==c&&1!==c)throw Error("bad yParity")}catch(a){P(!1,"invalid yParity","yParity",b[0])}let d=ac(b[1],32),e=ac(b[2],32);a.signature=cV.from({r:d,s:e,yParity:c})}class f6{#ae;#af;#b;#ag;#ah;#ai;#aj;#ak;#al;#am;#an;#ao;#ap;#aq;#ar;#as;#at;#au;get type(){return this.#ae}set type(a){switch(a){case null:this.#ae=null;break;case 0:case"legacy":this.#ae=0;break;case 1:case"berlin":case"eip-2930":this.#ae=1;break;case 2:case"london":case"eip-1559":this.#ae=2;break;case 3:case"cancun":case"eip-4844":this.#ae=3;break;case 4:case"pectra":case"eip-7702":this.#ae=4;break;default:P(!1,"unsupported transaction type","type",a)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){let a=this.#af;return null==a&&3===this.type?dc:a}set to(a){this.#af=null==a?null:ba(a)}get nonce(){return this.#ag}set nonce(a){this.#ag=al(a,"value")}get gasLimit(){return this.#ah}set gasLimit(a){this.#ah=ah(a)}get gasPrice(){let a=this.#ai;return null==a&&(0===this.type||1===this.type)?fT:a}set gasPrice(a){this.#ai=null==a?null:ah(a,"gasPrice")}get maxPriorityFeePerGas(){let a=this.#aj;return null==a?2===this.type||3===this.type?fT:null:a}set maxPriorityFeePerGas(a){this.#aj=null==a?null:ah(a,"maxPriorityFeePerGas")}get maxFeePerGas(){let a=this.#ak;return null==a?2===this.type||3===this.type?fT:null:a}set maxFeePerGas(a){this.#ak=null==a?null:ah(a,"maxFeePerGas")}get data(){return this.#b}set data(a){this.#b=Z(a)}get value(){return this.#al}set value(a){this.#al=ah(a,"value")}get chainId(){return this.#am}set chainId(a){this.#am=ah(a)}get signature(){return this.#an||null}set signature(a){this.#an=null==a?null:cV.from(a)}isValid(){let a=this.signature;if(a&&!a.isValid())return!1;let b=this.authorizationList;if(b){for(let a of b)if(!a.signature.isValid())return!1}return!0}get accessList(){let a=this.#ao||null;return null==a?1===this.type||2===this.type||3===this.type?[]:null:a}set accessList(a){this.#ao=null==a?null:cI(a)}get authorizationList(){let a=this.#at||null;return null==a&&4===this.type?[]:a}set authorizationList(a){this.#at=null==a?null:a.map(a=>cW(a))}get maxFeePerBlobGas(){let a=this.#ap;return null==a&&3===this.type?fT:a}set maxFeePerBlobGas(a){this.#ap=null==a?null:ah(a,"maxFeePerBlobGas")}get blobVersionedHashes(){let a=this.#aq;return null==a&&3===this.type?[]:a}set blobVersionedHashes(a){if(null!=a){P(Array.isArray(a),"blobVersionedHashes must be an Array","value",a),a=a.slice();for(let b=0;b<a.length;b++)P(W(a[b],32),"invalid blobVersionedHash",`value[${b}]`,a[b])}this.#aq=a}get blobs(){return null==this.#as?null:this.#as.map(a=>Object.assign({},a))}set blobs(a){if(null==a){this.#as=null;return}let b=[],c=[];for(let d=0;d<a.length;d++){let e=a[d];if(X(e)){O(this.#ar,"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let a=U(e);if(P(a.length<=131072,"blob is too large",`blobs[${d}]`,e),131072!==a.length){let b=new Uint8Array(131072);b.set(a),a=b}let f=this.#ar.blobToKzgCommitment(a),g=Z(this.#ar.computeBlobKzgProof(a,f));b.push({data:Z(a),commitment:Z(f),proof:g}),c.push(f$(1,f))}else{let a=Z(e.data),d=Z(e.commitment),f=Z(e.proof);b.push({data:a,commitment:d,proof:f}),c.push(f$(1,d))}}this.#as=b,this.#aq=c}get kzg(){return this.#ar}set kzg(a){if(null==a)this.#ar=null;else this.#ar={blobToKzgCommitment:b=>{if("computeBlobProof"in a){if("blobToKzgCommitment"in a&&"function"==typeof a.blobToKzgCommitment)return U(a.blobToKzgCommitment(Z(b)))}else if("blobToKzgCommitment"in a&&"function"==typeof a.blobToKzgCommitment)return U(a.blobToKzgCommitment(b));if("blobToKZGCommitment"in a&&"function"==typeof a.blobToKZGCommitment)return U(a.blobToKZGCommitment(Z(b)));P(!1,"unsupported KZG library","kzg",a)},computeBlobKzgProof:(b,c)=>"computeBlobProof"in a&&"function"==typeof a.computeBlobProof?U(a.computeBlobProof(Z(b),Z(c))):"computeBlobKzgProof"in a&&"function"==typeof a.computeBlobKzgProof?a.computeBlobKzgProof(b,c):"computeBlobKZGProof"in a&&"function"==typeof a.computeBlobKZGProof?U(a.computeBlobKZGProof(Z(b),Z(c))):void P(!1,"unsupported KZG library","kzg",a)}}get blobWrapperVersion(){return this.#au}set blobWrapperVersion(a){this.#au=a}constructor(){this.#ae=null,this.#af=null,this.#ag=0,this.#ah=fT,this.#ai=null,this.#aj=null,this.#ak=null,this.#b="0x",this.#al=fT,this.#am=fT,this.#an=null,this.#ao=null,this.#ap=null,this.#aq=null,this.#ar=null,this.#as=null,this.#at=null,this.#au=null}get hash(){return null==this.signature?null:a4(this.#av(!0,!1))}get unsignedHash(){return a4(this.unsignedSerialized)}get from(){var a,b,c;return null==this.signature?null:(a=this.unsignedHash,b=this.signature.getCanonical(),ba(a4("0x"+("string"==typeof(c=fL.recoverPublicKey(a,b))?fL.computePublicKey(c,!1):c.publicKey).substring(4)).substring(26)))}get fromPublicKey(){return null==this.signature?null:fL.recoverPublicKey(this.unsignedHash,this.signature.getCanonical())}isSigned(){return null!=this.signature}#av(a,b){O(!a||null!=this.signature,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});let c=a?this.signature:null;switch(this.inferType()){case 0:return function(a,b){let c=[f3(a.nonce,"nonce"),f3(a.gasPrice||0,"gasPrice"),f3(a.gasLimit,"gasLimit"),a.to||"0x",f3(a.value,"value"),a.data],d=fT;if(a.chainId!=fT)d=ah(a.chainId,"tx.chainId"),P(!b||null==b.networkV||b.legacyChainId===d,"tx.chainId/sig.v mismatch","sig",b);else if(a.signature){let b=a.signature.legacyChainId;null!=b&&(d=b)}if(!b)return d!==fT&&(c.push(an(d)),c.push("0x"),c.push("0x")),fS(c);let e=BigInt(27+b.yParity);return d!==fT?e=cV.getChainIdV(d,b.v):BigInt(b.v)!==e&&P(!1,"tx.chainId/sig.v mismatch","sig",b),c.push(an(e)),c.push(an(b.r)),c.push(an(b._s)),fS(c)}(this,c);case 1:let d;return d=[f3(this.chainId,"chainId"),f3(this.nonce,"nonce"),f3(this.gasPrice||0,"gasPrice"),f3(this.gasLimit,"gasLimit"),this.to||"0x",f3(this.value,"value"),this.data,f4(this.accessList||[])],c&&(d.push(f3(c.yParity,"recoveryParam")),d.push(an(c.r)),d.push(an(c.s))),$(["0x01",fS(d)]);case 2:let e;return e=[f3(this.chainId,"chainId"),f3(this.nonce,"nonce"),f3(this.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),f3(this.maxFeePerGas||0,"maxFeePerGas"),f3(this.gasLimit,"gasLimit"),this.to||"0x",f3(this.value,"value"),this.data,f4(this.accessList||[])],c&&(e.push(f3(c.yParity,"yParity")),e.push(an(c.r)),e.push(an(c.s))),$(["0x02",fS(e)]);case 3:return function(a,b,c){let d=[f3(a.chainId,"chainId"),f3(a.nonce,"nonce"),f3(a.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),f3(a.maxFeePerGas||0,"maxFeePerGas"),f3(a.gasLimit,"gasLimit"),a.to||dc,f3(a.value,"value"),a.data,f4(a.accessList||[]),f3(a.maxFeePerBlobGas||0,"maxFeePerBlobGas"),function(a,b){P(Array.isArray(a),`invalid ${b}`,"value",a);for(let b=0;b<a.length;b++)P(W(a[b],32),"invalid ${ param } hash",`value[${b}]`,a[b]);return a}(a.blobVersionedHashes||[],"blobVersionedHashes")];if(b&&(d.push(f3(b.yParity,"yParity")),d.push(an(b.r)),d.push(an(b.s)),c)){if(null!=a.blobWrapperVersion){let b=an(a.blobWrapperVersion),e=[];for(let{proof:a}of c){let b=U(a),c=b.length/128;for(let a=0;a<b.length;a+=c)e.push(b.subarray(a,a+c))}return $(["0x03",fS([d,b,c.map(a=>a.data),c.map(a=>a.commitment),e])])}return $(["0x03",fS([d,c.map(a=>a.data),c.map(a=>a.commitment),c.map(a=>a.proof)])])}return $(["0x03",fS(d)])}(this,c,b?this.blobs:null);case 4:let f=[f3(this.chainId,"chainId"),f3(this.nonce,"nonce"),f3(this.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),f3(this.maxFeePerGas||0,"maxFeePerGas"),f3(this.gasLimit,"gasLimit"),this.to||"0x",f3(this.value,"value"),this.data,f4(this.accessList||[]),(this.authorizationList||[]).map(a=>[f3(a.chainId,"chainId"),a.address,f3(a.nonce,"nonce"),f3(a.signature.yParity,"yParity"),an(a.signature.r),an(a.signature._s)])];return c&&(f.push(f3(c.yParity,"yParity")),f.push(an(c.r)),f.push(an(c.s))),$(["0x04",fS(f)])}O(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get serialized(){return this.#av(!0,!0)}get unsignedSerialized(){return this.#av(!1,!1)}inferType(){let a=this.inferTypes();return a.indexOf(2)>=0?2:a.pop()}inferTypes(){let a=null!=this.gasPrice,b=null!=this.maxFeePerGas||null!=this.maxPriorityFeePerGas,c=null!=this.accessList,d=null!=this.#ap||this.#aq;null!=this.maxFeePerGas&&null!=this.maxPriorityFeePerGas&&O(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),O(!b||0!==this.type&&1!==this.type,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),O(0!==this.type||!c,"legacy transaction cannot have accessList","BAD_DATA",{value:this});let e=[];return null!=this.type?e.push(this.type):this.authorizationList&&this.authorizationList.length?e.push(4):b?e.push(2):a?(e.push(1),c||e.push(0)):c?(e.push(1),e.push(2)):(d&&this.to||(e.push(0),e.push(1),e.push(2)),e.push(3)),e.sort(),e}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}clone(){return f6.from(this)}toJSON(){let a=a=>null==a?null:a.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:a(this.gasLimit),gasPrice:a(this.gasPrice),maxPriorityFeePerGas:a(this.maxPriorityFeePerGas),maxFeePerGas:a(this.maxFeePerGas),value:a(this.value),chainId:a(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}[fZ](){return this.toString()}toString(){let a=[],b=b=>{let c=this[b];"string"==typeof c&&(c=JSON.stringify(c)),a.push(`${b}: ${c}`)};this.type&&b("type"),b("to"),b("data"),b("nonce"),b("gasLimit"),b("value"),null!=this.chainId&&b("chainId"),this.signature&&(b("from"),a.push(`signature: ${this.signature.toString()}`));let c=this.authorizationList;if(c){let b=[];for(let a of c){let c=[];c.push(`address: ${JSON.stringify(a.address)}`),null!=a.nonce&&c.push(`nonce: ${a.nonce}`),null!=a.chainId&&c.push(`chainId: ${a.chainId}`),a.signature&&c.push(`signature: ${a.signature.toString()}`),b.push(`Authorization { ${c.join(", ")} }`)}a.push(`authorizations: [ ${b.join(", ")} ]`)}return`Transaction { ${a.join(", ")} }`}static from(a){if(null==a)return new f6;if("string"==typeof a){let b=U(a);if(b[0]>=127)return f6.from(function(a){let b=fP(a);P(Array.isArray(b)&&(9===b.length||6===b.length),"invalid field count for legacy transaction","data",a);let c={type:0,nonce:f1(b[0],"nonce"),gasPrice:f2(b[1],"gasPrice"),gasLimit:f2(b[2],"gasLimit"),to:f_(b[3]),value:f2(b[4],"value"),data:Z(b[5]),chainId:fT};if(6===b.length)return c;let d=f2(b[6],"v"),e=f2(b[7],"r"),f=f2(b[8],"s");if(e===fT&&f===fT)c.chainId=d;else{let a=(d-fX)/fU;a<fT&&(a=fT),c.chainId=a,P(a!==fT||d===fV||d===fW,"non-canonical legacy v","v",b[6]),c.signature=cV.from({r:ac(b[7],32),s:ac(b[8],32),v:d})}return c}(b));switch(b[0]){case 1:let c,d;return f6.from((P(Array.isArray(c=fP(U(b).slice(1)))&&(8===c.length||11===c.length),"invalid field count for transaction type: 1","data",Z(b)),d={type:1,chainId:f2(c[0],"chainId"),nonce:f1(c[1],"nonce"),gasPrice:f2(c[2],"gasPrice"),gasLimit:f2(c[3],"gasLimit"),to:f_(c[4]),value:f2(c[5],"value"),data:Z(c[6]),accessList:f0(c[7],"accessList")},8===c.length||f5(d,c.slice(8)),d));case 2:let e,f;return f6.from((P(Array.isArray(e=fP(U(b).slice(1)))&&(9===e.length||12===e.length),"invalid field count for transaction type: 2","data",Z(b)),f={type:2,chainId:f2(e[0],"chainId"),nonce:f1(e[1],"nonce"),maxPriorityFeePerGas:f2(e[2],"maxPriorityFeePerGas"),maxFeePerGas:f2(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:f2(e[4],"gasLimit"),to:f_(e[5]),value:f2(e[6],"value"),data:Z(e[7]),accessList:f0(e[8],"accessList")},9===e.length||f5(f,e.slice(9)),f));case 3:return f6.from(function(a){let b=fP(U(a).slice(1)),c="3",d=null,e=null;if(4===b.length&&Array.isArray(b[0])){c="3 (network format)";let a=b[1],d=b[2],f=b[3];P(Array.isArray(a),"invalid network format: blobs not an array","fields[1]",a),P(Array.isArray(d),"invalid network format: commitments not an array","fields[2]",d),P(Array.isArray(f),"invalid network format: proofs not an array","fields[3]",f),P(a.length===d.length,"invalid network format: blobs/commitments length mismatch","fields",b),P(a.length===f.length,"invalid network format: blobs/proofs length mismatch","fields",b),e=[];for(let c=0;c<b[1].length;c++)e.push({data:a[c],commitment:d[c],proof:f[c]});b=b[0]}else if(5===b.length&&Array.isArray(b[0])){c="3 (EIP-7594 network format)",d=al(b[1]);let a=b[2],f=b[3],g=b[4];P(1===d,`unsupported EIP-7594 network format version: ${d}`,"fields[1]",d),P(Array.isArray(a),"invalid EIP-7594 network format: blobs not an array","fields[2]",a),P(Array.isArray(f),"invalid EIP-7594 network format: commitments not an array","fields[3]",f),P(Array.isArray(g),"invalid EIP-7594 network format: proofs not an array","fields[4]",g),P(a.length===f.length,"invalid network format: blobs/commitments length mismatch","fields",b),P(128*a.length===g.length,"invalid network format: blobs/proofs length mismatch","fields",b),e=[];for(let b=0;b<a.length;b++){let c=[];for(let a=0;a<128;a++)c.push(g[128*b+a]);e.push({data:a[b],commitment:f[b],proof:$(c)})}b=b[0]}P(Array.isArray(b)&&(11===b.length||14===b.length),`invalid field count for transaction type: ${c}`,"data",Z(a));let f={type:3,chainId:f2(b[0],"chainId"),nonce:f1(b[1],"nonce"),maxPriorityFeePerGas:f2(b[2],"maxPriorityFeePerGas"),maxFeePerGas:f2(b[3],"maxFeePerGas"),gasPrice:null,gasLimit:f2(b[4],"gasLimit"),to:f_(b[5]),value:f2(b[6],"value"),data:Z(b[7]),accessList:f0(b[8],"accessList"),maxFeePerBlobGas:f2(b[9],"maxFeePerBlobGas"),blobVersionedHashes:b[10],blobWrapperVersion:d};e&&(f.blobs=e),P(null!=f.to,`invalid address for transaction type: ${c}`,"data",a),P(Array.isArray(f.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",a);for(let b=0;b<f.blobVersionedHashes.length;b++)P(W(f.blobVersionedHashes[b],32),`invalid blobVersionedHash at index ${b}: must be length 32`,"data",a);return 11===b.length||f5(f,b.slice(11)),f}(b));case 4:let g,h;return f6.from((P(Array.isArray(g=fP(U(b).slice(1)))&&(10===g.length||13===g.length),"invalid field count for transaction type: 4","data",Z(b)),h={type:4,chainId:f2(g[0],"chainId"),nonce:f1(g[1],"nonce"),maxPriorityFeePerGas:f2(g[2],"maxPriorityFeePerGas"),maxFeePerGas:f2(g[3],"maxFeePerGas"),gasPrice:null,gasLimit:f2(g[4],"gasLimit"),to:f_(g[5]),value:f2(g[6],"value"),data:Z(g[7]),accessList:f0(g[8],"accessList"),authorizationList:function(a,b){try{if(!Array.isArray(a))throw Error("authorizationList: invalid array");let b=[];for(let c=0;c<a.length;c++){let d=a[c];if(!Array.isArray(d))throw Error(`authorization[${c}]: invalid array`);if(6!==d.length)throw Error(`authorization[${c}]: wrong length`);if(!d[1])throw Error(`authorization[${c}]: null address`);b.push({address:f_(d[1]),nonce:f2(d[2],"nonce"),chainId:f2(d[0],"chainId"),signature:cV.from({yParity:f1(d[3],"yParity"),r:ac(d[4],32),s:ac(d[5],32)})})}return b}catch(c){P(!1,c.message,b,a)}}(g[9],"authorizationList")},10===g.length||f5(h,g.slice(10)),h))}O(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}let b=new f6;return null!=a.type&&(b.type=a.type),null!=a.to&&(b.to=a.to),null!=a.nonce&&(b.nonce=a.nonce),null!=a.gasLimit&&(b.gasLimit=a.gasLimit),null!=a.gasPrice&&(b.gasPrice=a.gasPrice),null!=a.maxPriorityFeePerGas&&(b.maxPriorityFeePerGas=a.maxPriorityFeePerGas),null!=a.maxFeePerGas&&(b.maxFeePerGas=a.maxFeePerGas),null!=a.maxFeePerBlobGas&&(b.maxFeePerBlobGas=a.maxFeePerBlobGas),null!=a.data&&(b.data=a.data),null!=a.value&&(b.value=a.value),null!=a.chainId&&(b.chainId=a.chainId),null!=a.signature&&(b.signature=cV.from(a.signature)),null!=a.accessList&&(b.accessList=a.accessList),null!=a.authorizationList&&(b.authorizationList=a.authorizationList),null!=a.blobVersionedHashes&&(b.blobVersionedHashes=a.blobVersionedHashes),null!=a.kzg&&(b.kzg=a.kzg),null!=a.blobWrapperVersion&&(b.blobWrapperVersion=a.blobWrapperVersion),null!=a.blobs&&(b.blobs=a.blobs),null!=a.hash&&(P(b.isSigned(),"unsigned transaction cannot define '.hash'","tx",a),P(b.hash===a.hash,"hash mismatch","tx",a)),null!=a.from&&(P(b.isSigned(),"unsigned transaction cannot define '.from'","tx",a),P(b.from.toLowerCase()===(a.from||"").toLowerCase(),"from mismatch","tx",a)),b}}let f7="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);let f8=BigInt(58);function f9(a){return a.match(/^ipfs:\/\/ipfs\//i)?a=a.substring(12):a.match(/^ipfs:\/\//i)?a=a.substring(7):P(!1,"unsupported IPFS format","link",a),`https://gateway.ipfs.io/ipfs/${a}`}class ga{name;constructor(a){J(this,{name:a})}connect(a){return this}supportsCoinType(a){return!1}async encodeAddress(a,b){throw Error("unsupported coin")}async decodeAddress(a,b){throw Error("unsupported coin")}}let gb=RegExp("^(ipfs)://(.*)$","i"),gc=[RegExp("^(https)://(.*)$","i"),RegExp("^(data):(.*)$","i"),gb,RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];class gd{provider;address;name;#aw;#ax;constructor(a,b,c){J(this,{provider:a,address:b,name:c}),this.#aw=null,this.#ax=new d$(b,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],a)}async supportsWildcard(){return null==this.#aw&&(this.#aw=(async()=>{try{return await this.#ax.supportsInterface("0x9061b923")}catch(a){if(L(a,"CALL_EXCEPTION"))return!1;throw this.#aw=null,a}})()),await this.#aw}async #ay(a,b){b=(b||[]).slice();let c=this.#ax.interface;b.unshift(eu(this.name));let d=null;if(await this.supportsWildcard()){var e;O(d=c.getFunction(a),"missing fragment","UNKNOWN_ERROR",{info:{funcName:a}}),b=[(e=this.name,P(true,"DNS encoded label cannot exceed 255","length",255),Z($(et(e).map(a=>{P(a.length<=255,`label ${JSON.stringify(e)} exceeds 255 bytes`,"name",e);let b=new Uint8Array(a.length+1);return b.set(a,1),b[0]=b.length-1,b})))+"00"),c.encodeFunctionData(d,b)],a="resolve(bytes,bytes)"}b.push({enableCcipRead:!0});try{let e=await this.#ax[a](...b);if(d)return c.decodeFunctionResult(d,e)[0];return e}catch(a){if(!L(a,"CALL_EXCEPTION"))throw a}return null}async getAddress(a){if(null==a&&(a=60),60===a)try{let a=await this.#ay("addr(bytes32)");if(null==a||a===dc)return null;return a}catch(a){if(L(a,"CALL_EXCEPTION"))return null;throw a}if(a>=0&&a<0x80000000){let b=a+0x80000000,c=await this.#ay("addr(bytes32,uint)",[b]);if(W(c,20))return ba(c)}let b=null;for(let c of this.provider.plugins)if(c instanceof ga&&c.supportsCoinType(a)){b=c;break}if(null==b)return null;let c=await this.#ay("addr(bytes32,uint)",[a]);if(null==c||"0x"===c)return null;let d=await b.decodeAddress(a,c);if(null!=d)return d;O(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${a})`,info:{coinType:a,data:c}})}async getText(a){let b=await this.#ay("text(bytes32,string)",[a]);return null==b||"0x"===b?null:b}async getContentHash(){let a=await this.#ay("contenthash(bytes32)");if(null==a||"0x"===a)return null;let b=a.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(b){let a="e3010170"===b[1]?"ipfs":"ipns",c=parseInt(b[4],16);if(b[5].length===2*c)return`${a}://${function(a){let b=U(a),c=ak(b),d="";for(;c;)d=f7[Number(c%f8)]+d,c/=f8;for(let a=0;a<b.length&&!b[a];a++)d=f7[0]+d;return d}("0x"+b[2])}`}let c=a.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(c&&64===c[1].length)return`bzz://${c[1]}`;O(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:a}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){let a=[{type:"name",value:this.name}];try{let b=await this.getText("avatar");if(null==b)return a.push({type:"!avatar",value:""}),{url:null,linkage:a};a.push({type:"avatar",value:b});for(let c=0;c<gc.length;c++){let d=b.match(gc[c]);if(null==d)continue;let e=d[1].toLowerCase();switch(e){case"https":case"data":return a.push({type:"url",value:b}),{linkage:a,url:b};case"ipfs":{let c=f9(b);return a.push({type:"ipfs",value:b}),a.push({type:"url",value:c}),{linkage:a,url:c}}case"erc721":case"erc1155":{let c="erc721"===e?"tokenURI(uint256)":"uri(uint256)";a.push({type:e,value:b});let f=await this.getAddress();if(null==f)return a.push({type:"!owner",value:""}),{url:null,linkage:a};let g=(d[2]||"").split("/");if(2!==g.length)return a.push({type:`!${e}caip`,value:d[2]||""}),{url:null,linkage:a};let h=g[1],i=new d$(g[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if("erc721"===e){let b=await i.ownerOf(h);if(f!==b)return a.push({type:"!owner",value:b}),{url:null,linkage:a};a.push({type:"owner",value:b})}else if("erc1155"===e){let b=await i.balanceOf(f,h);if(!b)return a.push({type:"!balance",value:"0"}),{url:null,linkage:a};a.push({type:"balance",value:b.toString()})}let j=await i[c](h);if(null==j||"0x"===j)return a.push({type:"!metadata-url",value:""}),{url:null,linkage:a};a.push({type:"metadata-url-base",value:j}),"erc1155"===e&&(j=j.replace("{id}",am(h,32).substring(2)),a.push({type:"metadata-url-expanded",value:j})),j.match(/^ipfs:/i)&&(j=f9(j)),a.push({type:"metadata-url",value:j});let k={},l=await new c9(j).send();l.assertOk();try{k=l.bodyJson}catch(b){try{a.push({type:"!metadata",value:l.bodyText})}catch(c){let b=l.body;b&&a.push({type:"!metadata",value:Z(b)})}return{url:null,linkage:a}}if(!k)return a.push({type:"!metadata",value:""}),{url:null,linkage:a};a.push({type:"metadata",value:JSON.stringify(k)});let m=k.image;if("string"!=typeof m)return a.push({type:"!imageUrl",value:""}),{url:null,linkage:a};if(m.match(/^(https:\/\/|data:)/i));else{let b=m.match(gb);if(null==b)return a.push({type:"!imageUrl-ipfs",value:m}),{url:null,linkage:a};a.push({type:"imageUrl-ipfs",value:m}),m=f9(m)}return a.push({type:"url",value:m}),{linkage:a,url:m}}}}}catch(a){}return{linkage:a,url:null}}static async getEnsAddress(a){let b=await a.getNetwork(),c=b.getPlugin("org.ethers.plugins.network.Ens");return O(c,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:b}}),c.address}static async #az(a,b){let c=await gd.getEnsAddress(a);try{let d=new d$(c,["function resolver(bytes32) view returns (address)"],a),e=await d.resolver(eu(b),{enableCcipRead:!0});if(e===dc)return null;return e}catch(a){throw a}}static async fromName(a,b){let c=b;for(;;){if(""===c||"."===c||"eth"!==b&&"eth"===c)return null;let d=await gd.#az(a,c);if(null!=d){let e=new gd(a,d,b);if(c!==b&&!await e.supportsWildcard())return null;return e}c=c.split(".").slice(1).join(".")}}}let ge=BigInt(0);function gf(a,b){return function(c){return null==c?b:a(c)}}function gg(a,b){return c=>{if(b&&null==c)return null;if(!Array.isArray(c))throw Error("not an array");return c.map(b=>a(b))}}function gh(a,b){return c=>{let d={};for(let e in a){let f=e;if(b&&e in b&&!(f in c)){for(let a of b[e])if(a in c){f=a;break}}try{let b=a[e](c[f]);void 0!==b&&(d[e]=b)}catch(b){let a=b instanceof Error?b.message:"not-an-error";O(!1,`invalid value for value.${e} (${a})`,"BAD_DATA",{value:c})}}return d}}function gi(a){return P(W(a,!0),"invalid data","value",a),a}function gj(a){return P(W(a,32),"invalid hash","value",a),a}let gk=gh({address:ba,blockHash:gj,blockNumber:al,data:gi,index:al,removed:gf(function(a){switch(a){case!0:case"true":return!0;case!1:case"false":return!1}P(!1,`invalid boolean; ${JSON.stringify(a)}`,"value",a)},!1),topics:gg(gj),transactionHash:gj,transactionIndex:al},{index:["logIndex"]}),gl=gh({hash:gf(gj),parentHash:gj,parentBeaconBlockRoot:gf(gj,null),number:al,timestamp:al,nonce:gf(gi),difficulty:ah,gasLimit:ah,gasUsed:ah,stateRoot:gf(gj,null),receiptsRoot:gf(gj,null),blobGasUsed:gf(ah,null),excessBlobGas:gf(ah,null),miner:gf(ba),prevRandao:gf(gj,null),extraData:gi,baseFeePerGas:gf(ah)},{prevRandao:["mixHash"]}),gm=gh({transactionIndex:al,blockNumber:al,transactionHash:gj,address:ba,topics:gg(gj),data:gi,index:al,blockHash:gj},{index:["logIndex"]}),gn=gh({to:gf(ba,null),from:gf(ba,null),contractAddress:gf(ba,null),index:al,root:gf(Z),gasUsed:ah,blobGasUsed:gf(ah,null),logsBloom:gf(gi),blockHash:gj,hash:gj,logs:gg(function(a){return gm(a)}),blockNumber:al,cumulativeGasUsed:ah,effectiveGasPrice:gf(ah),blobGasPrice:gf(ah,null),status:gf(al),type:gf(al,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function go(a){let b,c;a.to&&ah(a.to)===ge&&(a.to="0x0000000000000000000000000000000000000000");let d=gh({hash:gj,index:gf(al,void 0),type:a=>"0x"===a||null==a?0:al(a),accessList:gf(cI,null),blobVersionedHashes:gf(gg(gj,!0),null),authorizationList:gf(gg(a=>{let b;if(a.signature)b=a.signature;else{let c=a.yParity;"0x1b"===c?c=0:"0x1c"===c&&(c=1),b=Object.assign({},a,{yParity:c})}return{address:ba(a.address),chainId:ah(a.chainId),nonce:ah(a.nonce),signature:cV.from(b)}},!1),null),blockHash:gf(gj,null),blockNumber:gf(al,null),transactionIndex:gf(al,null),from:ba,gasPrice:gf(ah),maxPriorityFeePerGas:gf(ah),maxFeePerGas:gf(ah),maxFeePerBlobGas:gf(ah,null),gasLimit:ah,to:gf(ba,null),value:ah,nonce:al,data:gi,creates:gf(ba,null),chainId:gf(ah,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(a);if(null==d.to&&null==d.creates&&(b=ba(d.from),d.creates=ba(aa(a4(fS([b,c="0"===(c=ah(d.nonce,"tx.nonce").toString(16))?"0x":c.length%2?"0x0"+c:"0x"+c])),12))),(1===a.type||2===a.type)&&null==a.accessList&&(d.accessList=[]),a.signature?d.signature=cV.from(a.signature):d.signature=cV.from(a),null==d.chainId){let a=d.signature.legacyChainId;null!=a&&(d.chainId=a)}return d.blockHash&&ah(d.blockHash)===ge&&(d.blockHash=null),d}class gp{name;constructor(a){J(this,{name:a})}clone(){return new gp(this.name)}}class gq extends gp{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(a,b){null==a&&(a=0),super(`org.ethers.network.plugins.GasCost#${a||0}`);const c={effectiveBlock:a};function d(a,d){let e=(b||{})[a];null==e&&(e=d),P("number"==typeof e,`invalud value for ${a}`,"costs",b),c[a]=e}d("txBase",21e3),d("txCreate",32e3),d("txDataZero",4),d("txDataNonzero",16),d("txAccessListStorageKey",1900),d("txAccessListAddress",2400),J(this,c)}clone(){return new gq(this.effectiveBlock,this)}}class gr extends gp{address;targetNetwork;constructor(a,b){super("org.ethers.plugins.network.Ens"),J(this,{address:a||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",targetNetwork:null==b?1:b})}clone(){return new gr(this.address,this.targetNetwork)}}class gs extends gp{#E;#aA;get url(){return this.#E}get processFunc(){return this.#aA}constructor(a,b){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#E=a,this.#aA=b}clone(){return this}}let gt=new Map;class gu{#aB;#am;#aC;constructor(a,b){this.#aB=a,this.#am=ah(b),this.#aC=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#aB}set name(a){this.#aB=a}get chainId(){return this.#am}set chainId(a){this.#am=ah(a,"chainId")}matches(a){if(null==a)return!1;if("string"==typeof a){try{return this.chainId===ah(a)}catch(a){}return this.name===a}if("number"==typeof a||"bigint"==typeof a){try{return this.chainId===ah(a)}catch(a){}return!1}if("object"==typeof a){if(null!=a.chainId){try{return this.chainId===ah(a.chainId)}catch(a){}return!1}if(null!=a.name)return this.name===a.name}return!1}get plugins(){return Array.from(this.#aC.values())}attachPlugin(a){if(this.#aC.get(a.name))throw Error(`cannot replace existing plugin: ${a.name} `);return this.#aC.set(a.name,a.clone()),this}getPlugin(a){return this.#aC.get(a)||null}getPlugins(a){return this.plugins.filter(b=>b.name.split("#")[0]===a)}clone(){let a=new gu(this.name,this.chainId);return this.plugins.forEach(b=>{a.attachPlugin(b.clone())}),a}computeIntrinsicGas(a){let b=this.getPlugin("org.ethers.plugins.network.GasCost")||new gq,c=b.txBase;if(null==a.to&&(c+=b.txCreate),a.data)for(let d=2;d<a.data.length;d+=2)"00"===a.data.substring(d,d+2)?c+=b.txDataZero:c+=b.txDataNonzero;if(a.accessList){let d=cI(a.accessList);for(let a in d)c+=b.txAccessListAddress+b.txAccessListStorageKey*d[a].storageKeys.length}return c}static from(a){if(function(){gx||(gx=!0,a("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),a("ropsten",3,{ensNetwork:3}),a("rinkeby",4,{ensNetwork:4}),a("goerli",5,{ensNetwork:5}),a("kovan",42,{ensNetwork:42}),a("sepolia",0xaa36a7,{ensNetwork:0xaa36a7}),a("holesky",17e3,{ensNetwork:17e3}),a("classic",61,{}),a("classicKotti",6,{}),a("arbitrum",42161,{ensNetwork:1}),a("arbitrum-goerli",421613,{}),a("arbitrum-sepolia",421614,{}),a("base",8453,{ensNetwork:1}),a("base-goerli",84531,{}),a("base-sepolia",84532,{}),a("bnb",56,{ensNetwork:1}),a("bnbt",97,{}),a("filecoin",314,{}),a("filecoin-calibration",314159,{}),a("linea",59144,{ensNetwork:1}),a("linea-goerli",59140,{}),a("linea-sepolia",59141,{}),a("matic",137,{ensNetwork:1,plugins:[gw("https://gasstation.polygon.technology/v2")]}),a("matic-amoy",80002,{}),a("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[gw("https://gasstation-testnet.polygon.technology/v2")]}),a("optimism",10,{ensNetwork:1,plugins:[]}),a("optimism-goerli",420,{}),a("optimism-sepolia",0xaa37dc,{}),a("xdai",100,{ensNetwork:1}));function a(a,b,c){let d=function(){let d=new gu(a,b);return null!=c.ensNetwork&&d.attachPlugin(new gr(null,c.ensNetwork)),d.attachPlugin(new gq),(c.plugins||[]).forEach(a=>{d.attachPlugin(a)}),d};gu.register(a,d),gu.register(b,d),c.altNames&&c.altNames.forEach(a=>{gu.register(a,d)})}}(),null==a)return gu.from("mainnet");if("number"==typeof a&&(a=BigInt(a)),"string"==typeof a||"bigint"==typeof a){let b=gt.get(a);if(b)return b();if("bigint"==typeof a)return new gu("unknown",a);P(!1,"unknown network","network",a)}if("function"==typeof a.clone)return a.clone();if("object"==typeof a){P("string"==typeof a.name&&"number"==typeof a.chainId,"invalid network object name or chainId","network",a);let b=new gu(a.name,a.chainId);return(a.ensAddress||null!=a.ensNetwork)&&b.attachPlugin(new gr(a.ensAddress,a.ensNetwork)),b}P(!1,"invalid network","network",a)}static register(a,b){"number"==typeof a&&(a=BigInt(a));let c=gt.get(a);c&&P(!1,`conflicting network for ${JSON.stringify(c.name)}`,"nameOrChainId",a),gt.set(a,b)}}function gv(a,b){let c=String(a);if(!c.match(/^[0-9.]+$/))throw Error(`invalid gwei value: ${a}`);let d=c.split(".");if(1===d.length&&d.push(""),2!==d.length)throw Error(`invalid gwei value: ${a}`);for(;d[1].length<b;)d[1]+="0";if(d[1].length>9){let a=BigInt(d[1].substring(0,9));!d[1].substring(9).match(/^0+$/)&&a++,d[1]=a.toString()}return BigInt(d[0]+d[1])}function gw(a){return new gs(a,async(a,b,c)=>{let d;c.setHeader("User-Agent","ethers");try{let[b,e]=await Promise.all([c.send(),a()]),f=(d=b).bodyJson.standard;return{gasPrice:e.gasPrice,maxFeePerGas:gv(f.maxFee,9),maxPriorityFeePerGas:gv(f.maxPriorityFee,9)}}catch(a){O(!1,`error encountered with polygon gas station (${JSON.stringify(c.url)})`,"SERVER_ERROR",{request:c,response:d,error:a})}})}let gx=!1;function gy(a){return JSON.parse(JSON.stringify(a))}class gz{#aD;#aE;#aF;#aG;constructor(a){this.#aD=a,this.#aE=null,this.#aF=4e3,this.#aG=-2}get pollingInterval(){return this.#aF}set pollingInterval(a){this.#aF=a}async #aH(){try{let a=await this.#aD.getBlockNumber();if(-2===this.#aG){this.#aG=a;return}if(a!==this.#aG){for(let b=this.#aG+1;b<=a;b++){if(null==this.#aE)return;await this.#aD.emit("block",b)}this.#aG=a}}catch(a){}null!=this.#aE&&(this.#aE=this.#aD._setTimeout(this.#aH.bind(this),this.#aF))}start(){this.#aE||(this.#aE=this.#aD._setTimeout(this.#aH.bind(this),this.#aF),this.#aH())}stop(){this.#aE&&(this.#aD._clearTimeout(this.#aE),this.#aE=null)}pause(a){this.stop(),a&&(this.#aG=-2)}resume(){this.start()}}class gA{#aD;#aH;#aI;constructor(a){this.#aD=a,this.#aI=!1,this.#aH=a=>{this._poll(a,this.#aD)}}async _poll(a,b){throw Error("sub-classes must override this")}start(){this.#aI||(this.#aI=!0,this.#aH(-2),this.#aD.on("block",this.#aH))}stop(){this.#aI&&(this.#aI=!1,this.#aD.off("block",this.#aH))}pause(a){this.stop()}resume(){this.start()}}class gB extends gA{#aJ;#aK;constructor(a,b){super(a),this.#aJ=b,this.#aK=-2}pause(a){a&&(this.#aK=-2),super.pause(a)}async _poll(a,b){let c=await b.getBlock(this.#aJ);null!=c&&(-2===this.#aK?this.#aK=c.number:c.number>this.#aK&&(b.emit(this.#aJ,c.number),this.#aK=c.number))}}class gC extends gA{#ac;constructor(a,b){super(a),this.#ac=gy(b)}async _poll(a,b){throw Error("@TODO")}}class gD extends gA{#aL;constructor(a,b){super(a),this.#aL=b}async _poll(a,b){let c=await b.getTransactionReceipt(this.#aL);c&&b.emit(this.#aL,c)}}class gE{#aD;#ac;#aE;#aI;#aG;constructor(a,b){this.#aD=a,this.#ac=gy(b),this.#aE=this.#aH.bind(this),this.#aI=!1,this.#aG=-2}async #aH(a){if(-2===this.#aG)return;let b=gy(this.#ac);b.fromBlock=this.#aG+1,b.toBlock=a;let c=await this.#aD.getLogs(b);if(0===c.length){this.#aG<a-60&&(this.#aG=a-60);return}for(let a of c)this.#aD.emit(this.#ac,a),this.#aG=a.blockNumber}start(){this.#aI||(this.#aI=!0,-2===this.#aG&&this.#aD.getBlockNumber().then(a=>{this.#aG=a}),this.#aD.on("block",this.#aE))}stop(){this.#aI&&(this.#aI=!1,this.#aD.off("block",this.#aE))}pause(a){this.stop(),a&&(this.#aG=-2)}resume(){this.start()}}let gF=BigInt(2);function gG(a){return a&&"function"==typeof a.then}function gH(a,b){return a+":"+JSON.stringify(b,(a,b)=>{if(null==b)return"null";if("bigint"==typeof b)return`bigint:${b.toString()}`;if("string"==typeof b)return b.toLowerCase();if("object"==typeof b&&!Array.isArray(b)){let a=Object.keys(b);return a.sort(),a.reduce((a,c)=>(a[c]=b[c],a),{})}return b})}class gI{name;constructor(a){J(this,{name:a})}start(){}stop(){}pause(a){}resume(){}}function gJ(a){return(a=Array.from(new Set(a).values())).sort(),a}async function gK(a,b){if(null==a)throw Error("invalid event");if(Array.isArray(a)&&(a={topics:a}),"string"==typeof a)switch(a){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:a,tag:a}}if(W(a,32)){let b=a.toLowerCase();return{type:"transaction",tag:gH("tx",{hash:b}),hash:b}}if(a.orphan){let b=a;return{type:"orphan",tag:gH("orphan",b),filter:JSON.parse(JSON.stringify(b))}}if(a.address||a.topics){let c=a,d={topics:(c.topics||[]).map(a=>null==a?null:Array.isArray(a)?gJ(a.map(a=>a.toLowerCase())):a.toLowerCase())};if(c.address){let a=[],e=[],f=c=>{W(c)?a.push(c):e.push((async()=>{a.push(await cr(c,b))})())};Array.isArray(c.address)?c.address.forEach(f):f(c.address),e.length&&await Promise.all(e),d.address=gJ(a.map(a=>a.toLowerCase()))}return{filter:d,tag:gH("event",d),type:"event"}}P(!1,"unknown ProviderEvent","event",a)}function gL(){return new Date().getTime()}let gM={cacheTimeout:250,pollingInterval:4e3};class gN{#aM;#aC;#aN;#aO;#aP;#aQ;#aR;#aS;#aT;#aU;#aV;#k;constructor(a,b){if(this.#k=Object.assign({},gM,b||{}),"any"===a)this.#aQ=!0,this.#aP=null;else if(a){const b=gu.from(a);this.#aQ=!1,this.#aP=Promise.resolve(b),setTimeout(()=>{this.emit("network",b,null)},0)}else this.#aQ=!1,this.#aP=null;this.#aS=-1,this.#aR=new Map,this.#aM=new Map,this.#aC=new Map,this.#aN=null,this.#aO=!1,this.#aT=1,this.#aU=new Map,this.#aV=!1}get pollingInterval(){return this.#k.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#aC.values())}attachPlugin(a){if(this.#aC.get(a.name))throw Error(`cannot replace existing plugin: ${a.name} `);return this.#aC.set(a.name,a.connect(this)),this}getPlugin(a){return this.#aC.get(a)||null}get disableCcipRead(){return this.#aV}set disableCcipRead(a){this.#aV=!!a}async #aW(a){let b=this.#k.cacheTimeout;if(b<0)return await this._perform(a);let c=gH(a.method,a),d=this.#aR.get(c);return d||(d=this._perform(a),this.#aR.set(c,d),setTimeout(()=>{this.#aR.get(c)===d&&this.#aR.delete(c)},b)),await d}async ccipReadFetch(a,b,c){if(this.disableCcipRead||0===c.length||null==a.to)return null;let d=a.to.toLowerCase(),e=b.toLowerCase(),f=[];for(let b=0;b<c.length;b++){let g,h=c[b],i=new c9(h.replace("{sender}",d).replace("{data}",e));-1===h.indexOf("{data}")&&(i.body={data:e,sender:d}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:i,index:b,urls:c});let j="unknown error";try{g=await i.send()}catch(a){f.push(a.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:i,result:{error:a}});continue}try{let a=g.bodyJson;if(a.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:i,result:a}),a.data;a.message&&(j=a.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:i,result:a})}catch(a){}O(g.statusCode<400||g.statusCode>=500,`response not found during CCIP fetch: ${j}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:a,info:{url:h,errorMessage:j}}),f.push(j)}O(!1,`error encountered during CCIP fetch: ${f.map(a=>JSON.stringify(a)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:a,info:{urls:c,errorMessages:f}})}_wrapBlock(a,b){let c;return new dq(((c=gl(a)).transactions=a.transactions.map(a=>"string"==typeof a?a:go(a)),c),this)}_wrapLog(a,b){return new dr(gk(a),this)}_wrapTransactionReceipt(a,b){return new ds(gn(a),this)}_wrapTransactionResponse(a,b){return new dt(go(a),this)}_detectNetwork(){O(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(a){O(!1,`unsupported method: ${a.method}`,"UNSUPPORTED_OPERATION",{operation:a.method,info:a})}async getBlockNumber(){let a=al(await this.#aW({method:"getBlockNumber"}),"%response");return this.#aS>=0&&(this.#aS=a),a}_getAddress(a){return cr(a,this)}_getBlockTag(a){if(null==a)return"latest";switch(a){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return a}return W(a)?W(a,32)?a:ao(a):("bigint"==typeof a&&(a=al(a,"blockTag")),"number"==typeof a)?a>=0?ao(a):this.#aS>=0?ao(this.#aS+a):this.getBlockNumber().then(b=>ao(b+a)):void P(!1,"invalid blockTag","blockTag",a)}_getFilter(a){let b,c,d=(a.topics||[]).map(a=>null==a?null:Array.isArray(a)?gJ(a.map(a=>a.toLowerCase())):a.toLowerCase()),e="blockHash"in a?a.blockHash:void 0,f=(a,b,c)=>{let f;switch(a.length){case 0:break;case 1:f=a[0];break;default:a.sort(),f=a}if(e&&(null!=b||null!=c))throw Error("invalid filter");let g={};return f&&(g.address=f),d.length&&(g.topics=d),b&&(g.fromBlock=b),c&&(g.toBlock=c),e&&(g.blockHash=e),g},g=[];if(a.address)if(Array.isArray(a.address))for(let b of a.address)g.push(this._getAddress(b));else g.push(this._getAddress(a.address));return"fromBlock"in a&&(b=this._getBlockTag(a.fromBlock)),("toBlock"in a&&(c=this._getBlockTag(a.toBlock)),g.filter(a=>"string"!=typeof a).length||null!=b&&"string"!=typeof b||null!=c&&"string"!=typeof c)?Promise.all([Promise.all(g),b,c]).then(a=>f(a[0],a[1],a[2])):f(g,b,c)}_getTransactionRequest(a){let b=dp(a),c=[];if(["to","from"].forEach(a=>{if(null==b[a])return;let d=cr(b[a],this);gG(d)?c.push(async function(){b[a]=await d}()):b[a]=d}),null!=b.blockTag){let a=this._getBlockTag(b.blockTag);gG(a)?c.push(async function(){b.blockTag=await a}()):b.blockTag=a}return c.length?async function(){return await Promise.all(c),b}():b}async getNetwork(){if(null==this.#aP){let a=(async()=>{try{let a=await this._detectNetwork();return this.emit("network",a,null),a}catch(b){throw this.#aP===a&&(this.#aP=null),b}})();return this.#aP=a,(await a).clone()}let a=this.#aP,[b,c]=await Promise.all([a,this._detectNetwork()]);return b.chainId!==c.chainId&&(this.#aQ?(this.emit("network",c,b),this.#aP===a&&(this.#aP=Promise.resolve(c))):O(!1,`network changed: ${b.chainId} => ${c.chainId} `,"NETWORK_ERROR",{event:"changed"})),b.clone()}async getFeeData(){let a=await this.getNetwork(),b=async()=>{let{_block:b,gasPrice:c,priorityFee:d}=await I({_block:this.#aX("latest",!1),gasPrice:(async()=>{try{let a=await this.#aW({method:"getGasPrice"});return ah(a,"%response")}catch(a){}return null})(),priorityFee:(async()=>{try{let a=await this.#aW({method:"getPriorityFee"});return ah(a,"%response")}catch(a){}return null})()}),e=null,f=null,g=this._wrapBlock(b,a);return g&&g.baseFeePerGas&&(f=null!=d?d:BigInt("1000000000"),e=g.baseFeePerGas*gF+f),new dn(c,e,f)},c=a.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(c){let a=new c9(c.url),d=await c.processFunc(b,this,a);return new dn(d.gasPrice,d.maxFeePerGas,d.maxPriorityFeePerGas)}return await b()}async estimateGas(a){let b=this._getTransactionRequest(a);return gG(b)&&(b=await b),ah(await this.#aW({method:"estimateGas",transaction:b}),"%response")}async #aY(a,b,c){O(c<10,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},a,{blockTag:b,enableCcipRead:!0})});let d=dp(a);try{return Z(await this._perform({method:"call",transaction:d,blockTag:b}))}catch(a){if(!this.disableCcipRead&&M(a)&&a.data&&c>=0&&"latest"===b&&null!=d.to&&"0x556f1830"===aa(a.data,0,4)){let e,f=a.data,g=await cr(d.to,this);try{e=function(a){let b={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};O(_(a)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});let c=aa(a,0,32);O(aa(c,0,12)===aa(gR,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),b.sender=aa(c,12);try{let c=[],d=al(aa(a,32,64)),e=al(aa(a,d,d+32)),f=aa(a,d+32);for(let a=0;a<e;a++){let b=function(a,b){try{let c=gO(a,b);if(c)return by(c)}catch(a){}return null}(f,32*a);if(null==b)throw Error("abort");c.push(b)}b.urls=c}catch(a){O(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{let c=gO(a,64);if(null==c)throw Error("abort");b.calldata=c}catch(a){O(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}O(aa(a,100,128)===aa(gR,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),b.selector=aa(a,96,100);try{let c=gO(a,128);if(null==c)throw Error("abort");b.extraData=c}catch(a){O(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return b.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(a=>b[a]),b}(aa(a.data,4))}catch(a){O(!1,a.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:d,info:{data:f}})}O(e.sender.toLowerCase()===g.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:f,reason:"OffchainLookup",transaction:d,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:e.errorArgs}});let h=await this.ccipReadFetch(d,e.calldata,e.urls);O(null!=h,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:d,info:{data:a.data,errorArgs:e.errorArgs}});let i={to:g,data:$([e.selector,function(a){let b=[],c=0;for(let d=0;d<a.length;d++)b.push(gQ),c+=32;for(let d=0;d<a.length;d++){let e=U(a[d]);b[d]=gP(c),b.push(gP(e.length)),b.push(function(a){if(a.length%32==0)return a;let b=new Uint8Array(32*Math.ceil(a.length/32));return b.set(a),b}(e)),c+=32+32*Math.ceil(e.length/32)}return $(b)}([h,e.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:i});try{let a=await this.#aY(i,b,c+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},i),result:a}),a}catch(a){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},i),error:a}),a}}throw a}}async #aZ(a){let{value:b}=await I({network:this.getNetwork(),value:a});return b}async call(a){let{tx:b,blockTag:c}=await I({tx:this._getTransactionRequest(a),blockTag:this._getBlockTag(a.blockTag)});return await this.#aZ(this.#aY(b,c,a.enableCcipRead?0:-1))}async #a$(a,b,c){let d=this._getAddress(b),e=this._getBlockTag(c);return("string"!=typeof d||"string"!=typeof e)&&([d,e]=await Promise.all([d,e])),await this.#aZ(this.#aW(Object.assign(a,{address:d,blockTag:e})))}async getBalance(a,b){return ah(await this.#a$({method:"getBalance"},a,b),"%response")}async getTransactionCount(a,b){return al(await this.#a$({method:"getTransactionCount"},a,b),"%response")}async getCode(a,b){return Z(await this.#a$({method:"getCode"},a,b))}async getStorage(a,b,c){let d=ah(b,"position");return Z(await this.#a$({method:"getStorage",position:d},a,c))}async broadcastTransaction(a){let{blockNumber:b,hash:c,network:d}=await I({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:a}),network:this.getNetwork()}),e=f6.from(a);if(e.hash!==c)throw Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(e,d).replaceableTransaction(b)}async #aX(a,b){if(W(a,32))return await this.#aW({method:"getBlock",blockHash:a,includeTransactions:b});let c=this._getBlockTag(a);return"string"!=typeof c&&(c=await c),await this.#aW({method:"getBlock",blockTag:c,includeTransactions:b})}async getBlock(a,b){let{network:c,params:d}=await I({network:this.getNetwork(),params:this.#aX(a,!!b)});return null==d?null:this._wrapBlock(d,c)}async getTransaction(a){let{network:b,params:c}=await I({network:this.getNetwork(),params:this.#aW({method:"getTransaction",hash:a})});return null==c?null:this._wrapTransactionResponse(c,b)}async getTransactionReceipt(a){let{network:b,params:c}=await I({network:this.getNetwork(),params:this.#aW({method:"getTransactionReceipt",hash:a})});if(null==c)return null;if(null==c.gasPrice&&null==c.effectiveGasPrice){let b=await this.#aW({method:"getTransaction",hash:a});if(null==b)throw Error("report this; could not find tx or effectiveGasPrice");c.effectiveGasPrice=b.gasPrice}return this._wrapTransactionReceipt(c,b)}async getTransactionResult(a){let{result:b}=await I({network:this.getNetwork(),result:this.#aW({method:"getTransactionResult",hash:a})});return null==b?null:Z(b)}async getLogs(a){let b=this._getFilter(a);gG(b)&&(b=await b);let{network:c,params:d}=await I({network:this.getNetwork(),params:this.#aW({method:"getLogs",filter:b})});return d.map(a=>this._wrapLog(a,c))}_getProvider(a){O(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(a){return await gd.fromName(this,a)}async getAvatar(a){let b=await this.getResolver(a);return b?await b.getAvatar():null}async resolveName(a){let b=await this.getResolver(a);return b?await b.getAddress():null}async lookupAddress(a){let b=eu((a=ba(a)).substring(2).toLowerCase()+".addr.reverse");try{let c=await gd.getEnsAddress(this),d=new d$(c,["function resolver(bytes32) view returns (address)"],this),e=await d.resolver(b);if(null==e||e===dc)return null;let f=new d$(e,["function name(bytes32) view returns (string)"],this),g=await f.name(b);if(await this.resolveName(g)!==a)return null;return g}catch(a){if(L(a,"BAD_DATA")&&"0x"===a.value||L(a,"CALL_EXCEPTION"))return null;throw a}}async waitForTransaction(a,b,c){let d=null!=b?b:1;return 0===d?this.getTransactionReceipt(a):new Promise(async(b,e)=>{let f=null,g=async c=>{try{let e=await this.getTransactionReceipt(a);if(null!=e&&c-e.blockNumber+1>=d){b(e),f&&(clearTimeout(f),f=null);return}}catch(a){console.log("EEE",a)}this.once("block",g)};null!=c&&(f=setTimeout(()=>{null!=f&&(f=null,this.off("block",g),e(N("timeout","TIMEOUT",{reason:"timeout"})))},c)),g(await this.getBlockNumber())})}async waitForBlock(a){O(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(a){let b=this.#aU.get(a);b&&(b.timer&&clearTimeout(b.timer),this.#aU.delete(a))}_setTimeout(a,b){null==b&&(b=0);let c=this.#aT++,d=()=>{this.#aU.delete(c),a()};if(this.paused)this.#aU.set(c,{timer:null,func:d,time:b});else{let a=setTimeout(d,b);this.#aU.set(c,{timer:a,func:d,time:gL()})}return c}_forEachSubscriber(a){for(let b of this.#aM.values())a(b.subscriber)}_getSubscriber(a){switch(a.type){case"debug":case"error":case"network":return new gI(a.type);case"block":{let a=new gz(this);return a.pollingInterval=this.pollingInterval,a}case"safe":case"finalized":return new gB(this,a.type);case"event":return new gE(this,a.filter);case"transaction":return new gD(this,a.hash);case"orphan":return new gC(this,a.filter)}throw Error(`unsupported event: ${a.type}`)}_recoverSubscriber(a,b){for(let c of this.#aM.values())if(c.subscriber===a){c.started&&c.subscriber.stop(),c.subscriber=b,c.started&&b.start(),null!=this.#aN&&b.pause(this.#aN);break}}async #a_(a,b){let c=await gK(a,this);return"event"===c.type&&b&&b.length>0&&!0===b[0].removed&&(c=await gK({orphan:"drop-log",log:b[0]},this)),this.#aM.get(c.tag)||null}async #a0(a){let b=await gK(a,this),c=b.tag,d=this.#aM.get(c);if(!d){let a=this._getSubscriber(b);d={subscriber:a,tag:c,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#aM.set(c,d)}return d}async on(a,b){let c=await this.#a0(a);return c.listeners.push({listener:b,once:!1}),c.started||(c.subscriber.start(),c.started=!0,null!=this.#aN&&c.subscriber.pause(this.#aN)),this}async once(a,b){let c=await this.#a0(a);return c.listeners.push({listener:b,once:!0}),c.started||(c.subscriber.start(),c.started=!0,null!=this.#aN&&c.subscriber.pause(this.#aN)),this}async emit(a,...b){let c=await this.#a_(a,b);if(!c||0===c.listeners.length)return!1;let d=c.listeners.length;return c.listeners=c.listeners.filter(({listener:c,once:d})=>{let e=new dw(this,d?null:c,a);try{c.call(this,...b,e)}catch(a){}return!d}),0===c.listeners.length&&(c.started&&c.subscriber.stop(),this.#aM.delete(c.tag)),d>0}async listenerCount(a){if(a){let b=await this.#a_(a);return b?b.listeners.length:0}let b=0;for(let{listeners:a}of this.#aM.values())b+=a.length;return b}async listeners(a){if(a){let b=await this.#a_(a);return b?b.listeners.map(({listener:a})=>a):[]}let b=[];for(let{listeners:a}of this.#aM.values())b=b.concat(a.map(({listener:a})=>a));return b}async off(a,b){let c=await this.#a_(a);if(!c)return this;if(b){let a=c.listeners.map(({listener:a})=>a).indexOf(b);a>=0&&c.listeners.splice(a,1)}return b&&0!==c.listeners.length||(c.started&&c.subscriber.stop(),this.#aM.delete(c.tag)),this}async removeAllListeners(a){if(a){let{tag:b,started:c,subscriber:d}=await this.#a0(a);c&&d.stop(),this.#aM.delete(b)}else for(let[a,{started:b,subscriber:c}]of this.#aM)b&&c.stop(),this.#aM.delete(a);return this}async addListener(a,b){return await this.on(a,b)}async removeListener(a,b){return this.off(a,b)}get destroyed(){return this.#aO}destroy(){for(let a of(this.removeAllListeners(),this.#aU.keys()))this._clearTimeout(a);this.#aO=!0}get paused(){return null!=this.#aN}set paused(a){!!a!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(a){if(this.#aS=-1,null!=this.#aN){if(!!a==this.#aN)return;O(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}for(let b of(this._forEachSubscriber(b=>b.pause(a)),this.#aN=!!a,this.#aU.values()))b.timer&&clearTimeout(b.timer),b.time=gL()-b.time}resume(){if(null!=this.#aN)for(let a of(this._forEachSubscriber(a=>a.resume()),this.#aN=null,this.#aU.values())){let b=a.time;b<0&&(b=0),a.time=gL(),setTimeout(a.func,b)}}}function gO(a,b){if("0x"===a)return null;try{let c=al(aa(a,b,b+32)),d=al(aa(a,c,c+32));return aa(a,c+32,c+32+d)}catch(a){}return null}function gP(a){let b=an(a);if(b.length>32)throw Error("internal; should not happen");let c=new Uint8Array(32);return c.set(b,32-b.length),c}let gQ=new Uint8Array([]),gR="0x0000000000000000000000000000000000000000000000000000000000000000";function gS(a,b){if(a.provider)return a.provider;O(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:b})}async function gT(a,b){let c=dp(b);if(null!=c.to&&(c.to=cr(c.to,a)),null!=c.from){let b=c.from;c.from=Promise.all([a.getAddress(),cr(b,a)]).then(([a,b])=>(P(a.toLowerCase()===b.toLowerCase(),"transaction from mismatch","tx.from",b),a))}else c.from=a.getAddress();return await I(c)}class gU{provider;constructor(a){J(this,{provider:a||null})}async getNonce(a){return gS(this,"getTransactionCount").getTransactionCount(await this.getAddress(),a)}async populateCall(a){return await gT(this,a)}async populateTransaction(a){let b=gS(this,"populateTransaction"),c=await gT(this,a);null==c.nonce&&(c.nonce=await this.getNonce("pending")),null==c.gasLimit&&(c.gasLimit=await this.estimateGas(c));let d=await this.provider.getNetwork();null!=c.chainId?P(ah(c.chainId)===d.chainId,"transaction chainId mismatch","tx.chainId",a.chainId):c.chainId=d.chainId;let e=null!=c.maxFeePerGas||null!=c.maxPriorityFeePerGas;if(null!=c.gasPrice&&(2===c.type||e)?P(!1,"eip-1559 transaction do not support gasPrice","tx",a):(0===c.type||1===c.type)&&e&&P(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",a),(2===c.type||null==c.type)&&null!=c.maxFeePerGas&&null!=c.maxPriorityFeePerGas)c.type=2;else if(0===c.type||1===c.type){let a=await b.getFeeData();O(null!=a.gasPrice,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),null==c.gasPrice&&(c.gasPrice=a.gasPrice)}else{let a=await b.getFeeData();if(null==c.type)if(null!=a.maxFeePerGas&&null!=a.maxPriorityFeePerGas)if(c.authorizationList&&c.authorizationList.length?c.type=4:c.type=2,null!=c.gasPrice){let a=c.gasPrice;delete c.gasPrice,c.maxFeePerGas=a,c.maxPriorityFeePerGas=a}else null==c.maxFeePerGas&&(c.maxFeePerGas=a.maxFeePerGas),null==c.maxPriorityFeePerGas&&(c.maxPriorityFeePerGas=a.maxPriorityFeePerGas);else null!=a.gasPrice?(O(!e,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),null==c.gasPrice&&(c.gasPrice=a.gasPrice),c.type=0):O(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(2===c.type||3===c.type||4===c.type)&&(null==c.maxFeePerGas&&(c.maxFeePerGas=a.maxFeePerGas),null==c.maxPriorityFeePerGas&&(c.maxPriorityFeePerGas=a.maxPriorityFeePerGas))}return await I(c)}async populateAuthorization(a){let b=Object.assign({},a);return null==b.chainId&&(b.chainId=(await gS(this,"getNetwork").getNetwork()).chainId),null==b.nonce&&(b.nonce=await this.getNonce()),b}async estimateGas(a){return gS(this,"estimateGas").estimateGas(await this.populateCall(a))}async call(a){return gS(this,"call").call(await this.populateCall(a))}async resolveName(a){let b=gS(this,"resolveName");return await b.resolveName(a)}async sendTransaction(a){let b=gS(this,"sendTransaction"),c=await this.populateTransaction(a);delete c.from;let d=f6.from(c);return await b.broadcastTransaction(await this.signTransaction(d))}authorize(a){O(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}class gV{#aD;#a1;#aE;#aI;#a2;#a3;constructor(a){this.#aD=a,this.#a1=null,this.#aE=this.#aH.bind(this),this.#aI=!1,this.#a2=null,this.#a3=!1}_subscribe(a){throw Error("subclasses must override this")}_emitResults(a,b){throw Error("subclasses must override this")}_recover(a){throw Error("subclasses must override this")}async #aH(a){try{null==this.#a1&&(this.#a1=this._subscribe(this.#aD));let a=null;try{a=await this.#a1}catch(a){if(!L(a,"UNSUPPORTED_OPERATION")||"eth_newFilter"!==a.operation)throw a}if(null==a){this.#a1=null,this.#aD._recoverSubscriber(this,this._recover(this.#aD));return}let b=await this.#aD.getNetwork();if(this.#a2||(this.#a2=b),this.#a2.chainId!==b.chainId)throw Error("chaid changed");if(this.#a3)return;let c=await this.#aD.send("eth_getFilterChanges",[a]);await this._emitResults(this.#aD,c)}catch(a){console.log("@TODO",a)}this.#aD.once("block",this.#aE)}#a4(){let a=this.#a1;a&&(this.#a1=null,a.then(a=>{this.#aD.destroyed||this.#aD.send("eth_uninstallFilter",[a])}))}start(){this.#aI||(this.#aI=!0,this.#aH(-2))}stop(){this.#aI&&(this.#aI=!1,this.#a3=!0,this.#a4(),this.#aD.off("block",this.#aE))}pause(a){a&&this.#a4(),this.#aD.off("block",this.#aE)}resume(){this.start()}}class gW extends gV{#a5;constructor(a,b){super(a),this.#a5=JSON.parse(JSON.stringify(b))}_recover(a){return new gE(a,this.#a5)}async _subscribe(a){return await a.send("eth_newFilter",[this.#a5])}async _emitResults(a,b){for(let c of b)a.emit(this.#a5,a._wrapLog(c,a._network))}}class gX extends gV{async _subscribe(a){return await a.send("eth_newPendingTransactionFilter",[])}async _emitResults(a,b){for(let c of b)a.emit("pending",c)}}let gY="bigint,boolean,function,number,string,symbol".split(/,/g);function gZ(a){if(null==a||gY.indexOf(typeof a)>=0||"function"==typeof a.getAddress)return a;if(Array.isArray(a))return a.map(gZ);if("object"==typeof a)return Object.keys(a).reduce((b,c)=>(b[c]=a[c],b),{});throw Error(`should not happen: ${a} (${typeof a})`)}function g$(a){return a?a.toLowerCase():a}function g_(a){return a&&"number"==typeof a.pollingInterval}let g0={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1048576,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class g1 extends gU{address;constructor(a,b){super(a),J(this,{address:b=ba(b)})}connect(a){O(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(a){return await this.populateCall(a)}async sendUncheckedTransaction(a){let b=gZ(a),c=[];if(b.from){let d=b.from;c.push((async()=>{let c=await cr(d,this.provider);P(null!=c&&c.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",a),b.from=c})())}else b.from=this.address;if(null==b.gasLimit&&c.push((async()=>{b.gasLimit=await this.provider.estimateGas({...b,from:this.address})})()),null!=b.to){let a=b.to;c.push((async()=>{b.to=await cr(a,this.provider)})())}c.length&&await Promise.all(c);let d=this.provider.getRpcTransaction(b);return this.provider.send("eth_sendTransaction",[d])}async sendTransaction(a){let b=await this.provider.getBlockNumber(),c=await this.sendUncheckedTransaction(a);return await new Promise((a,d)=>{let e=[1e3,100],f=0,g=async()=>{try{let d=await this.provider.getTransaction(c);if(null!=d)return void a(d.replaceableTransaction(b))}catch(a){if(L(a,"CANCELLED")||L(a,"BAD_DATA")||L(a,"NETWORK_ERROR")||L(a,"UNSUPPORTED_OPERATION")){null==a.info&&(a.info={}),a.info.sendTransactionHash=c,d(a);return}if(L(a,"INVALID_ARGUMENT")&&(f++,null==a.info&&(a.info={}),a.info.sendTransactionHash=c,f>10))return void d(a);this.provider.emit("error",N("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:a}))}this.provider._setTimeout(()=>{g()},e.pop()||4e3)};g()})}async signTransaction(a){let b=gZ(a);if(b.from){let c=await cr(b.from,this.provider);P(null!=c&&c.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",a),b.from=c}else b.from=this.address;let c=this.provider.getRpcTransaction(b);return await this.provider.send("eth_signTransaction",[c])}async signMessage(a){let b="string"==typeof a?bx(a):a;return await this.provider.send("personal_sign",[Z(b),this.address.toLowerCase()])}async signTypedData(a,b,c){let d=gZ(c),e=await cG.resolveNames(a,b,d,async a=>{let b=await cr(a);return P(null!=b,"TypedData does not support null address","value",a),b});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(cG.getPayload(e.domain,b,e.value))])}async unlock(a){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),a,null])}async _legacySignMessage(a){let b="string"==typeof a?bx(a):a;return await this.provider.send("eth_sign",[this.address.toLowerCase(),Z(b)])}}class g2 extends gN{#k;#a6;#a7;#a8;#a9;#a2;#ba;#bb(){if(this.#a8)return;let a=1===this._getOption("batchMaxCount")?0:this._getOption("batchStallTime");this.#a8=setTimeout(()=>{this.#a8=null;let a=this.#a7;for(this.#a7=[];a.length;){let b=[a.shift()];for(;a.length&&b.length!==this.#k.batchMaxCount;)if(b.push(a.shift()),JSON.stringify(b.map(a=>a.payload)).length>this.#k.batchMaxSize){a.unshift(b.pop());break}(async()=>{let a=1===b.length?b[0].payload:b.map(a=>a.payload);this.emit("debug",{action:"sendRpcPayload",payload:a});try{let c=await this._send(a);for(let{resolve:a,reject:d,payload:e}of(this.emit("debug",{action:"receiveRpcResult",result:c}),b)){if(this.destroyed){d(N("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e.method}));continue}let b=c.filter(a=>a.id===e.id)[0];if(null==b){let a=N("missing response for request","BAD_DATA",{value:c,info:{payload:e}});this.emit("error",a),d(a);continue}if("error"in b){d(this.getRpcError(e,b));continue}a(b.result)}}catch(a){for(let{reject:c}of(this.emit("debug",{action:"receiveRpcError",error:a}),b))c(a)}})()}},a)}constructor(a,b){super(a,b),this.#a6=1,this.#k=Object.assign({},g0,b||{}),this.#a7=[],this.#a8=null,this.#a2=null,this.#ba=null;{let a=null;const b=new Promise(b=>{a=b});this.#a9={promise:b,resolve:a}}const c=this._getOption("staticNetwork");"boolean"==typeof c?(P(!c||"any"!==a,"staticNetwork cannot be used on special network 'any'","options",b),c&&null!=a&&(this.#a2=gu.from(a))):c&&(P(null==a||c.matches(a),"staticNetwork MUST match network object","options",b),this.#a2=c)}_getOption(a){return this.#k[a]}get _network(){return O(this.#a2,"network is not available yet","NETWORK_ERROR"),this.#a2}async _perform(a){if("call"===a.method||"estimateGas"===a.method){let b=a.transaction;if(b&&null!=b.type&&ah(b.type)&&null==b.maxFeePerGas&&null==b.maxPriorityFeePerGas){let c=await this.getFeeData();null==c.maxFeePerGas&&null==c.maxPriorityFeePerGas&&(a=Object.assign({},a,{transaction:Object.assign({},b,{type:void 0})}))}}let b=this.getRpcRequest(a);return null!=b?await this.send(b.method,b.args):super._perform(a)}async _detectNetwork(){let a=this._getOption("staticNetwork");if(a){if(!0!==a)return a;else if(this.#a2)return this.#a2}return this.#ba||(this.ready?this.#ba=(async()=>{try{let a=gu.from(ah(await this.send("eth_chainId",[])));return this.#ba=null,a}catch(a){throw this.#ba=null,a}})():this.#ba=(async()=>{let a,b={id:this.#a6++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:b});try{a=(await this._send(b))[0],this.#ba=null}catch(a){throw this.#ba=null,this.emit("debug",{action:"receiveRpcError",error:a}),a}if(this.emit("debug",{action:"receiveRpcResult",result:a}),"result"in a)return gu.from(ah(a.result));throw this.getRpcError(b,a)})()),await this.#ba}_start(){null!=this.#a9&&null!=this.#a9.resolve&&(this.#a9.resolve(),this.#a9=null,(async()=>{for(;null==this.#a2&&!this.destroyed;)try{this.#a2=await this._detectNetwork()}catch(a){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",N("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:a}})),await new Promise(a=>{setTimeout(a,1e3)})}this.#bb()})())}async _waitUntilReady(){if(null!=this.#a9)return await this.#a9.promise}_getSubscriber(a){return"pending"===a.type?new gX(this):"event"===a.type?this._getOption("polling")?new gE(this,a.filter):new gW(this,a.filter):"orphan"===a.type&&"drop-log"===a.filter.orphan?new gI("orphan"):super._getSubscriber(a)}get ready(){return null==this.#a9}getRpcTransaction(a){let b={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(c=>{if(null==a[c])return;let d=c;"gasLimit"===c&&(d="gas"),b[d]=ao(ah(a[c],`tx.${c}`))}),["from","to","data"].forEach(c=>{null!=a[c]&&(b[c]=Z(a[c]))}),a.accessList&&(b.accessList=cI(a.accessList)),a.blobVersionedHashes&&(b.blobVersionedHashes=a.blobVersionedHashes.map(a=>a.toLowerCase())),a.authorizationList&&(b.authorizationList=a.authorizationList.map(a=>{let b=cW(a);return{address:b.address,nonce:ao(b.nonce),chainId:ao(b.chainId),yParity:ao(b.signature.yParity),r:ao(b.signature.r),s:ao(b.signature.s)}})),b}getRpcRequest(a){switch(a.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[g$(a.address),a.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[g$(a.address),a.blockTag]};case"getCode":return{method:"eth_getCode",args:[g$(a.address),a.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[g$(a.address),"0x"+a.position.toString(16),a.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[a.signedTransaction]};case"getBlock":if("blockTag"in a)return{method:"eth_getBlockByNumber",args:[a.blockTag,!!a.includeTransactions]};if("blockHash"in a)return{method:"eth_getBlockByHash",args:[a.blockHash,!!a.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[a.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[a.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(a.transaction),a.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(a.transaction)]};case"getLogs":return a.filter&&null!=a.filter.address&&(Array.isArray(a.filter.address)?a.filter.address=a.filter.address.map(g$):a.filter.address=g$(a.filter.address)),{method:"eth_getLogs",args:[a.filter]}}return null}getRpcError(a,b){let c,{method:d}=a,{error:e}=b;if("eth_estimateGas"===d&&e.message){let b=e.message;if(!b.match(/revert/i)&&b.match(/insufficient funds/i))return N("insufficient funds","INSUFFICIENT_FUNDS",{transaction:a.params[0],info:{payload:a,error:e}});if(b.match(/nonce/i)&&b.match(/too low/i))return N("nonce has already been used","NONCE_EXPIRED",{transaction:a.params[0],info:{payload:a,error:e}})}if("eth_call"===d||"eth_estimateGas"===d){let b=function a(b){if(null==b)return null;if("string"==typeof b.message&&b.message.match(/revert/i)&&W(b.data))return{message:b.message,data:b.data};if("object"==typeof b){for(let c in b){let d=a(b[c]);if(d)return d}return null}if("string"==typeof b)try{return a(JSON.parse(b))}catch(a){}return null}(e),c=co.getBuiltinCallException("eth_call"===d?"call":"estimateGas",a.params[0],b?b.data:null);return c.info={error:e,payload:a},c}let f=JSON.stringify((!function a(b,c){if(null!=b){if("string"==typeof b.message&&c.push(b.message),"object"==typeof b)for(let d in b)a(b[d],c);if("string"==typeof b)try{return a(JSON.parse(b),c)}catch(a){}}}(e,c=[]),c));if("string"==typeof e.message&&e.message.match(/user denied|ethers-user-denied/i))return N("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[d]||"unknown",reason:"rejected",info:{payload:a,error:e}});if("eth_sendRawTransaction"===d||"eth_sendTransaction"===d){let b=a.params[0];if(f.match(/insufficient funds|base fee exceeds gas limit/i))return N("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:b,info:{error:e}});if(f.match(/nonce/i)&&f.match(/too low/i))return N("nonce has already been used","NONCE_EXPIRED",{transaction:b,info:{error:e}});if(f.match(/replacement transaction/i)&&f.match(/underpriced/i))return N("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:b,info:{error:e}});if(f.match(/only replay-protected/i))return N("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:d,info:{transaction:b,info:{error:e}}})}let g=!!f.match(/the method .* does not exist/i);return(!g&&e&&e.details&&e.details.startsWith("Unauthorized method:")&&(g=!0),g)?N("unsupported operation","UNSUPPORTED_OPERATION",{operation:a.method,info:{error:e,payload:a}}):N("could not coalesce error","UNKNOWN_ERROR",{error:e,payload:a})}send(a,b){if(this.destroyed)return Promise.reject(N("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:a}));let c=this.#a6++,d=new Promise((d,e)=>{this.#a7.push({resolve:d,reject:e,payload:{method:a,params:b,id:c,jsonrpc:"2.0"}})});return this.#bb(),d}async getSigner(a){null==a&&(a=0);let b=this.send("eth_accounts",[]);if("number"==typeof a){let c=await b;if(a>=c.length)throw Error("no such account");return new g1(this,c[a])}let{accounts:c}=await I({network:this.getNetwork(),accounts:b});for(let b of(a=ba(a),c))if(ba(b)===a)return new g1(this,a);throw Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(a=>new g1(this,a))}destroy(){for(let{payload:a,reject:b}of(this.#a8&&(clearTimeout(this.#a8),this.#a8=null),this.#a7))b(N("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:a.method}));this.#a7=[],super.destroy()}}class g3 extends g2{#bc;constructor(a,b){super(a,b);let c=this._getOption("pollingInterval");null==c&&(c=g0.pollingInterval),this.#bc=c}_getSubscriber(a){let b=super._getSubscriber(a);return g_(b)&&(b.pollingInterval=this.#bc),b}get pollingInterval(){return this.#bc}set pollingInterval(a){if(!Number.isInteger(a)||a<0)throw Error("invalid interval");this.#bc=a,this._forEachSubscriber(a=>{g_(a)&&(a.pollingInterval=this.#bc)})}}class g4 extends g3{#bd;constructor(a,b,c){null==a&&(a="http://localhost:8545"),super(b,c),"string"==typeof a?this.#bd=new c9(a):this.#bd=a.clone()}_getConnection(){return this.#bd.clone()}async send(a,b){return await this._start(),await super.send(a,b)}async _send(a){let b=this._getConnection();b.body=JSON.stringify(a),b.setHeader("content-type","application/json");let c=await b.send();c.assertOk();let d=c.bodyJson;return Array.isArray(d)||(d=[d]),d}}class g5 extends g3{#R;#be;constructor(a,b,c){const d=Object.assign({},null!=c?c:{},{batchMaxCount:1});P(a&&a.request,"invalid EIP-1193 provider","ethereum",a),super(b,d),this.#be=null,c&&c.providerInfo&&(this.#be=c.providerInfo),this.#R=async(b,c)=>{let d={method:b,params:c};this.emit("debug",{action:"sendEip1193Request",payload:d});try{let b=await a.request(d);return this.emit("debug",{action:"receiveEip1193Result",result:b}),b}catch(b){let a=Error(b.message);throw a.code=b.code,a.data=b.data,a.payload=d,this.emit("debug",{action:"receiveEip1193Error",error:a}),a}}}get providerInfo(){return this.#be}async send(a,b){return await this._start(),await super.send(a,b)}async _send(a){P(!Array.isArray(a),"EIP-1193 does not support batch request","payload",a);try{let b=await this.#R(a.method,a.params||[]);return[{id:a.id,result:b}]}catch(b){return[{id:a.id,error:{code:b.code,data:b.data,message:b.message}}]}}getRpcError(a,b){switch((b=JSON.parse(JSON.stringify(b))).error.code||-1){case 4001:b.error.message=`ethers-user-denied: ${b.error.message}`;break;case 4200:b.error.message=`ethers-unsupported: ${b.error.message}`}return super.getRpcError(a,b)}async hasSigner(a){null==a&&(a=0);let b=await this.send("eth_accounts",[]);return"number"==typeof a?b.length>a:(a=a.toLowerCase(),0!==b.filter(b=>b.toLowerCase()===a).length)}async getSigner(a){if(null==a&&(a=0),!await this.hasSigner(a))try{await this.#R("eth_requestAccounts",[])}catch(b){let a=b.payload;throw this.getRpcError(a,{id:a.id,error:b})}return await super.getSigner(a)}static async discover(a){if(null==a&&(a={}),a.provider)return new g5(a.provider);let b=a.window?a.window:null;if(null==b)return null;let c=a.anyProvider;if(c&&b.ethereum)return new g5(b.ethereum);if(!("addEventListener"in b&&"dispatchEvent"in b&&"removeEventListener"in b))return null;let d=a.timeout?a.timeout:300;return 0===d?null:await new Promise((e,f)=>{let g=[],h=a=>{g.push(a.detail),c&&i()},i=()=>{if(clearTimeout(j),g.length)if(a&&a.filter){let b=a.filter(g.map(a=>Object.assign({},a.info)));if(null==b)e(null);else if(b instanceof g5)e(b);else{let a=null;if(b.uuid&&(a=g.filter(a=>b.uuid===a.info.uuid)[0]),a){let{provider:b,info:c}=a;e(new g5(b,void 0,{providerInfo:c}))}else f(N("filter returned unknown info","UNSUPPORTED_OPERATION",{value:b}))}}else{let{provider:a,info:b}=g[0];e(new g5(a,void 0,{providerInfo:b}))}else e(null);b.removeEventListener("eip6963:announceProvider",h)},j=setTimeout(()=>{i()},d);b.addEventListener("eip6963:announceProvider",h),b.dispatchEvent(new Event("eip6963:requestProvider"))})}}var g6=a.i(44002);let g7=[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"success",type:"bool"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"success",type:"bool"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint256"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"success",type:"bool"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"},{name:"_extraData",type:"bytes"}],name:"approveAndCall",outputs:[{name:"success",type:"bool"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"remaining",type:"uint256"}],payable:!1,type:"function"},{inputs:[{name:"_initialAmount",type:"uint256"},{name:"_tokenName",type:"string"},{name:"_decimalUnits",type:"uint8"},{name:"_tokenSymbol",type:"string"}],type:"constructor"},{payable:!1,type:"fallback"}],g8=[{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"_name",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_tokenId",type:"uint256"}],name:"getApproved",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_approved",type:"address"},{name:"_tokenId",type:"uint256"}],name:"approve",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_tokenId",type:"uint256"}],name:"transferFrom",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{name:"_index",type:"uint256"}],name:"tokenByIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_tokenId",type:"uint256"}],name:"ownerOf",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"_symbol",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_tokenId",type:"uint256"}],name:"tokenURI",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"}],g9=[{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"uint256",name:"_id",type:"uint256"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address[]",name:"_owners",type:"address[]"},{internalType:"uint256[]",name:"_ids",type:"uint256[]"}],name:"balanceOfBatch",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"isOperator",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_from",type:"address"},{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_id",type:"uint256"},{internalType:"uint256",name:"_amount",type:"uint256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_operator",type:"address"},{internalType:"bool",name:"_approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"_interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"}],name:"uri",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}],ha=[{payable:!0,stateMutability:"payable",type:"fallback"},{constant:!0,inputs:[{name:"user",type:"address"},{name:"token",type:"address"}],name:"tokenBalance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"users",type:"address[]"},{name:"tokens",type:"address[]"}],name:"balances",outputs:[{name:"",type:"uint256[]"}],payable:!1,stateMutability:"view",type:"function"}];var hb=a.i(96238);let hc={[hb.MAINNET_CHAIN_ID]:"0xb1f8e55c7f64d203c1400b9d8555d050f94adf39",[hb.BSC_MAINNET_CHAIN_ID]:"0x2352c63A83f9Fd126af8676146721Fa00924d7e4",[hb.OPTIMISM_MAINNET_CHAIN_ID]:"0xB1c568e9C3E6bdaf755A60c7418C269eb11524FC",[hb.POLYGON_CHAIN_ID]:"0x2352c63A83f9Fd126af8676146721Fa00924d7e4",[hb.AVALANCHE_MAINNET_CHAIN_ID]:"0xD023D153a0DFa485130ECFdE2FAA7e612EF94818",[hb.ARBITRUM_MAINNET_CHAIN_ID]:"0x151E24A486D7258dd7C33Fb67E4bB01919B7B32c"};class hd extends D{constructor({config:a,state:b,provider:c,blockTracker:d,getIdentities:e,onPreferencesStateChange:f,getCurrentChainId:g}){super({config:a,state:b}),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"blockTracker",void 0),(0,z.default)(this,"mutex",new H),(0,z.default)(this,"ethersProvider",void 0),(0,z.default)(this,"getIdentities",void 0),(0,z.default)(this,"getCurrentChainId",void 0),this.defaultState={accounts:{}},this.initialize(),this.provider=c,this.blockTracker=d,this.ethersProvider=new g5(this.provider,"any"),this.getIdentities=e,this.getCurrentChainId=g,f(()=>{this.syncAccounts()&&(g6.default.info("onPreferencesStateChange called"),this.refresh())}),this.blockTrackerListener=this.blockTrackerListener.bind(this)}blockTrackerListener(){this.refresh()}startPolling(){this.stopPolling(),Object.keys(this.state.accounts).length>0&&this.blockTracker.on("latest",this.blockTrackerListener)}stopPolling(){this.blockTracker.removeListener("latest",this.blockTrackerListener)}syncAccounts(){let{accounts:a}=this.state,b=Object.keys(this.getIdentities()),c=Object.keys(a),d=b.filter(a=>-1===c.indexOf(a)),e=c.filter(a=>-1===b.indexOf(a)),f=!1;return d.forEach(b=>{f=!0,a[b]={balance:"0x0"}}),e.forEach(b=>{f=!0,delete a[b]}),this.update({accounts:(0,y.default)({},a)}),f}async refresh(){let a=await this.mutex.acquire();try{this._updateAccounts()}catch{}finally{a()}}async _updateAccounts(){let{accounts:a}=this.state,b=Object.keys(a),c=this.getCurrentChainId();if("loading"!==c&&b.length>0){if(hc[c])return void await this._updateAccountsViaBalanceChecker(b,hc[c]);g6.default.info("falling back to ethQuery.getBalance"),await Promise.all(b.map(a=>this._updateAccount(a)))}}async _updateAccount(a){let b=await this.provider.request({method:"eth_getBalance",params:[a,"latest"]}),{accounts:c}=this.state;c[a]&&(c[a]={balance:ao(b)},this.update({accounts:c}))}async _updateAccountsViaBalanceChecker(a,b){let c=new d$(b,ha,this.ethersProvider);try{let b=await c.balances(a,["0x0000000000000000000000000000000000000000"]),{accounts:d}=this.state;return a.forEach((a,c)=>{let e=ao(b[c]);d[a]&&(d[a]={balance:e})}),this.update({accounts:d})}catch(b){return g6.default.warn("Torus - Account Tracker single call balance fetch failed",b),Promise.all(a.map(a=>this._updateAccount(a)))}}}a.i(26972);var he=a.i(62984);let hf=((t={}).approved="approved",t.cancelled="cancelled",t.cancelling="cancelling",t.confirmed="confirmed",t.failed="failed",t.finalized="finalized",t.processed="processed",t.rejected="rejected",t.signed="signed",t.submitted="submitted",t.unapproved="unapproved",t.dropped="dropped",t.expired="expired",t.pending="pending",t),hg="sentEther",hh="tx:warning",hi="tx:failed",hj="tx:confirmed",hk="tx:dropped",hl="tx:status_update",hm="tx:retry",hn="tx:block_update";a.i(19432);let ho=g6.default.getLogger("auth");ho.setLevel("error");let hp=-32601,hq=-32602,hr=-32603,hs=4001,ht={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};var hu=function(a,b){if(null==a)throw TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(a),b)};let hv=hr;function hw(a){return Number.isInteger(a)}function hx(a){return"string"==typeof a&&a.length>0}function hy(a){return!!a&&"object"==typeof a&&!Array.isArray(a)}function hz(a){return!!a&&!!hw(a.code)&&!!hx(a.message)&&(!a.stack||!!hx(a.stack))}function hA(a,b="Unspecified error message. This is a bug, please report it."){if(hw(a)){let b=a.toString();if(hu(ht,b))return ht[b].message;if(a>=-32099&&a<=-32e3)return"Unspecified server error."}return b}let hB={code:hv,message:hA(hv)};function hC(a){try{JSON.parse(JSON.stringify(a,(a,b)=>{if("__proto__"===a||"constructor"===a||"function"==typeof b||"symbol"==typeof b)throw Error("Not valid json");return b}),(a,b)=>{if("__proto__"!==a&&"constructor"!==a)return b})}catch{return!1}return!0}function hD(a){return Object.getOwnPropertyNames(a).reduce((b,c)=>{let d=a[c];return hC(d)&&(b[c]=d),b},{})}function hE(a){return Array.isArray(a)?a.map(a=>hC(a)?a:hy(a)?hD(a):null):hy(a)?hD(a):hC(a)?a:null}function hF(a,{fallbackError:b=hB,shouldIncludeStack:c=!0}={}){if(!hz(b))throw Error("Must provide fallback error with integer number code and string message.");let d=function(a,b){if(a&&"object"==typeof a&&"serialize"in a&&"function"==typeof a.serialize)return a.serialize();if(hz(a))return a;let c=hE(a);return(0,y.default)((0,y.default)({},b),{},{data:{cause:c}})}(a,b);return c||delete d.stack,d}var hG=a.i(57266);class hH extends Error{constructor({code:a,message:b,data:c}){if(!Number.isInteger(a))throw Error("code must be an integer");if(!b||"string"!=typeof b)throw Error("message must be string");super(b),(0,z.default)(this,"code",void 0),(0,z.default)(this,"data",void 0),this.code=a,void 0!==c&&(this.data=c)}toString(){return(0,hG.default)({code:this.code,message:this.message,data:this.data,stack:this.stack})}}var hI=function(a,b){if(null==a)throw TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(a),b)};function hJ(a,b){if("[Circular]"!==b)return b}class hK extends Error{constructor(a,b,c){if(!Number.isInteger(a))throw Error('"code" must be an integer.');if(!b||"string"!=typeof b)throw Error('"message" must be a non-empty string.');!function(a){return hy(a)&&hu(a,"cause")&&hy(a.cause)}(c)?(super(b),(0,z.default)(this,"cause",void 0),(0,z.default)(this,"code",void 0),(0,z.default)(this,"data",void 0)):(super(b,{cause:c.cause}),(0,z.default)(this,"cause",void 0),(0,z.default)(this,"code",void 0),(0,z.default)(this,"data",void 0),hI(this,"cause")||Object.assign(this,{cause:c.cause})),void 0!==c&&(this.data=c),this.code=a,this.cause=null==c?void 0:c.cause}serialize(){let a={code:this.code,message:this.message};return void 0!==this.data&&(a.data=this.data,function(a){if("object"!=typeof a||null===a)return!1;try{let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}catch{return!1}}(this.data)&&(a.data.cause=hE(this.data.cause))),this.stack&&(a.stack=this.stack),a}toString(){return(0,hG.default)(this.serialize(),{replacer:hJ,space:2})}}class hL extends hK{constructor(a,b,c){if(!function(a){return Number.isInteger(a)&&a>=1e3&&a<=4999}(a))throw Error('"code" must be an integer such that: 1000 <= code <= 4999');super(a,b,c)}}function hM(a){let{message:b="",code:c=-32603,stack:d="Stack trace is not available.",data:e=""}=a,f=parseInt((null==c?void 0:c.toString())||"-32603");return{message:b||(null==a?void 0:a.toString())||hA(f),code:f,stack:d,data:e||b||(null==a?void 0:a.toString())}}class hN extends C{constructor(){super(),(0,z.default)(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(a,b,c){let d=[],e=null,f=!1;for(let g of c)if([e,f]=await hN._runMiddleware(a,b,g,d),f)break;return[e,f,d.reverse()]}static _runMiddleware(a,b,c,d){return new Promise(e=>{let f=a=>{let c=a||b.error;c&&("object"==typeof c&&!1===Object.keys(c).includes("stack")&&(c.stack="Stack trace is not available."),ho.error(c),b.error=hF(c,{shouldIncludeStack:!0,fallbackError:hM(c)})),e([c,!0])};try{c(a,b,a=>{b.error?f(b.error):(a&&("function"!=typeof a&&f(new hH({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),d.push(a)),e([null,!1]))},f)}catch(a){f(a)}})}static async _runReturnHandlers(a){for(let b of a)await new Promise((a,c)=>{b(b=>b?c(b):a())})}static _checkForCompletion(a,b,c){if(!("result"in b)&&!("error"in b))throw new hH({code:-32603,message:"Response has no error or result for request"});if(!c)throw new hH({code:-32603,message:"Nothing ended request"})}push(a){this._middleware.push(a)}handle(a,b){if(b&&"function"!=typeof b)throw Error('"callback" must be a function if provided.');return Array.isArray(a)?b?this._handleBatch(a,b):this._handleBatch(a):b?this._handle(a,b):this._promiseHandle(a)}asMiddleware(){return async(a,b,c,d)=>{try{let[e,f,g]=await hN._runAllMiddleware(a,b,this._middleware);if(f)return await hN._runReturnHandlers(g),d(e);return c(async a=>{try{await hN._runReturnHandlers(g)}catch(b){return a(b)}return a()})}catch(a){return d(a)}}}async _handleBatch(a,b){try{let c=await Promise.all(a.map(this._promiseHandle.bind(this)));if(b)return b(null,c);return c}catch(a){if(b)return b(a);throw a}}_promiseHandle(a){return new Promise((b,c)=>{this._handle(a,(a,d)=>{a&&void 0===d?c(a):b(d)}).catch(c)})}async _handle(a,b){if(!a||Array.isArray(a)||"object"!=typeof a){let a=new hH({code:-32603,message:"request must be plain object"});return b(a,{id:void 0,jsonrpc:"2.0",error:a})}if("string"!=typeof a.method){let c=new hH({code:-32603,message:"method must be string"});return b(c,{id:a.id,jsonrpc:"2.0",error:c})}let c=(0,y.default)({},a),d={id:c.id,jsonrpc:c.jsonrpc},e=null;try{await this._processRequest(c,d)}catch(a){e=a}return e&&(delete d.result,d.error||("object"==typeof e&&!1===Object.keys(e).includes("stack")&&(e.stack="Stack trace is not available."),ho.error(e),d.error=hF(e,{shouldIncludeStack:!0,fallbackError:hM(e)}))),b(e,d)}async _processRequest(a,b){let[c,d,e]=await hN._runAllMiddleware(a,b,this._middleware);if(hN._checkForCompletion(a,b,d),await hN._runReturnHandlers(e),c)throw c}}function hO(a){let b=new hN;return a.forEach(a=>{b.push(a)}),b.asMiddleware()}function hP(a){let b=new C;return b.sendAsync=async b=>{let c=await a.handle(b);if(c.error){var d,e;"object"==typeof c.error&&!1===Object.keys(c.error).includes("stack")&&(c.error.stack="Stack trace is not available."),ho.error(c.error);let a=hF(c.error,{fallbackError:hM(c.error),shouldIncludeStack:!0}),b=null!=(d=null==a?void 0:a.code)?d:hr;throw new hK(b,null!=(e=null==a?void 0:a.message)?e:hA(b),null==a?void 0:a.data)}return c.result},b.send=(b,c)=>{if("function"!=typeof c)throw Error('Must provide callback to "send" method.');a.handle(b,c)},a.on&&a.on("notification",a=>{b.emit("data",null,a)}),b.request=async a=>{let c=(0,y.default)((0,y.default)({},a),{},{id:Math.random().toString(36).slice(2),jsonrpc:"2.0"});return await b.sendAsync(c)},b}var hQ=a.i(27549),hR=a.i(55539),hS=a.i(92911),hT=a.i(84617),hU=a.i(58515),hV=a.i(63398),hW=a.i(85228);class hX extends hW.BaseError{constructor({value:a}){super(`Number \`${a}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}var hY=a.i(21570),hZ=a.i(97295),h$=a.i(83346);let h_=a=>(b,c,d,e)=>{if(b.isAAProviderRequest=!0,"eth_accounts"===b.method||"eth_requestAccounts"===b.method){c.result=[a],e();return}d()};function h0(a){return async(b,c,d,e)=>{try{return c.result=await a.request(b),e()}catch(a){return e(a)}}}class h1 extends D{constructor({config:a,state:b,getProviderConfig:c,onNetworkStateChange:d}){super({state:b,config:a}),(0,z.default)(this,"_smartAccount",void 0),(0,z.default)(this,"_publicClient",void 0),(0,z.default)(this,"_bundlerClient",void 0),(0,z.default)(this,"_paymasterClient",void 0),(0,z.default)(this,"getProviderConfig",void 0),this.initialize(),this.getProviderConfig=c,d(a=>{a.chainId!==this.config.chainId&&this.configure({chainId:a.chainId})})}get smartAccount(){return this._smartAccount}get bundlerClient(){return this._bundlerClient}async setupProvider(a,b){let c=this.getProviderConfig(),d=(0,hQ.defineChain)({id:Number.parseInt(c.chainId,16),name:c.displayName,rpcUrls:{default:{http:[c.rpcTarget],webSocket:[c.wsTarget]}},blockExplorers:c.blockExplorerUrl?{default:{name:"explorer",url:c.blockExplorerUrl}}:void 0,nativeCurrency:{name:c.tickerName,symbol:c.ticker,decimals:c.decimals||18}});this._publicClient=(0,hR.createPublicClient)({chain:d,transport:(0,hS.http)(c.rpcTarget)});let e=new hN;e.push(h_(b)),e.push(h0(a));let f=hP(e),g=(0,hT.createWalletClient)({account:b,chain:d,transport:(0,hU.custom)(f)});this._smartAccount=await this.config.smartAccountInit.getSmartAccount({walletClient:g,client:this._publicClient}),this.config.paymasterConfig&&(this._paymasterClient=(0,hZ.createPaymasterClient)((0,y.default)((0,y.default)({},this.config.paymasterConfig),{},{transport:(0,hU.custom)(f)}))),this._bundlerClient=(0,h$.createBundlerClient)((0,y.default)((0,y.default)({},this.config.bundlerConfig),{},{account:this.smartAccount,client:this._publicClient,transport:(0,hU.custom)(f),paymaster:this._paymasterClient})),g6.default.info("check: this._smartAccount",this.smartAccount.address),this.update({smartAccountAddress:this.smartAccount.address})}async sendTransaction(a,b,c){var d,e,f,g,h,i;if(c.toLowerCase()!==this.smartAccount.address.toLowerCase())throw Error("Invalid address");let j={account:this.smartAccount,calls:[{to:b.to,value:b.value?BigInt(b.value):void 0,data:b.data}],maxFeePerGas:b.maxFeePerGas?BigInt(b.maxFeePerGas):void 0,maxPriorityFeePerGas:b.maxPriorityFeePerGas?BigInt(b.maxPriorityFeePerGas):void 0,callGasLimit:b.callGasLimit?BigInt(b.callGasLimit):void 0,preVerificationGas:b.preVerificationGas?BigInt(b.preVerificationGas):void 0,verificationGasLimit:b.verificationGasLimit?BigInt(b.verificationGasLimit):void 0,paymasterVerificationGasLimit:b.paymasterVerificationGasLimit?BigInt(b.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:b.paymasterPostOpGasLimit?BigInt(b.paymasterPostOpGasLimit):void 0},k={transactionParams:b,chainId:null!=(d=b.chainId)?d:this.getProviderConfig().chainId,createdAt:new Date,status:hf.approved};this.updateUserOpMeta(a,k);let l=await this.bundlerClient.sendUserOperation(j);this.updateUserOpMeta(a,{userOpHash:l,status:hf.submitted});let m=await this.bundlerClient.waitForUserOperationReceipt({hash:l});return this.updateUserOpMeta(a,{receipt:{transactionHash:null==(e=m.receipt)?void 0:e.transactionHash,nonce:null==(f=m.nonce)?void 0:f.toString(),gasUsed:(0,he.addHexPrefix)(null==(g=m.receipt)||null==(g=g.gasUsed)?void 0:g.toString(16)),effectiveGasPrice:(0,he.addHexPrefix)(null==(h=m.receipt)||null==(h=h.effectiveGasPrice)?void 0:h.toString(16)),type:null==(i=m.receipt)?void 0:i.type,reason:m.reason},status:m.success?hf.confirmed:hf.failed}),m.receipt.transactionHash}async signTransaction(a,b,c){var d;if(c.toLowerCase()!==this.smartAccount.address.toLowerCase())throw Error("Invalid address");let e={transactionParams:b,chainId:null!=(d=b.chainId)?d:this.getProviderConfig().chainId,createdAt:new Date,status:hf.approved};this.updateUserOpMeta(a,e);let f=await this.bundlerClient.prepareUserOperation({account:this.smartAccount,calls:[{to:b.to,value:b.value?BigInt(b.value):void 0,data:b.data}],maxFeePerGas:b.maxFeePerGas?BigInt(b.maxFeePerGas):void 0,maxPriorityFeePerGas:b.maxPriorityFeePerGas?BigInt(b.maxPriorityFeePerGas):void 0,callGasLimit:b.callGasLimit?BigInt(b.callGasLimit):void 0,preVerificationGas:b.preVerificationGas?BigInt(b.preVerificationGas):void 0,verificationGasLimit:b.verificationGasLimit?BigInt(b.verificationGasLimit):void 0,paymasterVerificationGasLimit:b.paymasterVerificationGasLimit?BigInt(b.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:b.paymasterPostOpGasLimit?BigInt(b.paymasterPostOpGasLimit):void 0}),g=await this.smartAccount.signUserOperation(f);return this.updateUserOpMeta(a,{signature:g,status:hf.signed}),g}async estimateGas(a,b){let c;if(b.toLowerCase()!==this.smartAccount.address.toLowerCase())throw Error("Invalid address");let d=[{to:a.to,value:a.value?BigInt(a.value):void 0,data:a.data}],e=a.maxFeePerGas?BigInt(a.maxFeePerGas):void 0,f=a.maxPriorityFeePerGas?BigInt(a.maxPriorityFeePerGas):void 0,g={account:this.smartAccount,calls:d,maxFeePerGas:e,maxPriorityFeePerGas:f,stateOverride:[{address:this.smartAccount.address,balance:function(a,b="wei"){return function(a,b){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test("1"))throw new hX({value:"1"});let[c,d="0"]="1".split("."),e=c.startsWith("-");if(e&&(c=c.slice(1)),d=d.replace(/(0+)$/,""),0===b)1===Math.round(Number(`.${d}`))&&(c=`${BigInt(c)+1n}`),d="";else if(d.length>b){let[a,e,f]=[d.slice(0,b-1),d.slice(b-1,b),d.slice(b)],g=Math.round(Number(`${e}.${f}`));(d=g>9?`${BigInt(a)+BigInt(1)}0`.padStart(a.length+1,"0"):`${a}${g}`).length>b&&(d=d.slice(1),c=`${BigInt(c)+1n}`),d=d.slice(0,b)}else d=d.padEnd(b,"0");return BigInt(`${e?"-":""}${c}${d}`)}("1",hV.etherUnits[b])}(0)}]};"0.6"!==this.smartAccount.entryPoint.version&&(c=await this.smartAccount.getFactoryArgs()),c&&(c.factory&&(g.factory=c.factory),c.factoryData&&(g.factoryData=c.factoryData));let h=await this.bundlerClient.estimateUserOperationGas(g),i={callGasLimit:(0,hY.toHex)(h.callGasLimit),preVerificationGas:(0,hY.toHex)(h.preVerificationGas),verificationGasLimit:(0,hY.toHex)(h.verificationGasLimit)};return h.paymasterVerificationGasLimit&&(i.paymasterVerificationGasLimit=(0,hY.toHex)(h.paymasterVerificationGasLimit)),h.paymasterPostOpGasLimit&&(i.paymasterPostOpGasLimit=(0,hY.toHex)(h.paymasterPostOpGasLimit)),i}async signMessage(a,b){if(b.toLowerCase()!==this.smartAccount.address.toLowerCase())throw Error("Invalid address");return this.smartAccount.sign({hash:a})}async signPersonalMessage(a,b){var c;if(b.toLowerCase()!==this.smartAccount.address.toLowerCase())throw Error("Invalid address");return null==(c=this.smartAccount)?void 0:c.signMessage({message:W(a)?{raw:a}:a})}async signTypedData(a,b){var c;if(b.toLowerCase()!==this.smartAccount.address.toLowerCase())throw Error("Invalid address");return null==(c=this.smartAccount)?void 0:c.signTypedData({domain:(0,y.default)((0,y.default)({},a.domain),{},{verifyingContract:a.domain.verifyingContract,salt:a.domain.salt,chainId:Number(a.domain.chainId)}),primaryType:a.primaryType,types:a.types,message:a.message})}updateUserOpMeta(a,b){let c=this.state.userOperations[a];this.update({userOperations:(0,y.default)((0,y.default)({},this.state.userOperations),{},{[a]:(0,y.default)((0,y.default)({},c),b)})})}}let h2=(a,b)=>a+b;class h3 extends D{constructor({config:a={},state:b={}}){super({config:a,state:b}),(0,z.default)(this,"name","BaseBlockTracker"),(0,z.default)(this,"_blockResetTimeout",void 0),this.defaultState={_currentBlock:{idempotencyKey:""},_isRunning:!1},this.defaultConfig={blockResetDuration:2e4},this.initialize(),this._onNewListener=this._onNewListener.bind(this),this._onRemoveListener=this._onRemoveListener.bind(this),this._resetCurrentBlock=this._resetCurrentBlock.bind(this),this._setupInternalEvents()}isRunning(){return this.state._isRunning}getCurrentBlock(){return this.state._currentBlock}async getLatestBlock(){return this.state._currentBlock.idempotencyKey?this.state._currentBlock:await new Promise(a=>{this.once("latest",b=>{b&&a(b)})})}removeAllListeners(a){return a?super.removeAllListeners(a):super.removeAllListeners(),this._setupInternalEvents(),this._onRemoveListener(),this}_start(){}_end(){}_newPotentialLatest(a){let b=this.state._currentBlock;b&&a.idempotencyKey===b.idempotencyKey||this._setCurrentBlock(a)}_setupInternalEvents(){this.removeListener("newListener",this._onNewListener),this.removeListener("removeListener",this._onRemoveListener),this.on("removeListener",this._onRemoveListener),this.on("newListener",this._onNewListener)}_onNewListener(){this._maybeStart()}_onRemoveListener(){this._getBlockTrackerEventCount()>0||this._maybeEnd()}_maybeStart(){this.state._isRunning||(this.state._isRunning=!0,this._cancelBlockResetTimeout(),this._start())}_maybeEnd(){this.state._isRunning&&(this.state._isRunning=!1,this._setupBlockResetTimeout(),this._end())}_getBlockTrackerEventCount(){return["latest","sync"].map(a=>this.listenerCount(a)).reduce(h2)}_setCurrentBlock(a){let b=this.state._currentBlock;this.update({_currentBlock:a}),this.emit("latest",a),this.emit("sync",{oldBlock:b,newBlock:a})}_setupBlockResetTimeout(){this._cancelBlockResetTimeout(),this._blockResetTimeout=setTimeout(this._resetCurrentBlock,this.config.blockResetDuration),this._blockResetTimeout.unref&&this._blockResetTimeout.unref()}_cancelBlockResetTimeout(){this._blockResetTimeout&&clearTimeout(this._blockResetTimeout)}_resetCurrentBlock(){this.update({_currentBlock:{idempotencyKey:""}})}}var h4=a.i(41858);class h5{constructor(a,b){(0,z.default)(this,"idleTimeTracker",void 0),(0,z.default)(this,"pollingInterval",void 0),(0,z.default)(this,"isPolling",!1),this.pollingInterval=b,this.idleTimeTracker=a}start(a){this.idleTimeTracker.on("active",this.poll.bind(this,a)),this.idleTimeTracker.on("idle",this.stop.bind(this)),this.poll(a)}stop(){this.isPolling=!1}async poll(a){if(!this.isPolling)for(this.isPolling=!0;this.isPolling;){if(this.idleTimeTracker.checkIfIdle()){this.isPolling=!1;return}try{await a()}catch(a){g6.default.error(a)}await (0,h4.timeout)(this.pollingInterval)}}}class h6 extends h3{constructor({config:a,state:b={},idleTimeTracker:c}){if(!a.provider)throw Error("PollingBlockTracker - no provider specified.");if(!c)throw Error("PollingBlockTracker - no idleTimeTracker specified.");super({config:a,state:b}),(0,z.default)(this,"pollingManager",void 0);const d=a.pollingInterval||20,e=a.retryTimeout||2;this.defaultConfig={provider:a.provider,pollingInterval:1e3*d,retryTimeout:1e3*e,setSkipCacheFlag:a.setSkipCacheFlag||!1},this.initialize(),this.pollingManager=new h5(c,d)}async checkForLatestBlock(){return await this._updateLatestBlock(),this.getLatestBlock()}_start(){this.pollingManager.start(async()=>{await this._synchronize().catch(a=>{this.emit("error",a)})})}_end(){this.pollingManager.stop()}async _synchronize(){try{await this._updateLatestBlock()}catch(b){let a=Error(`PollingBlockTracker - encountered an error while attempting to update latest block:
${b.stack}`);try{this.emit("error",a)}catch{g6.default.error(a)}await (0,h4.timeout)(this.config.retryTimeout)}}async _updateLatestBlock(){let a=await this._fetchLatestBlock();this._newPotentialLatest(a)}async _fetchLatestBlock(){try{let a=await this.config.provider.request({method:"eth_getBlockByNumber",params:["latest",!1]});return{blockHash:a.hash,idempotencyKey:a.number,timestamp:a.timestamp,baseFeePerGas:a.baseFeePerGas,gasLimit:a.gasLimit}}catch(a){throw g6.default.error("Polling Block Tracker: ",a),Error(`PollingBlockTracker - encountered error fetching block:
${a.message}`)}}}class h7 extends D{constructor({config:a={},state:b}){super({config:a,state:b}),this.defaultState={currentCurrency:"usd",conversionRate:0,conversionDate:"N/A",nativeCurrency:"ETH"},this.defaultConfig={pollInterval:6e5},this.initialize()}getNativeCurrency(){return this.state.nativeCurrency}setNativeCurrency(a){this.update({nativeCurrency:a,ticker:a})}getCurrentCurrency(){return this.state.currentCurrency}setCurrentCurrency(a){this.update({currentCurrency:a})}getConversionRate(){return this.state.conversionRate}setConversionRate(a){this.update({conversionRate:a})}getConversionDate(){return this.state.conversionDate}setConversionDate(a){this.update({conversionDate:a})}}var h8=a.i(7054);let h9=g6.default.getLogger("http-helpers");h9.setLevel(g6.levels.INFO);let ia="torus-default";async function ib(a,b){try{new URL(a)}catch{}return fetch(a,b)}function ic(){let a={};return ia&&(a["x-api-key"]=ia),a}function id(a){h9.info(`Response: ${a.status} ${a.statusText}`),h9.info(`Url: ${a.url}`)}let ie=async(a,b)=>{let c=null;try{let d=new Promise((b,d)=>{c=setTimeout(()=>{d(Error(`Timed out in ${a}ms`))},a)}),e=await Promise.race([b,d]);return null!=c&&clearTimeout(c),e}catch(a){throw null!=c&&clearTimeout(c),a}},ig=async(a,b={},c={})=>{let d={mode:"cors",headers:{}};c.useAPIKey&&(d.headers=(0,y.default)((0,y.default)({},d.headers),ic())),b.method="GET";let e=(0,h8.default)(d,b),f=await ib(a,e);if(f.ok){let a=f.headers.get("content-type");return null!=a&&a.includes("application/json")?f.json():f.text()}throw id(f),f},ih=(a,b={},c={},d={})=>{let e={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};d.useAPIKey&&(e.headers=(0,y.default)((0,y.default)({},e.headers),ic())),c.method="POST";let f=(0,h8.default)(e,c);return d.isUrlEncodedData?(f.body=b,"application/json; charset=utf-8"===f.headers["Content-Type"]&&delete f.headers["Content-Type"]):f.body=JSON.stringify(b),ie(d.timeout||6e4,ib(a,f).then(a=>{let b;if(d.logTracingHeader&&(b=a.headers.get("x-web3-correlation-id"))&&h9.info(`Request tracing with traceID = ${b}`),a.ok){let b=a.headers.get("content-type");return null!=b&&b.includes("application/json")?a.json():a.text()}throw id(a),a}))},ii=async(a,b={},c={},d={})=>{let e={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};d.useAPIKey&&(e.headers=(0,y.default)((0,y.default)({},e.headers),ic())),c.method="PATCH";let f=(0,h8.default)(e,c);d.isUrlEncodedData?(f.body=b,"application/json; charset=utf-8"===f.headers["Content-Type"]&&delete f.headers["Content-Type"]):f.body=JSON.stringify(b);let g=await ib(a,f);if(g.ok){let a=g.headers.get("content-type");return null!=a&&a.includes("application/json")?g.json():g.text()}throw id(g),g},ij=async(a,b={},c={},d={})=>{let e={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};d.useAPIKey&&(e.headers=(0,y.default)((0,y.default)({},e.headers),ic())),c.method="PUT";let f=(0,h8.default)(e,c);d.isUrlEncodedData?(f.body=b,"application/json; charset=utf-8"===f.headers["Content-Type"]&&delete f.headers["Content-Type"]):f.body=JSON.stringify(b);let g=await ib(a,f);if(g.ok){let a=g.headers.get("content-type");return null!=a&&a.includes("application/json")?g.json():g.text()}throw id(g),g},ik=async(a,b={},c={},d={})=>{let e={mode:"cors",headers:{"Content-Type":"application/json; charset=utf-8"}};d.useAPIKey&&(e.headers=(0,y.default)((0,y.default)({},e.headers),ic())),c.method="DELETE";let f=(0,h8.default)(e,c);d.isUrlEncodedData?(f.body=b,"application/json; charset=utf-8"===f.headers["Content-Type"]&&delete f.headers["Content-Type"]):f.body=JSON.stringify(b);let g=await ib(a,f);if(g.ok){let a=g.headers.get("content-type");return null!=a&&a.includes("application/json")?g.json():g.text()}throw id(g),g};class il extends h7{constructor({config:a,state:b,idleTimeTracker:c,onNetworkChanged:d}){super({config:a,state:b}),(0,z.default)(this,"pollingManager",void 0),this.defaultState=(0,y.default)((0,y.default)({},this.defaultState),{},{commonDenomination:"USD",commonDenominatorPrice:0}),this.initialize(),d(a=>{a.providerConfig.ticker.toUpperCase()!==this.state.nativeCurrency.toUpperCase()&&(this.setNativeCurrency(a.providerConfig.ticker),this.updateConversionRate())}),this.pollingManager=new h5(c,this.config.pollInterval)}setCommonDenomination(a){this.update({commonDenomination:a})}getCommonDenomination(){return this.state.commonDenomination}setCommonDenominatorPrice(a){this.update({commonDenominatorPrice:a})}getCommonDenominatorPrice(){return this.state.commonDenominatorPrice}async scheduleConversionInterval(){this.pollingManager.start(this.updateConversionRate.bind(this))}async updateConversionRate(){let a=this.getCurrentCurrency(),b=this.getNativeCurrency(),c=this.getCommonDenomination(),d=await this.retrieveConversionRate(b,a,c),e=Number.parseFloat(d[a.toUpperCase()]),f=Number.parseFloat(d[c.toUpperCase()]);e||f?(this.setConversionRate(e),this.setConversionDate(Math.floor(Date.now()/1e3).toString()),a.toUpperCase()===c.toUpperCase()?this.setCommonDenominatorPrice(e):this.setCommonDenominatorPrice(f)):(this.setConversionRate(0),this.setConversionDate("N/A"))}async retrieveConversionRate(a,b,c){try{let d=`${this.config.api}/currency?fsym=${a.toUpperCase()}&tsyms=${b.toUpperCase()}`;return c&&c.toUpperCase()!==b.toUpperCase()&&(d+=`,${c.toUpperCase()}`),await ig(d)}catch(c){g6.default.error(c,`CurrencyController - updateCommonDenominatorPrice: Failed to query rate for currency: ${a}/ ${b}`)}return{[b.toUpperCase()]:"0",[c.toUpperCase()]:"0"}}}var im=a.i(93176);function io(a,b){let c={};for(let[d,e]of Object.entries(a))b(e,d)||(c[d]=e);return c}function ip(a,b){let c={};for(let[d,e]of Object.entries(a))b(e,d)&&(c[d]=e);return c}function iq(a){try{return structuredClone(a)}catch{return JSON.parse(JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString():b))}}var ir=a.i(36603),is=a.i(34116),it=a.i(92743),iu=a.i(31247);let iv=["aBase","bBase"],iw=["aBase","bBase"],ix=["multiplicandBase","multiplierBase"],iy=new ir.BigNumber("1000000000000000000"),iz=new ir.BigNumber("1000000000"),iA=new ir.BigNumber("1"),iB={hex:a=>new ir.BigNumber((0,im.stripHexPrefix)(a),16),dec:a=>new ir.BigNumber(String(a),10),BN:a=>new ir.BigNumber(a.toString(16),16)},iC={WEI:a=>a.div(iy),GWEI:a=>a.div(iz),ETH:a=>a.div(iA)},iD={WEI:a=>a.times(iy).dp(0,ir.BigNumber.ROUND_HALF_UP),GWEI:a=>a.times(iz).dp(9,ir.BigNumber.ROUND_HALF_UP),ETH:a=>a.times(iA).dp(9,ir.BigNumber.ROUND_HALF_UP)},iE={hex:a=>a.toString(16),dec:a=>new ir.BigNumber(a).toString(10),BN:a=>new iu.default(a.toString(16))},iF=a=>Number.isInteger(a)&&a>1,iG=({value:a,fromNumericBase:b,fromDenomination:c,fromCurrency:d,toNumericBase:e,toDenomination:f,toCurrency:g,numberOfDecimals:h,conversionRate:i,invertConversionRate:j,roundDown:k})=>{let l=b?iB[b](a):a;if(c&&(l=iC[c](l)),d!==g){if(null==i)throw Error(`Converting from ${d} to ${g} requires a conversionRate, but one was not provided`);let a=iB.dec(i);j&&(a=new ir.BigNumber(1).div(i)),l=l.times(a)}return f&&(l=iD[f](l)),h&&(l=l.dp(h,ir.BigNumber.ROUND_HALF_DOWN)),k&&(l=l.dp(k,ir.BigNumber.ROUND_DOWN)),e&&(l=iE[e](l)),l},iH=(a,{fromCurrency:b=null,toCurrency:c=b,fromNumericBase:d,toNumericBase:e,fromDenomination:f,toDenomination:g,numberOfDecimals:h,conversionRate:i,invertConversionRate:j})=>b===c||i?iG({fromCurrency:b,toCurrency:c,fromNumericBase:d,toNumericBase:e,fromDenomination:f,toDenomination:g,numberOfDecimals:h,conversionRate:i,invertConversionRate:j,value:a}):0,iI=(a,b)=>{if(!iF(b))throw Error("Must specificy valid base");return"string"==typeof a||a instanceof ir.BigNumber?new ir.BigNumber(a,b):new ir.BigNumber(String(a),b)},iJ=(a,b,c={})=>{let{aBase:d,bBase:e}=c,f=(0,it.default)(c,iv);if(!iF(d)||!iF(e))throw Error("Must specify valid aBase and bBase");let g=iI(a,d).plus(iI(b,e));return iG((0,y.default)({value:g},f))},iK=(a,b,c={})=>{let{aBase:d,bBase:e}=c,f=(0,it.default)(c,iw);if(!iF(d)||!iF(e))throw Error("Must specify valid aBase and bBase");let g=iI(a,d).minus(iI(b,e));return iG((0,y.default)({value:g},f))},iL=(a,b,c={})=>{let{multiplicandBase:d,multiplierBase:e}=c,f=(0,it.default)(c,ix);if(!iF(d)||!iF(e))throw Error("Must specify valid multiplicandBase and multiplierBase");let g=iI(a,d).times(iI(b,e));return iG((0,y.default)({value:g},f))},iM=(a,b)=>{let c=Object.assign({},((0,is.default)(b),b)),d=Object.assign({},((0,is.default)(a),a)),e=iG((0,y.default)({},d)),f=iG((0,y.default)({},c));return e.gt(f)},iN=(a,b)=>{let c=Object.assign({},((0,is.default)(b),b)),d=Object.assign({},((0,is.default)(a),a)),e=iG((0,y.default)({},d)),f=iG((0,y.default)({},c));return e.lt(f)},iO=(a,b)=>{let c=Object.assign({},((0,is.default)(b),b)),d=Object.assign({},((0,is.default)(a),a));return iM((0,y.default)({},d),(0,y.default)({},c))?d.value:c.value},iP=(a,b)=>{let c=Object.assign({},((0,is.default)(b),b)),d=Object.assign({},((0,is.default)(a),a)),e=iG((0,y.default)({},d)),f=iG((0,y.default)({},c));return e.isGreaterThanOrEqualTo(f)},iQ=(a,b)=>{let c=Object.assign({},((0,is.default)(b),b)),d=Object.assign({},((0,is.default)(a),a)),e=iG((0,y.default)({},d)),f=iG((0,y.default)({},c));return e.isLessThanOrEqualTo(f)},iR=(a,b={})=>iL(a,-1,b),iS=a=>iH(a,{fromNumericBase:"dec",toNumericBase:"hex",fromDenomination:"GWEI",toDenomination:"WEI"}),iT=a=>iH(a,{fromNumericBase:"hex",toNumericBase:"dec",fromDenomination:"WEI",toDenomination:"GWEI"});function iU(a){return iT(iS(new ir.BigNumber(a)))}async function iV(a){let b=await ig(a);return{estimatedBaseFee:iU(b.estimatedBaseFee).toString(10),low:(0,y.default)((0,y.default)({},b.low),{},{suggestedMaxPriorityFeePerGas:iU(b.low.suggestedMaxPriorityFeePerGas).toString(10),suggestedMaxFeePerGas:iU(b.low.suggestedMaxFeePerGas).toString(10)}),medium:(0,y.default)((0,y.default)({},b.medium),{},{suggestedMaxPriorityFeePerGas:iU(b.medium.suggestedMaxPriorityFeePerGas).toString(10),suggestedMaxFeePerGas:iU(b.medium.suggestedMaxFeePerGas).toString(10)}),high:(0,y.default)((0,y.default)({},b.high),{},{suggestedMaxPriorityFeePerGas:iU(b.high.suggestedMaxPriorityFeePerGas).toString(10),suggestedMaxFeePerGas:iU(b.high.suggestedMaxFeePerGas).toString(10)})}}async function iW(a){let b,c,d=await a.request({method:"eth_feeHistory",params:[10,"latest",[10,50,95]]}),e=d.baseFeePerGas[d.baseFeePerGas.length-1],f=d.reward.filter(a=>"0x0"!==a[0]||"0x0"!==a[1]||"0x0"!==a[2]);if(f.length>0)b=f.reduce((a,b)=>({slow:a.slow.plus(new ir.BigNumber(b[0],16)),average:a.average.plus(new ir.BigNumber(b[1],16)),fast:a.fast.plus(new ir.BigNumber(b[2],16))}),{slow:new ir.BigNumber(0),average:new ir.BigNumber(0),fast:new ir.BigNumber(0)}),c=f.length;else{let d=await a.request({method:"eth_maxPriorityFeePerGas"}),e=new ir.BigNumber(d,16);b={slow:e,average:e.multipliedBy(1.1),fast:e.multipliedBy(1.5)},c=1}return{estimatedBaseFee:iT(e).toString(10),high:{maxWaitTimeEstimate:3e4,minWaitTimeEstimate:15e3,suggestedMaxFeePerGas:iT(b.fast.div(c).plus(e).toString(16)).toString(),suggestedMaxPriorityFeePerGas:iT(b.fast.div(c).toString(16)).toString()},medium:{maxWaitTimeEstimate:45e3,minWaitTimeEstimate:15e3,suggestedMaxFeePerGas:iT(b.average.div(c).plus(e).toString(16)).toString(),suggestedMaxPriorityFeePerGas:iT(b.average.div(c).toString(16)).toString()},low:{maxWaitTimeEstimate:6e4,minWaitTimeEstimate:15e3,suggestedMaxFeePerGas:iT(b.slow.div(c).plus(e).toString(16)).toString(),suggestedMaxPriorityFeePerGas:iT(b.slow.div(c).toString(16)).toString()}}}async function iX(a){let b=await ig(a,{referrer:a,referrerPolicy:"no-referrer-when-downgrade",method:"GET"});return{low:b.SafeGasPrice,medium:b.ProposeGasPrice,high:b.FastGasPrice}}async function iY(a){return{gasPrice:iT(await a.request({method:hb.METHOD_TYPES.ETH_GET_GAS_PRICE})).toString()}}class iZ extends D{constructor({config:a,state:b,idleTimeTracker:c,getNetworkIdentifier:d,getProvider:e,fetchGasEstimates:f=iV,fetchEthGasPriceEstimate:g=iY,fetchLegacyGasPriceEstimates:h=iX,fetchGasEstimatesViaEthFeeHistory:i=iW,getCurrentNetworkLegacyGasAPICompatibility:j,getCurrentNetworkEIP1559Compatibility:k,getCurrentAccountEIP1559Compatibility:l,onNetworkStateChange:m}){super({config:a,state:b}),(0,z.default)(this,"name","GasFeeController"),(0,z.default)(this,"API_SUPPORTED_CHAINIDS",new Set(["0x1","0x5","0xa4b1","0xa86a","0x2105","0x38","0xfa","0xa","0x89"])),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"currentChainId",void 0),(0,z.default)(this,"getNetworkIdentifier",void 0),(0,z.default)(this,"getProvider",void 0),(0,z.default)(this,"fetchGasEstimates",void 0),(0,z.default)(this,"fetchGasEstimatesViaEthFeeHistory",void 0),(0,z.default)(this,"fetchEthGasPriceEstimate",void 0),(0,z.default)(this,"fetchLegacyGasPriceEstimates",void 0),(0,z.default)(this,"getCurrentNetworkEIP1559Compatibility",void 0),(0,z.default)(this,"getCurrentAccountEIP1559Compatibility",void 0),(0,z.default)(this,"getCurrentNetworkLegacyGasAPICompatibility",void 0),(0,z.default)(this,"pollingManager",void 0),this.getNetworkIdentifier=d,this.getProvider=e,this.fetchGasEstimates=f,this.fetchEthGasPriceEstimate=g,this.fetchLegacyGasPriceEstimates=h,this.getCurrentNetworkEIP1559Compatibility=k,this.getCurrentNetworkLegacyGasAPICompatibility=j,this.getCurrentAccountEIP1559Compatibility=l,this.fetchGasEstimatesViaEthFeeHistory=i,this.defaultConfig={interval:3e4,legacyAPIEndpoint:"https://api.metaswap.codefi.network/gasPrices",EIP1559APIEndpoint:"https://mock-gas-server.herokuapp.com/"},this.defaultState={gasFeeEstimates:{},estimatedGasFeeTimeBounds:{},gasEstimateType:hb.GAS_ESTIMATE_TYPES.NONE},this.currentChainId=this.getNetworkIdentifier(),this.provider=this.getProvider(),this.initialize(),m(()=>{this.onNetworkStateChange()}),this.pollingManager=new h5(c,this.config.interval)}async onNetworkStateChange(){this.provider=this.getProvider();let a=this.getNetworkIdentifier();this.currentChainId!==a&&(this.currentChainId=a,await this.fetchGasFeeEstimates())}async resetPolling(){this.stopPolling(),await this.getGasFeeEstimatesAndStartPolling()}async fetchGasFeeEstimates(){return this._fetchGasFeeEstimateData()}async getGasFeeEstimatesAndStartPolling(){await this._fetchGasFeeEstimateData(),this._startPolling()}disconnectPoller(){this.stopPolling()}destroy(){this.stopPolling()}stopPolling(){this.resetState()}async _fetchGasFeeEstimateData(){let a,b,c=this.getCurrentNetworkLegacyGasAPICompatibility(),d=this.getNetworkIdentifier();if("loading"===d)return;"string"==typeof d&&(0,im.isHexString)((0,he.addHexPrefix)(d))&&(b=Number.parseInt(d,16));try{a=await this.getEIP1559Compatibility(),g6.default.info("eip1559 compatible",a)}catch(b){g6.default.warn(b),a=!1}let e=iq(this.defaultState);try{if(a){let a;try{if(this.API_SUPPORTED_CHAINIDS.has(d))a=await this.fetchGasEstimates(this.config.EIP1559APIEndpoint.replace("<chain_id>",`${b}`));else throw Error("ChainId not supported by api")}catch{a=await this.fetchGasEstimatesViaEthFeeHistory(this.provider)}let{suggestedMaxPriorityFeePerGas:c,suggestedMaxFeePerGas:f}=a.medium,g=this.getTimeEstimate(c,f);e={gasFeeEstimates:a,estimatedGasFeeTimeBounds:g,gasEstimateType:hb.GAS_ESTIMATE_TYPES.FEE_MARKET}}else if(c)e={gasFeeEstimates:await this.fetchLegacyGasPriceEstimates(this.config.legacyAPIEndpoint.replace("<chain_id>",`${b}`)),estimatedGasFeeTimeBounds:{},gasEstimateType:hb.GAS_ESTIMATE_TYPES.LEGACY};else throw Error("Main gas fee/price estimation failed. Use fallback")}catch{try{e={gasFeeEstimates:await this.fetchEthGasPriceEstimate(this.provider),estimatedGasFeeTimeBounds:{},gasEstimateType:hb.GAS_ESTIMATE_TYPES.ETH_GASPRICE}}catch(a){throw Error(`Gas fee/price estimation failed. Message: ${a.message}`)}}return this.update(e),e}async _startPolling(){this.pollingManager.start(async()=>{await this._fetchGasFeeEstimateData()})}resetState(){this.update(iq(this.defaultState))}async getEIP1559Compatibility(){var a,b;let c=await this.getCurrentNetworkEIP1559Compatibility(),d=null==(a=null==(b=this.getCurrentAccountEIP1559Compatibility)?void 0:b.call(this))||a;return c&&d}getTimeEstimate(a,b){return this.state.gasFeeEstimates&&this.state.gasEstimateType===hb.GAS_ESTIMATE_TYPES.FEE_MARKET?function(a,b,c){let d,e,{low:f,medium:g,high:h,estimatedBaseFee:i}=c,j=new ir.BigNumber(iS(new ir.BigNumber(a)),16),k=new ir.BigNumber(iS(new ir.BigNumber(b)),16),l=new ir.BigNumber(iS(new ir.BigNumber(i)),16),m=ir.BigNumber.min(j,k.minus(l)),n=new ir.BigNumber(iS(new ir.BigNumber(f.suggestedMaxPriorityFeePerGas)),16),o=new ir.BigNumber(iS(new ir.BigNumber(g.suggestedMaxPriorityFeePerGas)),16),p=new ir.BigNumber(iS(new ir.BigNumber(h.suggestedMaxPriorityFeePerGas)),16);return m.lt(n)?(d=null,e="unknown"):m.gte(n)&&m.lt(o)?(d=f.minWaitTimeEstimate,e=f.maxWaitTimeEstimate):m.gte(o)&&m.lt(p)?(d=g.minWaitTimeEstimate,e=g.maxWaitTimeEstimate):(d=m.eq(p)?h.minWaitTimeEstimate:0,e=h.maxWaitTimeEstimate),{lowerTimeBound:d,upperTimeBound:e}}(a,b,this.state.gasFeeEstimates):{}}}var i$=a.i(60458);class i_ extends D{constructor({config:a={},state:b}){var c;super({config:a,state:b}),this.defaultState={wallets:null!=(c=b.wallets)?c:[]},this.initialize()}async signAuthMessage(a,b){let c=this.state.wallets.find(b=>b.address===a);if(!c)throw Error("key does not exist");let d=(0,h4.hashMessage)(b).toString("hex");return await (0,h4.signMessage)(c.privateKey,d)}}class i0 extends i_{constructor({config:a,state:b}){super({config:a,state:b}),this.defaultState={wallets:[]},this.initialize()}async signTransaction(a,b){let c=this._getWalletForAccount(b);return a.signature=new fL((0,he.addHexPrefix)(c.privateKey)).sign(a.unsignedHash),a}getAccounts(){return this.state.wallets.map(a=>a.publicKey)}importAccount(a){let b=a.padStart(64,"0"),c=Buffer.from(b,"hex"),d=(0,he.bytesToHex)((0,i$.privateToPublic)(c)),e=(0,i$.toChecksumAddress)((0,he.bytesToHex)((0,i$.privateToAddress)(c))),f=this.state.wallets.find(a=>a.address===e);return f?f.address:(this.update({wallets:[...this.state.wallets,{publicKey:d,privateKey:a,address:e}]}),e)}removeAccount(a){let b=[...this.state.wallets],c=b.findIndex(b=>b.address===a);-1!==c&&(b.splice(c,1),this.update({wallets:b}))}getBufferPrivateKey(a){let b=(0,im.stripHexPrefix)(a);return Buffer.from(b,"hex")}async signMessage(a,b){let c=this._getWalletForAccount(b),d=this.getBufferPrivateKey(c.privateKey),e=(0,h4.ecsignature)(Buffer.from((0,im.stripHexPrefix)(a),"hex"),d);return(0,h4.concatSig)(Buffer.from((0,he.bigIntToBytes)(e.v)),Buffer.from(e.r),Buffer.from(e.s))}async signPersonalMessage(a,b){var c;let d=this._getWalletForAccount(b),e=new fL((0,he.addHexPrefix)(d.privateKey)),f=(0,im.isHexString)(a)?Buffer.from((0,im.stripHexPrefix)(a),"hex"):Buffer.from(a);return e.sign(("string"==typeof(c=f)&&(c=bx(c)),a4($([bx("\x19Ethereum Signed Message:\n"),bx(String(c.length)),c])))).serialized}async signTypedData(a,b){let c=this._getWalletForAccount(b),d=new fL((0,he.addHexPrefix)(c.privateKey));return delete a.types.EIP712Domain,d.sign(cG.hash(a.domain,a.types,a.message)).serialized}_getWalletForAccount(a){let b=a.toLowerCase(),c=this.state.wallets.find(a=>a.address.toLowerCase()===b);if(!c)throw Error("Torus Keyring - Unable to find matching address.");return c}}function i1(a){if(a){if("string"==typeof a)return[a];else if("object"==typeof a&&!Array.isArray(a)){let{message:b,data:c}=a;if(b&&"string"!=typeof b)throw Error("Must specify string message.");return[null!=b?b:void 0,c]}}return[]}function i2(a,b){let[c,d]=i1(b);return new hK(a,null!=c?c:hA(a),d)}let i3=a=>i2(hp,a),i4=a=>i2(hr,a),i5=a=>(function(a,b){let[c,d]=i1(b);return new hL(a,null!=c?c:hA(a),d)})(hs,a),i6="unapproved",i7="signed",i8="rejected",i9="failed",ja="unapprovedMessage";class jb extends D{constructor({config:a,state:b}){super({config:a,state:b}),(0,z.default)(this,"messages",void 0),this.defaultState={unapprovedMessages:{},unapprovedMessagesCount:0},this.messages=[],this.defaultConfig={},super.initialize()}getMessage(a){return this.messages.find(b=>b.id===a)}getAllMessages(){return this.messages}setMetadata(a,b){let c=this.getMessage(a);if(!c)throw Error(`${this.name}: Message not found for id: ${a}.`);c.metadata=b,this.updateMessage(c)}getUnapprovedMessages(){return this.messages.filter(a=>a.status===i6).reduce((a,b)=>(a[b.id]=b,a),{})}async addMessage(a){this.messages.push(a),this.saveMessageList()}approveMessage(a,b){return this.setMessageStatus(a,"approved"),this.prepMessageForSigning(b)}setMessageStatus(a,b){let c=this.getMessage(a);if(!c)throw Error(`${this.name}: Message not found for id: ${a}.`);c.status=b,this.updateMessage(c),this.emit(`${a}:${b}`,c),(b===i8||b===i7||b===i9)&&this.emit(`${a}:finished`,c)}async waitForFinishStatus(a,b){return new Promise((c,d)=>{this.once(`${a.id}:finished`,e=>e.status===i8?d(i5(`${b} Signature: User denied message signature`)):e.status===i9?d(i4(`${b} Signature: failed to sign message ${e.error}`)):e.status===i7?c(e.rawSig):d(i4(`${b} Signature: Unknown problem: ${JSON.stringify(a)}`)))})}updateMessage(a){let b=this.messages.findIndex(b=>a.id===b.id);-1!==b&&(this.messages[b]=a),this.saveMessageList()}saveMessageList(){let a=this.getUnapprovedMessages(),b=Object.keys(a).length;this.update({unapprovedMessages:a,unapprovedMessagesCount:b})}}var jc=a.i(85566);let jd=/^[0-9A-Fa-f]+$/gu;function je(a,b){if(!a||"string"!=typeof a||!(0,i$.isValidAddress)(a))throw Error(`Invalid "${b}" address: ${a} must be a valid string.`)}function jf(a){let{from:b,data:c}=a;if(je(b,"from"),!c||"string"!=typeof c)throw Error(`Invalid message "data": ${c} must be a valid string.`)}function jg(a){try{let b=(0,im.stripHexPrefix)(a);if(b.match(jd))return(0,he.addHexPrefix)(b)}catch{}return(0,he.bytesToHex)(Buffer.from(a,"utf8"))}async function jh(a,b){let c;if(je(a.from,"from"),!a.data||Array.isArray(a.data)||"object"!=typeof a.data&&"string"!=typeof a.data)throw Error('Invalid message "data": Must be a valid string or object.');if("object"==typeof a.data)c=a.data;else try{c=JSON.parse(a.data)}catch{throw Error("Data must be passed as a valid JSON string.")}if(!b)throw Error("Current chainId cannot be null or undefined.");let{chainId:d}=c.domain;if(d){"string"==typeof d&&(d=parseInt(d,d.startsWith("0x")?16:10));let a=parseInt(b,16);if(Number.isNaN(a))throw Error(`Cannot sign messages for chainId "${d}", because MetaMask is switching networks.`);if(d!==a)throw Error(`Provided chainId "${d}" must match the active chainId "${a}"`)}}async function ji(a){let{chainId:b,rpcUrls:c,nativeCurrency:d}=a||{};if(!b)throw Error("Invalid add chain params: please pass chainId in params");if(!W(b))throw Error("Invalid add chain params: please pass a valid hex chainId in params, for: ex: 0x1");if(!c||0===c.length)throw Error("params.rpcUrls not provided");if(!d)throw Error("params.nativeCurrency not provided");let{name:e,symbol:f,decimals:g}=d;if(!e)throw Error("params.nativeCurrency.name not provided");if(!f)throw Error("params.nativeCurrency.symbol not provided");if(void 0===g)throw Error("params.nativeCurrency.decimals not provided");let h=new g4(c[0],"any"),{chainId:i}=await h.getNetwork();if(Number.parseInt(i.toString())!==Number.parseInt(b,16))throw Error(`Provided rpc url's chainId version is not matching with provided chainId, expected: ${ao(i)}, received: ${b}`)}function jj(a){let{chainId:b}=a||{};if(!b)throw Error("Invalid switch chain params: please pass chainId in params");if(!W(b)){let[a,c]=b.split(":");if(a!==jc.CHAIN_NAMESPACES.SOLANA&&a!==jc.CHAIN_NAMESPACES.EIP155)throw Error("Invalid switch chain params: invalid namespace");if(!c||isNaN(Number(c)))throw Error("Invalid switch chain params: invalid chainId")}}class jk extends jb{constructor({config:a,state:b,addChain:c}){super({config:a,state:b}),(0,z.default)(this,"name","AddChainController"),(0,z.default)(this,"addChain",void 0),this.addChain=c,this.initialize()}async processAddChain(a){let b=this.getMessage(a);if(!b)throw Error("Message not found");try{return await this.approveMessage(a,b.messageParams),await this.addChain(b.messageParams),this.updateMessage((0,y.default)((0,y.default)({},b),{},{rawSig:JSON.stringify(b.messageParams)})),this.setMessageStatus(a,i7),null}catch(c){g6.default.error(c),b.error=(null==c?void 0:c.message)||(null==c?void 0:c.toString()),this.setMessageStatus(a,i9)}}async addNewUnapprovedMessage(a,b){return await this.addUnapprovedMessage(a,b),this.waitForFinishStatus(a,this.name)}async addUnapprovedMessage(a,b){b&&(a.origin=b.origin),await ji(a);let c=a.id||(0,h4.randomId)(),d={id:c,messageParams:a,status:i6,time:Date.now(),type:hb.METHOD_TYPES.ADD_CHAIN};return await this.addMessage(d),this.emit(ja,{messageData:d,req:b}),c}prepMessageForSigning(a){return Promise.resolve(a)}}class jl extends jb{constructor({config:a,state:b,signMessage:c}){super({config:a,state:b}),(0,z.default)(this,"name","MessageController"),(0,z.default)(this,"signMessage",void 0),this.signMessage=c,this.initialize()}async processSignMessage(a){let b=this.getMessage(a);if(!b)throw Error("Message not found");try{let c=await this.approveMessage(a,b.messageParams),d=await this.signMessage(c.data,c.from);return this.updateMessage((0,y.default)((0,y.default)({},b),{},{rawSig:d})),this.setMessageStatus(a,i7),d}catch(c){g6.default.error(c),b.error=(null==c?void 0:c.message)||(null==c?void 0:c.toString()),this.setMessageStatus(a,i9)}}async addNewUnapprovedMessage(a,b){return await this.addUnapprovedMessage(a,b),this.waitForFinishStatus(a,this.name)}async addUnapprovedMessage(a,b){jf(a),b&&(a.origin=b.origin),a.data=jg(a.data);let c=a.id||(0,h4.randomId)(),d={id:c,messageParams:a,status:i6,time:Date.now(),type:hb.METHOD_TYPES.ETH_SIGN};return await this.addMessage(d),this.emit(ja,{messageData:d,req:b}),c}prepMessageForSigning(a){return Promise.resolve(a)}}class jm extends jb{constructor({config:a,state:b,signPersonalMessage:c}){super({config:a,state:b}),(0,z.default)(this,"name","PersonalMessageController"),(0,z.default)(this,"signPersonalMessage",void 0),this.signPersonalMessage=c,this.initialize()}async processSignPersonalMessage(a){let b=this.getMessage(a);if(!b)throw Error("Message not found");try{let c=await this.approveMessage(a,b.messageParams),d=await this.signPersonalMessage(c.data,c.from);return this.updateMessage((0,y.default)((0,y.default)({},b),{},{rawSig:d})),this.setMessageStatus(a,i7),d}catch(c){g6.default.error(c),b.error=(null==c?void 0:c.message)||(null==c?void 0:c.toString()),this.setMessageStatus(a,i9)}}async addNewUnapprovedMessage(a,b){return await this.addUnapprovedMessage(a,b),this.waitForFinishStatus(a,this.name)}async addUnapprovedMessage(a,b){jf(a),b&&(a.origin=b.origin),a.data=jg(a.data);let c=a.id||(0,h4.randomId)(),d={id:c,messageParams:a,status:i6,time:Date.now(),type:hb.METHOD_TYPES.PERSONAL_SIGN};return await this.addMessage(d),this.emit(ja,{messageData:d,req:b}),c}prepMessageForSigning(a){return Promise.resolve(a)}}class jn extends jb{constructor({config:a,state:b,switchChain:c}){super({config:a,state:b}),(0,z.default)(this,"name","SwitchChainController"),(0,z.default)(this,"switchChain",void 0),this.switchChain=c,this.initialize()}async processSwitchChain(a){let b=this.getMessage(a);if(!b)throw Error("Message not found");try{return await this.approveMessage(a,b.messageParams),this.switchChain({chainId:b.messageParams.chainId}),this.updateMessage((0,y.default)((0,y.default)({},b),{},{rawSig:JSON.stringify(b.messageParams)})),this.setMessageStatus(a,i7),null}catch(c){g6.default.error(c),b.error=(null==c?void 0:c.message)||(null==c?void 0:c.toString()),this.setMessageStatus(a,i9)}}async addNewUnapprovedMessage(a,b){return await this.addUnapprovedMessage(a,b),this.waitForFinishStatus(a,this.name)}async addUnapprovedMessage(a,b){jj(a),b&&(a.origin=b.origin);let c=a.id||(0,h4.randomId)(),d={id:c,messageParams:a,status:i6,time:Date.now(),type:hb.METHOD_TYPES.SWITCH_CHAIN};return await this.addMessage(d),this.emit(ja,{messageData:d,req:b}),c}prepMessageForSigning(a){return Promise.resolve(a)}}class jo extends jb{constructor({config:a,state:b,signTypedData:c,getNetworkIdentifier:d}){super({config:a,state:b}),(0,z.default)(this,"name","TypedMessageController"),(0,z.default)(this,"signTypedData",void 0),(0,z.default)(this,"getNetworkIdentifier",void 0),this.signTypedData=c,this.getNetworkIdentifier=d,this.initialize()}async processSignTypedMessage(a){let b=this.getMessage(a);if(!b)throw Error("Message not found");try{let c=await this.approveMessage(a,b.messageParams),d=JSON.parse(c.data),e=await this.signTypedData(d,c.from);return this.updateMessage((0,y.default)((0,y.default)({},b),{},{rawSig:e})),this.setMessageStatus(a,i7),e}catch(c){g6.default.error(c),b.error=(null==c?void 0:c.message)||(null==c?void 0:c.toString()),this.setMessageStatus(a,i9)}}async addNewUnapprovedMessage(a,b){return await this.addUnapprovedMessage(a,b),this.waitForFinishStatus(a,this.name)}async addUnapprovedMessage(a,b){let c=this.getNetworkIdentifier();await jh(a,c),"string"!=typeof a.data&&(a.data=JSON.stringify(a.data)),b&&(a.origin=b.origin);let d=a.id||(0,h4.randomId)(),e={id:d,messageParams:a,status:i6,time:Date.now(),type:hb.METHOD_TYPES.ETH_SIGN_TYPED_DATA_V4};return await this.addMessage(e),this.emit(ja,{messageData:e,req:b}),d}prepMessageForSigning(a){return Promise.resolve(a)}}let jp=((u={}).UserUnauthorized="user.unauthorized",u);function jq(a){return async(b,c,d,e)=>{let f,g=new Promise(a=>{f=a}),h=null,i=!1,j=async()=>{i=!0,d(a=>{h=a,f()}),await g};try{await a(b,c,j),i?(await g,h(null)):e(null)}catch(a){h?h(a):e(a)}}}var jr=a.i(99214),js=a.i(698);let jt=["Gateway timeout","ETIMEDOUT","failed to parse response body","Failed to fetch"];function ju({rpcTarget:a,originHttpHeaderKey:b,analytics:c,providerConfig:d}){return jq(async(e,f,g)=>{let{fetchUrl:h,fetchParams:i}=function({req:a,rpcTarget:b,originHttpHeaderKey:c}){let d=new URL(b),e={id:a.id,jsonrpc:a.jsonrpc,method:a.method,params:a.params},f=a.origin,g={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)};return c&&f&&(g.headers[c]=f),{fetchUrl:d.href,fetchParams:g}}({req:e,rpcTarget:a,originHttpHeaderKey:b}),j=Date.now(),k=!Object.values(js.ANALYTICS_TRACKED_NETWORK_JPRC_METHODS).includes(e.method),l={chain_id:(0,h4.getCaipChainId)(d),chain_rpc_target:(0,h4.getHostname)(h),method:e.method};for(let a=0;a<5;a++){try{let a=await fetch(h,i);switch(a.status){case 405:throw i3();case 418:throw i4({message:"Request is being rate limited.",data:{cause:a}});case 503:case 504:throw i4({message:"Gateway timeout. The request took too long to process.This can happen when querying over too wide a block range.",data:{cause:a}})}let b=await a.json();f.result=function(a,b){if(200!==a.status)throw i4({message:`Non-200 status code: '${a.status}'`,data:b});if(b.error){var c;throw i4({data:b.error,message:null==(c=b.error)?void 0:c.message})}return b.result}(a,b),k||null==c||c.track(js.ANALYTICS_EVENTS.JRPC_REQUEST_COMPLETED,(0,y.default)((0,y.default)({request_type:js.ANALYTICS_JRPC_REQUEST_TYPES.NETWORK},l),{},{duration:Date.now()-j}));return}catch(b){let a=(b.message||b).toString();if(!jt.some(b=>a.includes(b)))throw k||null==c||c.track(js.ANALYTICS_EVENTS.JRPC_REQUEST_FAILED,(0,y.default)((0,y.default)({request_type:js.ANALYTICS_JRPC_REQUEST_TYPES.NETWORK},l),{},{error_code:null==b?void 0:b.code,error_message:a,duration:Date.now()-j})),await (0,jr.serializeError)(b)}await new Promise(a=>{setTimeout(a,1e3)})}})}function jv(a,b){return jq(async(c,d,e)=>{let{method:f}=c;if(f!==a)return e();if(!b)throw Error(`CommunicationMiddleware - ${a} not provided`);let g=await b(c);if(!g)return e();d.result=g})}function jw({getAccounts:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.GET_ACCOUNTS)return d();if(!a)throw Error("WalletMiddleware - opts.getAccounts not provided");c.result=await a(b)})}function jx({processTransaction:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.ETH_TRANSACTION)return d();if(!a)throw Error("WalletMiddleware - opts.processTransaction not provided");c.result=await a(b.params,b)})}function jy({processSignTransaction:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.ETH_SIGN_TRANSACTION)return d();if(!a)throw Error("WalletMiddleware - opts.processSignTransaction not provided");c.result=await a(b.params,b)})}function jz({processEstimateUserOperationGas:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.ETH_ESTIMATE_AA_TRANSACTION_GAS)return d();if(!a)throw Error("WalletMiddleware - opts.processEstimateUserOperationGas not provided");c.result=await a(b.params,b)})}function jA({processEthSignMessage:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.ETH_SIGN)return d();if(!a)throw Error("WalletMiddleware - opts.processEthSignMessage not provided");if(!(null!=b&&b.params))throw Error("WalletMiddleware - missing params");let f=b.params;if(Array.isArray(b.params)){if(2!==b.params.length)throw Error(`WalletMiddleware - incorrect params for ${e} method. expected [address, message]`);let a=b.params;f={from:a[0],data:a[1]}}c.result=await a(f,b)})}function jB({processTypedMessageV4:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.ETH_SIGN_TYPED_DATA_V4)return d();if(!a)throw Error("WalletMiddleware - opts.processTypedMessageV4 is not provided");if(!(null!=b&&b.params))throw Error("WalletMiddleware - missing params");let f=b.params;if(Array.isArray(b.params)){if(2!==b.params.length)throw Error(`WalletMiddleware - incorrect params for ${e} method. expected [address, typedData]`);let a=b.params;f={from:a[0],data:a[1]}}c.result=await a(f,b)})}function jC({processPersonalMessage:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.PERSONAL_SIGN)return d();if(!a)throw Error("WalletMiddleware - opts.processPersonalMessage is not provided");if(!(null!=b&&b.params))throw Error("WalletMiddleware - missing params");let f=b.params;if(Array.isArray(b.params)){if(!(b.params.length>=2))throw Error(`WalletMiddleware - incorrect params for ${e} method. expected [message, address]`);let a=b.params;if("object"==typeof a[0]){let{challenge:b,address:c}=a[0];f={from:c,data:b}}else{let b=a[0];f={from:a[1],data:b}}}c.result=await a(f,b)})}function jD({getPendingNonce:a}){return jq(async(b,c,d)=>{let{params:e,method:f}=b;if(f!==hb.METHOD_TYPES.ETH_GET_TRANSACTION_COUNT)return d();let{blockReference:g}=e;if("pending"!==g)return d();c.result=await a(e,b)})}function jE(a){let{r:b,s:c,v:d,txReceipt:e,transaction:f,transactionHash:g,accessList:h}=a,{to:i,data:j,nonce:k,gas:l,from:m,value:n,gasPrice:o,maxFeePerGas:p,maxPriorityFeePerGas:q}=f,r={v:d,r:b,s:c,to:i,gas:l,from:m,hash:g,nonce:k,input:j||"0x",value:n||"0x0",accessList:h||null,blockHash:(null==e?void 0:e.blockHash)||null,blockNumber:(null==e?void 0:e.blockNumber)||null,transactionIndex:(null==e?void 0:e.transactionIndex)||null,type:null};return p&&q?(r.maxFeePerGas=p,r.maxPriorityFeePerGas=q,r.type=hb.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET):(r.gasPrice=o,r.type=hb.TRANSACTION_ENVELOPE_TYPES.LEGACY),r}function jF({getPendingTransactionByHash:a}){return jq(async(b,c,d)=>{let{params:e,method:f}=b;if(f!==hb.METHOD_TYPES.ETH_GET_TRANSACTION_BY_HASH)return d();if(!a)throw Error("WalletMiddleware - opts.getPendingTransactionByHash not provided");let g=await a(e,b);if(!g)return d();c.result=jE(g)})}function jG({processSwitchEthereumChain:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.SWITCH_CHAIN)return d();if(!a)throw Error("WalletMiddleware - opts.processSwitchEthereumChain not provided");if(!(null!=b&&b.params))throw Error("WalletMiddleware - missing params");let f=b.params;if(Array.isArray(b.params)){if(1!==b.params.length)throw Error(`WalletMiddleware - incorrect params for ${e} method. expected [data]`);let[a]=b.params;f=a}c.result=await a(f,b)})}function jH({processWalletSwitchChain:a}){return jq(async(b,c,d)=>{let{method:e}=b;if("wallet_switchChain"!==e)return d();if(!a)throw Error("WalletMiddleware - opts.processWalletSwitchChain not provided");if(!(null!=b&&b.params))throw Error("WalletMiddleware - missing params");let f=b.params;if(Array.isArray(b.params)){if(1!==b.params.length)throw Error(`WalletMiddleware - incorrect params for ${e} method. expected [data]`);let[a]=b.params;f=a}c.result=await a(f,b)})}function jI({processAddEthereumChain:a}){return jq(async(b,c,d)=>{let{method:e}=b;if(e!==hb.METHOD_TYPES.ADD_CHAIN)return d();if(!a)throw Error("WalletMiddleware - opts.processAddEthereumChain not provided");if(!(null!=b&&b.params))throw Error("WalletMiddleware - missing params");let f=b.params;if(Array.isArray(b.params)){if(1!==b.params.length)throw Error(`WalletMiddleware - incorrect params for ${e} method. expected [data]`);let[a]=b.params;f=a}c.result=await a(f,b)})}function jJ({requestAccounts:a}){return jq(async(b,c,d)=>{let{method:e}=b;if("eth_requestAccounts"!==e)return d();if(!a)throw Error("WalletMiddleware - opts.requestAccounts not provided");c.result=await a(b)})}function jK({bundlerUrl:a,paymasterUrl:b,providerConfig:c,analytics:d}){let e=[],f=ju({rpcTarget:a,providerConfig:c,analytics:d});if(e.push((a,b,c,d)=>{if(!hb.BUNDLER_METHOD_TYPES.includes(a.method)&&!hb.PAYMASTER_METHOD_TYPES.includes(a.method))return c();let e=a.id,f=Math.floor(1e6*Math.random());a.id=f,b.id=f,c(c=>{a.id=e,b.id=e,c()})}),e.push((a,b,c,d)=>{if(!hb.BUNDLER_METHOD_TYPES.includes(a.method))return c();f(a,b,c,d)}),b){let a=ju({rpcTarget:b,providerConfig:c,analytics:d});e.push((b,c,d,e)=>{if(!hb.PAYMASTER_METHOD_TYPES.includes(b.method))return d();a(b,c,d,e)})}return hO(e)}function jL(a,b,c){var d;let{requestAccounts:e,getAccounts:f,getPrivateKey:g,getPublicKey:h,processTransaction:i,processSignTransaction:j,processEstimateUserOperationGas:k,processEthSignMessage:l,processTypedMessageV4:m,processPersonalMessage:n,getPendingNonce:o,getPendingTransactionByHash:p,processSwitchEthereumChain:q,processWalletSwitchChain:r,processAddEthereumChain:s,getProviderState:t,aaConfig:u,version:v}=a,w=[(d={version:v,wallet_get_provider_state:t},(a,b,c,e)=>{let f=d[a.method];return void 0===f?c():"function"==typeof f?f(a,b,c,e):(b.result=f,e())}),jJ({requestAccounts:e}),jw({getAccounts:f}),jv(hb.METHOD_TYPES.ETH_PRIVATE_KEY,g),jv(hb.METHOD_TYPES.PRIVATE_KEY,g),jv(hb.METHOD_TYPES.ETH_PUBLIC_KEY,h),jv(hb.METHOD_TYPES.PUBLIC_KEY,h),jx({processTransaction:i}),jy({processSignTransaction:j}),jz({processEstimateUserOperationGas:k}),jA({processEthSignMessage:l}),jB({processTypedMessageV4:m}),jC({processPersonalMessage:n}),jD({getPendingNonce:o}),jF({getPendingTransactionByHash:p}),jG({processSwitchEthereumChain:q}),jH({processWalletSwitchChain:r}),jI({processAddEthereumChain:s})];return u&&w.push(jK({bundlerUrl:u.bundlerUrl,paymasterUrl:u.paymasterUrl,providerConfig:b,analytics:c})),hO(w)}var jM=a.i(70611);let jN=((v={}).Block="block",v.Fork="fork",v.Never="never",v.Permanent="perma",v);function jO(a,b){var c;let d=b?function(a){if(!a.params)return[];let b=function(a){switch(a){case"eth_getStorageAt":return 2;case"eth_getBalance":case"eth_getCode":case"eth_getTransactionCount":case"eth_call":return 1;case"eth_getBlockByNumber":return 0;default:return}}(a.method);return void 0===b||!Array.isArray(a.params)||b>=a.params.length?a.params:"eth_getBlockByNumber"===a.method?a.params.slice(1):a.params.slice(0,b)}(a):null!=(c=a.params)?c:[];return function(a){switch(a){case"web3_clientVersion":case"web3_sha3":case"eth_protocolVersion":case"eth_getBlockTransactionCountByHash":case"eth_getUncleCountByBlockHash":case"eth_getCode":case"eth_getBlockByHash":case"eth_getTransactionByHash":case"eth_getTransactionByBlockHashAndIndex":case"eth_getTransactionReceipt":case"eth_getUncleByBlockHashAndIndex":case"eth_getCompilers":case"eth_compileLLL":case"eth_compileSolidity":case"eth_compileSerpent":case"shh_version":case"test_permaCache":return jN.Permanent;case"eth_getBlockByNumber":case"eth_getBlockTransactionCountByNumber":case"eth_getUncleCountByBlockNumber":case"eth_getTransactionByBlockNumberAndIndex":case"eth_getUncleByBlockNumberAndIndex":case"test_forkCache":return jN.Fork;case"eth_gasPrice":case"eth_blockNumber":case"eth_getBalance":case"eth_getStorageAt":case"eth_getTransactionCount":case"eth_call":case"eth_estimateGas":case"eth_getFilterLogs":case"eth_getLogs":case"test_blockCache":return jN.Block;default:return jN.Never}}(a.method)!==jN.Never?`${a.method}:${(0,jM.default)(d)}`:null}function jP(a){return(b,c,d,e)=>"eth_chainId"===b.method?(c.result=a,e()):"net_version"===b.method?(c.result=Number.parseInt(a,16).toString(10),e()):d()}function jQ(a){return(b,c,d,e)=>"eth_provider_config"===b.method?(c.result=a,e()):d()}function jR(a,b,c,d){let e,{chainId:f,rpcTarget:g}=a,h=ju({rpcTarget:g,providerConfig:a,analytics:d}),i=((e=new hN).push(h),hP(e)),j=new h6({config:(0,y.default)((0,y.default)({},b),{},{provider:i}),state:{},idleTimeTracker:c});return{networkMiddleware:hO([jP(f),jQ(a),function({cacheIdentifierForRequest:a}){let b={};async function c(a,b){let c,d,{resolve:e,promise:f}=(d=new Promise(a=>{c=a}),{resolve:c,promise:d});return b.push(b=>{a.result=iq(b.result),a.error=iq(b.error),e()}),f}return jq(async(d,e,f)=>{var g;if(d.skipCache)return f();let h=a(d);if(!h)return g6.default.info("Request is not cacheable, proceeding. req = %o",d),f();let i=b[h];if(i){g6.default.info("Running %i handler(s) for request %o",i.length,d),await c(e,i);return}i=[],b[h]=i,g6.default.info("Carrying original request forward %o",d),await f(),delete b[h],g6.default.info("Running %i collected handler(s) for request %o",i.length,d),g=i,setTimeout(()=>{g.forEach(a=>{try{a(e)}catch(a){g6.default.error(a)}})})})}({cacheIdentifierForRequest:jO}),h]),blockTracker:j}}let jS=()=>!0,jT=["newListener","removeListener"],jU=a=>!jT.includes(a),jV=["chainId","rpcTarget"];class jW extends D{constructor({config:a,state:b,idleTimeTracker:c,analytics:d}){super({config:a,state:b}),(0,z.default)(this,"name","NetworkController"),(0,z.default)(this,"providerProxy",void 0),(0,z.default)(this,"blockTrackerProxy",void 0),(0,z.default)(this,"mutex",new H),(0,z.default)(this,"provider",null),(0,z.default)(this,"blockTracker",null),(0,z.default)(this,"baseProviderHandlers",void 0),(0,z.default)(this,"idleTimeTracker",void 0),(0,z.default)(this,"analytics",void 0),this.defaultState={chainId:"loading",properties:{EIPS_1559:void 0},providerConfig:hb.SUPPORTED_NETWORKS[hb.MAINNET_CHAIN_ID]},this.analytics=d,this.initialize(),this.idleTimeTracker=c}getNetworkIdentifier(){return this.state.chainId}getNetworkRPCUrl(){return this.state.providerConfig.rpcTarget}initializeProvider(a){return this.baseProviderHandlers=a,this.configureProvider(),this.lookupNetwork(),this.providerProxy}getProvider(){return this.providerProxy}getBlockTracker(){return this.blockTrackerProxy}getProviderConfig(){return this.state.providerConfig}setProviderConfig(a){this.update({providerConfig:(0,y.default)({},a)}),this.refreshNetwork()}async getEIP1559Compatibility(){let{EIPS_1559:a}=this.state.properties;if(void 0!==a)return a;let b=await this.blockTracker.getLatestBlock(),c=b&&void 0!==b.baseFeePerGas;return this.update({properties:{EIPS_1559:c}}),c}async lookupNetwork(){let{chainId:a,rpcTarget:b}=this.getProviderConfig();if(!a||!b||!this.provider)return void this.update({chainId:"loading",properties:{}});let c=await this.mutex.acquire();try{let[a]=await Promise.all([this.provider.request({method:"eth_chainId"}),this.getEIP1559Compatibility()]);g6.default.info("network fetched chain id",a),this.update({chainId:a}),this.emit("networkDidChange")}catch{this.update({chainId:"loading"})}finally{c()}}configureProvider(){let a=this.getProviderConfig(),{chainId:b,rpcTarget:c}=a,d=(0,it.default)(a,jV);if(!b||!c)throw Error("chainId and rpcTarget must be provided in providerConfig");this.configureStandardProvider((0,y.default)({chainId:b,rpcTarget:c},d))}setNetworkClient({networkMiddleware:a,blockTracker:b}){let c=jL(this.baseProviderHandlers,this.getProviderConfig(),this.analytics),d=new hN;d.push(function({analytics:a,providerConfig:b}){return(c,d,e)=>{if(!Object.values(js.ANALYTICS_TRACKED_INTERNAL_JPRC_METHODS).includes(c.method))return e();let f=Date.now();e(e=>{let g={method:c.method,chain_id:(0,h4.getCaipChainId)(b),chain_rpc_target:(0,h4.getHostname)(b.rpcTarget),is_aa_provider_request:c.isAAProviderRequest};d.error?null==a||a.track(js.ANALYTICS_EVENTS.JRPC_REQUEST_FAILED,(0,y.default)((0,y.default)((0,y.default)({request_type:js.ANALYTICS_JRPC_REQUEST_TYPES.INTERNAL},g),(0,h4.getErrorAnalyticsProperties)(d.error)),{},{duration:Date.now()-f})):null==a||a.track(js.ANALYTICS_EVENTS.JRPC_REQUEST_COMPLETED,(0,y.default)((0,y.default)({request_type:js.ANALYTICS_JRPC_REQUEST_TYPES.INTERNAL},g),{},{duration:Date.now()-f})),e()})}}({providerConfig:this.getProviderConfig(),analytics:this.analytics})),d.push(c),d.push(a);let e=hP(d);this.setProvider({provider:e,blockTracker:b})}setProvider({provider:a,blockTracker:b}){if(this.providerProxy)this.providerProxy.setTarget(a);else{let b,c;this.providerProxy=(b=a,c=a=>{b=a},new Proxy({},{get:(a,d)=>"setTarget"===d?c:b[d],set:(a,d,e)=>("setTarget"===d?c=e:b[d]=e,!0),has:(a,c)=>"_"!==c[0]&&c in b}))}this.blockTrackerProxy?this.blockTrackerProxy.setTarget(b):this.blockTrackerProxy=function(a,b){let c=(b||{}).eventFilter||jS;if("string"==typeof c&&"skipInternal"===c&&(c=jU),"function"!=typeof c)throw Error("createEventEmitterProxy - Invalid eventFilter");let d=a,e=a=>{if(d===a)return;let b=d;d=a,b.eventNames().filter(c).forEach(c=>{(void 0!==b.rawListeners?b.rawListeners(c):b.listeners(c)).forEach(b=>{a.on(c,b)})}),b.removeAllListeners()};return new Proxy({},{get:(a,b)=>"setTarget"===b?e:d[b],set:(a,b,c)=>("setTarget"===b?e=c:d[b]=c,!0),has:(a,b)=>"_"!==b[0]&&b in d})}(b,{eventFilter:"skipInternal"}),this.provider=a,a.setMaxListeners(10),this.blockTracker=b}configureStandardProvider(a){let b=jR(a,this.config,this.idleTimeTracker,this.analytics);g6.default.info("networkClient",b),this.setNetworkClient(b)}refreshNetwork(){this.update({chainId:"loading",properties:{}}),this.configureProvider(),this.lookupNetwork()}}let jX=new dj(g7),jY=new dj(g8),jZ=new dj(g9),j$={from:(a,b=!0)=>b?(0,he.addHexPrefix)(a).toLowerCase():(0,he.addHexPrefix)(a),to:(a,b=!0)=>b?(0,he.addHexPrefix)(a).toLowerCase():(0,he.addHexPrefix)(a),nonce:a=>(0,he.addHexPrefix)(a),customNonceValue:a=>(0,he.addHexPrefix)(a),value:a=>(0,he.addHexPrefix)(a),data:a=>(0,he.addHexPrefix)(a),gas:a=>(0,he.addHexPrefix)(a),gasPrice:a=>(0,he.addHexPrefix)(a),type:he.addHexPrefix,maxFeePerGas:he.addHexPrefix,maxPriorityFeePerGas:he.addHexPrefix,callGasLimit:he.addHexPrefix,preVerificationGas:he.addHexPrefix,verificationGasLimit:he.addHexPrefix,paymasterVerificationGasLimit:he.addHexPrefix,paymasterPostOpGasLimit:he.addHexPrefix};function j_(a,b=!0){let c={id:a.id||(0,h4.randomId)(),from:a.from};for(let d in j$)a[d]&&(c[d]=j$[d](a[d],b));return c}function j0(a,b){return void 0!==a.chainId&&a.chainId===b}function j1(a){var b,c;return(0,im.isHexString)((0,he.addHexPrefix)(null==a||null==(b=a.transaction)?void 0:b.maxFeePerGas))&&(0,im.isHexString)((0,he.addHexPrefix)(null==a||null==(c=a.transaction)?void 0:c.maxPriorityFeePerGas))}function j2(a){return void 0===a.transaction.maxFeePerGas&&void 0===a.transaction.maxPriorityFeePerGas&&(void 0===a.transaction.gasPrice||(0,im.isHexString)((0,he.addHexPrefix)(a.transaction.gasPrice)))}function j3(a,b,c){if(void 0!==a[c]){let a;throw a=`Invalid transaction params: specified ${b} but also included ${c}, these cannot be mixed`,i2(hq,a)}}function j4(a,b){if("string"!=typeof a[b]){let c;throw c=`Invalid transaction params: ${b} is not a string. got: (${a[b]})`,i2(hq,c)}}function j5(a,b){switch(b){case"maxFeePerGas":case"maxPriorityFeePerGas":if(a.type&&a.type!==hb.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET){let b;throw b=`Invalid transaction envelope type: specified type "${a.type}" but including maxFeePerGas and maxPriorityFeePerGas requires type: "${hb.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET}"`,i2(hq,b)}break;default:if(a.type&&a.type===hb.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET){let b;throw b=`Invalid transaction envelope type: specified type "${a.type}" but included a gasPrice instead of maxFeePerGas and maxPriorityFeePerGas`,i2(hq,b)}}}function j6(a){if("string"!=typeof a.from){let b;throw b=`Invalid "from" address "${a.from}": not a string.`,i2(hq,b)}if(!(0,i$.isValidAddress)(a.from)){let a;throw a='Invalid "from" address.',i2(hq,a)}}function j7(a){if("0x"===a.to||null===a.to)if(a.data)delete a.to;else{let a;throw a='Invalid "to" address.',i2(hq,a)}else if(void 0!==a.to&&!(0,i$.isValidAddress)(a.to)){let a;throw a='Invalid "to" address.',i2(hq,a)}return a}function j8(a,b=!0){if(!a||"object"!=typeof a||Array.isArray(a)){let a;throw a="Invalid transaction params: must be an object.",i2(hq,a)}if(!a.to&&!a.data){let a;throw a='Invalid transaction params: must specify "data" for contract deployments, or "to" (and optionally "data") for all other types of transactions.',i2(hq,a)}if(j1({transaction:a})&&!b){let a;throw a="Invalid transaction params: params specify an EIP-1559 transaction but the current network does not support EIP-1559",i2(hq,a)}Object.entries(a).forEach(([b,c])=>{switch(b){case"from":j6(a);break;case"to":j7(a);break;case"gasPrice":j5(a,"gasPrice"),j3(a,"gasPrice","maxFeePerGas"),j3(a,"gasPrice","maxPriorityFeePerGas"),j4(a,"gasPrice");break;case"maxFeePerGas":j5(a,"maxFeePerGas"),j3(a,"maxFeePerGas","gasPrice"),j4(a,"maxFeePerGas");break;case"maxPriorityFeePerGas":j5(a,"maxPriorityFeePerGas"),j3(a,"maxPriorityFeePerGas","gasPrice"),j4(a,"maxPriorityFeePerGas");break;case"value":if(j4(a,"value"),c.toString().includes("-")){let a;throw a=`Invalid transaction value "${c}": not a positive number.`,i2(hq,a)}if(c.toString().includes(".")){let a;throw a=`Invalid transaction value of "${c}": number must be in wei.`,i2(hq,a)}break;case"chainId":if("number"!=typeof c&&"string"!=typeof c){let a;throw a=`Invalid transaction params: ${b} is not a Number or hex string. got: (${c})`,i2(hq,a)}break;default:j4(a,b)}})}function j9(a,b=!0){let c=j_(a,b);return j8(c),c}function ka(){return[hf.rejected,hf.confirmed,hf.failed,hf.dropped]}function kb(a){try{let b=jX.parseTransaction({data:a});if(b)return{name:b.name,methodParams:b.args.toArray(),type:hb.CONTRACT_TYPE_ERC20}}catch{}try{let b=jY.parseTransaction({data:a});if(b)return{name:b.name,methodParams:b.args.toArray(),type:hb.CONTRACT_TYPE_ERC721}}catch{}try{let b=jZ.parseTransaction({data:a});if(b)return{name:b.name,methodParams:b.args.toArray(),type:hb.CONTRACT_TYPE_ERC1155}}catch{}}let kc=async(a,b)=>{let c;try{c=await a.request({method:hb.METHOD_TYPES.ETH_GET_CODE,params:[b,"latest"]})}catch{c=null}let d=!!c&&"0x"!==c&&"0x0"!==c;return{contractCode:c,isContractAddress:d}};async function kd(a,b){let c,{data:d,to:e}=a,f="",g=[],h="";try{({name:f,methodParams:g,type:h}=d&&kb(d)||{})}catch(a){g6.default.debug("Failed to parse transaction data",a)}let i="";if(d&&!e)c="contractDeployment";else{let{contractCode:g,isContractAddress:h}=await kc(b,e);if(i=g,h){let b=a.value&&0!==Number(a.value),e=["approve","transfer","transferFrom","safeTransferFrom","setApprovalForAll"].find(a=>{var b;return a.toLowerCase()===(null==(b=f)?void 0:b.toLowerCase())});c=d&&e&&!b?e:"contractInteraction"}else c=hg}return{type:h||hb.CONTRACT_TYPE_ETH,category:c,methodParams:g,getCodeResponse:i}}function ke(a){return new ir.BigNumber((0,im.stripHexPrefix)(a),16)}function kf(a){return(0,he.addHexPrefix)(a.toString(16))}function kg(a,b){return hb.SUPPORTED_NETWORKS[b]?`${hb.SUPPORTED_NETWORKS[b].blockExplorerUrl}/tx/${a}`:""}let kh=a=>{var b;let{transaction:c,lowerCaseSelectedAddress:d,blockExplorerUrl:e}=a,f="";f=c.type===hb.CONTRACT_TYPE_ERC721||c.type===hb.CONTRACT_TYPE_ERC1155?c.symbol:c.type===hb.CONTRACT_TYPE_ERC20?(0,h4.formatSmallNumbers)(Number.parseFloat(c.total_amount),c.symbol,!0):(0,h4.formatSmallNumbers)(Number.parseFloat(c.total_amount),c.type_name,!0);let g=c.type===hb.CONTRACT_TYPE_ERC721||c.type===hb.CONTRACT_TYPE_ERC1155||c.isEtherscan?"":(0,h4.formatSmallNumbers)(Number.parseFloat(c.currency_amount),c.selected_currency,!0);return{id:c.created_at.toString(),date:new Date(c.created_at).toString(),from:c.from,from_aa_address:c.from_aa_address,slicedFrom:"string"==typeof c.from?(0,h4.addressSlicer)(c.from):"",to:c.to,slicedTo:"string"==typeof c.to?(0,h4.addressSlicer)(c.to):"",action:d===(null==(b=c.to)?void 0:b.toLowerCase())?"walletActivity.receive":"walletActivity.send",totalAmount:c.total_amount,totalAmountString:f,currencyAmount:c.currency_amount,currencyAmountString:g,amount:`${f} / ${g}`,status:c.status,etherscanLink:e?`${e}/tx/${c.transaction_hash}`:"",chainId:c.chain_id,ethRate:Number.parseFloat(null==c?void 0:c.total_amount)&&Number.parseFloat(null==c?void 0:c.currency_amount)?`1 ${c.symbol} = ${(0,h4.significantDigits)(Number.parseFloat(c.currency_amount)/Number.parseFloat(c.total_amount))}`:"",currencyUsed:c.selected_currency,type:c.type,type_name:c.type_name,type_image_link:c.type_image_link,transaction_hash:c.transaction_hash,transaction_category:c.transaction_category,isEtherscan:c.isEtherscan,input:c.input||"",token_id:c.token_id||"",contract_address:c.contract_address||"",nonce:c.nonce||"",is_cancel:!!c.is_cancel,gas:c.gas||"",gasPrice:c.gasPrice||""}},ki=async(a,b)=>{try{let c=await b.request({method:hb.METHOD_TYPES.ETH_GET_TRANSACTION_RECEIPT,params:[a]});if(null===c)return hf.submitted;if(c&&"0x1"===c.status)return hf.confirmed;if(c&&"0x0"===c.status)return hf.rejected;return}catch(a){g6.default.warn("unable to fetch transaction status",a);return}};function kj(a){let b=new Date(a),c=b.getDate(),d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][b.getMonth()],e=b.getFullYear();return`${c} ${d} ${e}`}function kk(a){return new Date(a).toTimeString().slice(0,8)}function kl(a,b){return(0,i$.isValidAddress)(a)}function km(a,b){return kl(a)?(0,i$.toChecksumAddress)(a):a}let kn={SIMPLE:(0,he.addHexPrefix)("5208"),BASE_TOKEN_ESTIMATE:(0,he.addHexPrefix)("186a0")};function ko(a,b){return null==a||null==b?null:new ir.BigNumber(a,10).lt(b,10)}let kp=a=>`https://infura-ipfs.io/${a}`;function kq(a){let b=a;return null!=a&&a.startsWith("ipfs")&&(b=kp(a.split("ipfs://")[1])),b}function kr(a){return a===hb.MAINNET_CHAIN_ID?"mainnet":hb.TEST_CHAINS.includes(a)?"testnet":"custom"}let ks=async a=>{let{txn:b,lowerCaseSelectedAddress:c,provider:d,chainId:e,blockExplorerUrl:f}=a;return(await Promise.all(b.map(async a=>{var b,c;let{category:f,type:g}=await kd((0,y.default)((0,y.default)({},a),{},{data:a.input}),d);return a.transaction_category=a.transaction_category||f,a.type_image_link=(null==(b=hb.SUPPORTED_NETWORKS[e])?void 0:b.logo)||"",a.type_name=null==(c=hb.SUPPORTED_NETWORKS[e])?void 0:c.ticker,a.type=g,a}))).reduce((a,b)=>{var d,g;let h=b.value?new ir.BigNumber(b.value).div(new ir.BigNumber(10).pow(new ir.BigNumber(b.tokenDecimal||18))).toString():"",i=hb.CONTRACT_TYPE_ETH;""!==b.contractAddress&&(i=b.tokenID?b.tokenValue?hb.CONTRACT_TYPE_ERC1155:hb.CONTRACT_TYPE_ERC721:hb.CONTRACT_TYPE_ERC20),i===hb.CONTRACT_TYPE_ERC1155&&(h=b.tokenValue);let j={type:i,type_image_link:b.type_image_link||"n/a",type_name:b.tokenName||(null==(d=hb.SUPPORTED_NETWORKS[e])?void 0:d.ticker)||"n/a",symbol:b.tokenSymbol||(null==(g=hb.SUPPORTED_NETWORKS[e])?void 0:g.ticker),token_id:b.tokenID||"",total_amount:h,created_at:new Date(1e3*Number(b.timeStamp)),from:b.from,to:b.to,transaction_hash:b.hash,status:b.txreceipt_status&&"0"===b.txreceipt_status?hf.failed:hf.confirmed,isEtherscan:!0,input:b.input,contract_address:b.contractAddress,transaction_category:b.transaction_category,gas:`0x${new ir.BigNumber(b.gasUsed||0,10).toString(16)}`,gasPrice:`0x${new ir.BigNumber(b.gasPrice||0,10).toString(16)}`,chain_id:e,currency_amount:"",nonce:b.nonce,from_aa_address:"",is_cancel:!1,selected_currency:""};return a.push(kh({transaction:j,lowerCaseSelectedAddress:c,blockExplorerUrl:f})),a},[])};class kt{constructor({chainId:a,contractAddress:b,contractImage:c,contractName:d,contractSymbol:e,nftStandard:f,provider:g,contractDescription:h,contractFallbackLogo:i,contractSupply:j}){(0,z.default)(this,"contractAddress",void 0),(0,z.default)(this,"contractName",void 0),(0,z.default)(this,"contractSymbol",void 0),(0,z.default)(this,"contractImage",void 0),(0,z.default)(this,"contractSupply",void 0),(0,z.default)(this,"contractFallbackLogo",void 0),(0,z.default)(this,"nftStandard",void 0),(0,z.default)(this,"contractDescription",void 0),(0,z.default)(this,"chainId",void 0),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"isSpecial",void 0),this.chainId=a,this.contractAddress=b,this.contractImage=c,this.contractName=d,this.contractSymbol=e,this.nftStandard=f,this.provider=g,this.contractDescription=h,this.contractFallbackLogo=i,this.contractSupply=j}async getNftMetadata(a,b){let c=(0,y.default)({description:"",image:"",name:"",tokenBalance:"",tokenId:"",decimals:"1"},b),[d,e]=await Promise.all([this.getCollectibleTokenURI(c.tokenId,this.nftStandard),!c.tokenBalance?this.fetchNftBalance(a,c.tokenId):Promise.resolve("0")]);c.tokenBalance=c.tokenBalance||e;try{let a=JSON.parse(d);c.image=c.image||kq(a.image),c.name=c.name||a.name,c.description=c.description||a.description,c.decimals=c.decimals||a.decimals}catch(a){g6.default.warn("Token uri is not a valid json object",a)}let f=kq(d);try{if(!c.description||!c.image||!c.name){let a=await ig(f);c.image=c.image||kq(a.image),c.name=c.name||a.name,c.description=c.description||a.description,c.decimals=c.decimals||a.decimals}}catch(a){g6.default.error("Failed to fetch nft metadata",a)}return c}async getContractMetadata(){let a={chainId:this.chainId,contractAddress:this.contractAddress,contractName:this.contractName,contractSymbol:this.contractSymbol,nftStandard:this.nftStandard,contractImage:this.contractImage,contractDescription:this.contractDescription,contractFallbackLogo:this.contractFallbackLogo,contractSupply:this.contractSupply};if(!this.nftStandard){let{standard:b,isSpecial:c}=await this.checkNftStandard();a.nftStandard=b,this.nftStandard=b,this.isSpecial=c}if(!this.contractName||!this.contractSymbol||!this.contractDescription){let b=this.nftStandard===hb.CONTRACT_TYPE_ERC721?g8:g9,c=new d$(this.contractAddress,b,this.provider),[d,e]=await Promise.all([c.name(),c.symbol()]);a.contractName=d,a.contractSymbol=e,this.contractName||(this.contractName=d),this.contractSymbol||(this.contractSymbol=e)}return a}async fetchNftBalance(a,b){let{standard:c}=await this.checkNftStandard(),d=c===hb.CONTRACT_TYPE_ERC721?g8:g9,e=new d$(this.contractAddress,d,this.provider);if(c===hb.CONTRACT_TYPE_ERC1155)return await e.balanceOf(a,b);let f="";try{f=await e.ownerOf(b)}catch{throw Error("Token id doesn't exists")}return f.toLowerCase()===a.toLowerCase()?"1":"0"}async checkNftStandard(){if(!this.nftStandard||void 0===this.isSpecial){if(Object.prototype.hasOwnProperty.call(hb.OLD_ERC721_LIST,this.contractAddress.toLowerCase()))return this.nftStandard=hb.CONTRACT_TYPE_ERC721,this.isSpecial=!0,{standard:hb.CONTRACT_TYPE_ERC721,isSpecial:!0};if(await this.contractSupportsInterface(hb.CONTRACT_TYPE_ERC721,hb.ERC721_INTERFACE_ID))return this.nftStandard=hb.CONTRACT_TYPE_ERC721,this.isSpecial=!1,{standard:hb.CONTRACT_TYPE_ERC721,isSpecial:!1};if(await this.contractSupportsInterface(hb.CONTRACT_TYPE_ERC1155,hb.ERC1155_INTERFACE_ID))return this.nftStandard=hb.CONTRACT_TYPE_ERC1155,this.isSpecial=!1,{standard:hb.CONTRACT_TYPE_ERC1155,isSpecial:!1};throw Error("Unsupported nft standard")}}async contractSupportsInterface(a,b){let c=a===hb.CONTRACT_TYPE_ERC721?g8:g9;return new d$(this.contractAddress,c,this.provider).supportsInterface(b)}async getCollectibleTokenURI(a,b=hb.CONTRACT_TYPE_ERC721){let c=b===hb.CONTRACT_TYPE_ERC721?"tokenURI":"uri",d=b===hb.CONTRACT_TYPE_ERC721?g8:g9;return new d$(this.contractAddress,d,this.provider)[c](a)}}class ku extends D{constructor({config:a,state:b,provider:c,getCustomNfts:d,getSimpleHashNfts:e,onPreferencesStateChange:f,onNetworkStateChange:g,idleTimeTracker:h}){super({config:a,state:b}),(0,z.default)(this,"name","NftsController"),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"ethersProvider",void 0),(0,z.default)(this,"getCustomNfts",void 0),(0,z.default)(this,"getSimpleHashNfts",void 0),(0,z.default)(this,"pollingManager",void 0),this.provider=c,this.ethersProvider=new g5(this.provider,"any"),this.getCustomNfts=d,this.getSimpleHashNfts=e,this.defaultConfig={interval:18e4,selectedAddress:"",chainId:""},this.defaultState={nfts:{}},this.initialize(),f(a=>{a.selectedAddress!==this.config.selectedAddress&&(this.configure({selectedAddress:a.selectedAddress}),this.restartNftDetection())}),g(a=>{let{chainId:b}=a.providerConfig;b!==this.config.chainId&&(this.configure({chainId:b}),this.restartNftDetection())}),this.pollingManager=new h5(h,this.config.interval)}get userSelectedAddress(){return this.config.selectedAddress}get userNfts(){var a;return this.userSelectedAddress&&null!=(a=this.state.nfts[this.userSelectedAddress])?a:[]}startNftDetection(a){this.configure({selectedAddress:a}),this.restartNftDetection()}restartNftDetection(){this.userSelectedAddress&&this.pollingManager.start(()=>{this.detectNewNfts(),this.refreshNftBalances()})}detectNewNfts(){let a=this.userSelectedAddress;if(!a)return;let b=this.config.chainId,c=[];if(!b)return void this.update({nfts:{[a]:[...c]}});if(this.getCustomNfts){let d=this.getCustomNfts(a).reduce((a,c)=>{if(c.network===b){let b={description:"",image:"",name:"",tokenBalance:"",tokenId:c.nft_id,customNftId:c.id.toString()};if(a[c.nft_address])a[c.nft_address].assets.push(b);else{let d={assets:[b],chainId:c.network,contractAddress:c.nft_address,contractName:"",contractSymbol:"",contractImage:"",nftStandard:c.nft_contract_standard,contractDescription:""};a[c.nft_address]=d}}return a},{});c.push(...Object.values(d))}this.update({nfts:{[a]:[...c]}})}async refreshNftBalances(a){let b=this.userSelectedAddress;if(""===b)return;let c=[...this.userNfts],d=[];try{let e=this.config.chainId;if(hb.MM_NFT_API_SUPPORTED_CHAINS.includes(e)){let c=await this.getSimpleHashNfts(b,e,a);d.push(...c),this.update({nfts:{[b]:d}})}c.length>0&&this.getNftBalancesUsingHandler(c)}catch(a){g6.default.error(a,"unable to fetch nft balances")}}async getNftBalancesUsingHandler(a){if(!this.userSelectedAddress)return;let b=this.userSelectedAddress,c=(await Promise.allSettled(a.map(async a=>{try{let c=new kt((0,y.default)((0,y.default)({},a),{},{provider:this.ethersProvider})),d=await c.getContractMetadata(),e=await Promise.allSettled(a.assets.map(a=>c.getNftMetadata(b,a)));return(0,y.default)((0,y.default)({},d),{},{assets:e.filter(a=>"fulfilled"===a.status).map(a=>a.value)})}catch(a){g6.default.warn("Invalid contract address while fetching",a);return}}))).filter(a=>"fulfilled"===a.status&&a.value).map(a=>a.value);this.update({nfts:{[b]:(0,h8.default)(this.userNfts,c)}})}}var kv=a.i(86164),kw=a.i(61861),kx=a.i(45747),ky=((w=ky||{})[w.GET=0]="GET",w[w.POST=1]="POST",w[w.PUT=2]="PUT",w[w.PATCH=3]="PATCH",w[w.DELETE=4]="DELETE",w);let kz=async(a,b)=>{try{return await a()}catch(a){throw(0,h4.isUnauthorizedError)(a)&&b.emit(jp.UserUnauthorized),a}},kA={selectedCurrency:"USD",theme:"dark",locale:"en",accountType:"normal",contacts:[],jwtToken:"",fetchedPastTx:[],pastTransactions:[],paymentTx:[],defaultPublicAddress:"",customTokens:[],customNfts:[],crashReport:!0,userInfo:{email:"",name:"",profileImage:"",authConnectionId:"",userId:"",authConnection:kv.AUTH_CONNECTION.GOOGLE,groupedAuthConnectionId:""}};class kB extends D{constructor({config:a,state:b,defaultPreferences:c,signAuthMessage:d,validateSignMessage:e}){if(super({config:a,state:b}),(0,z.default)(this,"name","PreferencesController"),(0,z.default)(this,"iframeOrigin",void 0),(0,z.default)(this,"wsApiClient",void 0),(0,z.default)(this,"chainNamespace",void 0),(0,z.default)(this,"signAuthMessage",void 0),(0,z.default)(this,"validateSignMessage",void 0),(0,z.default)(this,"defaultPreferences",void 0),!a.api)throw Error("PreferencesController - no api specified in config.");this.defaultState={identities:{},selectedAddress:"",lastErrorMessage:"",lastSuccessMessage:""},this.defaultConfig={api:a.api,pollInterval:18e4},this.initialize(),this.defaultPreferences=(0,y.default)((0,y.default)({},kA),c),this.signAuthMessage=d,this.validateSignMessage=e,this.wsApiClient=((a,b)=>{let c=(a,c,d,e,f)=>{var g;let h;if(g=e.jwtToken,h=1e3*(0,kx.jwtDecode)(g).exp,new Date().getTime()>=h)throw b.emit(jp.UserUnauthorized),new Response(null,{status:401,statusText:"Unauthorized"});let i=(0,y.default)({"Content-Type":"application/json; charset=utf-8"},(({jwtToken:a,publicAddress:b,eoaAddress:c,chainNamespace:d})=>{let e={Authorization:`Bearer ${a}`,"public-address":b,"chain-namespace":d};return c&&(e["eoa-address"]=c),{headers:e}})(e));return a===ky.GET?kz(()=>ig(c,i,f),b):a===ky.POST?kz(()=>ih(c,d,i,f),b):a===ky.PUT?kz(()=>ij(c,d,i,f),b):a===ky.PATCH?kz(()=>ii(c,d,i,f),b):a===ky.DELETE?kz(()=>ik(c,d,i,f),b):void 0};return{authGet:(b,d,e)=>c(ky.GET,`${a}/${b}`,{},d,e),authPost:(b,d,e,f)=>c(ky.POST,`${a}/${b}`,d,e,f),authPut:(b,d,e,f)=>c(ky.PUT,`${a}/${b}`,d,e,f),authPatch:(b,d,e,f)=>c(ky.PATCH,`${a}/${b}`,d,e,f),authRemove:(b,d,e,f)=>c(ky.DELETE,`${a}/${b}`,d,e,f)}})(this.config.api,this)}setIframeOrigin(a){this.iframeOrigin=a}getAddressState(a){let b=a||this.state.selectedAddress;return this.state.identities[b]}setSelectedAddress(a){this.update({selectedAddress:a})}async getUser(a){return(await this.wsApiClient.authGet("user?fetchTx=false",this.authCredentials(a),{useAPIKey:!0})).data}async createUser(a){let{selectedCurrency:b,theme:c,authConnectionId:d,groupedAuthConnectionId:e,userId:f,locale:g,address:h,idToken:i,type:j,web3AuthNetwork:k,metadata:l}=a,m=(0,y.default)({default_currency:b,theme:c,verifier:e||d,verifier_id:f,locale:g,idToken:i,account_type:j,web3auth_network:k},l);await this.wsApiClient.authPost("user",m,this.authCredentials(h),{useAPIKey:!0}),this.updateState({theme:c,defaultPublicAddress:h,selectedCurrency:b,locale:g,accountType:j},h)}async storeUserLogin(a){let{authConnectionId:b,groupedAuthConnectionId:c,userId:d,options:e,address:f,idToken:g,web3AuthClientId:h,web3AuthNetwork:i,sessionPubKey:j,loginMode:k}=a;if(!e.rehydrate){let a=kw.default.getParser(window.navigator.userAgent),e=(0,h4.getCustomDeviceInfo)(),l={os:a.getOSName(),os_version:a.getOSVersion()||"unidentified",browser:(null==e?void 0:e.browser)||a.getBrowserName()||"unidentified",browser_version:a.getBrowserVersion()||"unidentified",platform:a.getPlatform().type||"desktop",hostname:this.iframeOrigin,verifier:c||b,verifier_id:d,idToken:g,web3auth_client_id:h,web3auth_network:i,session_pub_key:j,login_mode:k};await this.wsApiClient.authPost("user/recordLogin",l,this.authCredentials(f),{useAPIKey:!0})}}async setCrashReport(a){var b;if(a===(null==(b=this.getAddressState())?void 0:b.crashReport))return!0;try{return await this.wsApiClient.authPatch("user",{enable_crash_reporter:a},this.authCredentials(),{useAPIKey:!0}),this.updateState({crashReport:a}),!0}catch(a){return g6.default.error(a),!1}}async setUserTheme(a){var b;if(a===(null==(b=this.getAddressState())?void 0:b.theme))return!0;try{return await this.wsApiClient.authPatch("user",{theme:a},this.authCredentials(),{useAPIKey:!0}),this.updateState({theme:a}),!0}catch(a){return g6.default.error(a),!1}}async setUserLocale(a){var b;if(a!==(null==(b=this.getAddressState())?void 0:b.locale))try{return await this.wsApiClient.authPatch("user",{locale:a},this.authCredentials(),{useAPIKey:!0}),this.updateState({locale:a}),!0}catch(a){return g6.default.error("unable to set locale",a),!1}}async setSelectedCurrency(a){var b;if(a.selectedCurrency===(null==(b=this.getAddressState())?void 0:b.selectedCurrency))return!0;try{return await this.wsApiClient.authPatch("user",{default_currency:a.selectedCurrency},this.authCredentials(),{useAPIKey:!0}),this.updateState({selectedCurrency:a.selectedCurrency}),!0}catch(a){return g6.default.error(a),!1}}async addContact(a){try{var b;let c=await this.wsApiClient.authPost("contact",a,this.authCredentials(),{useAPIKey:!0});return this.updateState({contacts:[...(null==(b=this.getAddressState())?void 0:b.contacts)||[],c.data]}),!0}catch(a){return g6.default.error("unable to add contact",a),!1}}async deleteContact(a){try{var b;let c=await this.wsApiClient.authRemove(`contact/${a}`,{},this.authCredentials(),{useAPIKey:!0}),d=null==(b=this.getAddressState())?void 0:b.contacts.filter(a=>a.id!==c.data.id);return d&&this.updateState({contacts:[...d]}),!0}catch(a){return g6.default.error("unable to delete contact",a),!1}}async revokeDiscord(a){try{let b=await this.wsApiClient.authPost("revoke/discord",{token:a},this.authCredentials(),{useAPIKey:!0});g6.default.info(b)}catch(a){g6.default.error(a)}}async patchPastTx(a,b){try{let c=await this.wsApiClient.authPatch("transaction",a,this.authCredentials(b),{useAPIKey:!0});g6.default.info("successfully patched",c)}catch(a){g6.default.error("unable to patch tx",a)}}async postPastTx(a,b){try{let c=await this.wsApiClient.authPost("transaction",a,this.authCredentials(b),{useAPIKey:!0});return g6.default.info("successfully posted tx",c),c}catch(a){g6.default.error(a,"unable to insert transaction")}}async getWalletOrders(a){try{let b=await this.wsApiClient.authGet("transaction",this.authCredentials(a),{useAPIKey:!0});return b.success&&b.data?b.data:[]}catch(a){return g6.default.error("unable to get wallet orders tx",a),[]}}async getTopUpOrders(a){try{return(await this.wsApiClient.authGet("transaction",this.authCredentials(a),{useAPIKey:!0})).data||[]}catch(a){g6.default.error("unable to fetch past Top up orders",a)}}async getBillBoardData(){try{let a=await this.wsApiClient.authGet("billboard",this.authCredentials(),{useAPIKey:!0});return a.success?a.data:[]}catch(a){return g6.default.error("unable to get billboard data",a),[]}}async getMessageForSigning(a,b){return(await ih(`${this.config.api}/auth/message`,{public_address:a,id_token:b,chain_namespace:this.chainNamespace},{},{useAPIKey:!0})).message}async getTwitterId(a){let b=await this.wsApiClient.authGet(`twitter?screen_name=${a.nick}`,this.authCredentials(),{useAPIKey:!0});return`${a.typeOfLogin.toLowerCase()}|${b.data.toString()}`}async sendEmail(a){return this.wsApiClient.authPost("transaction/sendemail",a.emailObject,this.authCredentials(),{useAPIKey:!0})}async refreshJwt(){let a=this.state.selectedAddress,b=await this.getMessageForSigning(a);await this.validateSignMessage(b);let c=await this.signAuthMessage(a,b),d=await ih(`${this.config.api}/auth/verify`,{challenge:b,public_address:a,signed_message:c,chain_namespace:this.chainNamespace},{},{useAPIKey:!0});this.updateState({jwtToken:d.token},a)}async getDappList(){try{let a=await this.wsApiClient.authGet("dapps",this.authCredentials(),{useAPIKey:!0});return a.success?a.data:[]}catch(a){return g6.default.error("unable to get dapps list",a),[]}}async init(a){let b,{address:c,userInfo:d,idToken:e,metadata:f={},type:g}=a;if(!this.getAddressState(c)){switch(g){case"external":if(!e)throw Error("SIWW idToken must be present");b=(await ih(`${this.config.api}/auth/verify`,(0,y.default)({account_type:g,public_address:c,id_token:e,verifier:d.groupedAuthConnectionId||d.authConnectionId,verifier_id:d.userId,chain_namespace:this.chainNamespace},f),{},{useAPIKey:!0})).token;break;case"imported":case"app_scoped_derived":case"account_abstraction":if(!e)throw Error("Web3Auth idToken must be present");b=(await ih(`${this.config.api}/auth/verify`,(0,y.default)({public_address:c,id_token:e,verifier:d.groupedAuthConnectionId||d.authConnectionId,verifier_id:d.userId,account_type:g,chain_namespace:this.chainNamespace},f),{},{useAPIKey:!0})).token;break;case"mpc":case"sfa":case"sfa_account_abstraction":if(!f.signatures)throw Error("web3auth signatures must be present");b=(await ih(`${this.config.api}/auth/verify`,(0,y.default)({public_address:c,verifier:d.groupedAuthConnectionId||d.authConnectionId,verifier_id:d.userId,account_type:g,chain_namespace:this.chainNamespace},f),{},{useAPIKey:!0})).token;break;default:if(!e)throw Error("Web3Auth idToken must be present");b=e}this.updateState({jwtToken:b,userInfo:d,accountType:null!=g?g:this.defaultPreferences.accountType},c)}}updateState(a,b){let c=b||this.state.selectedAddress,d=this.getAddressState(c)||iq(this.defaultPreferences),e=(0,y.default)((0,y.default)({},d),a);return this.update({identities:(0,y.default)((0,y.default)({},this.state.identities),{},{[c]:e})}),e}authCredentials(a){var b;let c=a||this.state.selectedAddress;return{jwtToken:(null==(b=this.getAddressState(c))?void 0:b.jwtToken)||"",publicAddress:c,chainNamespace:this.chainNamespace}}headers(a){var b;let c=a||this.state.selectedAddress;return(0,h4.getHeaders)((null==(b=this.getAddressState(c))?void 0:b.jwtToken)||"",c)}}class kC extends kB{constructor({config:a,state:b,provider:c,signAuthMessage:d,getProviderConfig:e,setProviderConfig:f,validateSignMessage:g}){super({config:a,state:b,defaultPreferences:{formattedPastTransactions:[],fetchedPastTx:[],paymentTx:[],etherscanTransactions:[]},signAuthMessage:d,validateSignMessage:g}),(0,z.default)(this,"chainNamespace",jc.CHAIN_NAMESPACES.EIP155),(0,z.default)(this,"_handle",void 0),(0,z.default)(this,"_mutex",new H),(0,z.default)(this,"getProviderConfig",void 0),(0,z.default)(this,"setProviderConfig",void 0),(0,z.default)(this,"provider",void 0),this.provider=c,this.getProviderConfig=e,this.setProviderConfig=f}async poll(a){var b;let c=await this._mutex.acquire();a&&this.configure({pollInterval:a}),this._handle&&window.clearTimeout(this._handle);let d=this.state.selectedAddress;!d||null!=(b=this.getAddressState(d))&&b.jwtToken&&(await this.sync(d),c(),this._handle=window.setTimeout(()=>{this.poll(this.config.pollInterval)},this.config.pollInterval))}async initPreferences(a){let{address:b,jwtToken:c,calledFromEmbed:d,userInfo:e,rehydrate:f,locale:g="en",type:h,signatures:i,web3AuthClientId:j,web3AuthNetwork:k,loginMode:l,sessionPubKey:m,aaProvider:n,eoaAddress:o,mainAddress:p}=a,{chainId:q}=this.getProviderConfig();await super.init({address:b,userInfo:e,idToken:c,type:h,metadata:{email:e.email,signatures:i,network:k,eoa_address:o,aa_provider:n,chain_id:q,main_address:p}});let{groupedAuthConnectionId:r,authConnectionId:s,userId:t}=e||{};if(!await this.sync(b)){let a=this.getAddressState(b);await this.createUser({selectedCurrency:a.selectedCurrency,theme:a.theme,groupedAuthConnectionId:r,authConnectionId:s,userId:t,locale:g,address:b,type:h,web3AuthNetwork:k,metadata:{aa_provider:n,chain_id:q,eoa_address:o}})}o&&this.updateState({eoaAddress:o},b),this.storeUserLogin({groupedAuthConnectionId:r,authConnectionId:s,userId:t,options:{calledFromEmbed:d,rehydrate:f},address:b,web3AuthClientId:j,web3AuthNetwork:k,sessionPubKey:m,loginMode:l})}getSelectedAddress(){return this.state.selectedAddress}async sync(a){try{let b=await this.getUser(a);if(b){let{default_currency:c,contacts:d,theme:e,locale:f,public_address:g,default_public_address:h,customNetworks:i,customTokens:j,customNfts:k,account_type:l}=b||{};return this.updateState({contacts:d,theme:e,selectedCurrency:c,locale:f,defaultPublicAddress:h||g,customTokens:j,customNfts:k,customNetworks:i,accountType:l},a),!0}return!1}catch(a){if((0,h4.isUnauthorizedError)(a))throw a;return g6.default.error(a),!1}finally{this.getWalletOrders(a).then(b=>{b&&b.length>0&&(this.updateState({fetchedPastTx:[...b]},a),this.calculatePastTx(b,a))}).catch(a=>g6.default.error(a))}}async patchNewTx(a,b){var c,d;let e=kh({transaction:a,blockExplorerUrl:this.getBlockExplorerUrl()}),f=(null==(c=this.getAddressState(b))?void 0:c.formattedPastTransactions)||[],g=f.findIndex(b=>b.transaction_hash===a.transaction_hash&&b.chainId===a.chain_id);if(a.status===hf.submitted||a.status===hf.confirmed)if(-1===g){let c=this.cancelTxCalculate([...f,e]);a.is_cancel=e.is_cancel,a.to=null==(d=a.to)?void 0:d.toLowerCase(),a.from=a.from.toLowerCase(),this.updateState({formattedPastTransactions:c},b),this.postPastTx(a,b)}else e.is_cancel=f[g].is_cancel,f[g]=e,this.updateState({formattedPastTransactions:this.cancelTxCalculate([...f])},b)}recalculatePastTx(a){let b=a||this.state.selectedAddress,c=this.getAddressState(b);null!=c&&c.fetchedPastTx&&this.calculatePastTx(c.fetchedPastTx,b)}async refetchEtherscanTx(a){var b;let c=a||this.state.selectedAddress;if(!c)return[];let d=null==c?void 0:c.toLowerCase();if(null!=(b=this.getAddressState(c))&&b.jwtToken){let{chainId:a}=this.getProviderConfig();if(hb.MM_TOKEN_API_SUPPORTED_CHAINS.includes(a)){let b=await this.fetchEtherscanTx({selectedAddress:c,chainId:this.getProviderConfig().chainId}),e=await ks({txn:b,lowerCaseSelectedAddress:d,provider:this.provider,chainId:a,blockExplorerUrl:this.getBlockExplorerUrl()});return g6.default.info("Formatted Etherscan Response",e),this.updateState({etherscanTransactions:e}),b}}}async fetchEtherscanTx(a){try{let b=await this.wsApiClient.authGet(`etherscan?chainId=${a.chainId}`,this.authCredentials(a.selectedAddress));return g6.default.info("Etherscan Response API",b),b.success?b.data:[]}catch(a){return g6.default.error("unable to fetch etherscan tx",a),[]}}async fetchQuote(a){try{let b=await this.wsApiClient.authPost("quote",a,this.authCredentials());return b.success?b.data:[]}catch(a){return g6.default.error("unable to get swap quote",a),[]}}async getEtherScanTokens(a,b,c){let d=`tokens?chainId=${b}&address=${a}`;return c&&(d+="&skipCache=true"),(await this.wsApiClient.authGet(d,this.authCredentials())).data}async getSimpleHashNfts(a,b,c){let d=`nfts?chainId=${b}&address=${a}`;return c&&(d+="&skipCache=true"),(await this.wsApiClient.authGet(d,this.authCredentials())).data}getCustomTokens(a){var b,c;return null!=(b=null==(c=this.getAddressState(a))?void 0:c.customTokens)?b:[]}getCustomNfts(a){var b,c;return null!=(b=null==(c=this.getAddressState(a))?void 0:c.customNfts)?b:[]}isChainIdSupported(a,b){return!!this.getChainOptions(a).find(a=>(0,im.stripHexPrefix)(a.chainId)===b)}async addChain(a){if(this.getChainOptions().find(b=>b.chainId===a.chainId))return;let b={displayName:a.chainName,rpcTarget:a.rpcUrls[0],ticker:a.nativeCurrency.symbol,chainId:a.chainId,blockExplorerUrl:a.blockExplorerUrls[0],tickerName:a.nativeCurrency.name,logo:a.nativeCurrency.symbol};if(!await this.addCustomNetwork({network:b}))throw Error("unable to add custom network")}switchChain(a){let b=this.getChainOptions().find(b=>b.chainId===a.chainId);if(b)this.setProviderConfig(b);else throw Error(`chainId ${a.chainId} is not supported`)}async addCustomNetwork({network:a}){try{let{selectedAddress:b}=this.state,c={network_name:a.displayName,rpc_url:a.rpcTarget,chain_id:a.chainId,symbol:a.ticker,block_explorer_url:a.blockExplorerUrl||void 0,is_testnet:a.isTestnet||!1,logo:a.logo,symbol_name:a.tickerName},d=await this.wsApiClient.authPost("customnetwork",c,this.authCredentials(b),{useAPIKey:!0});return await this.sync(b),d.data.id}catch{return g6.default.error("error adding custom network"),null}}async deleteCustomNetwork(a){try{let{selectedAddress:b}=this.state;return await this.wsApiClient.authRemove(`customnetwork/${a}`,{},this.authCredentials(b),{useAPIKey:!0}),await this.sync(b),!0}catch{return g6.default.error("error deleting custom network"),!1}}async editCustomNetwork({network:a,id:b}){try{let{selectedAddress:c}=this.state,d={network_name:a.displayName,rpc_url:a.rpcTarget,chain_id:a.chainId,symbol:a.ticker||void 0,block_explorer_url:a.blockExplorerUrl||void 0,is_testnet:a.isTestnet||!1};return await this.wsApiClient.authPatch(`customnetwork/${b}`,d,this.authCredentials(c),{useAPIKey:!0}),await this.sync(c),!0}catch{return g6.default.error("error editing custom network"),!1}}getChainOptions(a=this.state.selectedAddress){var b,c;let{identities:d}=this.state,e=Object.values(null!=(b=null==(c=d[a])?void 0:c.customNetworks)?b:[]).reduce((a,b)=>{let c={blockExplorerUrl:b.block_explorer_url,chainId:b.chain_id,displayName:b.network_name,logo:"eth.svg",rpcTarget:b.rpc_url,ticker:b.symbol,tickerName:b.symbol.toUpperCase(),isCustom:!0,id:b.id};return Object.keys(hb.SUPPORTED_NETWORKS).includes(c.chainId)||a.push(c),a},[]);return[...Object.values(hb.SUPPORTED_NETWORKS).reduce((a,b)=>(a.push(b),a),[]),...e]}getBlockExplorerUrl(){let a=this.getChainOptions().find(a=>a.chainId===this.getProviderConfig().chainId);return a?`${a.blockExplorerUrl}`:""}async calculatePastTx(a,b){let c=[],d=[],e=b.toLowerCase(),f=this.getChainOptions(b).find(a=>a.chainId===this.getProviderConfig().chainId);for(let b of a){var g;if((null==f?void 0:f.chainId)===b.chain_id&&b.to&&b.from&&(e===b.from.toLowerCase()||e===(null==(g=b.to)?void 0:g.toLowerCase())))if("confirmed"!==b.status)d.push(b);else{let a=kh({transaction:b,lowerCaseSelectedAddress:e,blockExplorerUrl:this.getBlockExplorerUrl()});c.push(a)}}let h=d.map(a=>ki(a.transaction_hash,this.provider).catch(a=>g6.default.error(a))),i=await Promise.all(h);for(let[a,f]of d.entries()){let d=kh({transaction:f,lowerCaseSelectedAddress:e,blockExplorerUrl:this.getBlockExplorerUrl()});d.status=i[a]||hf.submitted,c.push(d),e===f.from.toLowerCase()&&d.status&&d.status!==f.status&&this.patchPastTx({id:f.id,status:d.status},b)}let j=this.cancelTxCalculate(c);this.updateState({formattedPastTransactions:[...j]},b)}cancelTxCalculate(a){let b={};for(let c of a)b[c.nonce]?b[c.nonce].push(c):b[c.nonce]=[c];for(let[,a]of Object.entries(b))if(a.length>1){let b=a.sort((a,b)=>{let c=new Date(a.date).getTime();return new Date(b.date).getTime()-c}),c=b[0];c.is_cancel=!0,b.slice(1).forEach(a=>{a.hasCancel=!0,a.status="confirmed"===c.status?hf.cancelled:hf.cancelling,a.cancelDateInitiated=`${kk(new Date(c.date).getTime())} - ${kj(c.date)}`,a.etherscanLink=c.etherscanLink,a.cancelGas=c.gas,a.cancelGasPrice=c.gasPrice})}return a}}class kD{constructor({address:a,symbol:b,decimals:c,name:d,provider:e}){(0,z.default)(this,"address",void 0),(0,z.default)(this,"symbol",void 0),(0,z.default)(this,"decimals",void 0),(0,z.default)(this,"name",void 0),(0,z.default)(this,"contract",void 0),this.address=a,this.contract=new d$(a,g7,e),this.symbol=b,this.decimals=c,this.name=d}async getSymbol(){return this.symbol&&"ERC20"!==this.symbol||(this.symbol=await this.contract.symbol()),this.symbol}async getDecimals(){try{return this.decimals||(this.decimals=await this.contract.decimals()),this.decimals}catch(a){return g6.default.warn(`Could not get decimals for token ${this.address}`,a),0}}async getName(){return this.name||(this.name=await this.contract.name()),this.name}async getUserBalance(a){return this.decimals||await this.getDecimals(),(await this.contract.balanceOf(a)).toString(16)}}class kE extends D{constructor({config:a,state:b,idleTimeTracker:c,onPreferencesStateChange:d,onNetworkStateChange:e,onTokensStateChange:f}){super({config:a,state:b}),(0,z.default)(this,"pollingManager",void 0),this.defaultState=(0,y.default)((0,y.default)({},this.defaultState),{},{contractExchangeRates:{}}),this.initialize(),d(a=>{let{selectedAddress:b}=a;this.configure({selectedAddress:b})}),e(a=>{let{chainId:b,ticker:c}=a.providerConfig;this.configure({chainId:b,nativeCurrency:c})}),f(a=>{let{tokens:b}=a,c=b[this.config.selectedAddress];(null==c?void 0:c.length)>0&&this.config.tokens!==b[this.config.selectedAddress]&&(this.configure({tokens:b[this.config.selectedAddress]}),this.updateExchangeRates())}),this.pollingManager=new h5(c,this.config.pollInterval)}async scheduleConversionInterval(){this.pollingManager.start(this.updateExchangeRates.bind(this))}async updateExchangeRates(){let a=hb.COINGECKO_PLATFORMS_CHAIN_CODE_MAP[this.config.chainId],b={};a?b=await this.fetchExchangeRates(this.config.nativeCurrency,a):(g6.default.info(`ChainId ${this.config.chainId} not supported by coingecko`),this.config.tokens.forEach(a=>{b[a.tokenAddress]=void 0})),this.update({contractExchangeRates:b})}async fetchExchangeRates(a,b){let c=this.config.tokens.map(a=>a.tokenAddress);if(hb.COINGECKO_SUPPORTED_CURRENCIES.has(a.toLowerCase())){let d=await ig(`${this.config.currencyApi}/currency/exchange-rates?platform=${b.platform}&contract_addresses=${c.join(",")}&vs_currencies=${a.toLowerCase()}`),e={};return Object.keys(d).forEach(b=>{e[b]=d[b][a.toLowerCase()]||0}),e}let[d,e]=await Promise.all([ig(`${this.config.currencyApi}/currency/exchange-rates?platform=${b.platform}&contract_addresses=${c.join(",")}&vs_currencies=eth`),ig(`${this.config.currencyApi}/currency?fsym=${a.toUpperCase()}&tsyms=ETH`)]),f={};return Object.keys(d).forEach(a=>{f[a]=d[a].eth*Number.parseFloat(e.eth)||0}),f}}class kF extends D{constructor({config:a,state:b,provider:c,idleTimeTracker:d,getCustomTokens:e,getEtherScanTokens:f,getProviderConfig:g,onPreferencesStateChange:h,onNetworkStateChange:i}){super({config:a,state:b}),(0,z.default)(this,"name","TokensController"),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"ethersProvider",void 0),(0,z.default)(this,"pollingManager",void 0),(0,z.default)(this,"getProviderConfig",void 0),(0,z.default)(this,"getCustomTokens",void 0),(0,z.default)(this,"getEtherScanTokens",void 0),this.provider=c,this.ethersProvider=new g5(this.provider,"any"),this.getCustomTokens=e,this.getEtherScanTokens=f,this.getProviderConfig=g,this.defaultConfig={interval:18e4,selectedAddress:"",chainId:""},this.defaultState={tokens:{}},this.initialize(),h(a=>{a.selectedAddress!==this.config.selectedAddress&&(this.configure({selectedAddress:a.selectedAddress}),this.restartTokenDetection())}),i(a=>{let{chainId:b}=a.providerConfig;b!==this.config.chainId&&(this.configure({chainId:b}),this.restartTokenDetection())}),this.pollingManager=new h5(d,this.config.interval)}get userSelectedAddress(){return this.config.selectedAddress}get userTokens(){var a;return this.userSelectedAddress&&null!=(a=this.state.tokens[this.userSelectedAddress])?a:[]}startTokenDetection(a){this.configure({selectedAddress:a}),this.restartTokenDetection()}restartTokenDetection(){this.userSelectedAddress&&this.pollingManager.start(async()=>{this.detectNewTokens(),await this.refreshTokenBalances()})}detectNewTokens(){let a=this.userSelectedAddress;if(!a)return;let b=this.config.chainId,c=[];if(!b)return void this.update({tokens:{[a]:[...c]}});let d=this.getProviderConfig();if(null!=d&&d.isErc20&&null!=d&&d.tokenAddress&&c.push({tokenAddress:d.tokenAddress,name:d.tickerName,logo:d.logo,erc20:!0,symbol:d.ticker,decimals:"18",chainId:b}),this.getCustomTokens){let d=this.getCustomTokens(a);c.push(...d.reduce((a,c)=>(c.network===b&&a.push({tokenAddress:c.token_address,name:c.token_name,logo:"eth.svg",erc20:!0,symbol:c.token_symbol,decimals:c.decimals,balance:"",customTokenId:c.id.toString(),chainId:c.network}),a),[]))}this.update({tokens:{[a]:[...c]}})}async refreshTokenBalances(a){let b=this.userSelectedAddress;if(""===b)return;let c=[...this.userTokens];try{let d=[],e=this.config.chainId;if(hb.MM_TOKEN_API_SUPPORTED_CHAINS.includes(e)){let c=await this.getEtherScanTokens(b,e,a);d.push(...c)}let f=c.filter(a=>!d.find(b=>{var c,d;return(null==(c=b.tokenAddress)?void 0:c.toLocaleLowerCase())===(null==(d=a.tokenAddress)?void 0:d.toLocaleLowerCase())}));if(f.length>0){let a=f.map(a=>a.tokenAddress),c=hc[e];if(c){let g=new d$(c,ha,this.ethersProvider),h=await g.balances([b],a);a.forEach((a,b)=>{let c=ao(h[b]);c&&"0x0"!==c&&d.push((0,y.default)((0,y.default)({},f[b]),{},{balance:c,chainId:e}))})}else{let a=await this.getTokenBalancesUsingHandler(f);d.push(...a)}}this.update({tokens:{[b]:d}})}catch(d){g6.default.error(d,"unable to fetch token balances using single call balance address");let a=await this.getTokenBalancesUsingHandler(c);this.update({tokens:{[b]:a}})}}async getTokenBalancesUsingHandler(a){return this.userSelectedAddress?(await Promise.allSettled(a.map(async a=>{try{let b=new kD({address:a.tokenAddress,decimals:Number.parseInt(a.decimals),name:a.name,symbol:a.symbol,provider:this.ethersProvider}),c=await b.getUserBalance(this.userSelectedAddress);return{decimals:b.decimals.toString(),erc20:!0,logo:a.logo||"eth.svg",name:b.name,symbol:b.symbol,tokenAddress:b.address,balance:`0x${c}`,customTokenId:a.customTokenId,network:a.chainId,chainId:a.chainId}}catch(a){g6.default.warn("could not fetch user token balance",a);return}}))).reduce((a,b)=>("fulfilled"===b.status&&b.value&&a.push(b.value),a),[]):[]}}class kG{constructor({provider:a,blockTracker:b,getPendingTransactions:c,getConfirmedTransactions:d}){(0,z.default)(this,"provider",void 0),(0,z.default)(this,"blockTracker",void 0),(0,z.default)(this,"getPendingTransactions",void 0),(0,z.default)(this,"getConfirmedTransactions",void 0),(0,z.default)(this,"lockMap",void 0),this.provider=a,this.blockTracker=b,this.getPendingTransactions=c,this.getConfirmedTransactions=d,this.lockMap={}}async getGlobalLock(){let a=this._lookupMutex("global");return{releaseLock:await a.acquire()}}async getNonceLock(a){await this._globalMutexFree();let b=await this._takeMutex(a);try{let c={},d=await this._getNetworkNextNonce(a),e=this._getHighestLocallyConfirmed(a),f=d.nonce,g=Math.max(f,e),h=this.getPendingTransactions(a),i=this._getHighestContinuousFrom(h,g);return c.params={highestLocallyConfirmed:e,highestSuggested:g,nextNetworkNonce:f},c.local=i,c.network=d,{nextNonce:Math.max(d.nonce,i.nonce),nonceDetails:c,releaseLock:b}}catch(a){throw b(),a}}async _globalMutexFree(){let a=this._lookupMutex("global");(await a.acquire())()}async _takeMutex(a){let b=this._lookupMutex(a);return await b.acquire()}_lookupMutex(a){let b=this.lockMap[a];return b||(b=new H,this.lockMap[a]=b),b}async _getNetworkNextNonce(a){let b=await this.blockTracker.getLatestBlock(),c=Number.parseInt(await this.provider.request({method:hb.METHOD_TYPES.ETH_GET_TRANSACTION_COUNT,params:[a,b.idempotencyKey]}),16);return{name:"network",nonce:c,details:{block:b,baseCount:c}}}_getHighestLocallyConfirmed(a){let b=this.getConfirmedTransactions(a),c=this._getHighestNonce(b);return Number.isInteger(c)?c+1:0}_getHighestNonce(a){let b=a.map(a=>{let{nonce:b}=a.transaction;return Number.parseInt(b,16)});return Math.max.apply(null,b)}_getHighestContinuousFrom(a,b){let c=new Set(a.map(a=>{let{nonce:b}=a.transaction;return Number.parseInt(b,16)})),d=b;for(;c.has(d);)d+=1;return{name:"local",nonce:d,details:{startPoint:b,highest:d}}}}class kH extends C{constructor({provider:a,nonceTracker:b,approveTransaction:c,publishTransaction:d,getPendingTransactions:e,getConfirmedTransactions:f}){super(),(0,z.default)(this,"DROPPED_BUFFER_COUNT",3),(0,z.default)(this,"nonceTracker",void 0),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"approveTransaction",void 0),(0,z.default)(this,"droppedBlocksBufferByHash",void 0),(0,z.default)(this,"getConfirmedTransactions",void 0),(0,z.default)(this,"getPendingTransactions",void 0),(0,z.default)(this,"publishTransaction",void 0),this.provider=a,this.nonceTracker=b,this.approveTransaction=c,this.publishTransaction=d,this.getPendingTransactions=e,this.getConfirmedTransactions=f,this.droppedBlocksBufferByHash=new Map}async updatePendingTxs(){let a=await this.nonceTracker.getGlobalLock();try{let a=this.getPendingTransactions();await Promise.all(a.map(a=>this._checkPendingTx(a)))}catch(a){g6.default.error("PendingTransactionTracker - Error updating pending transactions"),g6.default.error(a)}a.releaseLock()}async resubmitPendingTxs(a){let b=this.getPendingTransactions();if(0!==b.length)for(let d of b)try{await this._resubmitTx(d,a.idempotencyKey)}catch(b){var c;let a=(null==(c=b.value)||null==(c=c.message)?void 0:c.toLowerCase())||b.message.toLowerCase();if(a.includes("replacement transaction underpriced")||a.includes("known transaction")||a.includes("gas price too low to replace")||a.includes("transaction with the same hash was already imported")||a.includes("gateway timeout")||a.includes("nonce too low"))return;d.warning={error:a,message:"There was an error when resubmitting this transaction."},this.emit(hh,{txMeta:d,txId:d.id})}}async _resubmitTx(a,b){if(a.userOpHash)return;a.firstRetryBlockNumber||this.emit(hn,{txMeta:a,latestBlockNumber:b,txId:a.id});let c=a.firstRetryBlockNumber||b,d=Number.parseInt(b,16)-Number.parseInt(c,16),e=a.retryCount||0;if(d<=Math.min(50,2**e))return;if(!("rawTransaction"in a))return this.approveTransaction(a.id);let{rawTransaction:f}=a,g=await this.publishTransaction(f);return this.emit(hm,{txMeta:a,txId:a.id}),g}async _checkPendingTx(a){let b=a.transactionHash,c=a.id;if(a.status===hf.submitted&&!a.isUserOperation){if(!b){let a=Error("We had an error while submitting this transaction, please try again.");a.name="NoTxHashError",this.emit(hi,{txId:c,error:a});return}if(this._checkIfNonceIsTaken(a))return void this.emit(hk,{txId:c});try{let a=await this.provider.request({method:hb.METHOD_TYPES.ETH_GET_TRANSACTION_RECEIPT,params:[b]});if(null!=a&&a.blockNumber){let{baseFeePerGas:b,timestamp:d}=await this.provider.request({method:hb.METHOD_TYPES.ETH_GET_BLOCK_BY_HASH,params:[a.blockHash,!1]});this.emit(hj,{txId:c,txReceipt:a,baseFeePerGas:b,blockTimestamp:d});return}}catch(b){g6.default.error("error while loading tx",b),a.warning={error:b.message,message:"There was a problem loading this transaction."},this.emit(hh,{txMeta:a,txId:c})}await this._checkIfTxWasDropped(a)&&this.emit(hk,{txId:c})}}async _checkIfTxWasDropped(a){let{transactionHash:b,transaction:{nonce:c,from:d}}=a,e=await this.provider.request({method:hb.METHOD_TYPES.ETH_GET_TRANSACTION_COUNT,params:[d,"latest"]});if(Number.parseInt(c,16)>=Number.parseInt(e,16))return!1;this.droppedBlocksBufferByHash.has(b)||this.droppedBlocksBufferByHash.set(b,0);let f=this.droppedBlocksBufferByHash.get(b);return f<this.DROPPED_BUFFER_COUNT?(this.droppedBlocksBufferByHash.set(b,f+1),!1):(this.droppedBlocksBufferByHash.delete(b),!0)}_checkIfNonceIsTaken(a){let b=a.transaction.from;return this.getConfirmedTransactions(b).some(b=>b.id!==a.id&&b.transaction.nonce===a.transaction.nonce)}}class kI{constructor(a,b){(0,z.default)(this,"provider",void 0),(0,z.default)(this,"blockTracker",void 0),this.provider=a,this.blockTracker=b}async analyzeGasUsage(a){let b,c=await this.blockTracker.getLatestBlock(),d=new iu.BN((0,im.stripHexPrefix)(c.gasLimit),16).mul(new iu.BN(19)).div(new iu.BN(20)),e=(0,he.addHexPrefix)(d.toString("hex"));try{e=await this.estimateTxGas(a)}catch(a){g6.default.warn(a),b={reason:a.message,errorKey:a.errorKey,debug:{blockNumber:c.idempotencyKey,blockGasLimit:c.gasLimit}}}return{blockGasLimit:c.gasLimit,estimatedGasHex:e,simulationFails:b}}addGasBuffer(a,b,c=1.5){let d=new iu.BN((0,im.stripHexPrefix)(a),16),e=new iu.BN((0,im.stripHexPrefix)(b),16).muln(.9),f=d.muln(c);return d.gt(e)?(0,he.addHexPrefix)(d.toString("hex")):f.lt(e)?(0,he.addHexPrefix)(f.toString("hex")):(0,he.addHexPrefix)(e.toString("hex"))}async estimateTxGas(a){let b=iq(a.transaction);return delete b.gasPrice,delete b.maxFeePerGas,delete b.maxPriorityFeePerGas,this.provider.request({method:"eth_estimateGas",params:[b]})}}class kJ extends D{constructor({config:a,state:b,getCurrentChainId:c}){super({config:a,state:b}),(0,z.default)(this,"getCurrentChainId",void 0),this.defaultConfig={txHistoryLimit:40},this.defaultState={transactions:{},unapprovedTxs:{},currentNetworkTxsList:[]},this.initialize(),this.getCurrentChainId=c}getUnapprovedTxList(){let a=this.getCurrentChainId();return ip(this.state.transactions,b=>b.status===hf.unapproved&&(0,h4.transactionMatchesNetwork)(b,a))}getTransaction(a){let{transactions:b}=this.state;return b[a]}updateTransaction(a){let b=a.id;a.updated_at=new Date().toISOString(),this.update({transactions:(0,y.default)((0,y.default)({},this.state.transactions),{},{[b]:a})})}setTxStatusRejected(a){this._setTransactionStatus(a,hf.rejected),this._deleteTransaction(a)}setTxStatusUnapproved(a){this._setTransactionStatus(a,hf.unapproved)}setTxStatusApproved(a){this._setTransactionStatus(a,hf.approved)}setTxStatusSigned(a,b){this._setTransactionStatus(a,hf.signed,b)}setTxStatusSubmitted(a){this._setTransactionStatus(a,hf.submitted)}setTxStatusDropped(a){this._setTransactionStatus(a,hf.dropped)}setTxStatusExpired(a){this._setTransactionStatus(a,hf.expired)}setTxStatusConfirmed(a){this._setTransactionStatus(a,hf.confirmed)}setTxStatusFailed(a,b){let c=b||Error("Internal torus failure"),d=this.getTransaction(a);d.error=c,this.updateTransaction(d),this._setTransactionStatus(a,hf.failed)}isFinalState(a){return a===hf.rejected||a===hf.submitted||a===hf.confirmed||a===hf.failed||a===hf.cancelled||a===hf.expired}clearUnapprovedTxs(){this.update({transactions:io(this.state.transactions,a=>a.status===hf.unapproved)})}_addTransactionsToState(a){this.update({transactions:a.reduce((a,b)=>(a[b.id]=b,a),this.state.transactions)})}_setTransactionsToState(a){this.update({transactions:a.reduce((a,b)=>(a[b.id]=b,a),{})})}_deleteTransaction(a){let{transactions:b}=this.state;delete b[a],this.update({transactions:b})}_deleteTransactions(a){let{transactions:b}=this.state;a.forEach(a=>{delete b[a]}),this.update({transactions:b})}_setTransactionStatus(a,b,c){let d=this.getTransaction(a);d&&(d.status=b,this.updateTransaction(d),this.emit(hl,{txId:a,status:b}),this.isFinalState(b)||c?this.emit(`${d.id}:finished`,d):this.emit(`${d.id}:${b}`,a))}}var kK=(x=function(a,b){return(x=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)},function(a,b){function c(){this.constructor=a}x(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),kL=Object.prototype.hasOwnProperty;function kM(a,b){return kL.call(a,b)}function kN(a){if(Array.isArray(a)){for(var b=Array(a.length),c=0;c<b.length;c++)b[c]=""+c;return b}if(Object.keys)return Object.keys(a);var d=[];for(var e in a)kM(a,e)&&d.push(e);return d}function kO(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}}function kP(a){for(var b,c=0,d=a.length;c<d;){if((b=a.charCodeAt(c))>=48&&b<=57){c++;continue}return!1}return!0}function kQ(a){return -1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function kR(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function kS(a,b){var c=[a];for(var d in b){var e="object"==typeof b[d]?JSON.stringify(b[d],null,2):b[d];void 0!==e&&c.push(d+": "+e)}return c.join("\n")}var kT=function(a){function b(b,c,d,e,f){var g=this.constructor,h=a.call(this,kS(b,{name:c,index:d,operation:e,tree:f}))||this;return h.name=c,h.index=d,h.operation=e,h.tree=f,Object.setPrototypeOf(h,g.prototype),h.message=kS(b,{name:c,index:d,operation:e,tree:f}),h}return kK(b,a),b}(Error),kU={add:function(a,b,c){return a[b]=this.value,{newDocument:c}},remove:function(a,b,c){var d=a[b];return delete a[b],{newDocument:c,removed:d}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:function(a,b,c){var d=kW(c,this.path);d&&(d=kO(d));var e=kX(c,{op:"remove",path:this.from}).removed;return kX(c,{op:"add",path:this.path,value:e}),{newDocument:c,removed:d}},copy:function(a,b,c){var d=kW(c,this.from);return kX(c,{op:"add",path:this.path,value:kO(d)}),{newDocument:c}},test:function(a,b,c){return{newDocument:c,test:k0(a[b],this.value)}},_get:function(a,b,c){return this.value=a[b],{newDocument:c}}},kV={add:function(a,b,c){return kP(b)?a.splice(b,0,this.value):a[b]=this.value,{newDocument:c,index:b}},remove:function(a,b,c){return{newDocument:c,removed:a.splice(b,1)[0]}},replace:function(a,b,c){var d=a[b];return a[b]=this.value,{newDocument:c,removed:d}},move:kU.move,copy:kU.copy,test:kU.test,_get:kU._get};function kW(a,b){if(""==b)return a;var c={op:"_get",path:b};return kX(a,c),c.value}function kX(a,b,c,d,e,f){if(void 0===c&&(c=!1),void 0===d&&(d=!0),void 0===e&&(e=!0),void 0===f&&(f=0),c&&("function"==typeof c?c(b,0,a,b.path):k$(b,0)),""===b.path){var g={newDocument:a};if("add"===b.op)return g.newDocument=b.value,g;if("replace"===b.op)return g.newDocument=b.value,g.removed=a,g;if("move"===b.op||"copy"===b.op)return g.newDocument=kW(a,b.from),"move"===b.op&&(g.removed=a),g;else if("test"===b.op){if(g.test=k0(a,b.value),!1===g.test)throw new kT("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return g.newDocument=a,g}else if("remove"===b.op)return g.removed=a,g.newDocument=null,g;else if("_get"===b.op)return b.value=a,g;else if(!c)return g;else throw new kT("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",f,b,a)}d||(a=kO(a));var h=(b.path||"").split("/"),i=a,j=1,k=h.length,l=void 0,m=void 0,n=void 0;for(n="function"==typeof c?c:k$;;){if((m=h[j])&&-1!=m.indexOf("~")&&(m=kR(m)),e&&("__proto__"==m||"prototype"==m&&j>0&&"constructor"==h[j-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(c&&void 0===l&&(void 0===i[m]?l=h.slice(0,j).join("/"):j==k-1&&(l=b.path),void 0!==l&&n(b,0,a,l)),j++,Array.isArray(i)){if("-"===m)m=i.length;else if(c&&!kP(m))throw new kT("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",f,b,a);else kP(m)&&(m=~~m);if(j>=k){if(c&&"add"===b.op&&m>i.length)throw new kT("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",f,b,a);var g=kV[b.op].call(b,i,m,a);if(!1===g.test)throw new kT("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return g}}else if(j>=k){var g=kU[b.op].call(b,i,m,a);if(!1===g.test)throw new kT("Test operation failed","TEST_OPERATION_FAILED",f,b,a);return g}if(i=i[m],c&&j<k&&(!i||"object"!=typeof i))throw new kT("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",f,b,a)}}function kY(a,b,c,d,e){if(void 0===d&&(d=!0),void 0===e&&(e=!0),c&&!Array.isArray(b))throw new kT("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");d||(a=kO(a));for(var f=Array(b.length),g=0,h=b.length;g<h;g++)f[g]=kX(a,b[g],c,!0,e,g),a=f[g].newDocument;return f.newDocument=a,f}function kZ(a,b,c){var d=kX(a,b);if(!1===d.test)throw new kT("Test operation failed","TEST_OPERATION_FAILED",c,b,a);return d.newDocument}function k$(a,b,c,d){if("object"!=typeof a||null===a||Array.isArray(a))throw new kT("Operation is not an object","OPERATION_NOT_AN_OBJECT",b,a,c);if(kU[a.op]){if("string"!=typeof a.path)throw new kT("Operation `path` property is not a string","OPERATION_PATH_INVALID",b,a,c);else if(0!==a.path.indexOf("/")&&a.path.length>0)throw new kT('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",b,a,c);else if(("move"===a.op||"copy"===a.op)&&"string"!=typeof a.from)throw new kT("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",b,a,c);else if(("add"===a.op||"replace"===a.op||"test"===a.op)&&void 0===a.value)throw new kT("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",b,a,c);else if(("add"===a.op||"replace"===a.op||"test"===a.op)&&function a(b){if(void 0===b)return!0;if(b){if(Array.isArray(b)){for(var c=0,d=b.length;c<d;c++)if(a(b[c]))return!0}else if("object"==typeof b){for(var e=kN(b),f=e.length,g=0;g<f;g++)if(a(b[e[g]]))return!0}}return!1}(a.value))throw new kT("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",b,a,c);else if(c){if("add"==a.op){var e=a.path.split("/").length,f=d.split("/").length;if(e!==f+1&&e!==f)throw new kT("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",b,a,c)}else if("replace"===a.op||"remove"===a.op||"_get"===a.op){if(a.path!==d)throw new kT("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",b,a,c)}else if("move"===a.op||"copy"===a.op){var g=k_([{op:"_get",path:a.from,value:void 0}],c);if(g&&"OPERATION_PATH_UNRESOLVABLE"===g.name)throw new kT("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",b,a,c)}}}else throw new kT("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",b,a,c)}function k_(a,b,c){try{if(!Array.isArray(a))throw new kT("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(b)kY(kO(b),kO(a),c||!0);else{c=c||k$;for(var d=0;d<a.length;d++)c(a[d],d,b,void 0)}}catch(a){if(a instanceof kT)return a;throw a}}function k0(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var c,d,e,f=Array.isArray(a),g=Array.isArray(b);if(f&&g){if((d=a.length)!=b.length)return!1;for(c=d;0!=c--;)if(!k0(a[c],b[c]))return!1;return!0}if(f!=g)return!1;var h=Object.keys(a);if((d=h.length)!==Object.keys(b).length)return!1;for(c=d;0!=c--;)if(!b.hasOwnProperty(h[c]))return!1;for(c=d;0!=c--;)if(!k0(a[e=h[c]],b[e]))return!1;return!0}return a!=a&&b!=b}a.s(["JsonPatchError",()=>kT,"_areEquals",()=>k0,"applyOperation",()=>kX,"applyPatch",()=>kY,"applyReducer",()=>kZ,"deepClone",()=>kO,"getValueByPointer",()=>kW,"validate",()=>k_,"validator",()=>k$],84810);var k1=new WeakMap,k2=function(a){this.observers=new Map,this.obj=a},k3=function(a,b){this.callback=a,this.observer=b};function k4(a,b){b.unobserve()}function k5(a,b){var c=k1.get(a);if(c){var d,e=c.observers.get(b);d=e&&e.observer}else c=new k2(a),k1.set(a,c);return d||(d={},c.value=kO(a),b&&(d.callback=b,d.next=null),d.patches=[],d.object=a,d.unobserve=function(){var a,b;k6(d),clearTimeout(d.next),a=c,b=d,a.observers.delete(b.callback)},c.observers.set(b,new k3(b,d))),d}function k6(a,b){void 0===b&&(b=!1);var c=k1.get(a.object);k7(c.value,a.object,a.patches,"",b),a.patches.length&&kY(c.value,a.patches);var d=a.patches;return d.length>0&&(a.patches=[],a.callback&&a.callback(d)),d}function k7(a,b,c,d,e){if(b!==a){"function"==typeof b.toJSON&&(b=b.toJSON());for(var f=kN(b),g=kN(a),h=!1,i=g.length-1;i>=0;i--){var j=g[i],k=a[j];if(kM(b,j)&&(void 0!==b[j]||void 0===k||!1!==Array.isArray(b))){var l=b[j];"object"==typeof k&&null!=k&&"object"==typeof l&&null!=l&&Array.isArray(k)===Array.isArray(l)?k7(k,l,c,d+"/"+kQ(j),e):k!==l&&(e&&c.push({op:"test",path:d+"/"+kQ(j),value:kO(k)}),c.push({op:"replace",path:d+"/"+kQ(j),value:kO(l)}))}else Array.isArray(a)===Array.isArray(b)?(e&&c.push({op:"test",path:d+"/"+kQ(j),value:kO(k)}),c.push({op:"remove",path:d+"/"+kQ(j)}),h=!0):(e&&c.push({op:"test",path:d,value:a}),c.push({op:"replace",path:d,value:b}))}if(h||f.length!=g.length)for(var i=0;i<f.length;i++){var j=f[i];kM(a,j)||void 0===b[j]||c.push({op:"add",path:d+"/"+kQ(j),value:kO(b[j])})}}}function k8(a,b,c){void 0===c&&(c=!1);var d=[];return k7(a,b,d,"",c),d}a.s(["compare",()=>k8,"generate",()=>k6,"observe",()=>k5,"unobserve",()=>k4],79288);let k9=Object.assign({},a.i(84810),a.i(79288),{JsonPatchError:kT,deepClone:kO,escapePathComponent:kQ,unescapePathComponent:kR});function la(a,b,c){let d=k9.compare(a,b);return d[0]&&(c&&(d[0].note=c),d[0].timestamp=Date.now()),d}function lb(a){return iq(a).reduce((a,b)=>k9.applyPatch(a,b).newDocument)}function lc(a){let b=(0,y.default)({},a);return delete b.history,iq(b)}class ld extends kJ{constructor({config:a,state:b,getCurrentChainId:c}){super({config:a,state:b,getCurrentChainId:c})}generateTxMeta(a={}){var b;let c=this.getCurrentChainId();if("loading"===c)throw Error("Torus is having trouble connecting to the network");let d=null;return a.transaction&&"string"==typeof a.origin&&"torus"!==a.origin&&(void 0!==a.transaction.gasPrice?d={gasPrice:a.transaction.gasPrice}:(void 0!==a.transaction.maxFeePerGas||void 0!==a.transaction.maxPriorityFeePerGas)&&(d={maxPriorityFeePerGas:a.transaction.maxPriorityFeePerGas,maxFeePerGas:a.transaction.maxFeePerGas}),void 0!==a.transaction.gas&&(d=(0,y.default)((0,y.default)({},d),{},{gas:a.transaction.gas}))),(0,y.default)({id:(null==(b=a.transaction)?void 0:b.id)||(0,h4.randomId)(),time:Date.now(),status:hf.unapproved,loadingDefaults:!0,chainId:c,dappSuggestedGasFees:d},a)}addTransactionToState(a){a.transaction&&(a.transaction=j9(a.transaction,!1)),this.once(`${a.id}:signed`,()=>{this.removeAllListeners(`${a.id}:rejected`)}),this.once(`${a.id}:rejected`,()=>{this.removeAllListeners(`${a.id}:signed`)}),a.history=[];let b=lc(a);a.history.push(b);let c=this.getTransactions({filterToCurrentNetwork:!1}),{txHistoryLimit:d}=this.config,e=new Set,f=c.reverse().filter(a=>{let{nonce:b}=a.transaction,{chainId:c,status:f}=a,g=`${b}-${c}`;return!e.has(g)&&(!(e.size<d-1)&&!1!==ka().includes(f)||(e.add(g),!1))}).map(a=>a.id);return this._deleteTransactions(f),this._addTransactionsToState([a]),a}wipeTransactions(a){let{transactions:b}=this.state,c=this.getCurrentChainId();this.update({transactions:io(b,b=>{let d=(0,h4.transactionMatchesNetwork)(b,c);return b.transaction.from===a&&d})})}getTransactions({searchCriteria:a={},initialList:b,filterToCurrentNetwork:c=!0,limit:d}={}){var e,f,g;let h=this.getCurrentChainId(),i=(e=a=>"function"==typeof a?a:b=>b===a,Object.fromEntries(Object.entries(a).map(([a,b])=>[a,e(b,a)]))),j=(f=Object.values(ip(b?b.reduce((a,b)=>{let c=b.id;return("string"==typeof c||"number"==typeof c)&&(a[c.toString()]=b),a},{}):this.state.transactions,a=>{let b=(0,h4.transactionMatchesNetwork)(a,h);if(c&&!b)return!1;for(let[b,c]of Object.entries(i))if(b in a.transaction){if(!1===c(a.transaction[b]))return!1}else if(!1===c(a[b]))return!1;return!0})),g="time",f.slice().sort((a,b)=>a[g]<b[g]?-1:+(a[g]>b[g])));if(void 0!==d){let a=new Set,b=[];for(let c=j.length-1;c>-1;c-=1){let e=j[c],{nonce:f}=e.transaction;if(!a.has(f))if(!(a.size<d))continue;else a.add(f);b.unshift(e)}return b}return j}getApprovedTransactions(a){let b={status:hf.approved};return a&&(b.from=a),this.getTransactions({searchCriteria:b})}getSubmittedTransactions(a){let b={status:hf.submitted};return a&&(b.from=a),this.getTransactions({searchCriteria:b})}getPendingTransactions(a){return[...this.getSubmittedTransactions(a),...this.getApprovedTransactions(a)]}getConfirmedTransactions(a){let b={status:hf.confirmed};return a&&(b.from=a),this.getTransactions({searchCriteria:b})}getUnapprovedTxList(){let a=this.getCurrentChainId();return ip(this.state.transactions,b=>{let c=(0,h4.transactionMatchesNetwork)(b,a);return b.status===hf.unapproved&&c})}updateTransactionInState(a,b){a.transaction&&(a.transaction=j9(a.transaction,!1));let c=lc(a),d=la(lb(a.history),c,b);d.length>0&&a.history.push(d),this.updateTransaction(a)}_setTransactionStatus(a,b,c){let d=this.getTransaction(a);d&&(d.status=b,this.updateTransactionInState(d),this.emit(hl,{txId:a,status:b}),this.isFinalState(b)||c?this.emit(`${d.id}:finished`,d):this.emit(`${d.id}:${b}`,a))}}class le extends ld{constructor({config:a,state:b,provider:c,blockTracker:d,signEthTx:e,getCurrentChainId:f,getCurrentNetworkEIP1559Compatibility:g,getCurrentAccountEIP1559Compatibility:h,getSelectedAddress:i,getEIP1559GasFeeEstimates:j}){super({config:a,state:b,getCurrentChainId:f}),(0,z.default)(this,"getSelectedAddress",void 0),(0,z.default)(this,"getEIP1559GasFeeEstimates",void 0),(0,z.default)(this,"nonceTracker",void 0),(0,z.default)(this,"pendingTxTracker",void 0),(0,z.default)(this,"txGasUtil",void 0),(0,z.default)(this,"_getCurrentNetworkEIP1559Compatibility",void 0),(0,z.default)(this,"_getCurrentAccountEIP1559Compatibility",void 0),(0,z.default)(this,"signEthTx",void 0),(0,z.default)(this,"provider",void 0),(0,z.default)(this,"blockTracker",void 0),(0,z.default)(this,"inProcessOfSigning",new Set),(0,z.default)(this,"getUnapprovedTxCount",()=>Object.keys(this.getUnapprovedTxList()).length),(0,z.default)(this,"getPendingTxCount",a=>this.getPendingTransactions(a).length),this.blockTracker=d,this._getCurrentNetworkEIP1559Compatibility=g,this._getCurrentAccountEIP1559Compatibility=h,this.getSelectedAddress=i,this.getEIP1559GasFeeEstimates=j,this.signEthTx=e,this.provider=c,this.txGasUtil=new kI(this.provider,this.blockTracker),this.nonceTracker=new kG({provider:c,blockTracker:d,getConfirmedTransactions:this.getConfirmedTransactions.bind(this),getPendingTransactions:this.getSubmittedTransactions.bind(this)}),this.pendingTxTracker=new kH({provider:c,nonceTracker:this.nonceTracker,getPendingTransactions:this.getPendingTransactions.bind(this),getConfirmedTransactions:this.getConfirmedTransactions.bind(this),approveTransaction:this.approveTransaction.bind(this),publishTransaction:a=>this.provider.request({method:hb.METHOD_TYPES.ETH_SEND_RAW_TRANSACTION,params:[a]})}),this._setupListeners()}addTransactionUnapproved(a){this.addTransactionToState(a),this.emit(`${a.id}:unapproved`,a)}async addNewUnapprovedTransaction(a,b){let c=await this.createTransaction(a,b);return this.processApproval(c)}async processApproval(a){return new Promise((b,c)=>{this.once(`${a.id}:finished`,d=>d.status===hf.rejected?c(i5("Transaction Signature: User denied message signature")):d.status===hf.failed?c(i4(`Transaction Signature: failed to sign message ${d.error}`)):d.status===hf.signed&&d.isSignOnly?b(d.rawTransaction):d.status===hf.submitted?b(d.transactionHash):c(i4(`Transaction Signature: Unknown problem: ${JSON.stringify(a.transaction)}`)))})}async approveTransaction(a){let b,c=this.getTransaction(a);if(!this.inProcessOfSigning.has(a)){this.inProcessOfSigning.add(a);try{this.setTxStatusApproved(a);let d=c.transaction.from,{customNonceValue:e}=c.transaction,f=Number(e),g=(b=await this.nonceTracker.getNonceLock(d)).nextNonce;c.transaction.nonce=(0,he.addHexPrefix)((0===f?e:e||g).toString(16)),c.nonceDetails=b.nonceDetails,this.updateTransactionInState(c,"transactions#approveTransaction"),await this.signTransaction(a,c.isSignOnly),c.isSignOnly||await this.publishTransaction(a),b.releaseLock()}catch(c){try{this.setTxStatusFailed(a,c)}catch(a){g6.default.error(a)}throw b&&b.releaseLock(),c}finally{this.inProcessOfSigning.delete(a)}}}async signTransaction(a,b){let c=this.getTransaction(a),d=this.getCurrentChainId(),e={type:Number.parseInt(j1(c)?hb.TRANSACTION_ENVELOPE_TYPES.FEE_MARKET:hb.TRANSACTION_ENVELOPE_TYPES.LEGACY,16),chainId:d,gasLimit:c.transaction.gas,accessList:c.transaction.accessList,data:c.transaction.data,gasPrice:c.transaction.gasPrice,maxFeePerGas:c.transaction.maxFeePerGas,maxPriorityFeePerGas:c.transaction.maxPriorityFeePerGas,nonce:Number.parseInt(c.transaction.nonce,16),to:c.transaction.to,value:c.transaction.value},f=c.transaction.from,g=f6.from(e),h=await this.signEthTx(g,f);c.r=h.signature.r,c.s=h.signature.s,c.v=(0,he.addHexPrefix)(h.signature.v.toString(16));let i=h.serialized;return c.rawTransaction=i,this.updateTransactionInState(c,"transactions#signTransaction: add r, s, v values and rawTx"),this.setTxStatusSigned(a,b),i}async publishTransaction(a){let b,c=this.getTransaction(a).rawTransaction;try{b=await this.provider.request({method:hb.METHOD_TYPES.ETH_SEND_RAW_TRANSACTION,params:[c]})}catch(a){if(a.message.toLowerCase().includes("known transaction"))b=a4((0,he.addHexPrefix)(c)),b=(0,he.addHexPrefix)(b);else throw a}this.setTxHash(a,b),this.setTxStatusSubmitted(a)}async confirmTransaction(a){let{txId:b,txReceipt:c}=a;g6.default.info(a,"confirm params");let d=this.getTransaction(b);if(d)try{d.txReceipt=(0,y.default)({},c),this.setTxStatusConfirmed(b),this.markNonceDuplicatesDropped(b),this.updateTransactionInState(d,"transactions#confirmTransaction - add txReceipt")}catch(a){g6.default.error(a)}}cancelTransaction(a){throw Error(`Method not implemented. ${a}`)}async getEIP1559Compatibility(a){let b=await this._getCurrentNetworkEIP1559Compatibility(),c=await this._getCurrentAccountEIP1559Compatibility(a);return b&&c}async addTransactionGasDefaults(a){if(a.isUserOperation)return a;let b=a;try{b=await this.addTxGasDefaults(a)}catch(c){throw g6.default.warn(c),(b=this.getTransaction(a.id)).loadingDefaults=!1,this.updateTransactionInState(a,"Failed to calculate gas defaults."),c}return b.loadingDefaults=!1,this.updateTransactionInState(b,"Added new unapproved transaction."),b}async addTxGasDefaults(a){let b=a.transaction.type!==hb.TRANSACTION_ENVELOPE_TYPES.LEGACY&&await this.getEIP1559Compatibility(),{gasPrice:c,maxFeePerGas:d,maxPriorityFeePerGas:e}=await this.getDefaultGasFees(a,b),{gasLimit:f,simulationFails:g}=await this.getDefaultGasLimit(a);return a=this.getTransaction(a.id),g&&(a.simulationFails=g),b?(!a.transaction.gasPrice||a.transaction.maxFeePerGas||a.transaction.maxPriorityFeePerGas?(d&&!a.transaction.maxFeePerGas&&(a.transaction.maxFeePerGas=d),e&&!a.transaction.maxPriorityFeePerGas&&(a.transaction.maxPriorityFeePerGas=e),c&&!a.transaction.maxFeePerGas&&(a.transaction.maxFeePerGas=c),a.transaction.maxFeePerGas&&!a.transaction.maxPriorityFeePerGas&&(a.transaction.maxPriorityFeePerGas=a.transaction.maxFeePerGas)):(a.transaction.maxFeePerGas=a.transaction.gasPrice,a.transaction.maxPriorityFeePerGas=ko("string"==typeof e?(0,im.stripHexPrefix)(e):e,"string"==typeof a.transaction.gasPrice?(0,im.stripHexPrefix)(a.transaction.gasPrice):a.transaction.gasPrice)?e:a.transaction.gasPrice),delete a.transaction.gasPrice):(delete a.transaction.maxPriorityFeePerGas,delete a.transaction.maxFeePerGas),!c||a.transaction.gasPrice||a.transaction.maxPriorityFeePerGas||a.transaction.maxFeePerGas||(a.transaction.gasPrice=c),f&&!a.transaction.gas&&(a.transaction.gas=f),a}setTxHash(a,b){let c=this.getTransaction(a);c.transactionHash=b,this.updateTransactionInState(c,"transactions#setTxHash")}async getDefaultGasFees(a,b){if(!b&&a.transaction.gasPrice||b&&a.transaction.maxFeePerGas&&a.transaction.maxPriorityFeePerGas)return{};try{let{gasFeeEstimates:a,gasEstimateType:c}=await this.getEIP1559GasFeeEstimates();if(b&&c===hb.GAS_ESTIMATE_TYPES.FEE_MARKET){let{medium:{suggestedMaxPriorityFeePerGas:b,suggestedMaxFeePerGas:c}={}}=a;if(b&&c)return{maxFeePerGas:(0,he.addHexPrefix)(iS(new ir.BigNumber(c)).toString(16)),maxPriorityFeePerGas:(0,he.addHexPrefix)(iS(new ir.BigNumber(b)).toString(16))}}else if(c===hb.GAS_ESTIMATE_TYPES.LEGACY){let{medium:b}=a;return{gasPrice:(0,he.addHexPrefix)(iS(new ir.BigNumber(b)).toString(16))}}else if(c===hb.GAS_ESTIMATE_TYPES.ETH_GASPRICE){let{gasPrice:b}=a;return{gasPrice:(0,he.addHexPrefix)(iS(new ir.BigNumber(b)).toString(16))}}}catch(a){g6.default.error(a)}let c=await this.provider.request({method:hb.METHOD_TYPES.ETH_GET_GAS_PRICE});return{gasPrice:c&&(0,he.addHexPrefix)(c)}}async getDefaultGasLimit(a){let b=this.getCurrentChainId(),c=hb.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP[b],d=kr(b);if(a.transaction.gas)return{};if(a.transaction.to&&a.transactionCategory===hg&&"custom"!==d&&!a.transaction.data)return{gasLimit:kn.SIMPLE};let{blockGasLimit:e,estimatedGasHex:f,simulationFails:g}=await this.txGasUtil.analyzeGasUsage(a);return{gasLimit:this.txGasUtil.addGasBuffer((0,he.addHexPrefix)(f),e,c),simulationFails:g}}async createTransaction(a,b){let c=j_(a);j8(c,await this.getEIP1559Compatibility(a.from));let d=this.generateTxMeta({transaction:c,origin:b.origin}),{type:e,category:f,methodParams:g}=await kd(a,this.provider);return d.contractType=e,d.transactionCategory=f,d.methodParams=g,d.isUserOperation=b.isUserOperation,d.isSignOnly=b.isSignOnly,d.transaction.value=d.transaction.value?(0,he.addHexPrefix)(d.transaction.value):"0x0",this.emit(`${d.id}:unapproved`,d),d=this.addTransactionToState(d),d=await this.addTransactionGasDefaults(d),this.emit("tx:unapproved",{txMeta:d,req:b}),d}_setupListeners(){this.setupBlockTrackerListener(),this.pendingTxTracker.on(hh,a=>{this.updateTransactionInState(a.txMeta)}),this.pendingTxTracker.on(hk,a=>this.setTxStatusDropped(a.txId)),this.pendingTxTracker.on(hn,({txMeta:a,latestBlockNumber:b})=>{a.firstRetryBlockNumber||(a.firstRetryBlockNumber=b,this.updateTransactionInState(a))}),this.pendingTxTracker.on(hm,a=>{"retryCount"in a.txMeta||(a.txMeta.retryCount=0),a.txMeta.retryCount+=1,this.updateTransactionInState(a.txMeta)}),this.pendingTxTracker.on(hi,a=>{this.setTxStatusFailed(a.txId,a.error)}),this.pendingTxTracker.on(hj,a=>this.confirmTransaction(a))}setupBlockTrackerListener(){let a=!1,b=this.onLatestBlock.bind(this);this.on(hl,()=>{let c=this.getPendingTransactions();!a&&c.length>0?(this.blockTracker.on("latest",b),a=!0):a&&!c.length&&(this.blockTracker.removeListener("latest",b),a=!1)})}async onLatestBlock(a){try{await this.pendingTxTracker.updatePendingTxs()}catch(a){g6.default.error(a)}try{await this.pendingTxTracker.resubmitPendingTxs(a)}catch(a){g6.default.error(a)}}markNonceDuplicatesDropped(a){let b=this.getTransaction(a),{nonce:c,from:d}=b.transaction,e=this.getTransactions({searchCriteria:{from:d,nonce:c}});e.length&&e.forEach(c=>{c.id!==a&&(this.updateTransactionInState(b,"transactions/pending-tx-tracker#event: tx:confirmed reference to confirmed txHash with same nonce"),c.status!==hf.failed&&this.setTxStatusDropped(c.id))})}}var lf=a.i(36785),lg=a.i(61098),lh=a.i(59841),li=a.i(41702),lj=a.i(58541),lk=a.i(37242);a.s(["ARBITRUM_MAINNET_CHAIN_ID",()=>hb.ARBITRUM_MAINNET_CHAIN_ID,"ARBITRUM_TESTNET_CHAIN_ID",()=>hb.ARBITRUM_TESTNET_CHAIN_ID,"AVALANCHE_MAINNET_CHAIN_ID",()=>hb.AVALANCHE_MAINNET_CHAIN_ID,"AVALANCHE_TESTNET_CHAIN_ID",()=>hb.AVALANCHE_TESTNET_CHAIN_ID,"AccountAbstractionController",()=>h1,"AccountTrackerController",()=>hd,"AddChainController",()=>jk,"BASE_CHAIN_ID",()=>hb.BASE_CHAIN_ID,"BASE_TESTNET_CHAIN_ID",()=>hb.BASE_TESTNET_CHAIN_ID,"BNToHex",()=>kf,"BSC_MAINNET_CHAIN_ID",()=>hb.BSC_MAINNET_CHAIN_ID,"BSC_TESTNET_CHAIN_ID",()=>hb.BSC_TESTNET_CHAIN_ID,"BUNDLER_METHOD_TYPES",()=>hb.BUNDLER_METHOD_TYPES,"BiconomySmartAccount",()=>lf.BiconomySmartAccount,"CELO_MAINNET_CHAIN_ID",()=>hb.CELO_MAINNET_CHAIN_ID,"CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP",()=>hb.CHAIN_ID_TO_GAS_LIMIT_BUFFER_MAP,"COINGECKO_PLATFORMS_CHAIN_CODE_MAP",()=>hb.COINGECKO_PLATFORMS_CHAIN_CODE_MAP,"COINGECKO_SUPPORTED_CURRENCIES",()=>hb.COINGECKO_SUPPORTED_CURRENCIES,"CONTRACT_TYPE_ERC1155",()=>hb.CONTRACT_TYPE_ERC1155,"CONTRACT_TYPE_ERC20",()=>hb.CONTRACT_TYPE_ERC20,"CONTRACT_TYPE_ERC721",()=>hb.CONTRACT_TYPE_ERC721,"CONTRACT_TYPE_ETH",()=>hb.CONTRACT_TYPE_ETH,"CurrencyController",()=>il,"DEFAULT_CURRENCY",()=>"eth","ERC1155_INTERFACE_ID",()=>hb.ERC1155_INTERFACE_ID,"ERC721_ENUMERABLE_INTERFACE_ID",()=>hb.ERC721_ENUMERABLE_INTERFACE_ID,"ERC721_INTERFACE_ID",()=>hb.ERC721_INTERFACE_ID,"ERC721_METADATA_INTERFACE_ID",()=>hb.ERC721_METADATA_INTERFACE_ID,"GAS_ESTIMATE_TYPES",()=>hb.GAS_ESTIMATE_TYPES,"GAS_LIMITS",()=>kn,"GasFeeController",()=>iZ,"KernelSmartAccount",()=>lg.KernelSmartAccount,"KeyringController",()=>i0,"LINEA_CHAIN_ID",()=>hb.LINEA_CHAIN_ID,"LINEA_SEPOLIA_CHAIN_ID",()=>hb.LINEA_SEPOLIA_CHAIN_ID,"LOCALHOST",()=>hb.LOCALHOST,"MAINNET_CHAIN_ID",()=>hb.MAINNET_CHAIN_ID,"METHOD_TYPES",()=>hb.METHOD_TYPES,"MM_NFT_API_SUPPORTED_CHAINS",()=>hb.MM_NFT_API_SUPPORTED_CHAINS,"MM_TOKEN_API_SUPPORTED_CHAINS",()=>hb.MM_TOKEN_API_SUPPORTED_CHAINS,"MessageController",()=>jl,"MetamaskSmartAccount",()=>lh.MetamaskSmartAccount,"NetworkController",()=>jW,"NexusSmartAccount",()=>li.NexusSmartAccount,"NftHandler",()=>kt,"NftsController",()=>ku,"NonceTracker",()=>kG,"OLD_ERC721_LIST",()=>hb.OLD_ERC721_LIST,"OPTIMISM_MAINNET_CHAIN_ID",()=>hb.OPTIMISM_MAINNET_CHAIN_ID,"OPTIMISM_TESTNET_CHAIN_ID",()=>hb.OPTIMISM_TESTNET_CHAIN_ID,"PAYMASTER_METHOD_TYPES",()=>hb.PAYMASTER_METHOD_TYPES,"POLYGON_AMOY_CHAIN_ID",()=>hb.POLYGON_AMOY_CHAIN_ID,"POLYGON_CHAIN_ID",()=>hb.POLYGON_CHAIN_ID,"PendingTransactionTracker",()=>kH,"PersonalMessageController",()=>jm,"PollingBlockTracker",()=>h6,"PreferencesController",()=>kC,"SEPOLIA_CHAIN_ID",()=>hb.SEPOLIA_CHAIN_ID,"SMART_ACCOUNT",()=>hb.SMART_ACCOUNT,"SUPPORTED_NETWORKS",()=>hb.SUPPORTED_NETWORKS,"SafeSmartAccount",()=>lj.SafeSmartAccount,"SwitchChainController",()=>jn,"TEST_CHAINS",()=>hb.TEST_CHAINS,"TRANSACTION_ENVELOPE_TYPES",()=>hb.TRANSACTION_ENVELOPE_TYPES,"TokenHandler",()=>kD,"TokenRatesController",()=>kE,"TokensController",()=>kF,"TransactionController",()=>le,"TransactionGasUtil",()=>kI,"TransactionStateManager",()=>ld,"TrustSmartAccount",()=>lk.TrustSmartAccount,"TypedMessageController",()=>jo,"XDAI_CHAIN_ID",()=>hb.XDAI_CHAIN_ID,"addCurrencies",()=>iJ,"addEtherscanTransactions",()=>ks,"bnLessThan",()=>ko,"conversionGTE",()=>iP,"conversionGreaterThan",()=>iM,"conversionLTE",()=>iQ,"conversionLessThan",()=>iN,"conversionMax",()=>iO,"conversionUtil",()=>iH,"createAAMiddleware",()=>jK,"createChainIdMiddleware",()=>jP,"createEthereumMiddleware",()=>jL,"createGetAccountsMiddleware",()=>jw,"createJsonRpcClient",()=>jR,"createPendingNonceMiddleware",()=>jD,"createPendingTxMiddleware",()=>jF,"createProcessAddEthereumChain",()=>jI,"createProcessEstimateUserOperationGasMiddleware",()=>jz,"createProcessEthSignMessage",()=>jA,"createProcessPersonalMessage",()=>jC,"createProcessSignTransactionMiddleware",()=>jy,"createProcessSwitchEthereumChain",()=>jG,"createProcessTransactionMiddleware",()=>jx,"createProcessTypedMessageV4",()=>jB,"createProcessWalletSwitchChain",()=>jH,"createProviderConfigMiddleware",()=>jQ,"createRequestAccountsMiddleware",()=>jJ,"decGWEIToHexWEI",()=>iS,"determineTransactionType",()=>kd,"ensureFieldIsString",()=>j4,"ensureMutuallyExclusiveFieldsNotProvided",()=>j3,"eoaInterceptorMiddleware",()=>h_,"eoaProviderAsMiddleware",()=>h0,"erc1155Abi",()=>g9,"erc20Abi",()=>g7,"erc721Abi",()=>g8,"formatDate",()=>kj,"formatPastTx",()=>kh,"formatTime",()=>kk,"formatTxMetaForRpcResult",()=>jE,"generateHistoryEntry",()=>la,"getBigNumber",()=>iI,"getChainType",()=>kr,"getEthTxStatus",()=>ki,"getEtherScanHashLink",()=>kg,"getFinalStates",()=>ka,"getIpfsEndpoint",()=>kp,"hexToBn",()=>ke,"hexWEIToDecGWEI",()=>iT,"isAddressByChainId",()=>kl,"isEIP1559Transaction",()=>j1,"isLegacyTransaction",()=>j2,"multiplyCurrencies",()=>iL,"normalizeAndValidateTxParams",()=>j9,"normalizeMessageData",()=>jg,"normalizeTxParameters",()=>j_,"parseStandardTokenTransactionData",()=>kb,"readAddressAsContract",()=>kc,"replayHistory",()=>lb,"sanitizeNftMetdataUrl",()=>kq,"singleBalanceCheckerAbi",()=>ha,"snapshotFromTxMeta",()=>lc,"subtractCurrencies",()=>iK,"toChecksumAddressByChainId",()=>km,"toNegative",()=>iR,"transactionMatchesNetwork",()=>j0,"validateAddChainData",()=>ji,"validateAddress",()=>je,"validateFrom",()=>j6,"validateRecipient",()=>j7,"validateSignMessageData",()=>jf,"validateSwitchChainData",()=>jj,"validateTxParameters",()=>j8,"validateTypedSignMessageDataV4",()=>jh],59352)}];

//# sourceMappingURL=node_modules_3a3562e4._.js.map