{"version":3,"sources":["../../../../node_modules/%40segment/analytics-next/src/lib/is-plan-event-enabled.ts","../../../../node_modules/%40segment/analytics-next/src/plugins/schema-filter/index.ts"],"sourcesContent":["import { PlanEvent, TrackPlan } from '../core/events/interfaces'\n\n/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nexport function isPlanEventEnabled(\n  plan: TrackPlan | undefined,\n  planEvent: PlanEvent | undefined\n): boolean {\n  // Always prioritize the event's `enabled` status\n  if (typeof planEvent?.enabled === 'boolean') {\n    return planEvent.enabled\n  }\n\n  // Assume absence of a tracking plan means events are enabled\n  return plan?.__default?.enabled ?? true\n}\n","import { CDNSettings } from '../../browser'\nimport { Context } from '../../core/context'\nimport { PlanEvent, TrackPlan } from '../../core/events/interfaces'\nimport { Plugin } from '../../core/plugin'\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled'\nimport { RemotePlugin } from '../remote-loader'\n\nfunction disabledActionDestinations(\n  plan: PlanEvent | undefined,\n  settings: CDNSettings\n): { [destination: string]: string[] } {\n  if (!plan || !Object.keys(plan)) {\n    return {}\n  }\n\n  const disabledIntegrations = plan.integrations\n    ? Object.keys(plan.integrations).filter(\n        (i) => plan.integrations![i] === false\n      )\n    : []\n\n  // This accounts for cases like Fullstory, where the settings.integrations\n  // contains a \"Fullstory\" object but settings.remotePlugins contains \"Fullstory (Actions)\"\n  const disabledRemotePlugins: string[] = []\n  ;(settings.remotePlugins ?? []).forEach((p: RemotePlugin) => {\n    disabledIntegrations.forEach((int) => {\n      if (p.creationName == int) {\n        disabledRemotePlugins.push(p.name)\n      }\n    })\n  })\n\n  return (settings.remotePlugins ?? []).reduce((acc, p) => {\n    if (p.settings['subscriptions']) {\n      if (disabledRemotePlugins.includes(p.name)) {\n        // @ts-expect-error element implicitly has an 'any' type because p.settings is a JSONObject\n        p.settings['subscriptions'].forEach(\n          // @ts-expect-error parameter 'sub' implicitly has an 'any' type\n          (sub) => (acc[`${p.name} ${sub.partnerAction}`] = false)\n        )\n      }\n    }\n    return acc\n  }, {})\n}\n\nexport function schemaFilter(\n  track: TrackPlan | undefined,\n  settings: CDNSettings\n): Plugin {\n  function filter(ctx: Context): Context {\n    const plan = track\n    const ev = ctx.event.event\n\n    if (plan && ev) {\n      const planEvent = plan[ev]\n      if (!isPlanEventEnabled(plan, planEvent)) {\n        ctx.updateEvent('integrations', {\n          ...ctx.event.integrations,\n          All: false,\n          'Segment.io': true,\n        })\n        return ctx\n      } else {\n        const disabledActions = disabledActionDestinations(planEvent, settings)\n\n        ctx.updateEvent('integrations', {\n          ...ctx.event.integrations,\n          ...planEvent?.integrations,\n          ...disabledActions,\n        })\n      }\n    }\n\n    return ctx\n  }\n\n  return {\n    name: 'Schema Filter',\n    version: '0.1.0',\n    isLoaded: () => true,\n    load: () => Promise.resolve(),\n    type: 'before',\n    page: filter,\n    alias: filter,\n    track: filter,\n    identify: filter,\n    group: filter,\n  }\n}\n"],"names":[],"mappings":"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"}