{"version":3,"sources":["../../../../node_modules/%40segment/analytics-next/src/core/query-string/index.ts","../../../../node_modules/%40segment/analytics-next/src/core/query-string/pickPrefix.ts"],"sourcesContent":["import { pickPrefix } from './pickPrefix'\nimport { gracefulDecodeURIComponent } from './gracefulDecodeURIComponent'\nimport { Analytics } from '../analytics'\nimport { Context } from '../context'\nimport { isPlainObject } from '@segment/analytics-core'\n\nexport interface QueryStringParams {\n  [key: string]: string | null\n}\n\nexport function queryString(\n  analytics: Analytics,\n  query: string\n): Promise<Context[]> {\n  const a = document.createElement('a')\n  a.href = query\n  const parsed = a.search.slice(1)\n  const params = parsed.split('&').reduce((acc: QueryStringParams, str) => {\n    const [k, v] = str.split('=')\n    acc[k] = gracefulDecodeURIComponent(v)\n    return acc\n  }, {})\n\n  const calls = []\n\n  const { ajs_uid, ajs_event, ajs_aid } = params\n  const { aid: aidPattern = /.+/, uid: uidPattern = /.+/ } = isPlainObject(\n    analytics.options.useQueryString\n  )\n    ? analytics.options.useQueryString\n    : {}\n\n  if (ajs_aid) {\n    const anonId = Array.isArray(params.ajs_aid)\n      ? params.ajs_aid[0]\n      : params.ajs_aid\n\n    if (aidPattern.test(anonId)) {\n      analytics.setAnonymousId(anonId)\n    }\n  }\n\n  if (ajs_uid) {\n    const uid = Array.isArray(params.ajs_uid)\n      ? params.ajs_uid[0]\n      : params.ajs_uid\n\n    if (uidPattern.test(uid)) {\n      const traits = pickPrefix('ajs_trait_', params)\n\n      calls.push(analytics.identify(uid, traits))\n    }\n  }\n\n  if (ajs_event) {\n    const event = Array.isArray(params.ajs_event)\n      ? params.ajs_event[0]\n      : params.ajs_event\n    const props = pickPrefix('ajs_prop_', params)\n    calls.push(analytics.track(event, props))\n  }\n\n  return Promise.all(calls)\n}\n","import { QueryStringParams } from '.'\n\n/**\n * Returns an object containing only the properties prefixed by the input\n * string.\n * Ex: prefix('ajs_traits_', { ajs_traits_address: '123 St' })\n * will return { address: '123 St' }\n **/\nexport function pickPrefix(\n  prefix: string,\n  object: QueryStringParams\n): QueryStringParams {\n  return Object.keys(object).reduce((acc: QueryStringParams, key: string) => {\n    if (key.startsWith(prefix)) {\n      const field = key.substr(prefix.length)\n      acc[field] = object[key]!\n    }\n    return acc\n  }, {})\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}