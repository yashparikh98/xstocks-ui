{"version":3,"sources":["../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/node_modules/%40toruslabs/constants/dist/lib.esm/constants.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/index.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/util.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/server.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/broadcast-channel.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/redundant-adaptive-broadcast-channel.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/options.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/native.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/simulate.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/indexed-db.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/method-chooser.js","../../../../node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/localstorage.js","../../../../node_modules/oblivious-set/src/index.ts"],"sourcesContent":["const TORUS_LEGACY_NETWORK = {\n  MAINNET: \"mainnet\",\n  TESTNET: \"testnet\",\n  CYAN: \"cyan\",\n  AQUA: \"aqua\",\n  CELESTE: \"celeste\"\n};\nconst TORUS_SAPPHIRE_NETWORK = {\n  SAPPHIRE_DEVNET: \"sapphire_devnet\",\n  SAPPHIRE_MAINNET: \"sapphire_mainnet\"\n};\nconst PROXY_CONTRACT_ADDRESS = {\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"0xf20336e16B5182637f09821c27BDe29b0AFcfe80\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"0xd084604e5FA387FbC2Da8bAab07fDD6aDED4614A\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"0x9f072ba19b3370e512aa1b4bfcdaf97283168005\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"0x29Dea82a0509153b91040ee13cDBba0f03efb625\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"0x6Bffb4e89453069E7487f0fa5c9f4a2D771cce6c\"\n};\nconst MULTI_CLUSTER_NETWORKS = [\n  // TORUS_LEGACY_NETWORK.AQUA,\n  // TORUS_LEGACY_NETWORK.CELESTE,\n  // TORUS_LEGACY_NETWORK.CYAN,\n];\nconst LEGACY_NETWORKS_ROUTE_MAP = {\n  [TORUS_LEGACY_NETWORK.AQUA]: {\n    migrationCompleted: true,\n    networkIdentifier: \"aqua\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.CELESTE]: {\n    migrationCompleted: true,\n    networkIdentifier: \"celeste\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.CYAN]: {\n    migrationCompleted: true,\n    networkIdentifier: \"cyan\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.MAINNET]: {\n    migrationCompleted: true,\n    networkIdentifier: \"mainnet\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.TESTNET]: {\n    migrationCompleted: true,\n    networkIdentifier: \"teal\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET\n  }\n};\nconst NETWORK_MAP = {\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"mainnet\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"goerli\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"polygon-mainnet\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"polygon-mainnet\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"polygon-mainnet\"\n};\nconst SIGNER_MAP = {\n  [TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"https://api.web3auth.io/signer-polygon-service\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"https://api.web3auth.io/signer-polygon-service\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"https://api.web3auth.io/signer-polygon-service\"\n};\nconst METADATA_MAP = {\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"https://api.web3auth.io/metadata-service\"\n};\n\n// FND backend service\nconst FND_SERVER = \"https://api.web3auth.io/fnd-service\";\n\n// Session backend service\nconst SESSION_SERVER_API_URL = \"https://api.web3auth.io/session-service\";\nconst SESSION_SERVER_SOCKET_URL = \"https://session.web3auth.io\";\n\n// Authjs backend service\nconst AUTHJS_SERVER_URL = \"https://api.web3auth.io/authjs-service\";\nconst KEY_TYPE = {\n  SECP256K1: \"secp256k1\",\n  ED25519: \"ed25519\"\n};\nconst SIG_TYPE = {\n  ECDSA_SECP256K1: \"ecdsa-secp256k1\",\n  ED25519: \"ed25519\",\n  BIP340: \"bip340\"\n};\n\nexport { AUTHJS_SERVER_URL, FND_SERVER, KEY_TYPE, LEGACY_NETWORKS_ROUTE_MAP, METADATA_MAP, MULTI_CLUSTER_NETWORKS, NETWORK_MAP, PROXY_CONTRACT_ADDRESS, SESSION_SERVER_API_URL, SESSION_SERVER_SOCKET_URL, SIGNER_MAP, SIG_TYPE, TORUS_LEGACY_NETWORK, TORUS_SAPPHIRE_NETWORK };\n","import * as indexedDb from './methods/indexed-db.js';\nexport { indexedDb as IndexedDbMethod };\nimport * as localstorage from './methods/localstorage.js';\nexport { localstorage as LocalstorageMethod };\nimport * as native from './methods/native.js';\nexport { native as NativeMethod };\nimport * as server from './methods/server.js';\nexport { server as ServerMethod };\nexport { BroadcastChannel, OPEN_BROADCAST_CHANNELS, enforceOptions } from './broadcast-channel.js';\nexport { chooseMethod } from './method-chooser.js';\nexport { RedundantAdaptiveBroadcastChannel } from './redundant-adaptive-broadcast-channel.js';\n","import loglevel from 'loglevel';\n\n// import Bowser from 'bowser';\n/**\n * returns true if the given object is a promise\n */\nfunction isPromise(obj) {\n  if (obj && typeof obj.then === \"function\") {\n    return true;\n  }\n  return false;\n}\nPromise.resolve(false);\nPromise.resolve(true);\nconst PROMISE_RESOLVED_VOID = Promise.resolve();\nfunction sleep(time, resolveWith) {\n  if (!time) time = 0;\n  return new Promise(resolve => {\n    setTimeout(() => resolve(resolveWith), time);\n  });\n}\nfunction randomInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\n/**\n * https://stackoverflow.com/a/8084248\n */\nfunction generateRandomId() {\n  return Math.random().toString(36).substring(2);\n}\nlet lastMs = 0;\n\n/**\n * returns the current time in micro-seconds,\n * WARNING: This is a pseudo-function\n * Performance.now is not reliable in webworkers, so we just make sure to never return the same time.\n * This is enough in browsers, and this function will not be used in nodejs.\n * The main reason for this hack is to ensure that BroadcastChannel behaves equal to production when it is used in fast-running unit tests.\n */\nfunction microSeconds() {\n  let ret = Date.now() * 1000; // milliseconds to microseconds\n  if (ret <= lastMs) {\n    ret = lastMs + 1;\n  }\n  lastMs = ret;\n  return ret;\n}\n\n// the problem is only in iframes. we should default to server in case of iframes.\n// storage scoping is present in all browsers now\n// Safari and other browsers support native Broadcast channel now. It's in LS.\n// test here: https://pubkey.github.io/broadcast-channel/e2e.html?methodType=native\n// https://caniuse.com/broadcastchannel\n// export function are3PCSupported() {\n//     if (typeof navigator === 'undefined') return false;\n//     const browserInfo = Bowser.parse(navigator.userAgent);\n//     log.info(JSON.stringify(browserInfo), 'current browser info');\n\n//     let thirdPartyCookieSupport = true;\n//     // brave\n//     if (navigator.brave) {\n//         thirdPartyCookieSupport = false;\n//     }\n//     // All webkit & gecko engine instances use itp (intelligent tracking prevention -\n//     // https://webkit.org/tracking-prevention/#intelligent-tracking-prevention-itp)\n//     if (browserInfo.engine.name === Bowser.ENGINE_MAP.WebKit || browserInfo.engine.name === Bowser.ENGINE_MAP.Gecko) {\n//         thirdPartyCookieSupport = false;\n//     }\n\n//     return thirdPartyCookieSupport;\n// }\n\nconst log = loglevel.getLogger(\"broadcast-channel\");\nlog.setLevel(\"error\");\n\nexport { PROMISE_RESOLVED_VOID, generateRandomId, isPromise, log, microSeconds, randomInt, sleep };\n","import { sign, getPublic } from '@toruslabs/eccrypto';\nimport { keccak256, encryptData, decryptData } from '@toruslabs/metadata-helpers';\nimport { ObliviousSet } from 'oblivious-set';\nimport { io } from 'socket.io-client';\nimport { fillOptionsWithDefaults } from '../options.js';\nimport { microSeconds as microSeconds$1, sleep, generateRandomId, log } from '../util.js';\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\nconst microSeconds = microSeconds$1;\nconst KEY_PREFIX = \"pubkey.broadcastChannel-\";\nconst type = \"server\";\nlet SOCKET_CONN_INSTANCE = null;\n// used to decide to reconnect socket e.g. when socket connection is disconnected unexpectedly\nconst runningChannels = new Set();\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\nfunction postMessage(channelState, messageJson) {\n  return new Promise((resolve, reject) => {\n    sleep().then(async () => {\n      const key = storageKey(channelState.channelName);\n      const channelEncPrivKey = keccak256(Buffer.from(key, \"utf8\"));\n      const encData = await encryptData(channelEncPrivKey.toString(\"hex\"), {\n        token: generateRandomId(),\n        time: Date.now(),\n        data: messageJson,\n        uuid: channelState.uuid\n      });\n      const body = {\n        allowedOrigin: channelState.server.allowed_origin,\n        sameIpCheck: true,\n        key: getPublic(channelEncPrivKey).toString(\"hex\"),\n        data: encData,\n        signature: (await sign(channelEncPrivKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\")\n      };\n      if (channelState.timeout) body.timeout = channelState.timeout;\n      return fetch(`${channelState.server.api_url}/channel/set`, {\n        method: \"POST\",\n        body: JSON.stringify(body),\n        headers: {\n          \"Content-Type\": \"application/json; charset=utf-8\"\n        }\n      }).then(resolve).catch(reject);\n    }).catch(reject);\n  });\n}\nfunction getSocketInstance(socketUrl) {\n  if (SOCKET_CONN_INSTANCE) {\n    return SOCKET_CONN_INSTANCE;\n  }\n  const SOCKET_CONN = io(socketUrl, {\n    transports: [\"websocket\", \"polling\"],\n    // use WebSocket first, if available\n    withCredentials: true,\n    reconnectionDelayMax: 10000,\n    reconnectionAttempts: 10\n  });\n  SOCKET_CONN.on(\"connect_error\", err => {\n    // revert to classic upgrade\n    SOCKET_CONN.io.opts.transports = [\"polling\", \"websocket\"];\n    log.error(\"connect error\", err);\n  });\n  SOCKET_CONN.on(\"connect\", async () => {\n    const {\n      engine\n    } = SOCKET_CONN.io;\n    log.debug(\"initially connected to\", engine.transport.name); // in most cases, prints \"polling\"\n    engine.once(\"upgrade\", () => {\n      // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)\n      log.debug(\"upgraded\", engine.transport.name); // in most cases, prints \"websocket\"\n    });\n    engine.once(\"close\", reason => {\n      // called when the underlying connection is closed\n      log.debug(\"connection closed\", reason);\n    });\n  });\n  SOCKET_CONN.on(\"error\", err => {\n    log.error(\"socket errored\", err);\n    SOCKET_CONN.disconnect();\n  });\n  SOCKET_CONN_INSTANCE = SOCKET_CONN;\n  return SOCKET_CONN;\n}\nfunction setupSocketConnection(socketUrl, channelState, fn) {\n  const socketConn = getSocketInstance(socketUrl);\n  const key = storageKey(channelState.channelName);\n  const channelEncPrivKey = keccak256(Buffer.from(key, \"utf8\"));\n  const channelPubKey = getPublic(channelEncPrivKey).toString(\"hex\");\n  if (socketConn.connected) {\n    socketConn.emit(\"v2:check_auth_status\", channelPubKey, {\n      sameIpCheck: true,\n      allowedOrigin: channelState.server.allowed_origin\n    });\n  } else {\n    socketConn.once(\"connect\", () => {\n      log.debug(\"connected with socket\");\n      socketConn.emit(\"v2:check_auth_status\", channelPubKey, {\n        sameIpCheck: true,\n        allowedOrigin: channelState.server.allowed_origin\n      });\n    });\n  }\n  const reconnect = () => {\n    socketConn.once(\"connect\", async () => {\n      if (runningChannels.has(channelState.channelName)) {\n        socketConn.emit(\"v2:check_auth_status\", channelPubKey, {\n          sameIpCheck: true,\n          allowedOrigin: channelState.server.allowed_origin\n        });\n      }\n    });\n  };\n  const visibilityListener = () => {\n    // if channel is closed, then remove the listener.\n    if (!socketConn || !runningChannels.has(channelState.channelName)) {\n      document.removeEventListener(\"visibilitychange\", visibilityListener);\n      return;\n    }\n    // if not connected, then wait for connection and ping server for latest msg.\n    if (!socketConn.connected && document.visibilityState === \"visible\") {\n      reconnect();\n    }\n  };\n  const listener = async ev => {\n    try {\n      const decData = await decryptData(channelEncPrivKey.toString(\"hex\"), ev);\n      log.info(decData);\n      fn(decData);\n    } catch (error) {\n      log.error(error);\n    }\n  };\n  socketConn.on(\"disconnect\", () => {\n    log.debug(\"socket disconnected\");\n    if (runningChannels.has(channelState.channelName)) {\n      log.error(\"socket disconnected unexpectedly, reconnecting socket\");\n      reconnect();\n    }\n  });\n  socketConn.on(`${channelPubKey}_success`, listener);\n  if (typeof document !== \"undefined\") document.addEventListener(\"visibilitychange\", visibilityListener);\n  return socketConn;\n}\nfunction removeStorageEventListener() {\n  if (SOCKET_CONN_INSTANCE) {\n    SOCKET_CONN_INSTANCE.disconnect();\n  }\n}\nfunction canBeUsed() {\n  return true;\n}\nfunction create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  const uuid = generateRandomId();\n\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n  const eMIs = new ObliviousSet(options.server.removeTimeout);\n  const state = {\n    channelName,\n    uuid,\n    eMIs,\n    // emittedMessagesIds\n    server: {\n      api_url: options.server.api_url,\n      socket_url: options.server.socket_url,\n      allowed_origin: options.server.allowed_origin\n    },\n    time: microSeconds$1()\n  };\n  if (options.server.timeout) state.timeout = options.server.timeout;\n  setupSocketConnection(options.server.socket_url, state, msgObj => {\n    if (!state.messagesCallback) return; // no listener\n    if (msgObj.uuid === state.uuid) return; // own message\n    if (!msgObj.token || state.eMIs.has(msgObj.token)) return; // already emitted\n    // if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    state.eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  runningChannels.add(channelName);\n  return state;\n}\nfunction close(channelState) {\n  runningChannels.delete(channelState.channelName);\n  // give 2 sec for all msgs which are in transit to be consumed\n  // by receiver.\n  // window.setTimeout(() => {\n  //     removeStorageEventListener(channelState);\n  //     SOCKET_CONN_INSTANCE = null;\n  // }, 1000);\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nfunction averageResponseTime() {\n  const defaultTime = 500;\n  // TODO: Maybe increase it based on operation\n  return defaultTime;\n}\n\nexport { averageResponseTime, canBeUsed, close, create, getSocketInstance, microSeconds, onMessage, postMessage, removeStorageEventListener, setupSocketConnection, storageKey, type };\n","import _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { chooseMethod } from './method-chooser.js';\nimport { fillOptionsWithDefaults } from './options.js';\nimport { PROMISE_RESOLVED_VOID, isPromise } from './util.js';\n\nlet ENFORCED_OPTIONS;\nfunction enforceOptions(options) {\n  ENFORCED_OPTIONS = options;\n}\n\n/**\n * Contains all open channels,\n * used in tests to ensure everything is closed.\n */\n\nconst OPEN_BROADCAST_CHANNELS = new Set();\nlet lastId = 0;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nclass BroadcastChannel {\n  // beforeClose\n\n  constructor(name, options) {\n    _defineProperty(this, \"id\", void 0);\n    _defineProperty(this, \"name\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    _defineProperty(this, \"method\", void 0);\n    _defineProperty(this, \"closed\", void 0);\n    _defineProperty(this, \"_addEL\", void 0);\n    _defineProperty(this, \"_prepP\", void 0);\n    // preparePromise\n    _defineProperty(this, \"_state\", void 0);\n    _defineProperty(this, \"_uMP\", void 0);\n    // unsent message promises\n    _defineProperty(this, \"_iL\", void 0);\n    // isListening\n    _defineProperty(this, \"_onML\", void 0);\n    // onMessageListener\n    _defineProperty(this, \"_befC\", void 0);\n    this.id = lastId++;\n    OPEN_BROADCAST_CHANNELS.add(this);\n    this.name = name;\n    if (ENFORCED_OPTIONS) {\n      options = ENFORCED_OPTIONS;\n    }\n    this.options = fillOptionsWithDefaults(options || {});\n    this.method = chooseMethod(this.options);\n    this.closed = false;\n    this._iL = false;\n    this._onML = null;\n    this._addEL = {\n      message: [],\n      internal: []\n    };\n    this._uMP = new Set();\n    this._befC = [];\n    this._prepP = null;\n    _prepareChannel(this);\n  }\n  get type() {\n    return this.method.type;\n  }\n  get isClosed() {\n    return this.closed;\n  }\n  set onmessage(fn) {\n    const time = this.method.microSeconds();\n    const listenObj = {\n      time,\n      fn: fn\n    };\n    _removeListenerObject(this, \"message\", this._onML);\n    if (fn && typeof fn === \"function\") {\n      this._onML = listenObj;\n      _addListenerObject(this, \"message\", listenObj);\n    } else {\n      this._onML = null;\n    }\n  }\n  postMessage(msg) {\n    if (this.closed) {\n      throw new Error(`BroadcastChannel.postMessage(): Cannot post message after channel has closed ${JSON.stringify(msg)}`);\n    }\n    return _post(this, \"message\", msg);\n  }\n  postInternal(msg) {\n    return _post(this, \"internal\", msg);\n  }\n  addEventListener(type, fn) {\n    const time = this.method.microSeconds();\n    const listenObj = {\n      time,\n      fn: fn\n    };\n    _addListenerObject(this, type, listenObj);\n  }\n  removeEventListener(type, fn) {\n    const obj = this._addEL[type].find(o => o.fn === fn);\n    _removeListenerObject(this, type, obj);\n  }\n  close() {\n    if (this.closed) {\n      return Promise.resolve();\n    }\n    OPEN_BROADCAST_CHANNELS.delete(this);\n    this.closed = true;\n    const awaitPrepare = this._prepP ? this._prepP : PROMISE_RESOLVED_VOID;\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare.then(() => Promise.all(Array.from(this._uMP))).then(() => Promise.all(this._befC.map(fn => fn()))).then(() => this.method.close ? this.method.close(this._state) : PROMISE_RESOLVED_VOID);\n  }\n}\n_defineProperty(BroadcastChannel, \"_pubkey\", true);\nfunction _post(broadcastChannel, type, msg) {\n  const time = broadcastChannel.method.microSeconds();\n  const msgObj = {\n    time,\n    type,\n    data: msg\n  };\n  const awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : PROMISE_RESOLVED_VOID;\n  return awaitPrepare.then(() => {\n    const sendPromise = broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n    broadcastChannel._uMP.add(sendPromise);\n    // eslint-disable-next-line promise/catch-or-return\n    sendPromise.catch(() => {}).then(() => broadcastChannel._uMP.delete(sendPromise));\n    return sendPromise;\n  });\n}\nfunction _prepareChannel(channel) {\n  const maybePromise = channel.method.create(channel.name, channel.options);\n  if (isPromise(maybePromise)) {\n    const promise = maybePromise;\n    channel._prepP = promise;\n    promise.then(s => {\n      channel._state = s;\n      return s;\n    }).catch(err => {\n      throw err;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    const listenerFn = msgObj => {\n      channel._addEL[msgObj.type].forEach(listenerObject => {\n        if (msgObj.time >= listenerObject.time) {\n          listenerObject.fn(msgObj.data);\n        } else if (channel.method.type === \"server\") {\n          listenerObject.fn(msgObj.data);\n        }\n      });\n    };\n    const time = channel.method.microSeconds();\n    if (channel._prepP) {\n      channel._prepP.then(() => {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n        return true;\n      }).catch(err => {\n        throw err;\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    channel._iL = false;\n    const time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n  _startListening(channel);\n}\nfunction _removeListenerObject(channel, type, obj) {\n  if (obj) {\n    channel._addEL[type] = channel._addEL[type].filter(o => o !== obj);\n    _stopListening(channel);\n  }\n}\n\nexport { BroadcastChannel, OPEN_BROADCAST_CHANNELS, enforceOptions };\n","import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { BroadcastChannel } from './broadcast-channel.js';\nimport { type as type$1 } from './methods/localstorage.js';\nimport { type } from './methods/native.js';\nimport { type as type$2 } from './methods/server.js';\nimport { type as type$3 } from './methods/simulate.js';\nimport { log } from './util.js';\n\n/**\n * The RedundantAdaptiveBroadcastChannel class is designed to add fallback to during channel post message and synchronization issues between senders and receivers in a broadcast communication scenario. It achieves this by:\n * Creating a separate channel for each communication method, allowing all methods to listen simultaneously.\n * Implementing redundant message delivery by attempting to send messages through multiple channels when the primary channel fails.\n * Ensuring message delivery by using multiple communication methods simultaneously while preventing duplicate message processing.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nclass RedundantAdaptiveBroadcastChannel {\n  constructor(name, options = {}) {\n    _defineProperty(this, \"name\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    _defineProperty(this, \"closed\", void 0);\n    _defineProperty(this, \"onML\", void 0);\n    _defineProperty(this, \"methodPriority\", void 0);\n    _defineProperty(this, \"channels\", void 0);\n    _defineProperty(this, \"listeners\", void 0);\n    _defineProperty(this, \"processedNonces\", void 0);\n    _defineProperty(this, \"nonce\", void 0);\n    this.name = name;\n    this.options = options;\n    this.closed = false;\n    this.onML = null;\n    // order from fastest to slowest\n    this.methodPriority = [type, type$1, type$2];\n    this.channels = new Map();\n    this.listeners = new Set();\n    this.processedNonces = new Set();\n    this.nonce = 0;\n    this.initChannels();\n  }\n  set onmessage(fn) {\n    this.removeEventListener(\"message\", this.onML);\n    if (fn && typeof fn === \"function\") {\n      this.onML = fn;\n      this.addEventListener(\"message\", fn);\n    } else {\n      this.onML = null;\n    }\n  }\n  initChannels() {\n    // only use simulate if type simulate ( for testing )\n    if (this.options.type === type$3) {\n      this.methodPriority = [type$3];\n    }\n\n    // iterates through the methodPriority array, attempting to create a new BroadcastChannel for each method\n    this.methodPriority.forEach(method => {\n      try {\n        const channel = new BroadcastChannel(this.name, _objectSpread(_objectSpread({}, this.options), {}, {\n          type: method\n        }));\n        this.channels.set(method, channel);\n        log.debug(`Succeeded to initialize ${method} method in channel ${this.name}`);\n        // listening on every method\n        channel.onmessage = event => this.handleMessage(event);\n      } catch (error) {\n        log.warn(`Failed to initialize ${method} method in channel ${this.name}: ${error instanceof Error ? error.message : String(error)}`);\n      }\n    });\n    if (this.channels.size === 0) {\n      throw new Error(\"Failed to initialize any communication method\");\n    }\n  }\n  allChannels() {\n    return Array.from(this.channels.keys());\n  }\n  hasChannel(method) {\n    return this.channels.has(method);\n  }\n  handleMessage(event) {\n    if (event && event.nonce) {\n      if (this.processedNonces.has(event.nonce)) {\n        // log.debug(`Duplicate message received via ${method}, nonce: ${event.nonce}`);\n        return;\n      }\n      this.processedNonces.add(event.nonce);\n\n      // Cleanup old nonces (keeping last 1000 to prevent memory issues)\n      if (this.processedNonces.size > 1000) {\n        const nonces = Array.from(this.processedNonces);\n        const oldestNonce = nonces.sort()[0];\n        this.processedNonces.delete(oldestNonce);\n      }\n      this.listeners.forEach(listener => {\n        listener(event.message);\n      });\n    }\n  }\n  async postMessage(message) {\n    if (this.closed) {\n      throw new Error(\"AdaptiveBroadcastChannel.postMessage(): \" + `Cannot post message after channel has closed ${\n      /**\n       * In the past when this error appeared, it was realy hard to debug.\n       * So now we log the msg together with the error so it at least\n       * gives some clue about where in your application this happens.\n       */\n      JSON.stringify(message)}`);\n    }\n    const nonce = this.generateNonce();\n    const wrappedMessage = {\n      nonce,\n      message\n    };\n    const postPromises = Array.from(this.channels.entries()).map(([method, channel]) => channel.postMessage(wrappedMessage).catch(error => {\n      log.warn(`Failed to send via ${method}: ${error.message}`);\n      throw error;\n    }));\n    const result = await Promise.allSettled(postPromises);\n\n    // Check if at least one promise resolved successfully\n    const anySuccessful = result.some(p => p.status === \"fulfilled\");\n    if (!anySuccessful) {\n      throw new Error(\"Failed to send message through any method\");\n    }\n    return message;\n  }\n  generateNonce() {\n    return `${Date.now()}-${this.nonce++}`;\n  }\n  addEventListener(_type, listener) {\n    // type params is not being used, it's there to keep same interface as BroadcastChannel\n    this.listeners.add(listener);\n  }\n  removeEventListener(_type, listener) {\n    // type params is not being used, it's there to keep same interface as BroadcastChannel\n    this.listeners.delete(listener);\n  }\n  async close() {\n    if (this.closed) {\n      return;\n    }\n    this.onML = null;\n\n    // use for loop instead of channels.values().map because of bug in safari Map\n    const promises = [];\n    for (const c of this.channels.values()) {\n      promises.push(c.close());\n    }\n    await Promise.all(promises);\n    this.channels.clear();\n    this.listeners.clear();\n    this.closed = true;\n  }\n}\n\nexport { RedundantAdaptiveBroadcastChannel };\n","import { SESSION_SERVER_API_URL, SESSION_SERVER_SOCKET_URL } from '@toruslabs/constants';\n\nfunction fillOptionsWithDefaults(originalOptions = {}) {\n  const options = JSON.parse(JSON.stringify(originalOptions));\n\n  // main\n  if (typeof options.webWorkerSupport === \"undefined\") options.webWorkerSupport = true;\n\n  // indexed-db\n  if (!options.idb) options.idb = {};\n  //  after this time the messages get deleted\n  if (!options.idb.ttl) options.idb.ttl = 1000 * 45;\n  if (!options.idb.fallbackInterval) options.idb.fallbackInterval = 150;\n  //  handles abrupt db onclose events.\n  if (originalOptions.idb && typeof originalOptions.idb.onclose === \"function\") options.idb.onclose = originalOptions.idb.onclose;\n\n  // localstorage\n  if (!options.localstorage) options.localstorage = {};\n  if (!options.localstorage.removeTimeout) options.localstorage.removeTimeout = 1000 * 60;\n\n  // server\n  if (!options.server) options.server = {};\n  if (!options.server.api_url) options.server.api_url = `${SESSION_SERVER_API_URL}/v2`;\n  if (!options.server.socket_url) options.server.socket_url = `${SESSION_SERVER_SOCKET_URL}`;\n  if (!options.server.removeTimeout) options.server.removeTimeout = 1000 * 60 * 5; // 5 minutes\n\n  // custom methods\n  if (originalOptions.methods) options.methods = originalOptions.methods;\n  return options;\n}\n\nexport { fillOptionsWithDefaults };\n","import { microSeconds as microSeconds$1, PROMISE_RESOLVED_VOID } from '../util.js';\n\nconst microSeconds = microSeconds$1;\nconst type = \"native\";\nfunction create(channelName) {\n  const state = {\n    time: microSeconds$1(),\n    messagesCallback: null,\n    bc: new BroadcastChannel(channelName),\n    subFns: [] // subscriberFunctions\n  };\n  state.bc.onmessage = msg => {\n    if (state.messagesCallback) {\n      state.messagesCallback(msg.data);\n    }\n  };\n  return state;\n}\nfunction close(channelState) {\n  channelState.bc.close();\n  channelState.subFns = [];\n}\nfunction postMessage(channelState, messageJson) {\n  try {\n    channelState.bc.postMessage(messageJson);\n    return PROMISE_RESOLVED_VOID;\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  /**\n   * in the electron-renderer, isNode will be true even if we are in browser-context\n   * so we also check if window is undefined\n   */\n  if (typeof window === \"undefined\") return false;\n  if (typeof BroadcastChannel === \"function\") {\n    if (BroadcastChannel._pubkey) {\n      throw new Error(\"BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill\");\n    }\n    return true;\n  }\n  return false;\n}\nfunction averageResponseTime() {\n  return 150;\n}\n\nexport { averageResponseTime, canBeUsed, close, create, microSeconds, onMessage, postMessage, type };\n","import { microSeconds as microSeconds$1 } from '../util.js';\n\nconst microSeconds = microSeconds$1;\nconst type = \"simulate\";\nconst SIMULATE_CHANNELS = new Set();\nconst SIMULATE_DELAY_TIME = 5;\nfunction create(channelName) {\n  const state = {\n    time: microSeconds$1(),\n    name: channelName,\n    messagesCallback: null\n  };\n  SIMULATE_CHANNELS.add(state);\n  return state;\n}\nfunction close(channelState) {\n  SIMULATE_CHANNELS.delete(channelState);\n}\nfunction postMessage(channelState, messageJson) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      const channelArray = Array.from(SIMULATE_CHANNELS);\n      channelArray.forEach(channel => {\n        if (channel.name === channelState.name &&\n        // has same name\n        channel !== channelState &&\n        // not own channel\n        !!channel.messagesCallback &&\n        // has subscribers\n        channel.time < messageJson.time // channel not created after postMessage() call\n        ) {\n          channel.messagesCallback(messageJson);\n        }\n      });\n      resolve();\n    }, SIMULATE_DELAY_TIME);\n  });\n}\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  return true;\n}\nfunction averageResponseTime() {\n  return SIMULATE_DELAY_TIME;\n}\n\nexport { SIMULATE_DELAY_TIME, averageResponseTime, canBeUsed, close, create, microSeconds, onMessage, postMessage, type };\n","import { microSeconds as microSeconds$1, generateRandomId, PROMISE_RESOLVED_VOID, randomInt, sleep } from '../util.js';\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options.js';\n\n/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n *\n * When working on this, ensure to use these performance optimizations:\n * @link https://rxdb.info/slow-indexeddb.html\n */\n\nconst microSeconds = microSeconds$1;\nconst DB_PREFIX = \"pubkey.broadcast-channel-0-\";\nconst OBJECT_STORE_ID = \"messages\";\n\n/**\n * Use relaxed durability for faster performance on all transactions.\n * @link https://nolanlawson.com/2021/08/22/speeding-up-indexeddb-reads-and-writes/\n */\nconst TRANSACTION_SETTINGS = {\n  durability: \"relaxed\"\n};\nconst type = \"idb\";\nfunction getIdb() {\n  if (typeof indexedDB !== \"undefined\") return indexedDB;\n  if (typeof window !== \"undefined\") {\n    const extWindow = window;\n    if (typeof extWindow.mozIndexedDB !== \"undefined\") return extWindow.mozIndexedDB;\n    if (typeof extWindow.webkitIndexedDB !== \"undefined\") return extWindow.webkitIndexedDB;\n    if (typeof extWindow.msIndexedDB !== \"undefined\") return extWindow.msIndexedDB;\n  }\n  return false;\n}\n\n/**\n * If possible, we should explicitly commit IndexedDB transactions\n * for better performance.\n * @link https://nolanlawson.com/2021/08/22/speeding-up-indexeddb-reads-and-writes/\n */\nfunction commitIndexedDBTransaction(tx) {\n  if (tx.commit) {\n    tx.commit();\n  }\n}\nfunction createDatabase(channelName) {\n  const IndexedDB = getIdb();\n  if (!IndexedDB) return Promise.reject(new Error(\"IndexedDB not available\"));\n\n  // create table\n  const dbName = DB_PREFIX + channelName;\n\n  /**\n   * All IndexedDB databases are opened without version\n   * because it is a bit faster, especially on firefox\n   * @link http://nparashuram.com/IndexedDB/perf/#Open%20Database%20with%20version\n   */\n  const openRequest = IndexedDB.open(dbName);\n  openRequest.onupgradeneeded = ev => {\n    const db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: \"id\",\n      autoIncrement: true\n    });\n  };\n  const dbPromise = new Promise((resolve, reject) => {\n    openRequest.onerror = ev => reject(ev);\n    openRequest.onsuccess = () => {\n      resolve(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n\n/**\n * writes the new message to the database\n * so other readers can find it\n */\nfunction writeMessage(db, readerUuid, messageJson) {\n  const time = Date.now();\n  const writeObject = {\n    uuid: readerUuid,\n    time,\n    data: messageJson\n  };\n  const tx = db.transaction([OBJECT_STORE_ID], \"readwrite\", TRANSACTION_SETTINGS);\n  return new Promise((resolve, reject) => {\n    tx.oncomplete = () => resolve();\n    tx.onerror = ev => reject(ev);\n    const objectStore = tx.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n    commitIndexedDBTransaction(tx);\n  });\n}\nfunction getAllMessages(db) {\n  const tx = db.transaction(OBJECT_STORE_ID, \"readonly\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  const ret = [];\n  return new Promise(resolve => {\n    objectStore.openCursor().onsuccess = ev => {\n      const cursor = ev.target.result;\n      if (cursor) {\n        ret.push(cursor.value);\n        cursor.continue();\n      } else {\n        commitIndexedDBTransaction(tx);\n        resolve(ret);\n      }\n    };\n  });\n}\nfunction getMessagesHigherThan(db, lastCursorId) {\n  const tx = db.transaction(OBJECT_STORE_ID, \"readonly\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  const ret = [];\n  let keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n\n  /**\n   * Optimization shortcut,\n   * if getAll() can be used, do not use a cursor.\n   * @link https://rxdb.info/slow-indexeddb.html\n   */\n  if (objectStore.getAll) {\n    const getAllRequest = objectStore.getAll(keyRangeValue);\n    return new Promise((resolve, reject) => {\n      getAllRequest.onerror = err => reject(err);\n      getAllRequest.onsuccess = function (e) {\n        resolve(e.target.result);\n      };\n    });\n  }\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch {\n      return objectStore.openCursor();\n    }\n  }\n  return new Promise((resolve, reject) => {\n    const openCursorRequest = openCursor();\n    openCursorRequest.onerror = err => reject(err);\n    openCursorRequest.onsuccess = ev => {\n      const cursor = ev.target.result;\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor.continue(lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor.continue();\n        }\n      } else {\n        commitIndexedDBTransaction(tx);\n        resolve(ret);\n      }\n    };\n  });\n}\nfunction removeMessagesById(db, ids) {\n  const tx = db.transaction([OBJECT_STORE_ID], \"readwrite\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  return Promise.all(ids.map(id => {\n    const deleteRequest = objectStore.delete(id);\n    return new Promise(resolve => {\n      deleteRequest.onsuccess = () => resolve();\n    });\n  }));\n}\nfunction getOldMessages(db, ttl) {\n  const olderThen = Date.now() - ttl;\n  const tx = db.transaction(OBJECT_STORE_ID, \"readonly\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  const ret = [];\n  return new Promise(resolve => {\n    objectStore.openCursor().onsuccess = ev => {\n      const cursor = ev.target.result;\n      if (cursor) {\n        const msgObk = cursor.value;\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk);\n          cursor.continue();\n        } else {\n          // no more old messages,\n          commitIndexedDBTransaction(tx);\n          resolve(ret);\n        }\n      } else {\n        resolve(ret);\n      }\n    };\n  });\n}\nfunction cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(tooOld => {\n    return removeMessagesById(db, tooOld.map(msg => msg.id));\n  });\n}\nfunction create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  return createDatabase(channelName).then(db => {\n    const state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName,\n      options,\n      uuid: generateRandomId(),\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: PROMISE_RESOLVED_VOID,\n      messagesCallback: null,\n      readQueuePromises: [],\n      db,\n      time: microSeconds$1()\n    };\n\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n    _readLoop(state);\n    return state;\n  });\n}\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(() => sleep(state.options.idb.fallbackInterval)).then(() => _readLoop(state)).catch(e => {\n    throw e;\n  });\n}\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n  return true;\n}\n\n/**\n * reads all new messages from the database and emits them\n */\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return PROMISE_RESOLVED_VOID;\n\n  // if no one is listening, we do not need to scan for new messages\n  if (!state.messagesCallback) return PROMISE_RESOLVED_VOID;\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(newerMessages => {\n    const useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */.filter(msgObj => !!msgObj).map(msgObj => {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n      return msgObj;\n    }).filter(msgObj => _filterMessage(msgObj, state)).sort((msgObjA, msgObjB) => msgObjA.time - msgObjB.time); // sort by time\n    useMessages.forEach(msgObj => {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return PROMISE_RESOLVED_VOID;\n  });\n}\nfunction close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\nfunction postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(() => writeMessage(channelState.db, channelState.uuid, messageJson)).then(() => {\n    if (randomInt(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n    return PROMISE_RESOLVED_VOID;\n  });\n  return channelState.writeBlockPromise;\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\nfunction canBeUsed() {\n  const idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\nfunction averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\n\nexport { TRANSACTION_SETTINGS, averageResponseTime, canBeUsed, cleanOldMessages, close, commitIndexedDBTransaction, create, createDatabase, getAllMessages, getIdb, getMessagesHigherThan, getOldMessages, microSeconds, onMessage, postMessage, removeMessagesById, type, writeMessage };\n","import * as indexedDb from './methods/indexed-db.js';\nimport * as localstorage from './methods/localstorage.js';\nimport * as native from './methods/native.js';\nimport * as server from './methods/server.js';\nimport * as simulate from './methods/simulate.js';\n\n// order is important\nconst METHODS = [native,\n// fastest\nindexedDb, localstorage, server];\nfunction chooseMethod(options) {\n  let chooseMethods = [].concat(options.methods || [], METHODS).filter(Boolean);\n\n  // directly chosen\n  if (options.type) {\n    if (options.type === \"simulate\") {\n      // only use simulate-method if directly chosen\n      return simulate;\n    }\n    const ret = chooseMethods.find(m => m.type === options.type);\n    if (!ret) throw new Error(`method-type ${options.type} not found`);else return ret;\n  }\n\n  /**\n   * if no webworker support is needed,\n   * remove idb from the list so that localstorage is been chosen\n   */\n  if (!options.webWorkerSupport) {\n    chooseMethods = chooseMethods.filter(m => m.type !== \"idb\");\n  }\n  const useMethod = chooseMethods.find(method => method.canBeUsed(options));\n  if (!useMethod) throw new Error(`No useable method found in ${JSON.stringify(METHODS.map(m => m.type))}`);else return useMethod;\n}\n\nexport { chooseMethod };\n","import { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options.js';\nimport { microSeconds as microSeconds$1, sleep, generateRandomId } from '../util.js';\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\nconst microSeconds = microSeconds$1;\nconst KEY_PREFIX = \"pubkey.broadcastChannel-\";\nconst type = \"localstorage\";\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\nfunction getLocalStorage() {\n  let localStorage = null;\n  if (typeof window === \"undefined\") return null;\n  try {\n    localStorage = window.localStorage;\n    localStorage = window[\"ie8-eventlistener/storage\"] || window.localStorage;\n  } catch {\n    // New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n  return localStorage;\n}\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\nfunction postMessage(channelState, messageJson) {\n  return new Promise((resolve, reject) => {\n    sleep().then(() => {\n      var _getLocalStorage;\n      const key = storageKey(channelState.channelName);\n      const writeObj = {\n        token: generateRandomId(),\n        time: Date.now(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      const value = JSON.stringify(writeObj);\n      // eslint-disable-next-line promise/always-return\n      (_getLocalStorage = getLocalStorage()) === null || _getLocalStorage === void 0 || _getLocalStorage.setItem(key, value);\n\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n      const ev = document.createEvent(\"StorageEvent\");\n      ev.initStorageEvent(\"storage\", true, true, key, null, value, \"\", null);\n      window.dispatchEvent(ev);\n      resolve();\n    }).catch(reject);\n  });\n}\nfunction addStorageEventListener(channelName, fn) {\n  const key = storageKey(channelName);\n  const listener = ev => {\n    if (ev.key === key && ev.newValue) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n  window.addEventListener(\"storage\", listener);\n  return listener;\n}\nfunction removeStorageEventListener(listener) {\n  window.removeEventListener(\"storage\", listener);\n}\nfunction canBeUsed() {\n  const ls = getLocalStorage();\n  if (!ls) return false;\n  try {\n    const key = \"__broadcastchannel_check\";\n    ls.setItem(key, \"works\");\n    ls.removeItem(key);\n  } catch {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n  return true;\n}\nfunction create(channelName, options) {\n  const filledOptions = fillOptionsWithDefaults(options);\n  if (!canBeUsed()) {\n    throw new Error(\"BroadcastChannel: localstorage cannot be used\");\n  }\n  const uuid = generateRandomId();\n\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   */\n  const eMIs = new ObliviousSet(filledOptions.localstorage.removeTimeout);\n  const state = {\n    channelName,\n    uuid,\n    time: microSeconds$1(),\n    eMIs // emittedMessagesIds\n  };\n  state.listener = addStorageEventListener(channelName, msgObj => {\n    if (!state.messagesCallback) return; // no listener\n    if (msgObj.uuid === uuid) return; // own message\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < (state.messagesCallbackTime || 0)) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nfunction close(channelState) {\n  if (channelState.listener) {\n    removeStorageEventListener(channelState.listener);\n  }\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nfunction averageResponseTime() {\n  const defaultTime = 120;\n  const userAgent = navigator.userAgent.toLowerCase();\n  if (userAgent.includes(\"safari\") && !userAgent.includes(\"chrome\")) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n  return defaultTime;\n}\n\nexport { addStorageEventListener, averageResponseTime, canBeUsed, close, create, getLocalStorage, microSeconds, onMessage, postMessage, removeStorageEventListener, storageKey, type };\n","\n/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n */\nexport class ObliviousSet<T = any> {\n    public readonly map = new Map();\n\n    /**\n     * Creating calls to setTimeout() is expensive,\n     * so we only do that if there is not timeout already open.\n     */\n    public _to: boolean = false;\n    constructor(\n        public readonly ttl: number\n    ) { }\n\n    has(value: T): boolean {\n        return this.map.has(value);\n    }\n\n    add(value: T): void {\n        this.map.set(value, now());\n\n        /**\n         * When a new value is added,\n         * start the cleanup at the next tick\n         * to not block the cpu for more important stuff\n         * that might happen.\n         */\n        if (!this._to) {\n            this._to = true;\n            setTimeout(() => {\n                this._to = false;\n                removeTooOldValues(this);\n            }, 0);\n        }\n    }\n\n    clear() {\n        this.map.clear();\n    }\n}\n\n\n/**\n * Removes all entries from the set\n * where the TTL has expired\n */\nexport function removeTooOldValues(\n    obliviousSet: ObliviousSet\n) {\n    const olderThen = now() - obliviousSet.ttl;\n    const iterator = obliviousSet.map[Symbol.iterator]();\n\n    /**\n     * Because we can assume the new values are added at the bottom,\n     * we start from the top and stop as soon as we reach a non-too-old value.\n     */\n    while (true) {\n\n        const next = iterator.next().value;\n\n        if (!next) {\n            return; // no more elements\n        }\n        const value = next[0];\n        const time = next[1];\n        if (time < olderThen) {\n            obliviousSet.map.delete(value);\n        } else {\n            // We reached a value that is not old enough\n            return;\n        }\n    }\n}\n\nexport function now(): number {\n    return Date.now();\n}\n\n\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12]}