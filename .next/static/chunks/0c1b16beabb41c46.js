(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,66933,e=>{"use strict";let t;var n=e.i(86325);Promise.resolve(!1),Promise.resolve(!0);let s=Promise.resolve();function o(e,t){return e||(e=0),new Promise(n=>{setTimeout(()=>n(t),e)})}function r(){return Math.random().toString(36).substring(2)}let i=0;function a(){let e=1e3*Date.now();return e<=i&&(e=i+1),i=e,e}let l=n.default.getLogger("broadcast-channel");l.setLevel("error");class c{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,d()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,function(e){let t=d()-e.ttl,n=e.map[Symbol.iterator]();for(;;){let s=n.next().value;if(!s)return;let o=s[0];if(!(s[1]<t))return;e.map.delete(o)}}(this)},0))}clear(){this.map.clear()}}function d(){return Date.now()}function u(e={}){let t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),t.server||(t.server={}),t.server.api_url||(t.server.api_url="https://api.web3auth.io/session-service/v2"),t.server.socket_url||(t.server.socket_url="https://session.web3auth.io"),t.server.removeTimeout||(t.server.removeTimeout=3e5),e.methods&&(t.methods=e.methods),t}let h="messages",m={durability:"relaxed"};function f(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){let e=window;if(void 0!==e.mozIndexedDB)return e.mozIndexedDB;if(void 0!==e.webkitIndexedDB)return e.webkitIndexedDB;if(void 0!==e.msIndexedDB)return e.msIndexedDB}return!1}function g(e){e.commit&&e.commit()}function p(e){let t=f();if(!t)return Promise.reject(Error("IndexedDB not available"));let n=t.open("pubkey.broadcast-channel-0-"+e);return n.onupgradeneeded=e=>{e.target.result.createObjectStore(h,{keyPath:"id",autoIncrement:!0})},new Promise((e,t)=>{n.onerror=e=>t(e),n.onsuccess=()=>{e(n.result)}})}function v(e,t,n){let s={uuid:t,time:Date.now(),data:n},o=e.transaction([h],"readwrite",m);return new Promise((e,t)=>{o.oncomplete=()=>e(),o.onerror=e=>t(e),o.objectStore(h).add(s),g(o)})}function b(e){let t=e.transaction(h,"readonly",m),n=t.objectStore(h),s=[];return new Promise(e=>{n.openCursor().onsuccess=n=>{let o=n.target.result;o?(s.push(o.value),o.continue()):(g(t),e(s))}})}function w(e,t){let n=e.transaction(h,"readonly",m),s=n.objectStore(h),o=[],r=IDBKeyRange.bound(t+1,1/0);if(s.getAll){let e=s.getAll(r);return new Promise((t,n)=>{e.onerror=e=>n(e),e.onsuccess=function(e){t(e.target.result)}})}return new Promise((e,i)=>{let a=function(){try{return r=IDBKeyRange.bound(t+1,1/0),s.openCursor(r)}catch{return s.openCursor()}}();a.onerror=e=>i(e),a.onsuccess=s=>{let r=s.target.result;r?r.value.id<t+1?r.continue(t+1):(o.push(r.value),r.continue()):(g(n),e(o))}})}function y(e,t){let n=e.transaction([h],"readwrite",m).objectStore(h);return Promise.all(t.map(e=>{let t=n.delete(e);return new Promise(e=>{t.onsuccess=()=>e()})}))}function _(e,t){let n=Date.now()-t,s=e.transaction(h,"readonly",m),o=s.objectStore(h),r=[];return new Promise(e=>{o.openCursor().onsuccess=t=>{let o=t.target.result;if(o){let t=o.value;t.time<n?(r.push(t),o.continue()):(g(s),e(r))}else e(r)}})}function k(e,t){return _(e,t).then(t=>y(e,t.map(e=>e.id)))}function C(e,t){return t=u(t),p(e).then(n=>{let i={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:r(),eMIs:new c(2*t.idb.ttl),writeBlockPromise:s,messagesCallback:null,readQueuePromises:[],db:n,time:a()};return n.onclose=function(){i.closed=!0,t.idb.onclose&&t.idb.onclose()},function e(t){t.closed||M(t).then(()=>o(t.options.idb.fallbackInterval)).then(()=>e(t)).catch(e=>{throw e})}(i),i})}function M(e){return e.closed||!e.messagesCallback?s:w(e.db,e.lastCursorId).then(t=>(t.filter(e=>!!e).map(t=>(t.id>e.lastCursorId&&(e.lastCursorId=t.id),t)).filter(t=>!(t.uuid===e.uuid||e.eMIs.has(t.id))&&!(t.data.time<e.messagesCallbackTime)).sort((e,t)=>e.time-t.time).forEach(t=>{e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))}),s))}function S(e){e.closed=!0,e.db.close()}function P(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(()=>v(e.db,e.uuid,t)).then(()=>(0===Math.floor(11*Math.random()+0)&&k(e.db,e.options.idb.ttl),s)),e.writeBlockPromise}function L(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,M(e)}function E(){return!!f()}function I(e){return 2*e.idb.fallbackInterval}e.s(["TRANSACTION_SETTINGS",()=>m,"averageResponseTime",()=>I,"canBeUsed",()=>E,"cleanOldMessages",()=>k,"close",()=>S,"commitIndexedDBTransaction",()=>g,"create",()=>C,"createDatabase",()=>p,"getAllMessages",()=>b,"getIdb",()=>f,"getMessagesHigherThan",()=>w,"getOldMessages",()=>_,"microSeconds",()=>a,"onMessage",()=>L,"postMessage",()=>P,"removeMessagesById",()=>y,"type",()=>"idb","writeMessage",()=>v],79813);var B=e.i(79813);let T="localstorage";function N(){let e=null;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function D(e){return"pubkey.broadcastChannel-"+e}function O(e,t){return new Promise((n,s)=>{o().then(()=>{var s;let o=D(e.channelName),i=JSON.stringify({token:r(),time:Date.now(),data:t,uuid:e.uuid});null==(s=N())||s.setItem(o,i);let a=document.createEvent("StorageEvent");a.initStorageEvent("storage",!0,!0,o,null,i,"",null),window.dispatchEvent(a),n()}).catch(s)})}function A(e,t){let n=D(e),s=e=>{e.key===n&&e.newValue&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",s),s}function x(e){window.removeEventListener("storage",e)}function $(){let e=N();if(!e)return!1;try{let t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function R(e,t){let n=u(t);if(!$())throw Error("BroadcastChannel: localstorage cannot be used");let s=r(),o=new c(n.localstorage.removeTimeout),i={channelName:e,uuid:s,time:a(),eMIs:o};return i.listener=A(e,e=>{!i.messagesCallback||e.uuid===s||!e.token||o.has(e.token)||e.data.time&&e.data.time<(i.messagesCallbackTime||0)||(o.add(e.token),i.messagesCallback(e.data))}),i}function j(e){e.listener&&x(e.listener)}function U(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function J(){let e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}e.s(["addStorageEventListener",()=>A,"averageResponseTime",()=>J,"canBeUsed",()=>$,"close",()=>j,"create",()=>R,"getLocalStorage",()=>N,"microSeconds",()=>a,"onMessage",()=>U,"postMessage",()=>O,"removeStorageEventListener",()=>x,"storageKey",()=>D,"type",()=>T],18767);var z=e.i(18767);let F="native";function K(e){let t={time:a(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=e=>{t.messagesCallback&&t.messagesCallback(e.data)},t}function W(e){e.bc.close(),e.subFns=[]}function H(e,t){try{return e.bc.postMessage(t),s}catch(e){return Promise.reject(e)}}function V(e,t){e.messagesCallback=t}function G(){if("undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1}function Q(){return 150}e.s(["averageResponseTime",()=>Q,"canBeUsed",()=>G,"close",()=>W,"create",()=>K,"microSeconds",()=>a,"onMessage",()=>V,"postMessage",()=>H,"type",()=>F],33519);var Y=e.i(33519),q=e.i(67034),X=e.i(48128),Z=e.i(61131),ee=e.i(67515),et=e.i(96085);let en="server",es=null,eo=new Set;function er(e){return"pubkey.broadcastChannel-"+e}function ei(e,t){return new Promise((n,s)=>{o().then(async()=>{let o=er(e.channelName),i=(0,Z.keccak256)(q.Buffer.from(o,"utf8")),a=await (0,ee.encryptData)(i.toString("hex"),{token:r(),time:Date.now(),data:t,uuid:e.uuid}),l={allowedOrigin:e.server.allowed_origin,sameIpCheck:!0,key:(0,X.getPublic)(i).toString("hex"),data:a,signature:(await (0,X.sign)(i,(0,Z.keccak256)(q.Buffer.from(a,"utf8")))).toString("hex")};return e.timeout&&(l.timeout=e.timeout),fetch(`${e.server.api_url}/channel/set`,{method:"POST",body:JSON.stringify(l),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(n).catch(s)}).catch(s)})}function ea(e){if(es)return es;let t=(0,et.io)(e,{transports:["websocket","polling"],withCredentials:!0,reconnectionDelayMax:1e4,reconnectionAttempts:10});return t.on("connect_error",e=>{t.io.opts.transports=["polling","websocket"],l.error("connect error",e)}),t.on("connect",async()=>{let{engine:e}=t.io;l.debug("initially connected to",e.transport.name),e.once("upgrade",()=>{l.debug("upgraded",e.transport.name)}),e.once("close",e=>{l.debug("connection closed",e)})}),t.on("error",e=>{l.error("socket errored",e),t.disconnect()}),es=t,t}function el(e,t,n){let s=ea(e),o=er(t.channelName),r=(0,Z.keccak256)(q.Buffer.from(o,"utf8")),i=(0,X.getPublic)(r).toString("hex");s.connected?s.emit("v2:check_auth_status",i,{sameIpCheck:!0,allowedOrigin:t.server.allowed_origin}):s.once("connect",()=>{l.debug("connected with socket"),s.emit("v2:check_auth_status",i,{sameIpCheck:!0,allowedOrigin:t.server.allowed_origin})});let a=()=>{s.once("connect",async()=>{eo.has(t.channelName)&&s.emit("v2:check_auth_status",i,{sameIpCheck:!0,allowedOrigin:t.server.allowed_origin})})},c=()=>{s&&eo.has(t.channelName)?s.connected||"visible"!==document.visibilityState||a():document.removeEventListener("visibilitychange",c)},d=async e=>{try{let t=await (0,ee.decryptData)(r.toString("hex"),e);l.info(t),n(t)}catch(e){l.error(e)}};return s.on("disconnect",()=>{l.debug("socket disconnected"),eo.has(t.channelName)&&(l.error("socket disconnected unexpectedly, reconnecting socket"),a())}),s.on(`${i}_success`,d),"undefined"!=typeof document&&document.addEventListener("visibilitychange",c),s}function ec(){es&&es.disconnect()}function ed(){return!0}function eu(e,t){t=u(t);let n={channelName:e,uuid:r(),eMIs:new c(t.server.removeTimeout),server:{api_url:t.server.api_url,socket_url:t.server.socket_url,allowed_origin:t.server.allowed_origin},time:a()};return t.server.timeout&&(n.timeout=t.server.timeout),el(t.server.socket_url,n,e=>{!n.messagesCallback||e.uuid===n.uuid||!e.token||n.eMIs.has(e.token)||(n.eMIs.add(e.token),n.messagesCallback(e.data))}),eo.add(e),n}function eh(e){eo.delete(e.channelName)}function em(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t}function ef(){return 500}e.s(["averageResponseTime",()=>ef,"canBeUsed",()=>ed,"close",()=>eh,"create",()=>eu,"getSocketInstance",()=>ea,"microSeconds",()=>a,"onMessage",()=>em,"postMessage",()=>ei,"removeStorageEventListener",()=>ec,"setupSocketConnection",()=>el,"storageKey",()=>er,"type",()=>en],89766);var eg=e.i(89766);e.s([],47586),e.i(47586);var ep=e.i(11577);let ev="simulate",eb=new Set;function ew(e){let t={time:a(),name:e,messagesCallback:null};return eb.add(t),t}function ey(e){eb.delete(e)}function e_(e,t){return new Promise(n=>{setTimeout(()=>{Array.from(eb).forEach(n=>{n.name===e.name&&n!==e&&n.messagesCallback&&n.time<t.time&&n.messagesCallback(t)}),n()},5)})}function ek(e,t){e.messagesCallback=t}function eC(){return!0}function eM(){return 5}e.s(["SIMULATE_DELAY_TIME",()=>5,"averageResponseTime",()=>eM,"canBeUsed",()=>eC,"close",()=>ey,"create",()=>ew,"microSeconds",()=>a,"onMessage",()=>ek,"postMessage",()=>e_,"type",()=>ev],26449);var eS=e.i(26449);let eP=[Y,B,z,eg];function eL(e){let t=[].concat(e.methods||[],eP).filter(Boolean);if(e.type){if("simulate"===e.type)return eS;let n=t.find(t=>t.type===e.type);if(n)return n;throw Error(`method-type ${e.type} not found`)}e.webWorkerSupport||(t=t.filter(e=>"idb"!==e.type));let n=t.find(t=>t.canBeUsed(e));if(n)return n;throw Error(`No useable method found in ${JSON.stringify(eP.map(e=>e.type))}`)}function eE(e){t=e}let eI=new Set,eB=0;class eT{constructor(e,n){(0,ep.default)(this,"id",void 0),(0,ep.default)(this,"name",void 0),(0,ep.default)(this,"options",void 0),(0,ep.default)(this,"method",void 0),(0,ep.default)(this,"closed",void 0),(0,ep.default)(this,"_addEL",void 0),(0,ep.default)(this,"_prepP",void 0),(0,ep.default)(this,"_state",void 0),(0,ep.default)(this,"_uMP",void 0),(0,ep.default)(this,"_iL",void 0),(0,ep.default)(this,"_onML",void 0),(0,ep.default)(this,"_befC",void 0),this.id=eB++,eI.add(this),this.name=e,t&&(n=t),this.options=u(n||{}),this.method=eL(this.options),this.closed=!1,this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,function(e){let t=e.method.create(e.name,e.options);(t&&"function"==typeof t.then?0:1)?e._state=t:(e._prepP=t,t.then(t=>(e._state=t,t)).catch(e=>{throw e}))}(this)}get type(){return this.method.type}get isClosed(){return this.closed}set onmessage(e){let t={time:this.method.microSeconds(),fn:e};eA(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,eO(this,"message",t)):this._onML=null}postMessage(e){if(this.closed)throw Error(`BroadcastChannel.postMessage(): Cannot post message after channel has closed ${JSON.stringify(e)}`);return eN(this,"message",e)}postInternal(e){return eN(this,"internal",e)}addEventListener(e,t){eO(this,e,{time:this.method.microSeconds(),fn:t})}removeEventListener(e,t){let n=this._addEL[e].find(e=>e.fn===t);eA(this,e,n)}close(){if(this.closed)return Promise.resolve();eI.delete(this),this.closed=!0;let e=this._prepP?this._prepP:s;return this._onML=null,this._addEL.message=[],e.then(()=>Promise.all(Array.from(this._uMP))).then(()=>Promise.all(this._befC.map(e=>e()))).then(()=>this.method.close?this.method.close(this._state):s)}}function eN(e,t,n){let o={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:s).then(()=>{let t=e.method.postMessage(e._state,o);return e._uMP.add(t),t.catch(()=>{}).then(()=>e._uMP.delete(t)),t})}function eD(e){return!!(e._addEL.message.length>0)||!!(e._addEL.internal.length>0)}function eO(e,t,n){e._addEL[t].push(n);if(!e._iL&&eD(e)){let t=t=>{e._addEL[t.type].forEach(n=>{t.time>=n.time?n.fn(t.data):"server"===e.method.type&&n.fn(t.data)})},n=e.method.microSeconds();e._prepP?e._prepP.then(()=>(e._iL=!0,e.method.onMessage(e._state,t,n),!0)).catch(e=>{throw e}):(e._iL=!0,e.method.onMessage(e._state,t,n))}}function eA(e,t,n){if(n){e._addEL[t]=e._addEL[t].filter(e=>e!==n);if(e._iL&&!eD(e)){e._iL=!1;let t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}}(0,ep.default)(eT,"_pubkey",!0);var ex=e.i(9428);class e${constructor(e,t={}){(0,ep.default)(this,"name",void 0),(0,ep.default)(this,"options",void 0),(0,ep.default)(this,"closed",void 0),(0,ep.default)(this,"onML",void 0),(0,ep.default)(this,"methodPriority",void 0),(0,ep.default)(this,"channels",void 0),(0,ep.default)(this,"listeners",void 0),(0,ep.default)(this,"processedNonces",void 0),(0,ep.default)(this,"nonce",void 0),this.name=e,this.options=t,this.closed=!1,this.onML=null,this.methodPriority=[F,T,en],this.channels=new Map,this.listeners=new Set,this.processedNonces=new Set,this.nonce=0,this.initChannels()}set onmessage(e){this.removeEventListener("message",this.onML),e&&"function"==typeof e?(this.onML=e,this.addEventListener("message",e)):this.onML=null}initChannels(){if(this.options.type===ev&&(this.methodPriority=[ev]),this.methodPriority.forEach(e=>{try{let t=new eT(this.name,(0,ex.default)((0,ex.default)({},this.options),{},{type:e}));this.channels.set(e,t),l.debug(`Succeeded to initialize ${e} method in channel ${this.name}`),t.onmessage=e=>this.handleMessage(e)}catch(t){l.warn(`Failed to initialize ${e} method in channel ${this.name}: ${t instanceof Error?t.message:String(t)}`)}}),0===this.channels.size)throw Error("Failed to initialize any communication method")}allChannels(){return Array.from(this.channels.keys())}hasChannel(e){return this.channels.has(e)}handleMessage(e){if(e&&e.nonce&&!this.processedNonces.has(e.nonce)){if(this.processedNonces.add(e.nonce),this.processedNonces.size>1e3){let e=Array.from(this.processedNonces).sort()[0];this.processedNonces.delete(e)}this.listeners.forEach(t=>{t(e.message)})}}async postMessage(e){if(this.closed)throw Error(`AdaptiveBroadcastChannel.postMessage(): Cannot post message after channel has closed ${JSON.stringify(e)}`);let t={nonce:this.generateNonce(),message:e},n=Array.from(this.channels.entries()).map(([e,n])=>n.postMessage(t).catch(t=>{throw l.warn(`Failed to send via ${e}: ${t.message}`),t}));if(!(await Promise.allSettled(n)).some(e=>"fulfilled"===e.status))throw Error("Failed to send message through any method");return e}generateNonce(){return`${Date.now()}-${this.nonce++}`}addEventListener(e,t){this.listeners.add(t)}removeEventListener(e,t){this.listeners.delete(t)}async close(){if(this.closed)return;this.onML=null;let e=[];for(let t of this.channels.values())e.push(t.close());await Promise.all(e),this.channels.clear(),this.listeners.clear(),this.closed=!0}}e.s(["BroadcastChannel",()=>eT,"IndexedDbMethod",0,B,"LocalstorageMethod",0,z,"NativeMethod",0,Y,"OPEN_BROADCAST_CHANNELS",()=>eI,"RedundantAdaptiveBroadcastChannel",()=>e$,"ServerMethod",0,eg,"chooseMethod",()=>eL,"enforceOptions",()=>eE],66933)}]);