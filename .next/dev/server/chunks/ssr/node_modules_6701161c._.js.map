{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/util.js"],"sourcesContent":["import loglevel from 'loglevel';\n\n// import Bowser from 'bowser';\n/**\n * returns true if the given object is a promise\n */\nfunction isPromise(obj) {\n  if (obj && typeof obj.then === \"function\") {\n    return true;\n  }\n  return false;\n}\nPromise.resolve(false);\nPromise.resolve(true);\nconst PROMISE_RESOLVED_VOID = Promise.resolve();\nfunction sleep(time, resolveWith) {\n  if (!time) time = 0;\n  return new Promise(resolve => {\n    setTimeout(() => resolve(resolveWith), time);\n  });\n}\nfunction randomInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\n/**\n * https://stackoverflow.com/a/8084248\n */\nfunction generateRandomId() {\n  return Math.random().toString(36).substring(2);\n}\nlet lastMs = 0;\n\n/**\n * returns the current time in micro-seconds,\n * WARNING: This is a pseudo-function\n * Performance.now is not reliable in webworkers, so we just make sure to never return the same time.\n * This is enough in browsers, and this function will not be used in nodejs.\n * The main reason for this hack is to ensure that BroadcastChannel behaves equal to production when it is used in fast-running unit tests.\n */\nfunction microSeconds() {\n  let ret = Date.now() * 1000; // milliseconds to microseconds\n  if (ret <= lastMs) {\n    ret = lastMs + 1;\n  }\n  lastMs = ret;\n  return ret;\n}\n\n// the problem is only in iframes. we should default to server in case of iframes.\n// storage scoping is present in all browsers now\n// Safari and other browsers support native Broadcast channel now. It's in LS.\n// test here: https://pubkey.github.io/broadcast-channel/e2e.html?methodType=native\n// https://caniuse.com/broadcastchannel\n// export function are3PCSupported() {\n//     if (typeof navigator === 'undefined') return false;\n//     const browserInfo = Bowser.parse(navigator.userAgent);\n//     log.info(JSON.stringify(browserInfo), 'current browser info');\n\n//     let thirdPartyCookieSupport = true;\n//     // brave\n//     if (navigator.brave) {\n//         thirdPartyCookieSupport = false;\n//     }\n//     // All webkit & gecko engine instances use itp (intelligent tracking prevention -\n//     // https://webkit.org/tracking-prevention/#intelligent-tracking-prevention-itp)\n//     if (browserInfo.engine.name === Bowser.ENGINE_MAP.WebKit || browserInfo.engine.name === Bowser.ENGINE_MAP.Gecko) {\n//         thirdPartyCookieSupport = false;\n//     }\n\n//     return thirdPartyCookieSupport;\n// }\n\nconst log = loglevel.getLogger(\"broadcast-channel\");\nlog.setLevel(\"error\");\n\nexport { PROMISE_RESOLVED_VOID, generateRandomId, isPromise, log, microSeconds, randomInt, sleep };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEA,+BAA+B;AAC/B;;CAEC,GACD,SAAS,UAAU,GAAG;IACpB,IAAI,OAAO,OAAO,IAAI,IAAI,KAAK,YAAY;QACzC,OAAO;IACT;IACA,OAAO;AACT;AACA,QAAQ,OAAO,CAAC;AAChB,QAAQ,OAAO,CAAC;AAChB,MAAM,wBAAwB,QAAQ,OAAO;AAC7C,SAAS,MAAM,IAAI,EAAE,WAAW;IAC9B,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,IAAI,QAAQ,CAAA;QACjB,WAAW,IAAM,QAAQ,cAAc;IACzC;AACF;AACA,SAAS,UAAU,GAAG,EAAE,GAAG;IACzB,OAAO,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,MAAM,MAAM,CAAC,IAAI;AACtD;AAEA;;CAEC,GACD,SAAS;IACP,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC;AAC9C;AACA,IAAI,SAAS;AAEb;;;;;;CAMC,GACD,SAAS;IACP,IAAI,MAAM,KAAK,GAAG,KAAK,MAAM,+BAA+B;IAC5D,IAAI,OAAO,QAAQ;QACjB,MAAM,SAAS;IACjB;IACA,SAAS;IACT,OAAO;AACT;AAEA,kFAAkF;AAClF,iDAAiD;AACjD,8EAA8E;AAC9E,mFAAmF;AACnF,uCAAuC;AACvC,sCAAsC;AACtC,0DAA0D;AAC1D,6DAA6D;AAC7D,qEAAqE;AAErE,0CAA0C;AAC1C,eAAe;AACf,6BAA6B;AAC7B,2CAA2C;AAC3C,QAAQ;AACR,wFAAwF;AACxF,sFAAsF;AACtF,yHAAyH;AACzH,2CAA2C;AAC3C,QAAQ;AAER,sCAAsC;AACtC,IAAI;AAEJ,MAAM,MAAM,sJAAQ,CAAC,SAAS,CAAC;AAC/B,IAAI,QAAQ,CAAC","ignoreList":[0]}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/oblivious-set/dist/esm/src/index.js","sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/oblivious-set/src/index.ts"],"sourcesContent":["\n/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n */\nexport class ObliviousSet<T = any> {\n    public readonly map = new Map();\n\n    /**\n     * Creating calls to setTimeout() is expensive,\n     * so we only do that if there is not timeout already open.\n     */\n    public _to: boolean = false;\n    constructor(\n        public readonly ttl: number\n    ) { }\n\n    has(value: T): boolean {\n        return this.map.has(value);\n    }\n\n    add(value: T): void {\n        this.map.set(value, now());\n\n        /**\n         * When a new value is added,\n         * start the cleanup at the next tick\n         * to not block the cpu for more important stuff\n         * that might happen.\n         */\n        if (!this._to) {\n            this._to = true;\n            setTimeout(() => {\n                this._to = false;\n                removeTooOldValues(this);\n            }, 0);\n        }\n    }\n\n    clear() {\n        this.map.clear();\n    }\n}\n\n\n/**\n * Removes all entries from the set\n * where the TTL has expired\n */\nexport function removeTooOldValues(\n    obliviousSet: ObliviousSet\n) {\n    const olderThen = now() - obliviousSet.ttl;\n    const iterator = obliviousSet.map[Symbol.iterator]();\n\n    /**\n     * Because we can assume the new values are added at the bottom,\n     * we start from the top and stop as soon as we reach a non-too-old value.\n     */\n    while (true) {\n\n        const next = iterator.next().value;\n\n        if (!next) {\n            return; // no more elements\n        }\n        const value = next[0];\n        const time = next[1];\n        if (time < olderThen) {\n            obliviousSet.map.delete(value);\n        } else {\n            // We reached a value that is not old enough\n            return;\n        }\n    }\n}\n\nexport function now(): number {\n    return Date.now();\n}\n\n\n"],"names":[],"mappings":"AACA;;;;GAIG;;;;;;;;AACG,MAAO,YAAY;IASD,IAAA;IARJ,GAAG,GAAG,IAAI,GAAG,EAAE,CAAC;IAEhC;;;OAGG,CACI,GAAG,GAAY,KAAK,CAAC;IAC5B,YACoB,GAAW,CAAA;QAAX,IAAA,CAAA,GAAG,GAAH,GAAG,CAAQ;IAC3B,CAAC;IAEL,GAAG,CAAC,KAAQ,EAAA;QACR,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,GAAG,CAAC,KAAQ,EAAA;QACR,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC;QAE3B;;;;;WAKG,CACH,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE;YACX,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;YAChB,UAAU,CAAC,GAAG,EAAE;gBACZ,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC;gBACjB,kBAAkB,CAAC,IAAI,CAAC,CAAC;YAC7B,CAAC,EAAE,CAAC,CAAC,CAAC;SACT;IACL,CAAC;IAED,KAAK,GAAA;QACD,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;IACrB,CAAC;CACJ;AAOK,SAAU,kBAAkB,CAC9B,YAA0B;IAE1B,MAAM,SAAS,GAAG,GAAG,EAAE,GAAG,YAAY,CAAC,GAAG,CAAC;IAC3C,MAAM,QAAQ,GAAG,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC;IAErD;;;OAGG,CACH,MAAO,IAAI,CAAE;QAET,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC;QAEnC,IAAI,CAAC,IAAI,EAAE;YACP,OAAO,CAAC,mBAAmB;SAC9B;QACD,MAAM,KAAK,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACtB,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACrB,IAAI,IAAI,GAAG,SAAS,EAAE;YAClB,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SAClC,MAAM;YACH,4CAA4C;YAC5C,OAAO;SACV;KACJ;AACL,CAAC;AAEK,SAAU,GAAG;IACf,OAAO,IAAI,CAAC,GAAG,EAAE,CAAC;AACtB,CAAC"}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/node_modules/%40toruslabs/constants/dist/lib.esm/constants.js"],"sourcesContent":["const TORUS_LEGACY_NETWORK = {\n  MAINNET: \"mainnet\",\n  TESTNET: \"testnet\",\n  CYAN: \"cyan\",\n  AQUA: \"aqua\",\n  CELESTE: \"celeste\"\n};\nconst TORUS_SAPPHIRE_NETWORK = {\n  SAPPHIRE_DEVNET: \"sapphire_devnet\",\n  SAPPHIRE_MAINNET: \"sapphire_mainnet\"\n};\nconst PROXY_CONTRACT_ADDRESS = {\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"0xf20336e16B5182637f09821c27BDe29b0AFcfe80\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"0xd084604e5FA387FbC2Da8bAab07fDD6aDED4614A\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"0x9f072ba19b3370e512aa1b4bfcdaf97283168005\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"0x29Dea82a0509153b91040ee13cDBba0f03efb625\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"0x6Bffb4e89453069E7487f0fa5c9f4a2D771cce6c\"\n};\nconst MULTI_CLUSTER_NETWORKS = [\n  // TORUS_LEGACY_NETWORK.AQUA,\n  // TORUS_LEGACY_NETWORK.CELESTE,\n  // TORUS_LEGACY_NETWORK.CYAN,\n];\nconst LEGACY_NETWORKS_ROUTE_MAP = {\n  [TORUS_LEGACY_NETWORK.AQUA]: {\n    migrationCompleted: true,\n    networkIdentifier: \"aqua\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.CELESTE]: {\n    migrationCompleted: true,\n    networkIdentifier: \"celeste\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.CYAN]: {\n    migrationCompleted: true,\n    networkIdentifier: \"cyan\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.MAINNET]: {\n    migrationCompleted: true,\n    networkIdentifier: \"mainnet\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET\n  },\n  [TORUS_LEGACY_NETWORK.TESTNET]: {\n    migrationCompleted: true,\n    networkIdentifier: \"teal\",\n    networkMigratedTo: TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET\n  }\n};\nconst NETWORK_MAP = {\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"mainnet\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"goerli\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"polygon-mainnet\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"polygon-mainnet\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"polygon-mainnet\"\n};\nconst SIGNER_MAP = {\n  [TORUS_SAPPHIRE_NETWORK.SAPPHIRE_MAINNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_SAPPHIRE_NETWORK.SAPPHIRE_DEVNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"https://api.web3auth.io/signer-service\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"https://api.web3auth.io/signer-polygon-service\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"https://api.web3auth.io/signer-polygon-service\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"https://api.web3auth.io/signer-polygon-service\"\n};\nconst METADATA_MAP = {\n  [TORUS_LEGACY_NETWORK.MAINNET]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.TESTNET]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.CYAN]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.AQUA]: \"https://api.web3auth.io/metadata-service\",\n  [TORUS_LEGACY_NETWORK.CELESTE]: \"https://api.web3auth.io/metadata-service\"\n};\n\n// FND backend service\nconst FND_SERVER = \"https://api.web3auth.io/fnd-service\";\n\n// Session backend service\nconst SESSION_SERVER_API_URL = \"https://api.web3auth.io/session-service\";\nconst SESSION_SERVER_SOCKET_URL = \"https://session.web3auth.io\";\n\n// Authjs backend service\nconst AUTHJS_SERVER_URL = \"https://api.web3auth.io/authjs-service\";\nconst KEY_TYPE = {\n  SECP256K1: \"secp256k1\",\n  ED25519: \"ed25519\"\n};\nconst SIG_TYPE = {\n  ECDSA_SECP256K1: \"ecdsa-secp256k1\",\n  ED25519: \"ed25519\",\n  BIP340: \"bip340\"\n};\n\nexport { AUTHJS_SERVER_URL, FND_SERVER, KEY_TYPE, LEGACY_NETWORKS_ROUTE_MAP, METADATA_MAP, MULTI_CLUSTER_NETWORKS, NETWORK_MAP, PROXY_CONTRACT_ADDRESS, SESSION_SERVER_API_URL, SESSION_SERVER_SOCKET_URL, SIGNER_MAP, SIG_TYPE, TORUS_LEGACY_NETWORK, TORUS_SAPPHIRE_NETWORK };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM,uBAAuB;IAC3B,SAAS;IACT,SAAS;IACT,MAAM;IACN,MAAM;IACN,SAAS;AACX;AACA,MAAM,yBAAyB;IAC7B,iBAAiB;IACjB,kBAAkB;AACpB;AACA,MAAM,yBAAyB;IAC7B,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,OAAO,CAAC,EAAE;AAClC;AACA,MAAM,yBAAyB,EAI9B;AACD,MAAM,4BAA4B;IAChC,CAAC,qBAAqB,IAAI,CAAC,EAAE;QAC3B,oBAAoB;QACpB,mBAAmB;QACnB,mBAAmB,uBAAuB,gBAAgB;IAC5D;IACA,CAAC,qBAAqB,OAAO,CAAC,EAAE;QAC9B,oBAAoB;QACpB,mBAAmB;QACnB,mBAAmB,uBAAuB,gBAAgB;IAC5D;IACA,CAAC,qBAAqB,IAAI,CAAC,EAAE;QAC3B,oBAAoB;QACpB,mBAAmB;QACnB,mBAAmB,uBAAuB,gBAAgB;IAC5D;IACA,CAAC,qBAAqB,OAAO,CAAC,EAAE;QAC9B,oBAAoB;QACpB,mBAAmB;QACnB,mBAAmB,uBAAuB,gBAAgB;IAC5D;IACA,CAAC,qBAAqB,OAAO,CAAC,EAAE;QAC9B,oBAAoB;QACpB,mBAAmB;QACnB,mBAAmB,uBAAuB,eAAe;IAC3D;AACF;AACA,MAAM,cAAc;IAClB,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,OAAO,CAAC,EAAE;AAClC;AACA,MAAM,aAAa;IACjB,CAAC,uBAAuB,gBAAgB,CAAC,EAAE;IAC3C,CAAC,uBAAuB,eAAe,CAAC,EAAE;IAC1C,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,OAAO,CAAC,EAAE;AAClC;AACA,MAAM,eAAe;IACnB,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,OAAO,CAAC,EAAE;IAChC,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,IAAI,CAAC,EAAE;IAC7B,CAAC,qBAAqB,OAAO,CAAC,EAAE;AAClC;AAEA,sBAAsB;AACtB,MAAM,aAAa;AAEnB,0BAA0B;AAC1B,MAAM,yBAAyB;AAC/B,MAAM,4BAA4B;AAElC,yBAAyB;AACzB,MAAM,oBAAoB;AAC1B,MAAM,WAAW;IACf,WAAW;IACX,SAAS;AACX;AACA,MAAM,WAAW;IACf,iBAAiB;IACjB,SAAS;IACT,QAAQ;AACV","ignoreList":[0]}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/options.js"],"sourcesContent":["import { SESSION_SERVER_API_URL, SESSION_SERVER_SOCKET_URL } from '@toruslabs/constants';\n\nfunction fillOptionsWithDefaults(originalOptions = {}) {\n  const options = JSON.parse(JSON.stringify(originalOptions));\n\n  // main\n  if (typeof options.webWorkerSupport === \"undefined\") options.webWorkerSupport = true;\n\n  // indexed-db\n  if (!options.idb) options.idb = {};\n  //  after this time the messages get deleted\n  if (!options.idb.ttl) options.idb.ttl = 1000 * 45;\n  if (!options.idb.fallbackInterval) options.idb.fallbackInterval = 150;\n  //  handles abrupt db onclose events.\n  if (originalOptions.idb && typeof originalOptions.idb.onclose === \"function\") options.idb.onclose = originalOptions.idb.onclose;\n\n  // localstorage\n  if (!options.localstorage) options.localstorage = {};\n  if (!options.localstorage.removeTimeout) options.localstorage.removeTimeout = 1000 * 60;\n\n  // server\n  if (!options.server) options.server = {};\n  if (!options.server.api_url) options.server.api_url = `${SESSION_SERVER_API_URL}/v2`;\n  if (!options.server.socket_url) options.server.socket_url = `${SESSION_SERVER_SOCKET_URL}`;\n  if (!options.server.removeTimeout) options.server.removeTimeout = 1000 * 60 * 5; // 5 minutes\n\n  // custom methods\n  if (originalOptions.methods) options.methods = originalOptions.methods;\n  return options;\n}\n\nexport { fillOptionsWithDefaults };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,SAAS,wBAAwB,kBAAkB,CAAC,CAAC;IACnD,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;IAE1C,OAAO;IACP,IAAI,OAAO,QAAQ,gBAAgB,KAAK,aAAa,QAAQ,gBAAgB,GAAG;IAEhF,aAAa;IACb,IAAI,CAAC,QAAQ,GAAG,EAAE,QAAQ,GAAG,GAAG,CAAC;IACjC,4CAA4C;IAC5C,IAAI,CAAC,QAAQ,GAAG,CAAC,GAAG,EAAE,QAAQ,GAAG,CAAC,GAAG,GAAG,OAAO;IAC/C,IAAI,CAAC,QAAQ,GAAG,CAAC,gBAAgB,EAAE,QAAQ,GAAG,CAAC,gBAAgB,GAAG;IAClE,qCAAqC;IACrC,IAAI,gBAAgB,GAAG,IAAI,OAAO,gBAAgB,GAAG,CAAC,OAAO,KAAK,YAAY,QAAQ,GAAG,CAAC,OAAO,GAAG,gBAAgB,GAAG,CAAC,OAAO;IAE/H,eAAe;IACf,IAAI,CAAC,QAAQ,YAAY,EAAE,QAAQ,YAAY,GAAG,CAAC;IACnD,IAAI,CAAC,QAAQ,YAAY,CAAC,aAAa,EAAE,QAAQ,YAAY,CAAC,aAAa,GAAG,OAAO;IAErF,SAAS;IACT,IAAI,CAAC,QAAQ,MAAM,EAAE,QAAQ,MAAM,GAAG,CAAC;IACvC,IAAI,CAAC,QAAQ,MAAM,CAAC,OAAO,EAAE,QAAQ,MAAM,CAAC,OAAO,GAAG,GAAG,ySAAsB,CAAC,GAAG,CAAC;IACpF,IAAI,CAAC,QAAQ,MAAM,CAAC,UAAU,EAAE,QAAQ,MAAM,CAAC,UAAU,GAAG,GAAG,4SAAyB,EAAE;IAC1F,IAAI,CAAC,QAAQ,MAAM,CAAC,aAAa,EAAE,QAAQ,MAAM,CAAC,aAAa,GAAG,OAAO,KAAK,GAAG,YAAY;IAE7F,iBAAiB;IACjB,IAAI,gBAAgB,OAAO,EAAE,QAAQ,OAAO,GAAG,gBAAgB,OAAO;IACtE,OAAO;AACT","ignoreList":[0]}},
    {"offset": {"line": 317, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/indexed-db.js"],"sourcesContent":["import { microSeconds as microSeconds$1, generateRandomId, PROMISE_RESOLVED_VOID, randomInt, sleep } from '../util.js';\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options.js';\n\n/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n *\n * When working on this, ensure to use these performance optimizations:\n * @link https://rxdb.info/slow-indexeddb.html\n */\n\nconst microSeconds = microSeconds$1;\nconst DB_PREFIX = \"pubkey.broadcast-channel-0-\";\nconst OBJECT_STORE_ID = \"messages\";\n\n/**\n * Use relaxed durability for faster performance on all transactions.\n * @link https://nolanlawson.com/2021/08/22/speeding-up-indexeddb-reads-and-writes/\n */\nconst TRANSACTION_SETTINGS = {\n  durability: \"relaxed\"\n};\nconst type = \"idb\";\nfunction getIdb() {\n  if (typeof indexedDB !== \"undefined\") return indexedDB;\n  if (typeof window !== \"undefined\") {\n    const extWindow = window;\n    if (typeof extWindow.mozIndexedDB !== \"undefined\") return extWindow.mozIndexedDB;\n    if (typeof extWindow.webkitIndexedDB !== \"undefined\") return extWindow.webkitIndexedDB;\n    if (typeof extWindow.msIndexedDB !== \"undefined\") return extWindow.msIndexedDB;\n  }\n  return false;\n}\n\n/**\n * If possible, we should explicitly commit IndexedDB transactions\n * for better performance.\n * @link https://nolanlawson.com/2021/08/22/speeding-up-indexeddb-reads-and-writes/\n */\nfunction commitIndexedDBTransaction(tx) {\n  if (tx.commit) {\n    tx.commit();\n  }\n}\nfunction createDatabase(channelName) {\n  const IndexedDB = getIdb();\n  if (!IndexedDB) return Promise.reject(new Error(\"IndexedDB not available\"));\n\n  // create table\n  const dbName = DB_PREFIX + channelName;\n\n  /**\n   * All IndexedDB databases are opened without version\n   * because it is a bit faster, especially on firefox\n   * @link http://nparashuram.com/IndexedDB/perf/#Open%20Database%20with%20version\n   */\n  const openRequest = IndexedDB.open(dbName);\n  openRequest.onupgradeneeded = ev => {\n    const db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: \"id\",\n      autoIncrement: true\n    });\n  };\n  const dbPromise = new Promise((resolve, reject) => {\n    openRequest.onerror = ev => reject(ev);\n    openRequest.onsuccess = () => {\n      resolve(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n\n/**\n * writes the new message to the database\n * so other readers can find it\n */\nfunction writeMessage(db, readerUuid, messageJson) {\n  const time = Date.now();\n  const writeObject = {\n    uuid: readerUuid,\n    time,\n    data: messageJson\n  };\n  const tx = db.transaction([OBJECT_STORE_ID], \"readwrite\", TRANSACTION_SETTINGS);\n  return new Promise((resolve, reject) => {\n    tx.oncomplete = () => resolve();\n    tx.onerror = ev => reject(ev);\n    const objectStore = tx.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n    commitIndexedDBTransaction(tx);\n  });\n}\nfunction getAllMessages(db) {\n  const tx = db.transaction(OBJECT_STORE_ID, \"readonly\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  const ret = [];\n  return new Promise(resolve => {\n    objectStore.openCursor().onsuccess = ev => {\n      const cursor = ev.target.result;\n      if (cursor) {\n        ret.push(cursor.value);\n        cursor.continue();\n      } else {\n        commitIndexedDBTransaction(tx);\n        resolve(ret);\n      }\n    };\n  });\n}\nfunction getMessagesHigherThan(db, lastCursorId) {\n  const tx = db.transaction(OBJECT_STORE_ID, \"readonly\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  const ret = [];\n  let keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n\n  /**\n   * Optimization shortcut,\n   * if getAll() can be used, do not use a cursor.\n   * @link https://rxdb.info/slow-indexeddb.html\n   */\n  if (objectStore.getAll) {\n    const getAllRequest = objectStore.getAll(keyRangeValue);\n    return new Promise((resolve, reject) => {\n      getAllRequest.onerror = err => reject(err);\n      getAllRequest.onsuccess = function (e) {\n        resolve(e.target.result);\n      };\n    });\n  }\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch {\n      return objectStore.openCursor();\n    }\n  }\n  return new Promise((resolve, reject) => {\n    const openCursorRequest = openCursor();\n    openCursorRequest.onerror = err => reject(err);\n    openCursorRequest.onsuccess = ev => {\n      const cursor = ev.target.result;\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor.continue(lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor.continue();\n        }\n      } else {\n        commitIndexedDBTransaction(tx);\n        resolve(ret);\n      }\n    };\n  });\n}\nfunction removeMessagesById(db, ids) {\n  const tx = db.transaction([OBJECT_STORE_ID], \"readwrite\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  return Promise.all(ids.map(id => {\n    const deleteRequest = objectStore.delete(id);\n    return new Promise(resolve => {\n      deleteRequest.onsuccess = () => resolve();\n    });\n  }));\n}\nfunction getOldMessages(db, ttl) {\n  const olderThen = Date.now() - ttl;\n  const tx = db.transaction(OBJECT_STORE_ID, \"readonly\", TRANSACTION_SETTINGS);\n  const objectStore = tx.objectStore(OBJECT_STORE_ID);\n  const ret = [];\n  return new Promise(resolve => {\n    objectStore.openCursor().onsuccess = ev => {\n      const cursor = ev.target.result;\n      if (cursor) {\n        const msgObk = cursor.value;\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk);\n          cursor.continue();\n        } else {\n          // no more old messages,\n          commitIndexedDBTransaction(tx);\n          resolve(ret);\n        }\n      } else {\n        resolve(ret);\n      }\n    };\n  });\n}\nfunction cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(tooOld => {\n    return removeMessagesById(db, tooOld.map(msg => msg.id));\n  });\n}\nfunction create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  return createDatabase(channelName).then(db => {\n    const state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName,\n      options,\n      uuid: generateRandomId(),\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: PROMISE_RESOLVED_VOID,\n      messagesCallback: null,\n      readQueuePromises: [],\n      db,\n      time: microSeconds$1()\n    };\n\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n    _readLoop(state);\n    return state;\n  });\n}\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(() => sleep(state.options.idb.fallbackInterval)).then(() => _readLoop(state)).catch(e => {\n    throw e;\n  });\n}\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n  return true;\n}\n\n/**\n * reads all new messages from the database and emits them\n */\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return PROMISE_RESOLVED_VOID;\n\n  // if no one is listening, we do not need to scan for new messages\n  if (!state.messagesCallback) return PROMISE_RESOLVED_VOID;\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(newerMessages => {\n    const useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */.filter(msgObj => !!msgObj).map(msgObj => {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n      return msgObj;\n    }).filter(msgObj => _filterMessage(msgObj, state)).sort((msgObjA, msgObjB) => msgObjA.time - msgObjB.time); // sort by time\n    useMessages.forEach(msgObj => {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return PROMISE_RESOLVED_VOID;\n  });\n}\nfunction close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\nfunction postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(() => writeMessage(channelState.db, channelState.uuid, messageJson)).then(() => {\n    if (randomInt(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n    return PROMISE_RESOLVED_VOID;\n  });\n  return channelState.writeBlockPromise;\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\nfunction canBeUsed() {\n  const idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\nfunction averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\n\nexport { TRANSACTION_SETTINGS, averageResponseTime, canBeUsed, cleanOldMessages, close, commitIndexedDBTransaction, create, createDatabase, getAllMessages, getIdb, getMessagesHigherThan, getOldMessages, microSeconds, onMessage, postMessage, removeMessagesById, type, writeMessage };\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 653, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/localstorage.js"],"sourcesContent":["import { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options.js';\nimport { microSeconds as microSeconds$1, sleep, generateRandomId } from '../util.js';\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\nconst microSeconds = microSeconds$1;\nconst KEY_PREFIX = \"pubkey.broadcastChannel-\";\nconst type = \"localstorage\";\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\nfunction getLocalStorage() {\n  let localStorage = null;\n  if (typeof window === \"undefined\") return null;\n  try {\n    localStorage = window.localStorage;\n    localStorage = window[\"ie8-eventlistener/storage\"] || window.localStorage;\n  } catch {\n    // New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n  return localStorage;\n}\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\nfunction postMessage(channelState, messageJson) {\n  return new Promise((resolve, reject) => {\n    sleep().then(() => {\n      var _getLocalStorage;\n      const key = storageKey(channelState.channelName);\n      const writeObj = {\n        token: generateRandomId(),\n        time: Date.now(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      const value = JSON.stringify(writeObj);\n      // eslint-disable-next-line promise/always-return\n      (_getLocalStorage = getLocalStorage()) === null || _getLocalStorage === void 0 || _getLocalStorage.setItem(key, value);\n\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n      const ev = document.createEvent(\"StorageEvent\");\n      ev.initStorageEvent(\"storage\", true, true, key, null, value, \"\", null);\n      window.dispatchEvent(ev);\n      resolve();\n    }).catch(reject);\n  });\n}\nfunction addStorageEventListener(channelName, fn) {\n  const key = storageKey(channelName);\n  const listener = ev => {\n    if (ev.key === key && ev.newValue) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n  window.addEventListener(\"storage\", listener);\n  return listener;\n}\nfunction removeStorageEventListener(listener) {\n  window.removeEventListener(\"storage\", listener);\n}\nfunction canBeUsed() {\n  const ls = getLocalStorage();\n  if (!ls) return false;\n  try {\n    const key = \"__broadcastchannel_check\";\n    ls.setItem(key, \"works\");\n    ls.removeItem(key);\n  } catch {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n  return true;\n}\nfunction create(channelName, options) {\n  const filledOptions = fillOptionsWithDefaults(options);\n  if (!canBeUsed()) {\n    throw new Error(\"BroadcastChannel: localstorage cannot be used\");\n  }\n  const uuid = generateRandomId();\n\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   */\n  const eMIs = new ObliviousSet(filledOptions.localstorage.removeTimeout);\n  const state = {\n    channelName,\n    uuid,\n    time: microSeconds$1(),\n    eMIs // emittedMessagesIds\n  };\n  state.listener = addStorageEventListener(channelName, msgObj => {\n    if (!state.messagesCallback) return; // no listener\n    if (msgObj.uuid === uuid) return; // own message\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < (state.messagesCallbackTime || 0)) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nfunction close(channelState) {\n  if (channelState.listener) {\n    removeStorageEventListener(channelState.listener);\n  }\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nfunction averageResponseTime() {\n  const defaultTime = 120;\n  const userAgent = navigator.userAgent.toLowerCase();\n  if (userAgent.includes(\"safari\") && !userAgent.includes(\"chrome\")) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n  return defaultTime;\n}\n\nexport { addStorageEventListener, averageResponseTime, canBeUsed, close, create, getLocalStorage, microSeconds, onMessage, postMessage, removeStorageEventListener, storageKey, type };\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 811, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/native.js"],"sourcesContent":["import { microSeconds as microSeconds$1, PROMISE_RESOLVED_VOID } from '../util.js';\n\nconst microSeconds = microSeconds$1;\nconst type = \"native\";\nfunction create(channelName) {\n  const state = {\n    time: microSeconds$1(),\n    messagesCallback: null,\n    bc: new BroadcastChannel(channelName),\n    subFns: [] // subscriberFunctions\n  };\n  state.bc.onmessage = msg => {\n    if (state.messagesCallback) {\n      state.messagesCallback(msg.data);\n    }\n  };\n  return state;\n}\nfunction close(channelState) {\n  channelState.bc.close();\n  channelState.subFns = [];\n}\nfunction postMessage(channelState, messageJson) {\n  try {\n    channelState.bc.postMessage(messageJson);\n    return PROMISE_RESOLVED_VOID;\n  } catch (err) {\n    return Promise.reject(err);\n  }\n}\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  /**\n   * in the electron-renderer, isNode will be true even if we are in browser-context\n   * so we also check if window is undefined\n   */\n  if (typeof window === \"undefined\") return false;\n  if (typeof BroadcastChannel === \"function\") {\n    if (BroadcastChannel._pubkey) {\n      throw new Error(\"BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill\");\n    }\n    return true;\n  }\n  return false;\n}\nfunction averageResponseTime() {\n  return 150;\n}\n\nexport { averageResponseTime, canBeUsed, close, create, microSeconds, onMessage, postMessage, type };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAM,eAAe,8OAAc;AACnC,MAAM,OAAO;AACb,SAAS,OAAO,WAAW;IACzB,MAAM,QAAQ;QACZ,MAAM,IAAA,8OAAc;QACpB,kBAAkB;QAClB,IAAI,IAAI,iBAAiB;QACzB,QAAQ,EAAE,CAAC,sBAAsB;IACnC;IACA,MAAM,EAAE,CAAC,SAAS,GAAG,CAAA;QACnB,IAAI,MAAM,gBAAgB,EAAE;YAC1B,MAAM,gBAAgB,CAAC,IAAI,IAAI;QACjC;IACF;IACA,OAAO;AACT;AACA,SAAS,MAAM,YAAY;IACzB,aAAa,EAAE,CAAC,KAAK;IACrB,aAAa,MAAM,GAAG,EAAE;AAC1B;AACA,SAAS,YAAY,YAAY,EAAE,WAAW;IAC5C,IAAI;QACF,aAAa,EAAE,CAAC,WAAW,CAAC;QAC5B,OAAO,uPAAqB;IAC9B,EAAE,OAAO,KAAK;QACZ,OAAO,QAAQ,MAAM,CAAC;IACxB;AACF;AACA,SAAS,UAAU,YAAY,EAAE,EAAE;IACjC,aAAa,gBAAgB,GAAG;AAClC;AACA,SAAS;IACP;;;GAGC,GACD,wCAAmC,OAAO;;;AAQ5C;AACA,SAAS;IACP,OAAO;AACT","ignoreList":[0]}},
    {"offset": {"line": 878, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/server.js"],"sourcesContent":["import { sign, getPublic } from '@toruslabs/eccrypto';\nimport { keccak256, encryptData, decryptData } from '@toruslabs/metadata-helpers';\nimport { ObliviousSet } from 'oblivious-set';\nimport { io } from 'socket.io-client';\nimport { fillOptionsWithDefaults } from '../options.js';\nimport { microSeconds as microSeconds$1, sleep, generateRandomId, log } from '../util.js';\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\nconst microSeconds = microSeconds$1;\nconst KEY_PREFIX = \"pubkey.broadcastChannel-\";\nconst type = \"server\";\nlet SOCKET_CONN_INSTANCE = null;\n// used to decide to reconnect socket e.g. when socket connection is disconnected unexpectedly\nconst runningChannels = new Set();\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\nfunction postMessage(channelState, messageJson) {\n  return new Promise((resolve, reject) => {\n    sleep().then(async () => {\n      const key = storageKey(channelState.channelName);\n      const channelEncPrivKey = keccak256(Buffer.from(key, \"utf8\"));\n      const encData = await encryptData(channelEncPrivKey.toString(\"hex\"), {\n        token: generateRandomId(),\n        time: Date.now(),\n        data: messageJson,\n        uuid: channelState.uuid\n      });\n      const body = {\n        allowedOrigin: channelState.server.allowed_origin,\n        sameIpCheck: true,\n        key: getPublic(channelEncPrivKey).toString(\"hex\"),\n        data: encData,\n        signature: (await sign(channelEncPrivKey, keccak256(Buffer.from(encData, \"utf8\")))).toString(\"hex\")\n      };\n      if (channelState.timeout) body.timeout = channelState.timeout;\n      return fetch(`${channelState.server.api_url}/channel/set`, {\n        method: \"POST\",\n        body: JSON.stringify(body),\n        headers: {\n          \"Content-Type\": \"application/json; charset=utf-8\"\n        }\n      }).then(resolve).catch(reject);\n    }).catch(reject);\n  });\n}\nfunction getSocketInstance(socketUrl) {\n  if (SOCKET_CONN_INSTANCE) {\n    return SOCKET_CONN_INSTANCE;\n  }\n  const SOCKET_CONN = io(socketUrl, {\n    transports: [\"websocket\", \"polling\"],\n    // use WebSocket first, if available\n    withCredentials: true,\n    reconnectionDelayMax: 10000,\n    reconnectionAttempts: 10\n  });\n  SOCKET_CONN.on(\"connect_error\", err => {\n    // revert to classic upgrade\n    SOCKET_CONN.io.opts.transports = [\"polling\", \"websocket\"];\n    log.error(\"connect error\", err);\n  });\n  SOCKET_CONN.on(\"connect\", async () => {\n    const {\n      engine\n    } = SOCKET_CONN.io;\n    log.debug(\"initially connected to\", engine.transport.name); // in most cases, prints \"polling\"\n    engine.once(\"upgrade\", () => {\n      // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)\n      log.debug(\"upgraded\", engine.transport.name); // in most cases, prints \"websocket\"\n    });\n    engine.once(\"close\", reason => {\n      // called when the underlying connection is closed\n      log.debug(\"connection closed\", reason);\n    });\n  });\n  SOCKET_CONN.on(\"error\", err => {\n    log.error(\"socket errored\", err);\n    SOCKET_CONN.disconnect();\n  });\n  SOCKET_CONN_INSTANCE = SOCKET_CONN;\n  return SOCKET_CONN;\n}\nfunction setupSocketConnection(socketUrl, channelState, fn) {\n  const socketConn = getSocketInstance(socketUrl);\n  const key = storageKey(channelState.channelName);\n  const channelEncPrivKey = keccak256(Buffer.from(key, \"utf8\"));\n  const channelPubKey = getPublic(channelEncPrivKey).toString(\"hex\");\n  if (socketConn.connected) {\n    socketConn.emit(\"v2:check_auth_status\", channelPubKey, {\n      sameIpCheck: true,\n      allowedOrigin: channelState.server.allowed_origin\n    });\n  } else {\n    socketConn.once(\"connect\", () => {\n      log.debug(\"connected with socket\");\n      socketConn.emit(\"v2:check_auth_status\", channelPubKey, {\n        sameIpCheck: true,\n        allowedOrigin: channelState.server.allowed_origin\n      });\n    });\n  }\n  const reconnect = () => {\n    socketConn.once(\"connect\", async () => {\n      if (runningChannels.has(channelState.channelName)) {\n        socketConn.emit(\"v2:check_auth_status\", channelPubKey, {\n          sameIpCheck: true,\n          allowedOrigin: channelState.server.allowed_origin\n        });\n      }\n    });\n  };\n  const visibilityListener = () => {\n    // if channel is closed, then remove the listener.\n    if (!socketConn || !runningChannels.has(channelState.channelName)) {\n      document.removeEventListener(\"visibilitychange\", visibilityListener);\n      return;\n    }\n    // if not connected, then wait for connection and ping server for latest msg.\n    if (!socketConn.connected && document.visibilityState === \"visible\") {\n      reconnect();\n    }\n  };\n  const listener = async ev => {\n    try {\n      const decData = await decryptData(channelEncPrivKey.toString(\"hex\"), ev);\n      log.info(decData);\n      fn(decData);\n    } catch (error) {\n      log.error(error);\n    }\n  };\n  socketConn.on(\"disconnect\", () => {\n    log.debug(\"socket disconnected\");\n    if (runningChannels.has(channelState.channelName)) {\n      log.error(\"socket disconnected unexpectedly, reconnecting socket\");\n      reconnect();\n    }\n  });\n  socketConn.on(`${channelPubKey}_success`, listener);\n  if (typeof document !== \"undefined\") document.addEventListener(\"visibilitychange\", visibilityListener);\n  return socketConn;\n}\nfunction removeStorageEventListener() {\n  if (SOCKET_CONN_INSTANCE) {\n    SOCKET_CONN_INSTANCE.disconnect();\n  }\n}\nfunction canBeUsed() {\n  return true;\n}\nfunction create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  const uuid = generateRandomId();\n\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n  const eMIs = new ObliviousSet(options.server.removeTimeout);\n  const state = {\n    channelName,\n    uuid,\n    eMIs,\n    // emittedMessagesIds\n    server: {\n      api_url: options.server.api_url,\n      socket_url: options.server.socket_url,\n      allowed_origin: options.server.allowed_origin\n    },\n    time: microSeconds$1()\n  };\n  if (options.server.timeout) state.timeout = options.server.timeout;\n  setupSocketConnection(options.server.socket_url, state, msgObj => {\n    if (!state.messagesCallback) return; // no listener\n    if (msgObj.uuid === state.uuid) return; // own message\n    if (!msgObj.token || state.eMIs.has(msgObj.token)) return; // already emitted\n    // if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    state.eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  runningChannels.add(channelName);\n  return state;\n}\nfunction close(channelState) {\n  runningChannels.delete(channelState.channelName);\n  // give 2 sec for all msgs which are in transit to be consumed\n  // by receiver.\n  // window.setTimeout(() => {\n  //     removeStorageEventListener(channelState);\n  //     SOCKET_CONN_INSTANCE = null;\n  // }, 1000);\n}\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nfunction averageResponseTime() {\n  const defaultTime = 500;\n  // TODO: Maybe increase it based on operation\n  return defaultTime;\n}\n\nexport { averageResponseTime, canBeUsed, close, create, getSocketInstance, microSeconds, onMessage, postMessage, removeStorageEventListener, setupSocketConnection, storageKey, type };\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1128, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/index.js"],"sourcesContent":["import * as indexedDb from './methods/indexed-db.js';\nexport { indexedDb as IndexedDbMethod };\nimport * as localstorage from './methods/localstorage.js';\nexport { localstorage as LocalstorageMethod };\nimport * as native from './methods/native.js';\nexport { native as NativeMethod };\nimport * as server from './methods/server.js';\nexport { server as ServerMethod };\nexport { BroadcastChannel, OPEN_BROADCAST_CHANNELS, enforceOptions } from './broadcast-channel.js';\nexport { chooseMethod } from './method-chooser.js';\nexport { RedundantAdaptiveBroadcastChannel } from './redundant-adaptive-broadcast-channel.js';\n"],"names":[],"mappings":";AAAA;AAEA;AAEA;AAEA","ignoreList":[0]}},
    {"offset": {"line": 1148, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/methods/simulate.js"],"sourcesContent":["import { microSeconds as microSeconds$1 } from '../util.js';\n\nconst microSeconds = microSeconds$1;\nconst type = \"simulate\";\nconst SIMULATE_CHANNELS = new Set();\nconst SIMULATE_DELAY_TIME = 5;\nfunction create(channelName) {\n  const state = {\n    time: microSeconds$1(),\n    name: channelName,\n    messagesCallback: null\n  };\n  SIMULATE_CHANNELS.add(state);\n  return state;\n}\nfunction close(channelState) {\n  SIMULATE_CHANNELS.delete(channelState);\n}\nfunction postMessage(channelState, messageJson) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      const channelArray = Array.from(SIMULATE_CHANNELS);\n      channelArray.forEach(channel => {\n        if (channel.name === channelState.name &&\n        // has same name\n        channel !== channelState &&\n        // not own channel\n        !!channel.messagesCallback &&\n        // has subscribers\n        channel.time < messageJson.time // channel not created after postMessage() call\n        ) {\n          channel.messagesCallback(messageJson);\n        }\n      });\n      resolve();\n    }, SIMULATE_DELAY_TIME);\n  });\n}\nfunction onMessage(channelState, fn) {\n  channelState.messagesCallback = fn;\n}\nfunction canBeUsed() {\n  return true;\n}\nfunction averageResponseTime() {\n  return SIMULATE_DELAY_TIME;\n}\n\nexport { SIMULATE_DELAY_TIME, averageResponseTime, canBeUsed, close, create, microSeconds, onMessage, postMessage, type };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAM,eAAe,8OAAc;AACnC,MAAM,OAAO;AACb,MAAM,oBAAoB,IAAI;AAC9B,MAAM,sBAAsB;AAC5B,SAAS,OAAO,WAAW;IACzB,MAAM,QAAQ;QACZ,MAAM,IAAA,8OAAc;QACpB,MAAM;QACN,kBAAkB;IACpB;IACA,kBAAkB,GAAG,CAAC;IACtB,OAAO;AACT;AACA,SAAS,MAAM,YAAY;IACzB,kBAAkB,MAAM,CAAC;AAC3B;AACA,SAAS,YAAY,YAAY,EAAE,WAAW;IAC5C,OAAO,IAAI,QAAQ,CAAA;QACjB,WAAW;YACT,MAAM,eAAe,MAAM,IAAI,CAAC;YAChC,aAAa,OAAO,CAAC,CAAA;gBACnB,IAAI,QAAQ,IAAI,KAAK,aAAa,IAAI,IACtC,gBAAgB;gBAChB,YAAY,gBACZ,kBAAkB;gBAClB,CAAC,CAAC,QAAQ,gBAAgB,IAC1B,kBAAkB;gBAClB,QAAQ,IAAI,GAAG,YAAY,IAAI,CAAC,+CAA+C;kBAC7E;oBACA,QAAQ,gBAAgB,CAAC;gBAC3B;YACF;YACA;QACF,GAAG;IACL;AACF;AACA,SAAS,UAAU,YAAY,EAAE,EAAE;IACjC,aAAa,gBAAgB,GAAG;AAClC;AACA,SAAS;IACP,OAAO;AACT;AACA,SAAS;IACP,OAAO;AACT","ignoreList":[0]}},
    {"offset": {"line": 1217, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/method-chooser.js"],"sourcesContent":["import * as indexedDb from './methods/indexed-db.js';\nimport * as localstorage from './methods/localstorage.js';\nimport * as native from './methods/native.js';\nimport * as server from './methods/server.js';\nimport * as simulate from './methods/simulate.js';\n\n// order is important\nconst METHODS = [native,\n// fastest\nindexedDb, localstorage, server];\nfunction chooseMethod(options) {\n  let chooseMethods = [].concat(options.methods || [], METHODS).filter(Boolean);\n\n  // directly chosen\n  if (options.type) {\n    if (options.type === \"simulate\") {\n      // only use simulate-method if directly chosen\n      return simulate;\n    }\n    const ret = chooseMethods.find(m => m.type === options.type);\n    if (!ret) throw new Error(`method-type ${options.type} not found`);else return ret;\n  }\n\n  /**\n   * if no webworker support is needed,\n   * remove idb from the list so that localstorage is been chosen\n   */\n  if (!options.webWorkerSupport) {\n    chooseMethods = chooseMethods.filter(m => m.type !== \"idb\");\n  }\n  const useMethod = chooseMethods.find(method => method.canBeUsed(options));\n  if (!useMethod) throw new Error(`No useable method found in ${JSON.stringify(METHODS.map(m => m.type))}`);else return useMethod;\n}\n\nexport { chooseMethod };\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,qBAAqB;AACrB,MAAM,UAAU;IAAC;IACjB,UAAU;IACV;IAAW;IAAc;CAAO;AAChC,SAAS,aAAa,OAAO;IAC3B,IAAI,gBAAgB,EAAE,CAAC,MAAM,CAAC,QAAQ,OAAO,IAAI,EAAE,EAAE,SAAS,MAAM,CAAC;IAErE,kBAAkB;IAClB,IAAI,QAAQ,IAAI,EAAE;QAChB,IAAI,QAAQ,IAAI,KAAK,YAAY;YAC/B,8CAA8C;YAC9C,OAAO;QACT;QACA,MAAM,MAAM,cAAc,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,QAAQ,IAAI;QAC3D,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM,CAAC,YAAY,EAAE,QAAQ,IAAI,CAAC,UAAU,CAAC;aAAO,OAAO;IACjF;IAEA;;;GAGC,GACD,IAAI,CAAC,QAAQ,gBAAgB,EAAE;QAC7B,gBAAgB,cAAc,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK;IACvD;IACA,MAAM,YAAY,cAAc,IAAI,CAAC,CAAA,SAAU,OAAO,SAAS,CAAC;IAChE,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM,CAAC,2BAA2B,EAAE,KAAK,SAAS,CAAC,QAAQ,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI;SAAO,OAAO;AACxH","ignoreList":[0]}},
    {"offset": {"line": 1266, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/broadcast-channel.js"],"sourcesContent":["import _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { chooseMethod } from './method-chooser.js';\nimport { fillOptionsWithDefaults } from './options.js';\nimport { PROMISE_RESOLVED_VOID, isPromise } from './util.js';\n\nlet ENFORCED_OPTIONS;\nfunction enforceOptions(options) {\n  ENFORCED_OPTIONS = options;\n}\n\n/**\n * Contains all open channels,\n * used in tests to ensure everything is closed.\n */\n\nconst OPEN_BROADCAST_CHANNELS = new Set();\nlet lastId = 0;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nclass BroadcastChannel {\n  // beforeClose\n\n  constructor(name, options) {\n    _defineProperty(this, \"id\", void 0);\n    _defineProperty(this, \"name\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    _defineProperty(this, \"method\", void 0);\n    _defineProperty(this, \"closed\", void 0);\n    _defineProperty(this, \"_addEL\", void 0);\n    _defineProperty(this, \"_prepP\", void 0);\n    // preparePromise\n    _defineProperty(this, \"_state\", void 0);\n    _defineProperty(this, \"_uMP\", void 0);\n    // unsent message promises\n    _defineProperty(this, \"_iL\", void 0);\n    // isListening\n    _defineProperty(this, \"_onML\", void 0);\n    // onMessageListener\n    _defineProperty(this, \"_befC\", void 0);\n    this.id = lastId++;\n    OPEN_BROADCAST_CHANNELS.add(this);\n    this.name = name;\n    if (ENFORCED_OPTIONS) {\n      options = ENFORCED_OPTIONS;\n    }\n    this.options = fillOptionsWithDefaults(options || {});\n    this.method = chooseMethod(this.options);\n    this.closed = false;\n    this._iL = false;\n    this._onML = null;\n    this._addEL = {\n      message: [],\n      internal: []\n    };\n    this._uMP = new Set();\n    this._befC = [];\n    this._prepP = null;\n    _prepareChannel(this);\n  }\n  get type() {\n    return this.method.type;\n  }\n  get isClosed() {\n    return this.closed;\n  }\n  set onmessage(fn) {\n    const time = this.method.microSeconds();\n    const listenObj = {\n      time,\n      fn: fn\n    };\n    _removeListenerObject(this, \"message\", this._onML);\n    if (fn && typeof fn === \"function\") {\n      this._onML = listenObj;\n      _addListenerObject(this, \"message\", listenObj);\n    } else {\n      this._onML = null;\n    }\n  }\n  postMessage(msg) {\n    if (this.closed) {\n      throw new Error(`BroadcastChannel.postMessage(): Cannot post message after channel has closed ${JSON.stringify(msg)}`);\n    }\n    return _post(this, \"message\", msg);\n  }\n  postInternal(msg) {\n    return _post(this, \"internal\", msg);\n  }\n  addEventListener(type, fn) {\n    const time = this.method.microSeconds();\n    const listenObj = {\n      time,\n      fn: fn\n    };\n    _addListenerObject(this, type, listenObj);\n  }\n  removeEventListener(type, fn) {\n    const obj = this._addEL[type].find(o => o.fn === fn);\n    _removeListenerObject(this, type, obj);\n  }\n  close() {\n    if (this.closed) {\n      return Promise.resolve();\n    }\n    OPEN_BROADCAST_CHANNELS.delete(this);\n    this.closed = true;\n    const awaitPrepare = this._prepP ? this._prepP : PROMISE_RESOLVED_VOID;\n    this._onML = null;\n    this._addEL.message = [];\n    return awaitPrepare.then(() => Promise.all(Array.from(this._uMP))).then(() => Promise.all(this._befC.map(fn => fn()))).then(() => this.method.close ? this.method.close(this._state) : PROMISE_RESOLVED_VOID);\n  }\n}\n_defineProperty(BroadcastChannel, \"_pubkey\", true);\nfunction _post(broadcastChannel, type, msg) {\n  const time = broadcastChannel.method.microSeconds();\n  const msgObj = {\n    time,\n    type,\n    data: msg\n  };\n  const awaitPrepare = broadcastChannel._prepP ? broadcastChannel._prepP : PROMISE_RESOLVED_VOID;\n  return awaitPrepare.then(() => {\n    const sendPromise = broadcastChannel.method.postMessage(broadcastChannel._state, msgObj);\n    broadcastChannel._uMP.add(sendPromise);\n    // eslint-disable-next-line promise/catch-or-return\n    sendPromise.catch(() => {}).then(() => broadcastChannel._uMP.delete(sendPromise));\n    return sendPromise;\n  });\n}\nfunction _prepareChannel(channel) {\n  const maybePromise = channel.method.create(channel.name, channel.options);\n  if (isPromise(maybePromise)) {\n    const promise = maybePromise;\n    channel._prepP = promise;\n    promise.then(s => {\n      channel._state = s;\n      return s;\n    }).catch(err => {\n      throw err;\n    });\n  } else {\n    channel._state = maybePromise;\n  }\n}\nfunction _hasMessageListeners(channel) {\n  if (channel._addEL.message.length > 0) return true;\n  if (channel._addEL.internal.length > 0) return true;\n  return false;\n}\nfunction _startListening(channel) {\n  if (!channel._iL && _hasMessageListeners(channel)) {\n    const listenerFn = msgObj => {\n      channel._addEL[msgObj.type].forEach(listenerObject => {\n        if (msgObj.time >= listenerObject.time) {\n          listenerObject.fn(msgObj.data);\n        } else if (channel.method.type === \"server\") {\n          listenerObject.fn(msgObj.data);\n        }\n      });\n    };\n    const time = channel.method.microSeconds();\n    if (channel._prepP) {\n      channel._prepP.then(() => {\n        channel._iL = true;\n        channel.method.onMessage(channel._state, listenerFn, time);\n        return true;\n      }).catch(err => {\n        throw err;\n      });\n    } else {\n      channel._iL = true;\n      channel.method.onMessage(channel._state, listenerFn, time);\n    }\n  }\n}\nfunction _stopListening(channel) {\n  if (channel._iL && !_hasMessageListeners(channel)) {\n    channel._iL = false;\n    const time = channel.method.microSeconds();\n    channel.method.onMessage(channel._state, null, time);\n  }\n}\nfunction _addListenerObject(channel, type, obj) {\n  channel._addEL[type].push(obj);\n  _startListening(channel);\n}\nfunction _removeListenerObject(channel, type, obj) {\n  if (obj) {\n    channel._addEL[type] = channel._addEL[type].filter(o => o !== obj);\n    _stopListening(channel);\n  }\n}\n\nexport { BroadcastChannel, OPEN_BROADCAST_CHANNELS, enforceOptions };\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1469, "column": 0}, "map": {"version":3,"sources":["file:///Users/yashparikh/projects/xstocks-ui/node_modules/%40toruslabs/customauth/node_modules/%40toruslabs/broadcast-channel/dist/lib.esm/redundant-adaptive-broadcast-channel.js"],"sourcesContent":["import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { BroadcastChannel } from './broadcast-channel.js';\nimport { type as type$1 } from './methods/localstorage.js';\nimport { type } from './methods/native.js';\nimport { type as type$2 } from './methods/server.js';\nimport { type as type$3 } from './methods/simulate.js';\nimport { log } from './util.js';\n\n/**\n * The RedundantAdaptiveBroadcastChannel class is designed to add fallback to during channel post message and synchronization issues between senders and receivers in a broadcast communication scenario. It achieves this by:\n * Creating a separate channel for each communication method, allowing all methods to listen simultaneously.\n * Implementing redundant message delivery by attempting to send messages through multiple channels when the primary channel fails.\n * Ensuring message delivery by using multiple communication methods simultaneously while preventing duplicate message processing.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nclass RedundantAdaptiveBroadcastChannel {\n  constructor(name, options = {}) {\n    _defineProperty(this, \"name\", void 0);\n    _defineProperty(this, \"options\", void 0);\n    _defineProperty(this, \"closed\", void 0);\n    _defineProperty(this, \"onML\", void 0);\n    _defineProperty(this, \"methodPriority\", void 0);\n    _defineProperty(this, \"channels\", void 0);\n    _defineProperty(this, \"listeners\", void 0);\n    _defineProperty(this, \"processedNonces\", void 0);\n    _defineProperty(this, \"nonce\", void 0);\n    this.name = name;\n    this.options = options;\n    this.closed = false;\n    this.onML = null;\n    // order from fastest to slowest\n    this.methodPriority = [type, type$1, type$2];\n    this.channels = new Map();\n    this.listeners = new Set();\n    this.processedNonces = new Set();\n    this.nonce = 0;\n    this.initChannels();\n  }\n  set onmessage(fn) {\n    this.removeEventListener(\"message\", this.onML);\n    if (fn && typeof fn === \"function\") {\n      this.onML = fn;\n      this.addEventListener(\"message\", fn);\n    } else {\n      this.onML = null;\n    }\n  }\n  initChannels() {\n    // only use simulate if type simulate ( for testing )\n    if (this.options.type === type$3) {\n      this.methodPriority = [type$3];\n    }\n\n    // iterates through the methodPriority array, attempting to create a new BroadcastChannel for each method\n    this.methodPriority.forEach(method => {\n      try {\n        const channel = new BroadcastChannel(this.name, _objectSpread(_objectSpread({}, this.options), {}, {\n          type: method\n        }));\n        this.channels.set(method, channel);\n        log.debug(`Succeeded to initialize ${method} method in channel ${this.name}`);\n        // listening on every method\n        channel.onmessage = event => this.handleMessage(event);\n      } catch (error) {\n        log.warn(`Failed to initialize ${method} method in channel ${this.name}: ${error instanceof Error ? error.message : String(error)}`);\n      }\n    });\n    if (this.channels.size === 0) {\n      throw new Error(\"Failed to initialize any communication method\");\n    }\n  }\n  allChannels() {\n    return Array.from(this.channels.keys());\n  }\n  hasChannel(method) {\n    return this.channels.has(method);\n  }\n  handleMessage(event) {\n    if (event && event.nonce) {\n      if (this.processedNonces.has(event.nonce)) {\n        // log.debug(`Duplicate message received via ${method}, nonce: ${event.nonce}`);\n        return;\n      }\n      this.processedNonces.add(event.nonce);\n\n      // Cleanup old nonces (keeping last 1000 to prevent memory issues)\n      if (this.processedNonces.size > 1000) {\n        const nonces = Array.from(this.processedNonces);\n        const oldestNonce = nonces.sort()[0];\n        this.processedNonces.delete(oldestNonce);\n      }\n      this.listeners.forEach(listener => {\n        listener(event.message);\n      });\n    }\n  }\n  async postMessage(message) {\n    if (this.closed) {\n      throw new Error(\"AdaptiveBroadcastChannel.postMessage(): \" + `Cannot post message after channel has closed ${\n      /**\n       * In the past when this error appeared, it was realy hard to debug.\n       * So now we log the msg together with the error so it at least\n       * gives some clue about where in your application this happens.\n       */\n      JSON.stringify(message)}`);\n    }\n    const nonce = this.generateNonce();\n    const wrappedMessage = {\n      nonce,\n      message\n    };\n    const postPromises = Array.from(this.channels.entries()).map(([method, channel]) => channel.postMessage(wrappedMessage).catch(error => {\n      log.warn(`Failed to send via ${method}: ${error.message}`);\n      throw error;\n    }));\n    const result = await Promise.allSettled(postPromises);\n\n    // Check if at least one promise resolved successfully\n    const anySuccessful = result.some(p => p.status === \"fulfilled\");\n    if (!anySuccessful) {\n      throw new Error(\"Failed to send message through any method\");\n    }\n    return message;\n  }\n  generateNonce() {\n    return `${Date.now()}-${this.nonce++}`;\n  }\n  addEventListener(_type, listener) {\n    // type params is not being used, it's there to keep same interface as BroadcastChannel\n    this.listeners.add(listener);\n  }\n  removeEventListener(_type, listener) {\n    // type params is not being used, it's there to keep same interface as BroadcastChannel\n    this.listeners.delete(listener);\n  }\n  async close() {\n    if (this.closed) {\n      return;\n    }\n    this.onML = null;\n\n    // use for loop instead of channels.values().map because of bug in safari Map\n    const promises = [];\n    for (const c of this.channels.values()) {\n      promises.push(c.close());\n    }\n    await Promise.all(promises);\n    this.channels.clear();\n    this.listeners.clear();\n    this.closed = true;\n  }\n}\n\nexport { RedundantAdaptiveBroadcastChannel };\n"],"names":[],"mappings":"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","ignoreList":[0]}}]
}