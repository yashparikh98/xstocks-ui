(function(re,en){typeof exports=="object"&&typeof module<"u"?en(exports):typeof define=="function"&&define.amd?define(["exports"],en):(re=typeof globalThis<"u"?globalThis:re||self,en(re["@walletconnect/sign-client"]={}))})(this,function(re){"use strict";var en=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hl(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var lt={exports:{}},Xr=typeof Reflect=="object"?Reflect:null,Kl=Xr&&typeof Xr.apply=="function"?Xr.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},ks;Xr&&typeof Xr.ownKeys=="function"?ks=Xr.ownKeys:Object.getOwnPropertySymbols?ks=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ks=function(e){return Object.getOwnPropertyNames(e)};function Hb(t){console&&console.warn&&console.warn(t)}var Gl=Number.isNaN||function(e){return e!==e};function pe(){pe.init.call(this)}lt.exports=pe,lt.exports.once=Zb,pe.EventEmitter=pe,pe.prototype._events=void 0,pe.prototype._eventsCount=0,pe.prototype._maxListeners=void 0;var Wl=10;function qs(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(pe,"defaultMaxListeners",{enumerable:!0,get:function(){return Wl},set:function(t){if(typeof t!="number"||t<0||Gl(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Wl=t}}),pe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},pe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Gl(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Zl(t){return t._maxListeners===void 0?pe.defaultMaxListeners:t._maxListeners}pe.prototype.getMaxListeners=function(){return Zl(this)},pe.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Kl(c,this,n);else for(var u=c.length,l=ef(c,u),r=0;r<u;++r)Kl(l[r],this,n);return!0};function Yl(t,e,n,r){var i,s,o;if(qs(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=Zl(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Hb(a)}return t}pe.prototype.addListener=function(e,n){return Yl(this,e,n,!1)},pe.prototype.on=pe.prototype.addListener,pe.prototype.prependListener=function(e,n){return Yl(this,e,n,!0)};function Kb(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Xl(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Kb.bind(r);return i.listener=n,r.wrapFn=i,i}pe.prototype.once=function(e,n){return qs(n),this.on(e,Xl(this,e,n)),this},pe.prototype.prependOnceListener=function(e,n){return qs(n),this.prependListener(e,Xl(this,e,n)),this},pe.prototype.removeListener=function(e,n){var r,i,s,o,a;if(qs(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Gb(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this},pe.prototype.off=pe.prototype.removeListener,pe.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Jl(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Wb(i):ef(i,i.length)}pe.prototype.listeners=function(e){return Jl(this,e,!0)},pe.prototype.rawListeners=function(e){return Jl(this,e,!1)},pe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ql.call(t,e)},pe.prototype.listenerCount=Ql;function Ql(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}pe.prototype.eventNames=function(){return this._eventsCount>0?ks(this._events):[]};function ef(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Gb(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Wb(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Zb(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}tf(t,e,s,{once:!0}),e!=="error"&&Yb(t,i,{once:!0})})}function Yb(t,e,n){typeof t.on=="function"&&tf(t,"error",e,n)}function tf(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var K={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var $a=function(t,e){return $a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},$a(t,e)};function Xb(t,e){$a(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Ta=function(){return Ta=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ta.apply(this,arguments)};function Jb(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Qb(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function ey(t,e){return function(n,r){e(n,r,t)}}function ty(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function ny(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function ry(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function iy(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function sy(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Pa(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function nf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function oy(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(nf(arguments[e]));return t}function ay(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Ri(t){return this instanceof Ri?(this.v=t,this):new Ri(t)}function cy(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,y){s.push([d,f,p,y])>1||a(d,f)})})}function a(d,f){try{c(r[d](f))}catch(p){h(s[0][3],p)}}function c(d){d.value instanceof Ri?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function uy(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Ri(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function ly(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Pa=="function"?Pa(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function fy(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function hy(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function dy(t){return t&&t.__esModule?t:{default:t}}function py(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function gy(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var by=Object.freeze({__proto__:null,__extends:Xb,get __assign(){return Ta},__rest:Jb,__decorate:Qb,__param:ey,__metadata:ty,__awaiter:ny,__generator:ry,__createBinding:iy,__exportStar:sy,__values:Pa,__read:nf,__spread:oy,__spreadArrays:ay,__await:Ri,__asyncGenerator:cy,__asyncDelegator:uy,__asyncValues:ly,__makeTemplateObject:fy,__importStar:hy,__importDefault:dy,__classPrivateFieldGet:py,__classPrivateFieldSet:gy}),Ms=Hl(by),Ra={},Ni={},rf;function yy(){if(rf)return Ni;rf=1,Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.delay=void 0;function t(e){return new Promise(n=>{setTimeout(()=>{n(!0)},e)})}return Ni.delay=t,Ni}var Er={},Na={},xr={},sf;function wy(){return sf||(sf=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.ONE_THOUSAND=xr.ONE_HUNDRED=void 0,xr.ONE_HUNDRED=100,xr.ONE_THOUSAND=1e3),xr}var Ca={},of;function my(){return of||(of=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Ca)),Ca}var af;function cf(){return af||(af=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ms;e.__exportStar(wy(),t),e.__exportStar(my(),t)}(Na)),Na}var uf;function vy(){if(uf)return Er;uf=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.fromMiliseconds=Er.toMiliseconds=void 0;const t=cf();function e(r){return r*t.ONE_THOUSAND}Er.toMiliseconds=e;function n(r){return Math.floor(r/t.ONE_THOUSAND)}return Er.fromMiliseconds=n,Er}var lf;function Ey(){return lf||(lf=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ms;e.__exportStar(yy(),t),e.__exportStar(vy(),t)}(Ra)),Ra}var Jr={},ff;function xy(){if(ff)return Jr;ff=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const r=this.get(n);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const i=Date.now()-r.started;this.timestamps.set(n,{started:r.started,elapsed:i})}get(n){const r=this.timestamps.get(n);if(typeof r>"u")throw new Error(`No timestamp found for label: ${n}`);return r}elapsed(n){const r=this.get(n);return r.elapsed||Date.now()-r.started}}return Jr.Watch=t,Jr.default=t,Jr}var Ua={},Ci={},hf;function _y(){if(hf)return Ci;hf=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.IWatch=void 0;class t{}return Ci.IWatch=t,Ci}var df;function Sy(){return df||(df=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ms.__exportStar(_y(),t)}(Ua)),Ua}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ms;e.__exportStar(Ey(),t),e.__exportStar(xy(),t),e.__exportStar(Sy(),t),e.__exportStar(cf(),t)})(K);class _r{}class Iy extends _r{constructor(e){super()}}const pf=K.FIVE_SECONDS,Sr={pulse:"heartbeat_pulse"};class Fa extends Iy{constructor(e){super(e),this.events=new lt.exports.EventEmitter,this.interval=pf,this.interval=e?.interval||pf}static async init(e){const n=new Fa(e);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),K.toMiliseconds(this.interval))}pulse(){this.events.emit(Sr.pulse)}}const Oy=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Ay=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,By=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Dy(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){$y(t);return}return e}function $y(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function js(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!By.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Oy.test(t)||Ay.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Dy)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}function Ty(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Re(t,...e){try{return Ty(t(...e))}catch(n){return Promise.reject(n)}}function Py(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Ry(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function zs(t){if(Py(t))return String(t);if(Ry(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return zs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const La="base64:";function Ny(t){return typeof t=="string"?t:La+Fy(t)}function Cy(t){return typeof t!="string"||!t.startsWith(La)?t:Uy(t.slice(La.length))}function Uy(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Fy(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function ft(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Ly(...t){return ft(t.join(":"))}function Vs(t){return t=ft(t),t?t+":":""}function ky(t,e){if(e===void 0)return!0;let n=0,r=t.indexOf(":");for(;r>-1;)n++,r=t.indexOf(":",r+1);return n<=e}function qy(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function qD(t){return t}const My="memory",jy=()=>{const t=new Map;return{name:My,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,n){t.set(e,n)},setItemRaw(e,n){t.set(e,n)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function zy(t={}){const e={mounts:{"":t.driver||jy()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},r=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=ft(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await gf(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const d=new Map,f=p=>{let y=d.get(p.base);return y||(y={driver:p.driver,base:p.base,items:[]},d.set(p.base,y)),y};for(const p of u){const y=typeof p=="string",m=ft(y?p:p.key),A=y?void 0:p.value,$=y||!p.options?l:{...l,...p.options},_=n(m);f(_).items.push({key:m,value:A,relativeKey:_.relativeKey,options:$})}return Promise.all([...d.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(u,l={}){u=ft(u);const{relativeKey:h,driver:d}=n(u);return Re(d.hasItem,h,l)},getItem(u,l={}){u=ft(u);const{relativeKey:h,driver:d}=n(u);return Re(d.getItem,h,l).then(f=>js(f))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?Re(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(f=>({key:Ly(h.base,f.key),value:js(f.value)}))):Promise.all(h.items.map(d=>Re(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:js(f)})))))},getItemRaw(u,l={}){u=ft(u);const{relativeKey:h,driver:d}=n(u);return d.getItemRaw?Re(d.getItemRaw,h,l):Re(d.getItem,h,l).then(f=>Cy(f))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=ft(u);const{relativeKey:d,driver:f}=n(u);f.setItem&&(await Re(f.setItem,d,zs(l),h),f.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return Re(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:zs(d.value),options:d.options})),l);h.driver.setItem&&await Promise.all(h.items.map(d=>Re(h.driver.setItem,d.relativeKey,zs(d.value),d.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=ft(u);const{relativeKey:d,driver:f}=n(u);if(f.setItemRaw)await Re(f.setItemRaw,d,l,h);else if(f.setItem)await Re(f.setItem,d,Ny(l),h);else return;f.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=ft(u);const{relativeKey:h,driver:d}=n(u);d.removeItem&&(await Re(d.removeItem,h,l),(l.removeMeta||l.removeMata)&&await Re(d.removeItem,h+"$",l),d.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=ft(u);const{relativeKey:h,driver:d}=n(u),f=Object.create(null);if(d.getMeta&&Object.assign(f,await Re(d.getMeta,h,l)),!l.nativeOnly){const p=await Re(d.getItem,h+"$",l).then(y=>js(y));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=Vs(u);const h=r(u,!0);let d=[];const f=[];let p=!0;for(const m of h){m.driver.flags?.maxDepth||(p=!1);const A=await Re(m.driver.getKeys,m.relativeBase,l);for(const $ of A){const _=m.mountpoint+ft($);d.some(x=>_.startsWith(x))||f.push(_)}d=[m.mountpoint,...d.filter($=>!$.startsWith(m.mountpoint))]}const y=l.maxDepth!==void 0&&!p;return f.filter(m=>(!y||ky(m,l.maxDepth))&&qy(m,u))},async clear(u,l={}){u=Vs(u),await Promise.all(r(u,!1).map(async h=>{if(h.driver.clear)return Re(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(d.map(f=>h.driver.removeItem(f,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>bf(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=Vs(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(gf(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=Vs(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await bf(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=ft(u)+":";const l=n(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=ft(u),r(u,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function gf(t,e,n){return t.watch?t.watch((r,i)=>e(r,n+i)):()=>{}}async function bf(t){typeof t.dispose=="function"&&await Re(t.dispose)}function Ir(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function yf(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=Ir(n);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let ka;function Ui(){return ka||(ka=yf("keyval-store","keyval")),ka}function wf(t,e=Ui()){return e("readonly",n=>Ir(n.get(t)))}function Vy(t,e,n=Ui()){return n("readwrite",r=>(r.put(e,t),Ir(r.transaction)))}function Hy(t,e=Ui()){return e("readwrite",n=>(n.delete(t),Ir(n.transaction)))}function Ky(t=Ui()){return t("readwrite",e=>(e.clear(),Ir(e.transaction)))}function Gy(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Ir(t.transaction)}function Wy(t=Ui()){return t("readonly",e=>{if(e.getAllKeys)return Ir(e.getAllKeys());const n=[];return Gy(e,r=>n.push(r.key)).then(()=>n)})}const Zy=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),Yy=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Qr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Yy(t)}catch{return t}}function Fi(t){return typeof t=="string"?t:Zy(t)||""}const Xy="idb-keyval";var Jy=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",n=i=>e+i;let r;return t.dbName&&t.storeName&&(r=yf(t.dbName,t.storeName)),{name:Xy,options:t,async hasItem(i){return!(typeof await wf(n(i),r)>"u")},async getItem(i){return await wf(n(i),r)??null},setItem(i,s){return Vy(n(i),s,r)},removeItem(i){return Hy(n(i),r)},getKeys(){return Wy(r)},clear(){return Ky(r)}}};const Qy="WALLET_CONNECT_V2_INDEXED_DB",ew="keyvaluestorage";class tw{constructor(){this.indexedDb=zy({driver:Jy({dbName:Qy,storeName:ew})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const n=await this.indexedDb.getItem(e);if(n!==null)return n}async setItem(e,n){await this.indexedDb.setItem(e,Fi(n))}async removeItem(e){await this.indexedDb.removeItem(e)}}var qa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Hs={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},t.prototype.setItem=function(n,r){this[n]=String(r)},t.prototype.removeItem=function(n){delete this[n]},t.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(r){n[r]=void 0,delete n[r]})},t.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof qa<"u"&&qa.localStorage?Hs.exports=qa.localStorage:typeof window<"u"&&window.localStorage?Hs.exports=window.localStorage:Hs.exports=new e})();function nw(t){var e;return[t[0],Qr((e=t[1])!=null?e:"")]}class rw{constructor(){this.localStorage=Hs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(nw)}async getItem(e){const n=this.localStorage.getItem(e);if(n!==null)return Qr(n)}async setItem(e,n){this.localStorage.setItem(e,Fi(n))}async removeItem(e){this.localStorage.removeItem(e)}}const iw="wc_storage_version",mf=1,sw=async(t,e,n)=>{const r=iw,i=await e.getItem(r);if(i&&i>=mf){n(e);return}const s=await t.getKeys();if(!s.length){n(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(r,mf),n(e),ow(t,o)},ow=async(t,e)=>{e.length&&e.forEach(async n=>{await t.removeItem(n)})};class aw{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const e=new rw;this.storage=e;try{const n=new tw;sw(e,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,n){return await this.initialize(),this.storage.setItem(e,n)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),e())},20)})}}var tn={exports:{}};function cw(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var uw=lw;function lw(t,e,n){var r=n&&n.stringify||cw,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=r(t);for(var a=1;a<s;a++)o[a]=r(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,h=-1,d=t&&t.length||0,f=0;f<d;){if(t.charCodeAt(f)===37&&f+1<d){switch(h=h>-1?h:0,t.charCodeAt(f+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<f&&(u+=t.slice(h,f)),u+=Number(e[l]),h=f+2,f++;break;case 105:if(l>=c||e[l]==null)break;h<f&&(u+=t.slice(h,f)),u+=Math.floor(Number(e[l])),h=f+2,f++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<f&&(u+=t.slice(h,f));var p=typeof e[l];if(p==="string"){u+="'"+e[l]+"'",h=f+2,f++;break}if(p==="function"){u+=e[l].name||"<anonymous>",h=f+2,f++;break}u+=r(e[l]),h=f+2,f++;break;case 115:if(l>=c)break;h<f&&(u+=t.slice(h,f)),u+=String(e[l]),h=f+2,f++;break;case 37:h<f&&(u+=t.slice(h,f)),u+="%",h=f+2,f++,l--;break}++l}++f}return h===-1?t:(h<d&&(u+=t.slice(h)),u)}const vf=uw;tn.exports=dn;const Li=Iw().console||{},fw={mapHttpRequest:Ks,mapHttpResponse:Ks,wrapRequestSerializer:Ha,wrapResponseSerializer:Ha,wrapErrorSerializer:Ha,req:Ks,res:Ks,err:xf,errWithCause:xf};function Mn(t,e){return t==="silent"?1/0:e.levels.values[t]}const Ma=Symbol("pino.logFuncs"),ja=Symbol("pino.hierarchy"),hw={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Ef(t,e){const n={logger:e,parent:t[ja]};e[ja]=n}function dw(t,e,n){const r={};e.forEach(i=>{r[i]=n[i]?n[i]:Li[i]||Li[hw[i]||"log"]||ei}),t[Ma]=r}function pw(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function dn(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const n=t.browser.write||Li;t.browser.write&&(t.browser.asObject=!0);const r=t.serializers||{},i=pw(t.browser.serialize,r);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof n=="function"&&a.forEach(function(y){n[y]=n}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",u=Object.create(n);u.log||(u.log=ei),dw(u,a,n),Ef({},u),Object.defineProperty(u,"levelVal",{get:h}),Object.defineProperty(u,"level",{get:d,set:f});const l={transmit:e,serialize:i,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:xw(t),messageKey:t.messageKey||"msg",onChild:t.onChild||ei};u.levels=gw(t),u.level=c,u.isLevelEnabled=function(y){return this.levels.values[y]?this.levels.values[y]>=this.levels.values[this.level]:!1},u.setMaxListeners=u.getMaxListeners=u.emit=u.addListener=u.on=u.prependListener=u.once=u.prependOnceListener=u.removeListener=u.removeAllListeners=u.listeners=u.listenerCount=u.eventNames=u.write=u.flush=ei,u.serializers=r,u._serialize=i,u._stdErrSerialize=s,u.child=function(...y){return p.call(this,l,...y)},e&&(u._logEvent=Va());function h(){return Mn(this.level,this)}function d(){return this._level}function f(y){if(y!=="silent"&&!this.levels.values[y])throw Error("unknown level "+y);this._level=y,Or(this,l,u,"error"),Or(this,l,u,"fatal"),Or(this,l,u,"warn"),Or(this,l,u,"info"),Or(this,l,u,"debug"),Or(this,l,u,"trace"),o.forEach(m=>{Or(this,l,u,m)})}function p(y,m,A){if(!m)throw new Error("missing bindings for child Pino");A=A||{},i&&m.serializers&&(A.serializers=m.serializers);const $=A.serializers;if(i&&$){var _=Object.assign({},r,$),x=t.browser.serialize===!0?Object.keys(_):i;delete m.serializers,za([m],x,_,this._stdErrSerialize)}function T(F){this._childLevel=(F._childLevel|0)+1,this.bindings=m,_&&(this.serializers=_,this._serialize=x),e&&(this._logEvent=Va([].concat(F._logEvent.bindings,m)))}T.prototype=this;const R=new T(this);return Ef(this,R),R.child=function(...F){return p.call(this,y,...F)},R.level=A.level||this.level,y.onChild(R),R}return u}function gw(t){const e=t.customLevels||{},n=Object.assign({},dn.levels.values,e),r=Object.assign({},dn.levels.labels,bw(e));return{values:n,labels:r}}function bw(t){const e={};return Object.keys(t).forEach(function(n){e[t[n]]=n}),e}dn.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},dn.stdSerializers=fw,dn.stdTimeFunctions=Object.assign({},{nullTime:_f,epochTime:Sf,unixTime:_w,isoTime:Sw});function yw(t){const e=[];t.bindings&&e.push(t.bindings);let n=t[ja];for(;n.parent;)n=n.parent,n.logger.bindings&&e.push(n.logger.bindings);return e.reverse()}function Or(t,e,n,r){if(Object.defineProperty(t,r,{value:Mn(t.level,n)>Mn(r,n)?ei:n[Ma][r],writable:!0,enumerable:!0,configurable:!0}),t[r]===ei){if(!e.transmit)return;const s=e.transmit.level||t.level,o=Mn(s,n);if(Mn(r,n)<o)return}t[r]=mw(t,e,n,r);const i=yw(t);i.length!==0&&(t[r]=ww(i,t[r]))}function ww(t,e){return function(){return e.apply(this,[...t,...arguments])}}function mw(t,e,n,r){return function(i){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Li?Li:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var u=!1;if(e.serialize&&(za(o,this._serialize,this.serializers,this._stdErrSerialize),u=!0),e.asObject||e.formatters?i.call(a,...vw(this,r,o,s,e)):i.apply(a,o),e.transmit){const l=e.transmit.level||t._level,h=Mn(l,n),d=Mn(r,n);if(d<h)return;Ew(this,{ts:s,methodLevel:r,methodValue:d,transmitLevel:l,transmitValue:n.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Mn(t._level,n)},o,u)}}}(t[Ma][r])}function vw(t,e,n,r,i){const{level:s,log:o=h=>h}=i.formatters||{},a=n.slice();let c=a[0];const u={};let l=(t._childLevel|0)+1;if(l<1&&(l=1),r&&(u.time=r),s){const h=s(e,t.levels.values[e]);Object.assign(u,h)}else u.level=t.levels.values[e];if(i.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());return[o(u),...a]}else{if(c!==null&&typeof c=="object"){for(;l--&&typeof a[0]=="object";)Object.assign(u,a.shift());c=a.length?vf(a.shift(),a):void 0}else typeof c=="string"&&(c=vf(a.shift(),a));return c!==void 0&&(u[i.messageKey]=c),[o(u)]}}function za(t,e,n,r){for(const i in t)if(r&&t[i]instanceof Error)t[i]=dn.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i])&&e)for(const s in t[i])e.indexOf(s)>-1&&s in n&&(t[i][s]=n[s](t[i][s]))}function Ew(t,e,n,r=!1){const i=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,u=t._logEvent.bindings;r||za(n,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=n.filter(function(l){return u.indexOf(l)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,i(o,t._logEvent,c),t._logEvent=Va(u)}function Va(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function xf(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const n in t)e[n]===void 0&&(e[n]=t[n]);return e}function xw(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?_f:Sf}function Ks(){return{}}function Ha(t){return t}function ei(){}function _f(){return!1}function Sf(){return Date.now()}function _w(){return Math.round(Date.now()/1e3)}function Sw(){return new Date(Date.now()).toISOString()}function Iw(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}tn.exports.default=dn,tn.exports.pino=dn;const Ow={level:"info"},Gs="custom_context",Ka=1e3*1024;var Aw=Object.defineProperty,Bw=(t,e,n)=>e in t?Aw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jn=(t,e,n)=>Bw(t,typeof e!="symbol"?e+"":e,n);class Dw{constructor(e){jn(this,"nodeValue"),jn(this,"sizeInBytes"),jn(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class If{constructor(e){jn(this,"lengthInNodes"),jn(this,"sizeInBytes"),jn(this,"head"),jn(this,"tail"),jn(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const n=new Dw(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const n=e.value;return e=e.next,{done:!1,value:n}}}}}const $w=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n);function Of(t){return typeof t=="string"?t:$w(t)||""}var Tw=Object.defineProperty,Pw=(t,e,n)=>e in t?Tw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ws=(t,e,n)=>Pw(t,typeof e!="symbol"?e+"":e,n);class Af{constructor(e,n=Ka){Ws(this,"logs"),Ws(this,"level"),Ws(this,"levelValue"),Ws(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=tn.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new If(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===tn.exports.levels.values.error?console.error(e):n===tn.exports.levels.values.warn?console.warn(e):n===tn.exports.levels.values.debug?console.debug(e):n===tn.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Of({timestamp:new Date().toISOString(),log:e}));const n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new If(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const n=this.getLogArray();return n.push(Of({extraMetadata:e})),new Blob(n,{type:"application/json"})}}var Rw=Object.defineProperty,Nw=(t,e,n)=>e in t?Rw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Cw=(t,e,n)=>Nw(t,typeof e!="symbol"?e+"":e,n);class Uw{constructor(e,n=Ka){Cw(this,"baseChunkLogger"),this.baseChunkLogger=new Af(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const n=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}}var Fw=Object.defineProperty,Lw=(t,e,n)=>e in t?Fw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kw=(t,e,n)=>Lw(t,typeof e!="symbol"?e+"":e,n);class qw{constructor(e,n=Ka){kw(this,"baseChunkLogger"),this.baseChunkLogger=new Af(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var Mw=Object.defineProperty,jw=Object.defineProperties,zw=Object.getOwnPropertyDescriptors,Bf=Object.getOwnPropertySymbols,Vw=Object.prototype.hasOwnProperty,Hw=Object.prototype.propertyIsEnumerable,Df=(t,e,n)=>e in t?Mw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zs=(t,e)=>{for(var n in e||(e={}))Vw.call(e,n)&&Df(t,n,e[n]);if(Bf)for(var n of Bf(e))Hw.call(e,n)&&Df(t,n,e[n]);return t},Ys=(t,e)=>jw(t,zw(e));function Kw(t){return Ys(Zs({},t),{level:t?.level||Ow.level})}function Gw(t,e,n=Gs){return t[n]=e,t}function ht(t,e=Gs){return t[e]||""}function Ww(t,e,n=Gs){const r=ht(t,n);return r.trim()?`${r}/${e}`:e}function St(t,e,n=Gs){const r=Ww(t,e,n),i=t.child({context:r});return Gw(i,r,n)}function Zw(t){var e,n;const r=new Uw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:tn.exports(Ys(Zs({},t.opts),{level:"trace",browser:Ys(Zs({},(n=t.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function Yw(t){var e;const n=new qw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:tn.exports(Ys(Zs({},t.opts),{level:"trace"}),n),chunkLoggerController:n}}function $f(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Zw(t):Yw(t)}var Xw=Object.defineProperty,Jw=(t,e,n)=>e in t?Xw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Tf=(t,e,n)=>Jw(t,typeof e!="symbol"?e+"":e,n);class Qw extends _r{constructor(e){super(),this.opts=e,Tf(this,"protocol","wc"),Tf(this,"version",2)}}var em=Object.defineProperty,tm=(t,e,n)=>e in t?em(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,nm=(t,e,n)=>tm(t,typeof e!="symbol"?e+"":e,n);class rm extends _r{constructor(e,n){super(),this.core=e,this.logger=n,nm(this,"records",new Map)}}class im{constructor(e,n){this.logger=e,this.core=n}}class sm extends _r{constructor(e,n){super(),this.relayer=e,this.logger=n}}class om extends _r{constructor(e){super()}}class am{constructor(e,n,r,i){this.core=e,this.logger=n,this.name=r}}class cm extends _r{constructor(e,n){super(),this.relayer=e,this.logger=n}}class um extends _r{constructor(e,n){super(),this.core=e,this.logger=n}}class lm{constructor(e,n,r){this.core=e,this.logger=n,this.store=r}}class fm{constructor(e,n){this.projectId=e,this.logger=n}}class hm{constructor(e,n,r){this.core=e,this.logger=n,this.telemetryEnabled=r}}var dm=Object.defineProperty,pm=(t,e,n)=>e in t?dm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Pf=(t,e,n)=>pm(t,typeof e!="symbol"?e+"":e,n);class gm{constructor(e){this.opts=e,Pf(this,"protocol","wc"),Pf(this,"version",2)}}class bm{constructor(e){this.client=e}}function ym(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Rf(t,...e){if(!ym(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Nf(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function wm(t,e){Rf(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const ti=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ga=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function mm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Cf(t){return typeof t=="string"&&(t=mm(t)),Rf(t),t}class vm{clone(){return this._cloneInto()}}function Em(t){const e=r=>t().update(Cf(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Uf(t=32){if(ti&&typeof ti.getRandomValues=="function")return ti.getRandomValues(new Uint8Array(t));if(ti&&typeof ti.randomBytes=="function")return ti.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function xm(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}class _m extends vm{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ga(this.buffer)}update(e){Nf(this);const{view:n,buffer:r,blockLen:i}=this;e=Cf(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ga(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nf(this),wm(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;xm(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Ga(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const Xs=BigInt(2**32-1),Wa=BigInt(32);function Ff(t,e=!1){return e?{h:Number(t&Xs),l:Number(t>>Wa&Xs)}:{h:Number(t>>Wa&Xs)|0,l:Number(t&Xs)|0}}function Sm(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Ff(t[i],e);[n[i],r[i]]=[s,o]}return[n,r]}const Im=(t,e)=>BigInt(t>>>0)<<Wa|BigInt(e>>>0),Om=(t,e,n)=>t>>>n,Am=(t,e,n)=>t<<32-n|e>>>n,Bm=(t,e,n)=>t>>>n|e<<32-n,Dm=(t,e,n)=>t<<32-n|e>>>n,$m=(t,e,n)=>t<<64-n|e>>>n-32,Tm=(t,e,n)=>t>>>n-32|e<<64-n,Pm=(t,e)=>e,Rm=(t,e)=>t,Nm=(t,e,n)=>t<<n|e>>>32-n,Cm=(t,e,n)=>e<<n|t>>>32-n,Um=(t,e,n)=>e<<n-32|t>>>64-n,Fm=(t,e,n)=>t<<n-32|e>>>64-n;function Lm(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const km=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),qm=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,Mm=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),jm=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,zm=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),Vm=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,ne={fromBig:Ff,split:Sm,toBig:Im,shrSH:Om,shrSL:Am,rotrSH:Bm,rotrSL:Dm,rotrBH:$m,rotrBL:Tm,rotr32H:Pm,rotr32L:Rm,rotlSH:Nm,rotlSL:Cm,rotlBH:Um,rotlBL:Fm,add:Lm,add3L:km,add3H:qm,add4L:Mm,add4H:jm,add5H:Vm,add5L:zm},[Hm,Km]=ne.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),zn=new Uint32Array(80),Vn=new Uint32Array(80);class Gm extends _m{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:y,Hl:m}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=y|0,this.Hl=m|0}process(e,n){for(let _=0;_<16;_++,n+=4)zn[_]=e.getUint32(n),Vn[_]=e.getUint32(n+=4);for(let _=16;_<80;_++){const x=zn[_-15]|0,T=Vn[_-15]|0,R=ne.rotrSH(x,T,1)^ne.rotrSH(x,T,8)^ne.shrSH(x,T,7),F=ne.rotrSL(x,T,1)^ne.rotrSL(x,T,8)^ne.shrSL(x,T,7),U=zn[_-2]|0,D=Vn[_-2]|0,j=ne.rotrSH(U,D,19)^ne.rotrBH(U,D,61)^ne.shrSH(U,D,6),M=ne.rotrSL(U,D,19)^ne.rotrBL(U,D,61)^ne.shrSL(U,D,6),E=ne.add4L(F,M,Vn[_-7],Vn[_-16]),b=ne.add4H(E,R,j,zn[_-7],zn[_-16]);zn[_]=b|0,Vn[_]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:y,Gl:m,Hh:A,Hl:$}=this;for(let _=0;_<80;_++){const x=ne.rotrSH(h,d,14)^ne.rotrSH(h,d,18)^ne.rotrBH(h,d,41),T=ne.rotrSL(h,d,14)^ne.rotrSL(h,d,18)^ne.rotrBL(h,d,41),R=h&f^~h&y,F=d&p^~d&m,U=ne.add5L($,T,F,Km[_],Vn[_]),D=ne.add5H(U,A,x,R,Hm[_],zn[_]),j=U|0,M=ne.rotrSH(r,i,28)^ne.rotrBH(r,i,34)^ne.rotrBH(r,i,39),E=ne.rotrSL(r,i,28)^ne.rotrBL(r,i,34)^ne.rotrBL(r,i,39),b=r&s^r&a^s&a,v=i&o^i&c^o&c;A=y|0,$=m|0,y=f|0,m=p|0,f=h|0,p=d|0,{h,l:d}=ne.add(u|0,l|0,D|0,j|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const g=ne.add3L(j,E,v);r=ne.add3H(g,D,M,b),i=g|0}({h:r,l:i}=ne.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=ne.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ne.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=ne.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=ne.add(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=ne.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:y,l:m}=ne.add(this.Gh|0,this.Gl|0,y|0,m|0),{h:A,l:$}=ne.add(this.Hh|0,this.Hl|0,A|0,$|0),this.set(r,i,s,o,a,c,u,l,h,d,f,p,y,m,A,$)}roundClean(){zn.fill(0),Vn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Wm=Em(()=>new Gm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Za=BigInt(0),Lf=BigInt(1),Zm=BigInt(2);function Ya(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Xa(t){if(!Ya(t))throw new Error("Uint8Array expected")}function Ja(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Ym=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Qa(t){Xa(t);let e="";for(let n=0;n<t.length;n++)e+=Ym[t[n]];return e}function kf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Za:BigInt("0x"+t)}const pn={_0:48,_9:57,A:65,F:70,a:97,f:102};function qf(t){if(t>=pn._0&&t<=pn._9)return t-pn._0;if(t>=pn.A&&t<=pn.F)return t-(pn.A-10);if(t>=pn.a&&t<=pn.f)return t-(pn.a-10)}function Mf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=qf(t.charCodeAt(s)),a=qf(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Xm(t){return kf(Qa(t))}function Js(t){return Xa(t),kf(Qa(Uint8Array.from(t).reverse()))}function jf(t,e){return Mf(t.toString(16).padStart(e*2,"0"))}function ec(t,e){return jf(t,e).reverse()}function gn(t,e,n){let r;if(typeof e=="string")try{r=Mf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ya(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function zf(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Xa(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const tc=t=>typeof t=="bigint"&&Za<=t;function Jm(t,e,n){return tc(t)&&tc(e)&&tc(n)&&e<=t&&t<n}function ki(t,e,n,r){if(!Jm(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Qm(t){let e;for(e=0;t>Za;t>>=Lf,e+=1);return e}const e2=t=>(Zm<<BigInt(t-1))-Lf,t2={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ya(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function nc(t,e,n={}){const r=(i,s,o)=>{const a=t2[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}function Vf(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const Ne=BigInt(0),_e=BigInt(1),Ar=BigInt(2),n2=BigInt(3),rc=BigInt(4),Hf=BigInt(5),Kf=BigInt(8);function Be(t,e){const n=t%e;return n>=Ne?n:e+n}function r2(t,e,n){if(e<Ne)throw new Error("invalid exponent, negatives unsupported");if(n<=Ne)throw new Error("invalid modulus");if(n===_e)return Ne;let r=_e;for(;e>Ne;)e&_e&&(r=r*t%n),t=t*t%n,e>>=_e;return r}function nn(t,e,n){let r=t;for(;e-- >Ne;)r*=r,r%=n;return r}function Gf(t,e){if(t===Ne)throw new Error("invert: expected non-zero number");if(e<=Ne)throw new Error("invert: expected positive modulus, got "+e);let n=Be(t,e),r=e,i=Ne,s=_e;for(;n!==Ne;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==_e)throw new Error("invert: does not exist");return Be(i,e)}function i2(t){const e=(t-_e)/Ar;let n,r,i;for(n=t-_e,r=0;n%Ar===Ne;n/=Ar,r++);for(i=Ar;i<t&&r2(i,e,t)!==t-_e;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+_e)/rc;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+_e)/Ar;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,u=o.pow(o.mul(o.ONE,i),n),l=o.pow(a,s),h=o.pow(a,n);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(u,_e<<BigInt(c-d-1));u=o.sqr(f),l=o.mul(l,f),h=o.mul(h,u),c=d}return l}}function s2(t){if(t%rc===n2){const e=(t+_e)/rc;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Kf===Hf){const e=(t-Hf)/Kf;return function(n,r){const i=n.mul(r,Ar),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Ar),s),c=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(c),r))throw new Error("Cannot find square root");return c}}return i2(t)}const o2=(t,e)=>(Be(t,e)&_e)===_e,a2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function c2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=a2.reduce((r,i)=>(r[i]="function",r),e);return nc(t,n)}function u2(t,e,n){if(n<Ne)throw new Error("invalid exponent, negatives unsupported");if(n===Ne)return t.ONE;if(n===_e)return e;let r=t.ONE,i=e;for(;n>Ne;)n&_e&&(r=t.mul(r,i)),i=t.sqr(i),n>>=_e;return r}function l2(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function Wf(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Zf(t,e,n=!1,r={}){if(t<=Ne)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Wf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:e2(i),ZERO:Ne,ONE:_e,create:c=>Be(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ne<=c&&c<t},is0:c=>c===Ne,isOdd:c=>(c&_e)===_e,neg:c=>Be(-c,t),eql:(c,u)=>c===u,sqr:c=>Be(c*c,t),add:(c,u)=>Be(c+u,t),sub:(c,u)=>Be(c-u,t),mul:(c,u)=>Be(c*u,t),pow:(c,u)=>u2(a,c,u),div:(c,u)=>Be(c*Gf(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Gf(c,t),sqrt:r.sqrt||(c=>(o||(o=s2(t)),o(a,c))),invertBatch:c=>l2(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>n?ec(c,s):jf(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?Js(c):Xm(c)}});return Object.freeze(a)}const Yf=BigInt(0),Qs=BigInt(1);function ic(t,e){const n=e.negate();return t?n:e}function Xf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function sc(t,e){Xf(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1);return{windows:n,windowSize:r}}function f2(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function h2(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const oc=new WeakMap,Jf=new WeakMap;function ac(t){return Jf.get(t)||1}function d2(t,e){return{constTimeNegate:ic,hasPrecomputes(n){return ac(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>Yf;)r&Qs&&(i=i.add(s)),s=s.double(),r>>=Qs;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=sc(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){const{windows:s,windowSize:o}=sc(n,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**n-1),l=2**n,h=BigInt(n);for(let d=0;d<s;d++){const f=d*o;let p=Number(i&u);i>>=h,p>o&&(p-=l,i+=Qs);const y=f,m=f+Math.abs(p)-1,A=d%2!==0,$=p<0;p===0?c=c.add(ic(A,r[y])):a=a.add(ic($,r[m]))}return{p:a,f:c}},wNAFUnsafe(n,r,i,s=t.ZERO){const{windows:o,windowSize:a}=sc(n,e),c=BigInt(2**n-1),u=2**n,l=BigInt(n);for(let h=0;h<o;h++){const d=h*a;if(i===Yf)break;let f=Number(i&c);if(i>>=l,f>a&&(f-=u,i+=Qs),f===0)continue;let p=r[d+Math.abs(f)-1];f<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(n,r,i){let s=oc.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&oc.set(r,i(s))),s},wNAFCached(n,r,i){const s=ac(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=ac(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Xf(r,e),Jf.set(n,r),oc.delete(n)}}}function p2(t,e,n,r){if(f2(n,t),h2(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Qm(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let f=0;f<r.length;f++){const p=r[f],y=Number(p>>BigInt(h)&BigInt(a));c[y]=c[y].add(n[f])}let d=i;for(let f=c.length-1,p=i;f>0;f--)p=p.add(c[f]),d=d.add(p);if(l=l.add(d),h!==0)for(let f=0;f<o;f++)l=l.double()}return l}function g2(t){return c2(t.Fp),nc(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Wf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const zt=BigInt(0),dt=BigInt(1),eo=BigInt(2),b2=BigInt(8),y2={zip215:!0};function w2(t){const e=g2(t);return nc(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function m2(t){const e=w2(t),{Fp:n,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=eo<<BigInt(a*8)-dt,l=n.create,h=Zf(e.n,e.nBitLength),d=e.uvRatio||((g,w)=>{try{return{isValid:!0,value:n.sqrt(g*n.inv(w))}}catch{return{isValid:!1,value:zt}}}),f=e.adjustScalarBytes||(g=>g),p=e.domain||((g,w,S)=>{if(Ja("phflag",S),w.length||S)throw new Error("Contexts/pre-hash are not supported");return g});function y(g,w){ki("coordinate "+g,w,zt,u)}function m(g){if(!(g instanceof _))throw new Error("ExtendedPoint expected")}const A=Vf((g,w)=>{const{ex:S,ey:O,ez:I}=g,B=g.is0();w==null&&(w=B?b2:n.inv(I));const P=l(S*w),L=l(O*w),C=l(I*w);if(B)return{x:zt,y:dt};if(C!==dt)throw new Error("invZ was invalid");return{x:P,y:L}}),$=Vf(g=>{const{a:w,d:S}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:O,ey:I,ez:B,et:P}=g,L=l(O*O),C=l(I*I),k=l(B*B),N=l(k*k),q=l(L*w),z=l(k*l(q+C)),W=l(N+l(S*l(L*C)));if(z!==W)throw new Error("bad point: equation left != right (1)");const H=l(O*I),Z=l(B*P);if(H!==Z)throw new Error("bad point: equation left != right (2)");return!0});class _{constructor(w,S,O,I){this.ex=w,this.ey=S,this.ez=O,this.et=I,y("x",w),y("y",S),y("z",O),y("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof _)throw new Error("extended point not allowed");const{x:S,y:O}=w||{};return y("x",S),y("y",O),new _(S,O,dt,l(S*O))}static normalizeZ(w){const S=n.invertBatch(w.map(O=>O.ez));return w.map((O,I)=>O.toAffine(S[I])).map(_.fromAffine)}static msm(w,S){return p2(_,h,w,S)}_setWindowSize(w){R.setWindowSize(this,w)}assertValidity(){$(this)}equals(w){m(w);const{ex:S,ey:O,ez:I}=this,{ex:B,ey:P,ez:L}=w,C=l(S*L),k=l(B*I),N=l(O*L),q=l(P*I);return C===k&&N===q}is0(){return this.equals(_.ZERO)}negate(){return new _(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:w}=e,{ex:S,ey:O,ez:I}=this,B=l(S*S),P=l(O*O),L=l(eo*l(I*I)),C=l(w*B),k=S+O,N=l(l(k*k)-B-P),q=C+P,z=q-L,W=C-P,H=l(N*z),Z=l(q*W),Q=l(N*W),ee=l(z*q);return new _(H,Z,ee,Q)}add(w){m(w);const{a:S,d:O}=e,{ex:I,ey:B,ez:P,et:L}=this,{ex:C,ey:k,ez:N,et:q}=w;if(S===BigInt(-1)){const Lb=l((B-I)*(k+C)),kb=l((B+I)*(k-C)),Vl=l(kb-Lb);if(Vl===zt)return this.double();const qb=l(P*eo*q),Mb=l(L*eo*N),jb=Mb+qb,zb=kb+Lb,Vb=Mb-qb,UD=l(jb*Vl),FD=l(zb*Vb),LD=l(jb*Vb),kD=l(Vl*zb);return new _(UD,FD,kD,LD)}const z=l(I*C),W=l(B*k),H=l(L*O*q),Z=l(P*N),Q=l((I+B)*(C+k)-z-W),ee=Z-H,se=Z+H,he=l(W-S*z),Ee=l(Q*ee),qn=l(se*he),Da=l(Q*he),CD=l(ee*se);return new _(Ee,qn,CD,Da)}subtract(w){return this.add(w.negate())}wNAF(w){return R.wNAFCached(this,w,_.normalizeZ)}multiply(w){const S=w;ki("scalar",S,dt,r);const{p:O,f:I}=this.wNAF(S);return _.normalizeZ([O,I])[0]}multiplyUnsafe(w,S=_.ZERO){const O=w;return ki("scalar",O,zt,r),O===zt?T:this.is0()||O===dt?this:R.wNAFCachedUnsafe(this,O,_.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return R.unsafeLadder(this,r).is0()}toAffine(w){return A(this,w)}clearCofactor(){const{h:w}=e;return w===dt?this:this.multiplyUnsafe(w)}static fromHex(w,S=!1){const{d:O,a:I}=e,B=n.BYTES;w=gn("pointHex",w,B),Ja("zip215",S);const P=w.slice(),L=w[B-1];P[B-1]=L&-129;const C=Js(P),k=S?u:n.ORDER;ki("pointHex.y",C,zt,k);const N=l(C*C),q=l(N-dt),z=l(O*N-I);let{isValid:W,value:H}=d(q,z);if(!W)throw new Error("Point.fromHex: invalid y coordinate");const Z=(H&dt)===dt,Q=(L&128)!==0;if(!S&&H===zt&&Q)throw new Error("Point.fromHex: x=0 and x_0=1");return Q!==Z&&(H=l(-H)),_.fromAffine({x:H,y:C})}static fromPrivateKey(w){return D(w).point}toRawBytes(){const{x:w,y:S}=this.toAffine(),O=ec(S,n.BYTES);return O[O.length-1]|=w&dt?128:0,O}toHex(){return Qa(this.toRawBytes())}}_.BASE=new _(e.Gx,e.Gy,dt,l(e.Gx*e.Gy)),_.ZERO=new _(zt,dt,dt,zt);const{BASE:x,ZERO:T}=_,R=d2(_,a*8);function F(g){return Be(g,r)}function U(g){return F(Js(g))}function D(g){const w=n.BYTES;g=gn("private key",g,w);const S=gn("hashed private key",s(g),2*w),O=f(S.slice(0,w)),I=S.slice(w,2*w),B=U(O),P=x.multiply(B),L=P.toRawBytes();return{head:O,prefix:I,scalar:B,point:P,pointBytes:L}}function j(g){return D(g).pointBytes}function M(g=new Uint8Array,...w){const S=zf(...w);return U(s(p(S,gn("context",g),!!i)))}function E(g,w,S={}){g=gn("message",g),i&&(g=i(g));const{prefix:O,scalar:I,pointBytes:B}=D(w),P=M(S.context,O,g),L=x.multiply(P).toRawBytes(),C=M(S.context,L,B,g),k=F(P+C*I);ki("signature.s",k,zt,r);const N=zf(L,ec(k,n.BYTES));return gn("result",N,n.BYTES*2)}const b=y2;function v(g,w,S,O=b){const{context:I,zip215:B}=O,P=n.BYTES;g=gn("signature",g,2*P),w=gn("message",w),S=gn("publicKey",S,P),B!==void 0&&Ja("zip215",B),i&&(w=i(w));const L=Js(g.slice(P,2*P));let C,k,N;try{C=_.fromHex(S,B),k=_.fromHex(g.slice(0,P),B),N=x.multiplyUnsafe(L)}catch{return!1}if(!B&&C.isSmallOrder())return!1;const q=M(I,k.toRawBytes(),C.toRawBytes(),w);return k.add(C.multiplyUnsafe(q)).subtract(N).clearCofactor().equals(_.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:E,verify:v,ExtendedPoint:_,utils:{getExtendedPublicKey:D,randomPrivateKey:()=>o(n.BYTES),precompute(g=8,w=_.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const cc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Qf=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const v2=BigInt(1),eh=BigInt(2);BigInt(3);const E2=BigInt(5),x2=BigInt(8);function _2(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=cc,o=t*t%s*t%s,a=nn(o,eh,s)*o%s,c=nn(a,v2,s)*t%s,u=nn(c,E2,s)*c%s,l=nn(u,e,s)*u%s,h=nn(l,n,s)*l%s,d=nn(h,r,s)*h%s,f=nn(d,i,s)*d%s,p=nn(f,i,s)*d%s,y=nn(p,e,s)*u%s;return{pow_p_5_8:nn(y,eh,s)*t%s,b2:o}}function S2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function I2(t,e){const n=cc,r=Be(e*e*e,n),i=Be(r*r*e,n),s=_2(t*i).pow_p_5_8;let o=Be(t*r*s,n);const a=Be(e*o*o,n),c=o,u=Be(o*Qf,n),l=a===t,h=a===Be(-t,n),d=a===Be(-t*Qf,n);return l&&(o=c),(h||d)&&(o=u),o2(o,n)&&(o=Be(-o,n)),{isValid:l||h,value:o}}const O2=Zf(cc,void 0,!0),A2={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:O2,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:x2,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Wm,randomBytes:Uf,adjustScalarBytes:S2,uvRatio:I2},th=m2(A2),B2="EdDSA",D2="JWT",to=".",no="base64url",nh="utf8",rh="utf8",$2=":",T2="did",P2="key",ih="base58btc",R2="z",N2="K36",C2=32;function uc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function sh(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?uc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function oh(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=sh(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return uc(n)}function U2(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,m=0,A=0,$=p.length;A!==$&&p[A]===0;)A++,y++;for(var _=($-A)*l+1>>>0,x=new Uint8Array(_);A!==$;){for(var T=p[A],R=0,F=_-1;(T!==0||R<m)&&F!==-1;F--,R++)T+=256*x[F]>>>0,x[F]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");m=R,A++}for(var U=_-m;U!==_&&x[U]===0;)U++;for(var D=c.repeat(y);U<_;++U)D+=t.charAt(x[U]);return D}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var m=0,A=0;p[y]===c;)m++,y++;for(var $=(p.length-y)*u+1>>>0,_=new Uint8Array($);p[y];){var x=n[p.charCodeAt(y)];if(x===255)return;for(var T=0,R=$-1;(x!==0||T<A)&&R!==-1;R--,T++)x+=a*_[R]>>>0,_[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");A=T,y++}if(p[y]!==" "){for(var F=$-A;F!==$&&_[F]===0;)F++;for(var U=new Uint8Array(m+($-F)),D=m;F!==$;)U[D++]=_[F++];return U}}}function f(p){var y=d(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var F2=U2,L2=F2;const ah=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},k2=t=>new TextEncoder().encode(t),q2=t=>new TextDecoder().decode(t);class M2{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class j2{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ch(this,e)}}class z2{constructor(e){this.decoders=e}or(e){return ch(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ch=(t,e)=>new z2({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class V2{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new M2(e,n,r),this.decoder=new j2(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ro=({name:t,prefix:e,encode:n,decode:r})=>new V2(t,e,n,r),qi=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=L2(n,e);return ro({prefix:t,name:e,encode:r,decode:s=>ah(i(s))})},H2=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},K2=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},ke=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>ro({prefix:e,name:t,encode(i){return K2(i,r,n)},decode(i){return H2(i,r,n,t)}}),G2=ro({prefix:"\0",name:"identity",encode:t=>q2(t),decode:t=>k2(t)});var W2=Object.freeze({__proto__:null,identity:G2});const Z2=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Y2=Object.freeze({__proto__:null,base2:Z2});const X2=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var J2=Object.freeze({__proto__:null,base8:X2});const Q2=qi({prefix:"9",name:"base10",alphabet:"0123456789"});var ev=Object.freeze({__proto__:null,base10:Q2});const tv=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nv=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rv=Object.freeze({__proto__:null,base16:tv,base16upper:nv});const iv=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sv=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ov=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),av=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),cv=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),uv=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),lv=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fv=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),hv=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dv=Object.freeze({__proto__:null,base32:iv,base32upper:sv,base32pad:ov,base32padupper:av,base32hex:cv,base32hexupper:uv,base32hexpad:lv,base32hexpadupper:fv,base32z:hv});const pv=qi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gv=qi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var bv=Object.freeze({__proto__:null,base36:pv,base36upper:gv});const yv=qi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wv=qi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var mv=Object.freeze({__proto__:null,base58btc:yv,base58flickr:wv});const vv=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ev=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xv=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),_v=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Sv=Object.freeze({__proto__:null,base64:vv,base64pad:Ev,base64url:xv,base64urlpad:_v});const uh=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Iv=uh.reduce((t,e,n)=>(t[n]=e,t),[]),Ov=uh.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function Av(t){return t.reduce((e,n)=>(e+=Iv[n],e),"")}function Bv(t){const e=[];for(const n of t){const r=Ov[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const Dv=ro({prefix:"\u{1F680}",name:"base256emoji",encode:Av,decode:Bv});var $v=Object.freeze({__proto__:null,base256emoji:Dv}),Tv=fh,lh=128,Pv=127,Rv=~Pv,Nv=Math.pow(2,31);function fh(t,e,n){e=e||[],n=n||0;for(var r=n;t>=Nv;)e[n++]=t&255|lh,t/=128;for(;t&Rv;)e[n++]=t&255|lh,t>>>=7;return e[n]=t|0,fh.bytes=n-r+1,e}var Cv=lc,Uv=128,hh=127;function lc(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw lc.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&hh)<<i:(o&hh)*Math.pow(2,i),i+=7}while(o>=Uv);return lc.bytes=s-r,n}var Fv=Math.pow(2,7),Lv=Math.pow(2,14),kv=Math.pow(2,21),qv=Math.pow(2,28),Mv=Math.pow(2,35),jv=Math.pow(2,42),zv=Math.pow(2,49),Vv=Math.pow(2,56),Hv=Math.pow(2,63),Kv=function(t){return t<Fv?1:t<Lv?2:t<kv?3:t<qv?4:t<Mv?5:t<jv?6:t<zv?7:t<Vv?8:t<Hv?9:10},Gv={encode:Tv,decode:Cv,encodingLength:Kv},dh=Gv;const ph=(t,e,n=0)=>(dh.encode(t,e,n),e),gh=t=>dh.encodingLength(t),fc=(t,e)=>{const n=e.byteLength,r=gh(t),i=r+gh(n),s=new Uint8Array(i+n);return ph(t,s,0),ph(n,s,r),s.set(e,i),new Wv(t,n,e,s)};class Wv{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const bh=({name:t,code:e,encode:n})=>new Zv(t,e,n);class Zv{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?fc(this.code,n):n.then(r=>fc(this.code,r))}else throw Error("Unknown type, must be binary type")}}const yh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Yv=bh({name:"sha2-256",code:18,encode:yh("SHA-256")}),Xv=bh({name:"sha2-512",code:19,encode:yh("SHA-512")});var Jv=Object.freeze({__proto__:null,sha256:Yv,sha512:Xv});const wh=0,Qv="identity",mh=ah;var eE=Object.freeze({__proto__:null,identity:{code:wh,name:Qv,encode:mh,digest:t=>fc(wh,mh(t))}});new TextEncoder,new TextDecoder;const vh={...W2,...Y2,...J2,...ev,...rv,...dv,...bv,...mv,...Sv,...$v};({...Jv,...eE});function Eh(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const xh=Eh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),hc=Eh("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=sh(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),_h={utf8:xh,"utf-8":xh,hex:vh.base16,latin1:hc,ascii:hc,binary:hc,...vh};function io(t,e="utf8"){const n=_h[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}function ni(t,e="utf8"){const n=_h[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?uc(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function Sh(t){return Qr(io(ni(t,no),nh))}function so(t){return io(ni(Fi(t),nh),no)}function Ih(t){const e=ni(N2,ih),n=R2+io(oh([e,t]),ih);return[T2,P2,n].join($2)}function tE(t){return io(t,no)}function nE(t){return ni(t,no)}function rE(t){return ni([so(t.header),so(t.payload)].join(to),rh)}function iE(t){return[so(t.header),so(t.payload),tE(t.signature)].join(to)}function dc(t){const e=t.split(to),n=Sh(e[0]),r=Sh(e[1]),i=nE(e[2]),s=ni(e.slice(0,2).join(to),rh);return{header:n,payload:r,signature:i,data:s}}function Oh(t=Uf(C2)){const e=th.getPublicKey(t);return{secretKey:oh([t,e]),publicKey:e}}async function sE(t,e,n,r,i=K.fromMiliseconds(Date.now())){const s={alg:B2,typ:D2},o=Ih(r.publicKey),a=i+n,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=rE({header:s,payload:c}),l=th.sign(u,r.secretKey.slice(0,32));return iE({header:s,payload:c,signature:l})}var Ah=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},oE=function(){function t(e,n,r){this.name=e,this.version=n,this.os=r,this.type="browser"}return t}(),aE=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),cE=function(){function t(e,n,r,i){this.name=e,this.version=n,this.os=r,this.bot=i,this.type="bot-device"}return t}(),uE=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),lE=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),fE=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,hE=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Bh=3,dE=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",fE]],Dh=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function pE(t){return t?$h(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new lE:typeof navigator<"u"?$h(navigator.userAgent):yE()}function gE(t){return t!==""&&dE.reduce(function(e,n){var r=n[0],i=n[1];if(e)return e;var s=i.exec(t);return!!s&&[r,s]},!1)}function $h(t){var e=gE(t);if(!e)return null;var n=e[0],r=e[1];if(n==="searchbot")return new uE;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<Bh&&(i=Ah(Ah([],i,!0),wE(Bh-i.length),!0)):i=[];var s=i.join("."),o=bE(t),a=hE.exec(t);return a&&a[1]?new cE(n,s,o,a[1]):new oE(n,s,o)}function bE(t){for(var e=0,n=Dh.length;e<n;e++){var r=Dh[e],i=r[0],s=r[1],o=s.exec(t);if(o)return i}return null}function yE(){var t=typeof process<"u"&&process.version;return t?new aE(process.version.slice(1)):null}function wE(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}var we={};Object.defineProperty(we,"__esModule",{value:!0}),we.getLocalStorage=we.getLocalStorageOrThrow=we.getCrypto=we.getCryptoOrThrow=Th=we.getLocation=we.getLocationOrThrow=pc=we.getNavigator=we.getNavigatorOrThrow=Dr=we.getDocument=we.getDocumentOrThrow=we.getFromWindowOrThrow=we.getFromWindow=void 0;function Br(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}we.getFromWindow=Br;function ri(t){const e=Br(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}we.getFromWindowOrThrow=ri;function mE(){return ri("document")}we.getDocumentOrThrow=mE;function vE(){return Br("document")}var Dr=we.getDocument=vE;function EE(){return ri("navigator")}we.getNavigatorOrThrow=EE;function xE(){return Br("navigator")}var pc=we.getNavigator=xE;function _E(){return ri("location")}we.getLocationOrThrow=_E;function SE(){return Br("location")}var Th=we.getLocation=SE;function IE(){return ri("crypto")}we.getCryptoOrThrow=IE;function OE(){return Br("crypto")}we.getCrypto=OE;function AE(){return ri("localStorage")}we.getLocalStorageOrThrow=AE;function BE(){return Br("localStorage")}we.getLocalStorage=BE;var gc={};Object.defineProperty(gc,"__esModule",{value:!0});var Ph=gc.getWindowMetadata=void 0;const Rh=we;function DE(){let t,e;try{t=Rh.getDocumentOrThrow(),e=Rh.getLocationOrThrow()}catch{return null}function n(){const h=t.getElementsByTagName("link"),d=[];for(let f=0;f<h.length;f++){const p=h[f],y=p.getAttribute("rel");if(y&&y.toLowerCase().indexOf("icon")>-1){const m=p.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let A=e.protocol+"//"+e.host;if(m.indexOf("/")===0)A+=m;else{const $=e.pathname.split("/");$.pop();const _=$.join("/");A+=_+"/"+m}d.push(A)}else if(m.indexOf("//")===0){const A=e.protocol+m;d.push(A)}else d.push(m)}}return d}function r(...h){const d=t.getElementsByTagName("meta");for(let f=0;f<d.length;f++){const p=d[f],y=["itemprop","property","name"].map(m=>p.getAttribute(m)).filter(m=>m?h.includes(m):!1);if(y.length&&y){const m=p.getAttribute("content");if(m)return m}}return""}function i(){let h=r("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function s(){return r("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=n();return{description:a,url:c,icons:u,name:o}}Ph=gc.getWindowMetadata=DE;const $E="0.1.1";function TE(){return $E}class be extends Error{constructor(e,n={}){const r=(()=>{if(n.cause instanceof be){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:n.cause?.message?n.cause.message:n.details})(),i=n.cause instanceof be&&n.cause.docsPath||n.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${TE()}`}),this.cause=n.cause,this.details=r,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return Nh(this,e)}}function Nh(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?Nh(t.cause,e):e?null:t}const ii=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function oo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function si(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function bn(t,...e){if(!oo(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ch(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");si(t.outputLen),si(t.blockLen)}function oi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Uh(t,e){bn(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function PE(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Hn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function bc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function rn(t,e){return t<<32-e|t>>>e}const RE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function NE(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function CE(t){for(let e=0;e<t.length;e++)t[e]=NE(t[e]);return t}const Fh=RE?t=>t:CE,Lh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",UE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ai(t){if(bn(t),Lh)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=UE[t[n]];return e}const yn={_0:48,_9:57,A:65,F:70,a:97,f:102};function kh(t){if(t>=yn._0&&t<=yn._9)return t-yn._0;if(t>=yn.A&&t<=yn.F)return t-(yn.A-10);if(t>=yn.a&&t<=yn.f)return t-(yn.a-10)}function ao(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Lh)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=kh(t.charCodeAt(s)),a=kh(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function yc(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function co(t){return typeof t=="string"&&(t=yc(t)),bn(t),t}function wn(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];bn(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}class wc{}function uo(t){const e=r=>t().update(co(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function lo(t=32){if(ii&&typeof ii.getRandomValues=="function")return ii.getRandomValues(new Uint8Array(t));if(ii&&typeof ii.randomBytes=="function")return Uint8Array.from(ii.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function FE(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function LE(t,e,n){return t&e^~t&n}function kE(t,e,n){return t&e^t&n^e&n}class qh extends wc{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=bc(this.buffer)}update(e){oi(this),e=co(e),bn(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=bc(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oi(this),Uh(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,Hn(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;FE(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=bc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const mn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ke=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ge=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),fo=BigInt(2**32-1),Mh=BigInt(32);function qE(t,e=!1){return e?{h:Number(t&fo),l:Number(t>>Mh&fo)}:{h:Number(t>>Mh&fo)|0,l:Number(t&fo)|0}}function jh(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=qE(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const zh=(t,e,n)=>t>>>n,Vh=(t,e,n)=>t<<32-n|e>>>n,ci=(t,e,n)=>t>>>n|e<<32-n,ui=(t,e,n)=>t<<32-n|e>>>n,ho=(t,e,n)=>t<<64-n|e>>>n-32,po=(t,e,n)=>t>>>n-32|e<<64-n,ME=(t,e,n)=>t<<n|e>>>32-n,jE=(t,e,n)=>e<<n|t>>>32-n,zE=(t,e,n)=>e<<n-32|t>>>64-n,VE=(t,e,n)=>t<<n-32|e>>>64-n;function vn(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const HE=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),KE=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,GE=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),WE=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,ZE=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),YE=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,XE=BigInt(0),Mi=BigInt(1),JE=BigInt(2),QE=BigInt(7),e3=BigInt(256),t3=BigInt(113),Hh=[],Kh=[],Gh=[];for(let t=0,e=Mi,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Hh.push(2*(5*r+n)),Kh.push((t+1)*(t+2)/2%64);let i=XE;for(let s=0;s<7;s++)e=(e<<Mi^(e>>QE)*t3)%e3,e&JE&&(i^=Mi<<(Mi<<BigInt(s))-Mi);Gh.push(i)}const Wh=jh(Gh,!0),n3=Wh[0],r3=Wh[1],Zh=(t,e,n)=>n>32?zE(t,e,n):ME(t,e,n),Yh=(t,e,n)=>n>32?VE(t,e,n):jE(t,e,n);function i3(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=Zh(u,l,1)^n[a],d=Yh(u,l,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Kh[o],c=Zh(i,s,a),u=Yh(i,s,a),l=Hh[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=n3[r],t[1]^=r3[r]}Hn(n)}class mc extends wc{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,si(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=PE(this.state)}clone(){return this._cloneInto()}keccak(){Fh(this.state32),i3(this.state32,this.rounds),Fh(this.state32),this.posOut=0,this.pos=0}update(e){oi(this),e=co(e),bn(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){oi(this,!1),bn(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return si(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Uh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Hn(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new mc(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const s3=(t,e,n)=>uo(()=>new mc(e,t,n)),o3=s3(1,136,256/8),a3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Kn=new Uint32Array(64);class c3 extends qh{constructor(e=32){super(64,e,8,!1),this.A=mn[0]|0,this.B=mn[1]|0,this.C=mn[2]|0,this.D=mn[3]|0,this.E=mn[4]|0,this.F=mn[5]|0,this.G=mn[6]|0,this.H=mn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)Kn[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=Kn[h-15],f=Kn[h-2],p=rn(d,7)^rn(d,18)^d>>>3,y=rn(f,17)^rn(f,19)^f>>>10;Kn[h]=y+Kn[h-7]+p+Kn[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=rn(a,6)^rn(a,11)^rn(a,25),f=l+d+LE(a,c,u)+a3[h]+Kn[h]|0,y=(rn(r,2)^rn(r,13)^rn(r,22))+kE(r,i,s)|0;l=u,u=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+y|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){Hn(Kn)}destroy(){this.set(0,0,0,0,0,0,0,0),Hn(this.buffer)}}const Xh=jh(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),u3=Xh[0],l3=Xh[1],Gn=new Uint32Array(80),Wn=new Uint32Array(80);class Jh extends qh{constructor(e=64){super(128,e,16,!1),this.Ah=Ge[0]|0,this.Al=Ge[1]|0,this.Bh=Ge[2]|0,this.Bl=Ge[3]|0,this.Ch=Ge[4]|0,this.Cl=Ge[5]|0,this.Dh=Ge[6]|0,this.Dl=Ge[7]|0,this.Eh=Ge[8]|0,this.El=Ge[9]|0,this.Fh=Ge[10]|0,this.Fl=Ge[11]|0,this.Gh=Ge[12]|0,this.Gl=Ge[13]|0,this.Hh=Ge[14]|0,this.Hl=Ge[15]|0}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:y,Hl:m}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=y|0,this.Hl=m|0}process(e,n){for(let _=0;_<16;_++,n+=4)Gn[_]=e.getUint32(n),Wn[_]=e.getUint32(n+=4);for(let _=16;_<80;_++){const x=Gn[_-15]|0,T=Wn[_-15]|0,R=ci(x,T,1)^ci(x,T,8)^zh(x,T,7),F=ui(x,T,1)^ui(x,T,8)^Vh(x,T,7),U=Gn[_-2]|0,D=Wn[_-2]|0,j=ci(U,D,19)^ho(U,D,61)^zh(U,D,6),M=ui(U,D,19)^po(U,D,61)^Vh(U,D,6),E=GE(F,M,Wn[_-7],Wn[_-16]),b=WE(E,R,j,Gn[_-7],Gn[_-16]);Gn[_]=b|0,Wn[_]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:y,Gl:m,Hh:A,Hl:$}=this;for(let _=0;_<80;_++){const x=ci(h,d,14)^ci(h,d,18)^ho(h,d,41),T=ui(h,d,14)^ui(h,d,18)^po(h,d,41),R=h&f^~h&y,F=d&p^~d&m,U=ZE($,T,F,l3[_],Wn[_]),D=YE(U,A,x,R,u3[_],Gn[_]),j=U|0,M=ci(r,i,28)^ho(r,i,34)^ho(r,i,39),E=ui(r,i,28)^po(r,i,34)^po(r,i,39),b=r&s^r&a^s&a,v=i&o^i&c^o&c;A=y|0,$=m|0,y=f|0,m=p|0,f=h|0,p=d|0,{h,l:d}=vn(u|0,l|0,D|0,j|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const g=HE(j,E,v);r=KE(g,D,M,b),i=g|0}({h:r,l:i}=vn(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=vn(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=vn(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=vn(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=vn(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=vn(this.Fh|0,this.Fl|0,f|0,p|0),{h:y,l:m}=vn(this.Gh|0,this.Gl|0,y|0,m|0),{h:A,l:$}=vn(this.Hh|0,this.Hl|0,A|0,$|0),this.set(r,i,s,o,a,c,u,l,h,d,f,p,y,m,A,$)}roundClean(){Hn(Gn,Wn)}destroy(){Hn(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class f3 extends Jh{constructor(){super(48),this.Ah=Ke[0]|0,this.Al=Ke[1]|0,this.Bh=Ke[2]|0,this.Bl=Ke[3]|0,this.Ch=Ke[4]|0,this.Cl=Ke[5]|0,this.Dh=Ke[6]|0,this.Dl=Ke[7]|0,this.Eh=Ke[8]|0,this.El=Ke[9]|0,this.Fh=Ke[10]|0,this.Fl=Ke[11]|0,this.Gh=Ke[12]|0,this.Gl=Ke[13]|0,this.Hh=Ke[14]|0,this.Hl=Ke[15]|0}}const li=uo(()=>new c3),h3=uo(()=>new Jh),d3=uo(()=>new f3);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vc=BigInt(0),go=BigInt(1);function ji(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zn(t){if(!ji(t))throw new Error("Uint8Array expected")}function zi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function bo(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Qh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?vc:BigInt("0x"+t)}const ed=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",p3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function $r(t){if(Zn(t),ed)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=p3[t[n]];return e}const En={_0:48,_9:57,A:65,F:70,a:97,f:102};function td(t){if(t>=En._0&&t<=En._9)return t-En._0;if(t>=En.A&&t<=En.F)return t-(En.A-10);if(t>=En.a&&t<=En.f)return t-(En.a-10)}function yo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(ed)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=td(t.charCodeAt(s)),a=td(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function nt(t){return Qh($r(t))}function nd(t){return Zn(t),Qh($r(Uint8Array.from(t).reverse()))}function De(t,e){return yo(t.toString(16).padStart(e*2,"0"))}function rd(t,e){return De(t,e).reverse()}function We(t,e,n){let r;if(typeof e=="string")try{r=yo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ji(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function Se(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Zn(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function Ec(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const xc=t=>typeof t=="bigint"&&vc<=t;function _c(t,e,n){return xc(t)&&xc(e)&&xc(n)&&e<=t&&t<n}function fi(t,e,n,r){if(!_c(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Vi(t){let e;for(e=0;t>vc;t>>=go,e+=1);return e}function g3(t,e){return t>>BigInt(e)&go}const Tr=t=>(go<<BigInt(t))-go,Sc=t=>new Uint8Array(t),id=t=>Uint8Array.from(t);function b3(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Sc(t),i=Sc(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...h)=>n(i,r,...h),c=(h=Sc(0))=>{i=a(id([0]),h),r=a(),h.length!==0&&(i=a(id([1]),h),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){r=a();const f=r.slice();d.push(f),h+=r.length}return Se(...d)};return(h,d)=>{o(),c(h);let f;for(;!(f=d(u()));)c();return o(),f}}const y3={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ji(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Hi(t,e,n={}){const r=(i,s,o)=>{const a=y3[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const sd=()=>{throw new Error("not implemented")};function Ic(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}function w3(t,e){if(fd(t)>e)throw new q3({givenSize:fd(t),maxSize:e})}const xn={zero:48,nine:57,A:65,F:70,a:97,f:102};function od(t){if(t>=xn.zero&&t<=xn.nine)return t-xn.zero;if(t>=xn.A&&t<=xn.F)return t-(xn.A-10);if(t>=xn.a&&t<=xn.f)return t-(xn.a-10)}function m3(t,e={}){const{dir:n,size:r=32}=e;if(r===0)return t;if(t.length>r)throw new M3({size:t.length,targetSize:r,type:"Bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const o=n==="right";i[o?s:r-s-1]=t[o?s:t.length-s-1]}return i}function Oc(t,e){if(Sn(t)>e)throw new $3({givenSize:Sn(t),maxSize:e})}function v3(t,e){if(typeof e=="number"&&e>0&&e>Sn(t)-1)throw new ld({offset:e,position:"start",size:Sn(t)})}function E3(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Sn(t)!==n-e)throw new ld({offset:n,position:"end",size:Sn(t)})}function ad(t,e={}){const{dir:n,size:r=32}=e;if(r===0)return t;const i=t.replace("0x","");if(i.length>r*2)throw new T3({size:Math.ceil(i.length/2),targetSize:r,type:"Hex"});return`0x${i[n==="right"?"padEnd":"padStart"](r*2,"0")}`}const x3="#__bigint";function Ac(t,e,n){return JSON.stringify(t,(r,i)=>typeof e=="function"?e(r,i):typeof i=="bigint"?i.toString()+x3:i,n)}const _3=new TextEncoder,S3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function I3(t,e={}){const{strict:n=!1}=e;if(!t)throw new cd(t);if(typeof t!="string")throw new cd(t);if(n&&!/^0x[0-9a-fA-F]*$/.test(t))throw new ud(t);if(!t.startsWith("0x"))throw new ud(t)}function Bc(...t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function Dc(t){return t instanceof Uint8Array?Ki(t):Array.isArray(t)?Ki(new Uint8Array(t)):t}function O3(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(Oc(n,e.size),mo(n,e.size)):n}function Ki(t,e={}){let n="";for(let i=0;i<t.length;i++)n+=S3[t[i]];const r=`0x${n}`;return typeof e.size=="number"?(Oc(r,e.size),$c(r,e.size)):r}function wo(t,e={}){const{signed:n,size:r}=e,i=BigInt(t);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new D3({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:n,size:r,value:`${t}${u}`})}const c=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?mo(c,r):c}function A3(t,e={}){return Ki(_3.encode(t),e)}function mo(t,e){return ad(t,{dir:"left",size:e})}function $c(t,e){return ad(t,{dir:"right",size:e})}function _n(t,e,n,r={}){const{strict:i}=r;v3(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return i&&E3(s,e,n),s}function Sn(t){return Math.ceil((t.length-2)/2)}function B3(t,e={}){const{strict:n=!1}=e;try{return I3(t,{strict:n}),!0}catch{return!1}}class D3 extends be{constructor({max:e,min:n,signed:r,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${n}\` to \`${e}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class cd extends be{constructor(e){super(`Value \`${typeof e=="object"?Ac(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class ud extends be{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class $3 extends be{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class ld extends be{constructor({offset:e,position:n,size:r}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class T3 extends be{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}const P3=new TextEncoder;function R3(t){if(!(t instanceof Uint8Array)){if(!t)throw new vo(t);if(typeof t!="object")throw new vo(t);if(!("BYTES_PER_ELEMENT"in t))throw new vo(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new vo(t)}}function N3(t){return t instanceof Uint8Array?t:typeof t=="string"?U3(t):C3(t)}function C3(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function U3(t,e={}){const{size:n}=e;let r=t;n&&(Oc(t,n),r=$c(t,n));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=od(i.charCodeAt(c++)),l=od(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new be(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function F3(t,e={}){const{size:n}=e,r=P3.encode(t);return typeof n=="number"?(w3(r,n),L3(r,n)):r}function L3(t,e){return m3(t,{dir:"right",size:e})}function fd(t){return t.length}function k3(t){try{return R3(t),!0}catch{return!1}}class vo extends be{constructor(e){super(`Value \`${typeof e=="object"?Ac(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class q3 extends be{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class M3 extends be{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function hd(t,e={}){const{as:n=typeof t=="string"?"Hex":"Bytes"}=e,r=o3(N3(t));return n==="Bytes"?r:Ki(r)}class j3 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Tc={checksum:new j3(8192)}.checksum;function dd(t,e={}){const{compressed:n}=e,{prefix:r,x:i,y:s}=t;if(n===!1||typeof i=="bigint"&&typeof s=="bigint"){if(r!==4)throw new gd({prefix:r,cause:new W3});return}if(n===!0||typeof i=="bigint"&&typeof s>"u"){if(r!==3&&r!==2)throw new gd({prefix:r,cause:new G3});return}throw new K3({publicKey:t})}function z3(t){const e=(()=>{if(B3(t))return pd(t);if(k3(t))return V3(t);const{prefix:n,x:r,y:i}=t;return typeof r=="bigint"&&typeof i=="bigint"?{prefix:n??4,x:r,y:i}:{prefix:n,x:r}})();return dd(e),e}function V3(t){return pd(Ki(t))}function pd(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new Z3({publicKey:t});if(t.length===130){const r=BigInt(_n(t,0,32)),i=BigInt(_n(t,32,64));return{prefix:4,x:r,y:i}}if(t.length===132){const r=Number(_n(t,0,1)),i=BigInt(_n(t,1,33)),s=BigInt(_n(t,33,65));return{prefix:r,x:i,y:s}}const e=Number(_n(t,0,1)),n=BigInt(_n(t,1,33));return{prefix:e,x:n}}function H3(t,e={}){dd(t);const{prefix:n,x:r,y:i}=t,{includePrefix:s=!0}=e;return Bc(s?wo(n,{size:1}):"0x",wo(r,{size:32}),typeof i=="bigint"?wo(i,{size:32}):"0x")}class K3 extends be{constructor({publicKey:e}){super(`Value \`${Ac(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class gd extends be{constructor({prefix:e,cause:n}){super(`Prefix "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class G3 extends be{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class W3 extends be{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class Z3 extends be{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Sn(Dc(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}const Y3=/^0x[a-fA-F0-9]{40}$/;function Pc(t,e={}){const{strict:n=!0}=e;if(!Y3.test(t))throw new yd({address:t,cause:new Q3});if(n){if(t.toLowerCase()===t)return;if(bd(t)!==t)throw new yd({address:t,cause:new e8})}}function bd(t){if(Tc.has(t))return Tc.get(t);Pc(t,{strict:!1});const e=t.substring(2).toLowerCase(),n=hd(F3(e),{as:"Bytes"}),r=e.split("");for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&r[s]&&(r[s]=r[s].toUpperCase()),(n[s>>1]&15)>=8&&r[s+1]&&(r[s+1]=r[s+1].toUpperCase());const i=`0x${r.join("")}`;return Tc.set(t,i),i}function X3(t,e={}){const{checksum:n=!1}=e;return Pc(t),n?bd(t):t}function J3(t,e={}){const n=hd(`0x${H3(t).slice(4)}`).substring(26);return X3(`0x${n}`,e)}class yd extends be{constructor({address:e,cause:n}){super(`Address "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class Q3 extends be{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class e8 extends be{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const t8=/^(.*)\[([0-9]*)\]$/,n8=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,r8=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Rc(t,e){if(t.length!==e.length)throw new s8({expectedLength:t.length,givenLength:e.length});const n=[];for(let r=0;r<t.length;r++){const i=t[r],s=e[r];n.push(Rc.encode(i,s))}return Bc(...n)}(function(t){function e(n,r,i=!1){if(n==="address"){const c=r;return Pc(c),mo(c.toLowerCase(),i?32:0)}if(n==="string")return A3(r);if(n==="bytes")return r;if(n==="bool")return mo(O3(r),i?32:1);const s=n.match(r8);if(s){const[c,u,l="256"]=s,h=Number.parseInt(l,10)/8;return wo(r,{size:i?32:h,signed:u==="int"})}const o=n.match(n8);if(o){const[c,u]=o;if(Number.parseInt(u,10)!==(r.length-2)/2)throw new i8({expectedSize:Number.parseInt(u,10),value:r});return $c(r,i?32:0)}const a=n.match(t8);if(a&&Array.isArray(r)){const[c,u]=a,l=[];for(let h=0;h<r.length;h++)l.push(e(u,r[h],!0));return l.length===0?"0x":Bc(...l)}throw new o8(n)}t.encode=e})(Rc||(Rc={}));class i8 extends be{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${Sn(n)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class s8 extends be{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${n}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class o8 extends be{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class wd extends wc{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Ch(e);const r=co(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Hn(s)}update(e){return oi(this),this.iHash.update(e),this}digestInto(e){oi(this),bn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Nc=(t,e,n)=>new wd(t,e).update(n).digest();Nc.create=(t,e)=>new wd(t,e);const pt=BigInt(0),rt=BigInt(1),Pr=BigInt(2),a8=BigInt(3),md=BigInt(4),vd=BigInt(5),Ed=BigInt(8);function it(t,e){const n=t%e;return n>=pt?n:e+n}function Pt(t,e,n){let r=t;for(;e-- >pt;)r*=r,r%=n;return r}function Cc(t,e){if(t===pt)throw new Error("invert: expected non-zero number");if(e<=pt)throw new Error("invert: expected positive modulus, got "+e);let n=it(t,e),r=e,i=pt,s=rt;for(;n!==pt;){const a=r/n,c=r%n,u=i-s*a;r=n,n=c,i=s,s=u}if(r!==rt)throw new Error("invert: does not exist");return it(i,e)}function xd(t,e){const n=(t.ORDER+rt)/md,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function c8(t,e){const n=(t.ORDER-vd)/Ed,r=t.mul(e,Pr),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Pr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function u8(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-rt,n=0;for(;e%Pr===pt;)e/=Pr,n++;let r=Pr;const i=Yn(t);for(;xo(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return xd;let s=i.pow(r,e);const o=(e+rt)/Pr;return function(c,u){if(c.is0(u))return u;if(xo(c,u)!==1)throw new Error("Cannot find square root");let l=n,h=c.mul(c.ONE,s),d=c.pow(u,e),f=c.pow(u,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let p=1,y=c.sqr(d);for(;!c.eql(y,c.ONE);)if(p++,y=c.sqr(y),p===l)throw new Error("Cannot find square root");const m=rt<<BigInt(l-p-1),A=c.pow(h,m);l=p,h=c.sqr(A),d=c.mul(d,h),f=c.mul(f,A)}return f}}function l8(t){return t%md===a8?xd:t%Ed===vd?c8:u8(t)}const f8=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function _d(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=f8.reduce((r,i)=>(r[i]="function",r),e);return Hi(t,n)}function Eo(t,e,n){if(n<pt)throw new Error("invalid exponent, negatives unsupported");if(n===pt)return t.ONE;if(n===rt)return e;let r=t.ONE,i=e;for(;n>pt;)n&rt&&(r=t.mul(r,i)),i=t.sqr(i),n>>=rt;return r}function Rr(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function xo(t,e){const n=(t.ORDER-rt)/Pr,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Sd(t,e){e!==void 0&&si(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Yn(t,e,n=!1,r={}){if(t<=pt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Sd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:Tr(i),ZERO:pt,ONE:rt,create:c=>it(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return pt<=c&&c<t},is0:c=>c===pt,isOdd:c=>(c&rt)===rt,neg:c=>it(-c,t),eql:(c,u)=>c===u,sqr:c=>it(c*c,t),add:(c,u)=>it(c+u,t),sub:(c,u)=>it(c-u,t),mul:(c,u)=>it(c*u,t),pow:(c,u)=>Eo(a,c,u),div:(c,u)=>it(c*Cc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Cc(c,t),sqrt:r.sqrt||(c=>(o||(o=l8(t)),o(a,c))),toBytes:c=>n?rd(c,s):De(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?nd(c):nt(c)},invertBatch:c=>Rr(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function Id(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Uc(t){const e=Id(t);return e+Math.ceil(e/2)}function Od(t,e,n=!1){const r=t.length,i=Id(e),s=Uc(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?nd(t):nt(t),a=it(o,e-rt)+rt;return n?rd(a,i):De(a,i)}const Ad=BigInt(0),Fc=BigInt(1);function Lc(t,e){const n=e.negate();return t?n:e}function Bd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function kc(t,e){Bd(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Tr(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function Dd(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Fc);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:u}}function h8(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function d8(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const qc=new WeakMap,$d=new WeakMap;function Mc(t){return $d.get(t)||1}function p8(t,e){return{constTimeNegate:Lc,hasPrecomputes(n){return Mc(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>Ad;)r&Fc&&(i=i.add(s)),s=s.double(),r>>=Fc;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=kc(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){let s=t.ZERO,o=t.BASE;const a=kc(n,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:p}=Dd(i,c,a);i=u,h?o=o.add(Lc(f,r[p])):s=s.add(Lc(d,r[l]))}return{p:s,f:o}},wNAFUnsafe(n,r,i,s=t.ZERO){const o=kc(n,e);for(let a=0;a<o.windows&&i!==Ad;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=Dd(i,a,o);if(i=c,!l){const d=r[u];s=s.add(h?d.negate():d)}}return s},getPrecomputes(n,r,i){let s=qc.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&qc.set(r,i(s))),s},wNAFCached(n,r,i){const s=Mc(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Mc(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Bd(r,e),$d.set(n,r),qc.delete(n)}}}function g8(t,e,n,r){h8(n,t),d8(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Vi(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Tr(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){l.fill(o);for(let y=0;y<s;y++){const m=r[y],A=Number(m>>BigInt(f)&u);l[A]=l[A].add(n[y])}let p=o;for(let y=l.length-1,m=o;y>0;y--)m=m.add(l[y]),p=p.add(m);if(d=d.add(p),f!==0)for(let y=0;y<c;y++)d=d.double()}return d}function Td(t){return _d(t.Fp),Hi(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Sd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Pd(t){t.lowS!==void 0&&zi("lowS",t.lowS),t.prehash!==void 0&&zi("prehash",t.prehash)}function b8(t){const e=Td(t);Hi(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class y8 extends Error{constructor(e=""){super(e)}}const In={Err:y8,_tlv:{encode:(t,e)=>{const{Err:n}=In;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=bo(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?bo(i.length/2|128):"";return bo(t)+s+i+e},decode(t,e){const{Err:n}=In;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=In;if(t<Vt)throw new e("integer: negative integers are not allowed");let n=bo(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=In;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return nt(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=In,i=We("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=In,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}};function jc(t,e){return $r(De(t,e))}const Vt=BigInt(0),ge=BigInt(1),Xn=BigInt(2),Gi=BigInt(3),zc=BigInt(4);function Vc(t){const e=b8(t),{Fp:n}=e,r=Yn(e.n,e.nBitLength),i=e.toBytes||((_,x,T)=>{const R=x.toAffine();return Se(Uint8Array.from([4]),n.toBytes(R.x),n.toBytes(R.y))}),s=e.fromBytes||(_=>{const x=_.subarray(1),T=n.fromBytes(x.subarray(0,n.BYTES)),R=n.fromBytes(x.subarray(n.BYTES,2*n.BYTES));return{x:T,y:R}});function o(_){const{a:x,b:T}=e,R=n.sqr(_),F=n.mul(R,_);return n.add(n.add(F,n.mul(_,x)),T)}function a(_,x){const T=n.sqr(x),R=o(_);return n.eql(T,R)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=n.mul(n.pow(e.a,Gi),zc),u=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(c,u)))throw new Error("bad curve params: a or b");function l(_){return _c(_,ge,e.n)}function h(_){const{allowedPrivateKeyLengths:x,nByteLength:T,wrapPrivateKey:R,n:F}=e;if(x&&typeof _!="bigint"){if(ji(_)&&(_=$r(_)),typeof _!="string"||!x.includes(_.length))throw new Error("invalid private key");_=_.padStart(T*2,"0")}let U;try{U=typeof _=="bigint"?_:nt(We("private key",_,T))}catch{throw new Error("invalid private key, expected hex or "+T+" bytes, got "+typeof _)}return R&&(U=it(U,F)),fi("private key",U,ge,F),U}function d(_){if(!(_ instanceof y))throw new Error("ProjectivePoint expected")}const f=Ic((_,x)=>{const{px:T,py:R,pz:F}=_;if(n.eql(F,n.ONE))return{x:T,y:R};const U=_.is0();x==null&&(x=U?n.ONE:n.inv(F));const D=n.mul(T,x),j=n.mul(R,x),M=n.mul(F,x);if(U)return{x:n.ZERO,y:n.ZERO};if(!n.eql(M,n.ONE))throw new Error("invZ was invalid");return{x:D,y:j}}),p=Ic(_=>{if(_.is0()){if(e.allowInfinityPoint&&!n.is0(_.py))return;throw new Error("bad point: ZERO")}const{x,y:T}=_.toAffine();if(!n.isValid(x)||!n.isValid(T))throw new Error("bad point: x or y not FE");if(!a(x,T))throw new Error("bad point: equation left != right");if(!_.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class y{constructor(x,T,R){if(x==null||!n.isValid(x))throw new Error("x required");if(T==null||!n.isValid(T)||n.is0(T))throw new Error("y required");if(R==null||!n.isValid(R))throw new Error("z required");this.px=x,this.py=T,this.pz=R,Object.freeze(this)}static fromAffine(x){const{x:T,y:R}=x||{};if(!x||!n.isValid(T)||!n.isValid(R))throw new Error("invalid affine point");if(x instanceof y)throw new Error("projective point not allowed");const F=U=>n.eql(U,n.ZERO);return F(T)&&F(R)?y.ZERO:new y(T,R,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const T=Rr(n,x.map(R=>R.pz));return x.map((R,F)=>R.toAffine(T[F])).map(y.fromAffine)}static fromHex(x){const T=y.fromAffine(s(We("pointHex",x)));return T.assertValidity(),T}static fromPrivateKey(x){return y.BASE.multiply(h(x))}static msm(x,T){return g8(y,r,x,T)}_setWindowSize(x){$.setWindowSize(this,x)}assertValidity(){p(this)}hasEvenY(){const{y:x}=this.toAffine();if(n.isOdd)return!n.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){d(x);const{px:T,py:R,pz:F}=this,{px:U,py:D,pz:j}=x,M=n.eql(n.mul(T,j),n.mul(U,F)),E=n.eql(n.mul(R,j),n.mul(D,F));return M&&E}negate(){return new y(this.px,n.neg(this.py),this.pz)}double(){const{a:x,b:T}=e,R=n.mul(T,Gi),{px:F,py:U,pz:D}=this;let j=n.ZERO,M=n.ZERO,E=n.ZERO,b=n.mul(F,F),v=n.mul(U,U),g=n.mul(D,D),w=n.mul(F,U);return w=n.add(w,w),E=n.mul(F,D),E=n.add(E,E),j=n.mul(x,E),M=n.mul(R,g),M=n.add(j,M),j=n.sub(v,M),M=n.add(v,M),M=n.mul(j,M),j=n.mul(w,j),E=n.mul(R,E),g=n.mul(x,g),w=n.sub(b,g),w=n.mul(x,w),w=n.add(w,E),E=n.add(b,b),b=n.add(E,b),b=n.add(b,g),b=n.mul(b,w),M=n.add(M,b),g=n.mul(U,D),g=n.add(g,g),b=n.mul(g,w),j=n.sub(j,b),E=n.mul(g,v),E=n.add(E,E),E=n.add(E,E),new y(j,M,E)}add(x){d(x);const{px:T,py:R,pz:F}=this,{px:U,py:D,pz:j}=x;let M=n.ZERO,E=n.ZERO,b=n.ZERO;const v=e.a,g=n.mul(e.b,Gi);let w=n.mul(T,U),S=n.mul(R,D),O=n.mul(F,j),I=n.add(T,R),B=n.add(U,D);I=n.mul(I,B),B=n.add(w,S),I=n.sub(I,B),B=n.add(T,F);let P=n.add(U,j);return B=n.mul(B,P),P=n.add(w,O),B=n.sub(B,P),P=n.add(R,F),M=n.add(D,j),P=n.mul(P,M),M=n.add(S,O),P=n.sub(P,M),b=n.mul(v,B),M=n.mul(g,O),b=n.add(M,b),M=n.sub(S,b),b=n.add(S,b),E=n.mul(M,b),S=n.add(w,w),S=n.add(S,w),O=n.mul(v,O),B=n.mul(g,B),S=n.add(S,O),O=n.sub(w,O),O=n.mul(v,O),B=n.add(B,O),w=n.mul(S,B),E=n.add(E,w),w=n.mul(P,B),M=n.mul(I,M),M=n.sub(M,w),w=n.mul(I,S),b=n.mul(P,b),b=n.add(b,w),new y(M,E,b)}subtract(x){return this.add(x.negate())}is0(){return this.equals(y.ZERO)}wNAF(x){return $.wNAFCached(this,x,y.normalizeZ)}multiplyUnsafe(x){const{endo:T,n:R}=e;fi("scalar",x,Vt,R);const F=y.ZERO;if(x===Vt)return F;if(this.is0()||x===ge)return this;if(!T||$.hasPrecomputes(this))return $.wNAFCachedUnsafe(this,x,y.normalizeZ);let{k1neg:U,k1:D,k2neg:j,k2:M}=T.splitScalar(x),E=F,b=F,v=this;for(;D>Vt||M>Vt;)D&ge&&(E=E.add(v)),M&ge&&(b=b.add(v)),v=v.double(),D>>=ge,M>>=ge;return U&&(E=E.negate()),j&&(b=b.negate()),b=new y(n.mul(b.px,T.beta),b.py,b.pz),E.add(b)}multiply(x){const{endo:T,n:R}=e;fi("scalar",x,ge,R);let F,U;if(T){const{k1neg:D,k1:j,k2neg:M,k2:E}=T.splitScalar(x);let{p:b,f:v}=this.wNAF(j),{p:g,f:w}=this.wNAF(E);b=$.constTimeNegate(D,b),g=$.constTimeNegate(M,g),g=new y(n.mul(g.px,T.beta),g.py,g.pz),F=b.add(g),U=v.add(w)}else{const{p:D,f:j}=this.wNAF(x);F=D,U=j}return y.normalizeZ([F,U])[0]}multiplyAndAddUnsafe(x,T,R){const F=y.BASE,U=(j,M)=>M===Vt||M===ge||!j.equals(F)?j.multiplyUnsafe(M):j.multiply(M),D=U(this,T).add(U(x,R));return D.is0()?void 0:D}toAffine(x){return f(this,x)}isTorsionFree(){const{h:x,isTorsionFree:T}=e;if(x===ge)return!0;if(T)return T(y,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:T}=e;return x===ge?this:T?T(y,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return zi("isCompressed",x),this.assertValidity(),i(y,this,x)}toHex(x=!0){return zi("isCompressed",x),$r(this.toRawBytes(x))}}y.BASE=new y(e.Gx,e.Gy,n.ONE),y.ZERO=new y(n.ZERO,n.ONE,n.ZERO);const{endo:m,nBitLength:A}=e,$=p8(y,m?Math.ceil(A/2):A);return{CURVE:e,ProjectivePoint:y,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function w8(t){const e=Td(t);return Hi(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function m8(t){const e=w8(t),{Fp:n,n:r,nByteLength:i,nBitLength:s}=e,o=n.BYTES+1,a=2*n.BYTES+1;function c(g){return it(g,r)}function u(g){return Cc(g,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:f}=Vc({...e,toBytes(g,w,S){const O=w.toAffine(),I=n.toBytes(O.x),B=Se;return zi("isCompressed",S),S?B(Uint8Array.from([w.hasEvenY()?2:3]),I):B(Uint8Array.from([4]),I,n.toBytes(O.y))},fromBytes(g){const w=g.length,S=g[0],O=g.subarray(1);if(w===o&&(S===2||S===3)){const I=nt(O);if(!_c(I,ge,n.ORDER))throw new Error("Point is not on curve");const B=d(I);let P;try{P=n.sqrt(B)}catch(k){const N=k instanceof Error?": "+k.message:"";throw new Error("Point is not on curve"+N)}const L=(P&ge)===ge;return(S&1)===1!==L&&(P=n.neg(P)),{x:I,y:P}}else if(w===a&&S===4){const I=n.fromBytes(O.subarray(0,n.BYTES)),B=n.fromBytes(O.subarray(n.BYTES,2*n.BYTES));return{x:I,y:B}}else{const I=o,B=a;throw new Error("invalid Point, expected length of "+I+", or uncompressed "+B+", got "+w)}}});function p(g){const w=r>>ge;return g>w}function y(g){return p(g)?c(-g):g}const m=(g,w,S)=>nt(g.slice(w,S));class A{constructor(w,S,O){fi("r",w,ge,r),fi("s",S,ge,r),this.r=w,this.s=S,O!=null&&(this.recovery=O),Object.freeze(this)}static fromCompact(w){const S=i;return w=We("compactSignature",w,S*2),new A(m(w,0,S),m(w,S,2*S))}static fromDER(w){const{r:S,s:O}=In.toSig(We("DER",w));return new A(S,O)}assertValidity(){}addRecoveryBit(w){return new A(this.r,this.s,w)}recoverPublicKey(w){const{r:S,s:O,recovery:I}=this,B=F(We("msgHash",w));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const P=I===2||I===3?S+e.n:S;if(P>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(I&1)===0?"02":"03",C=l.fromHex(L+jc(P,n.BYTES)),k=u(P),N=c(-B*k),q=c(O*k),z=l.BASE.multiplyAndAddUnsafe(C,N,q);if(!z)throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new A(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return yo(this.toDERHex())}toDERHex(){return In.hexFromSig(this)}toCompactRawBytes(){return yo(this.toCompactHex())}toCompactHex(){const w=i;return jc(this.r,w)+jc(this.s,w)}}const $={isValidPrivateKey(g){try{return h(g),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const g=Uc(e.n);return Od(e.randomBytes(g),e.n)},precompute(g=8,w=l.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}};function _(g,w=!0){return l.fromPrivateKey(g).toRawBytes(w)}function x(g){if(typeof g=="bigint")return!1;if(g instanceof l)return!0;const S=We("key",g).length,O=n.BYTES,I=O+1,B=2*O+1;if(!(e.allowedPrivateKeyLengths||i===I))return S===I||S===B}function T(g,w,S=!0){if(x(g)===!0)throw new Error("first arg must be private key");if(x(w)===!1)throw new Error("second arg must be public key");return l.fromHex(w).multiply(h(g)).toRawBytes(S)}const R=e.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=nt(g),S=g.length*8-s;return S>0?w>>BigInt(S):w},F=e.bits2int_modN||function(g){return c(R(g))},U=Tr(s);function D(g){return fi("num < 2^"+s,g,Vt,U),De(g,i)}function j(g,w,S=M){if(["recovered","canonical"].some(H=>H in S))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:I}=e;let{lowS:B,prehash:P,extraEntropy:L}=S;B==null&&(B=!0),g=We("msgHash",g),Pd(S),P&&(g=We("prehashed msgHash",O(g)));const C=F(g),k=h(w),N=[D(k),D(C)];if(L!=null&&L!==!1){const H=L===!0?I(n.BYTES):L;N.push(We("extraEntropy",H))}const q=Se(...N),z=C;function W(H){const Z=R(H);if(!f(Z))return;const Q=u(Z),ee=l.BASE.multiply(Z).toAffine(),se=c(ee.x);if(se===Vt)return;const he=c(Q*c(z+se*k));if(he===Vt)return;let Ee=(ee.x===se?0:2)|Number(ee.y&ge),qn=he;return B&&p(he)&&(qn=y(he),Ee^=1),new A(se,qn,Ee)}return{seed:q,k2sig:W}}const M={lowS:e.lowS,prehash:!1},E={lowS:e.lowS,prehash:!1};function b(g,w,S=M){const{seed:O,k2sig:I}=j(g,w,S),B=e;return b3(B.hash.outputLen,B.nByteLength,B.hmac)(O,I)}l.BASE._setWindowSize(8);function v(g,w,S,O=E){const I=g;w=We("msgHash",w),S=We("publicKey",S);const{lowS:B,prehash:P,format:L}=O;if(Pd(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");const C=typeof I=="string"||ji(I),k=!C&&!L&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!C&&!k)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let N,q;try{if(k&&(N=new A(I.r,I.s)),C){try{L!=="compact"&&(N=A.fromDER(I))}catch(Ee){if(!(Ee instanceof In.Err))throw Ee}!N&&L!=="der"&&(N=A.fromCompact(I))}q=l.fromHex(S)}catch{return!1}if(!N||B&&N.hasHighS())return!1;P&&(w=e.hash(w));const{r:z,s:W}=N,H=F(w),Z=u(W),Q=c(H*Z),ee=c(z*Z),se=l.BASE.multiplyAndAddUnsafe(q,Q,ee)?.toAffine();return se?c(se.x)===z:!1}return{CURVE:e,getPublicKey:_,getSharedSecret:T,sign:b,verify:v,ProjectivePoint:l,Signature:A,utils:$}}function v8(t,e){const n=t.ORDER;let r=Vt;for(let p=n-ge;p%Xn===Vt;p/=Xn)r+=ge;const i=r,s=Xn<<i-ge-ge,o=s*Xn,a=(n-ge)/o,c=(a-ge)/Xn,u=o-ge,l=s,h=t.pow(e,a),d=t.pow(e,(a+ge)/Xn);let f=(p,y)=>{let m=h,A=t.pow(y,u),$=t.sqr(A);$=t.mul($,y);let _=t.mul(p,$);_=t.pow(_,c),_=t.mul(_,A),A=t.mul(_,y),$=t.mul(_,p);let x=t.mul($,A);_=t.pow(x,l);let T=t.eql(_,t.ONE);A=t.mul($,d),_=t.mul(x,m),$=t.cmov(A,$,T),x=t.cmov(_,x,T);for(let R=i;R>ge;R--){let F=R-Xn;F=Xn<<F-ge;let U=t.pow(x,F);const D=t.eql(U,t.ONE);A=t.mul($,m),m=t.mul(m,m),U=t.mul(x,m),$=t.cmov(A,$,D),x=t.cmov(U,x,D)}return{isValid:T,value:$}};if(t.ORDER%zc===Gi){const p=(t.ORDER-Gi)/zc,y=t.sqrt(t.neg(e));f=(m,A)=>{let $=t.sqr(A);const _=t.mul(m,A);$=t.mul($,_);let x=t.pow($,p);x=t.mul(x,_);const T=t.mul(x,y),R=t.mul(t.sqr(x),A),F=t.eql(R,m);let U=t.cmov(T,x,F);return{isValid:F,value:U}}}return f}function Rd(t,e){if(_d(t),!t.isValid(e.A)||!t.isValid(e.B)||!t.isValid(e.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const n=v8(t,e.Z);if(!t.isOdd)throw new Error("Fp.isOdd is not implemented!");return r=>{let i,s,o,a,c,u,l,h;i=t.sqr(r),i=t.mul(i,e.Z),s=t.sqr(i),s=t.add(s,i),o=t.add(s,t.ONE),o=t.mul(o,e.B),a=t.cmov(e.Z,t.neg(s),!t.eql(s,t.ZERO)),a=t.mul(a,e.A),s=t.sqr(o),u=t.sqr(a),c=t.mul(u,e.A),s=t.add(s,c),s=t.mul(s,o),u=t.mul(u,a),c=t.mul(u,e.B),s=t.add(s,c),l=t.mul(i,o);const{isValid:d,value:f}=n(s,u);h=t.mul(i,r),h=t.mul(h,f),l=t.cmov(l,o,d),h=t.cmov(h,f,d);const p=t.isOdd(r)===t.isOdd(h);h=t.cmov(t.neg(h),h,p);const y=Rr(t,[a],!0)[0];return l=t.mul(l,y),{x:l,y:h}}}function E8(t){return{hash:t,hmac:(e,...n)=>Nc(t,e,wn(...n)),randomBytes:lo}}function _o(t,e){const n=r=>m8({...t,...E8(r)});return{...n(e),create:n}}const x8=nt;function Jn(t,e){if(Wi(t),Wi(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);const n=Array.from({length:e}).fill(0);for(let r=e-1;r>=0;r--)n[r]=t&255,t>>>=8;return new Uint8Array(n)}function _8(t,e){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t[r]^e[r];return n}function Wi(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function S8(t,e,n,r){Zn(t),Zn(e),Wi(n),e.length>255&&(e=r(Se(Ec("H2C-OVERSIZE-DST-"),e)));const{outputLen:i,blockLen:s}=r,o=Math.ceil(n/i);if(n>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=Se(e,Jn(e.length,1)),c=Jn(0,s),u=Jn(n,2),l=new Array(o),h=r(Se(c,t,u,Jn(0,1),a));l[0]=r(Se(h,Jn(1,1),a));for(let f=1;f<=o;f++){const p=[_8(h,l[f-1]),Jn(f+1,1),a];l[f]=r(Se(...p))}return Se(...l).slice(0,n)}function I8(t,e,n,r,i){if(Zn(t),Zn(e),Wi(n),e.length>255){const s=Math.ceil(2*r/8);e=i.create({dkLen:s}).update(Ec("H2C-OVERSIZE-DST-")).update(e).digest()}if(n>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(t).update(Jn(n,2)).update(e).update(Jn(e.length,1)).digest()}function Nd(t,e,n){Hi(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:s,hash:o,expand:a,DST:c}=n;Zn(t),Wi(e);const u=typeof c=="string"?Ec(c):c,l=r.toString(2).length,h=Math.ceil((l+i)/8),d=e*s*h;let f;if(a==="xmd")f=S8(t,u,d,o);else if(a==="xof")f=I8(t,u,d,i,o);else if(a==="_internal_pass")f=t;else throw new Error('expand must be "xmd" or "xof"');const p=new Array(e);for(let y=0;y<e;y++){const m=new Array(s);for(let A=0;A<s;A++){const $=h*(A+y*s),_=f.subarray($,$+h);m[A]=it(x8(_),r)}p[y]=m}return p}function Cd(t,e){const n=e.map(r=>Array.from(r).reverse());return(r,i)=>{const[s,o,a,c]=n.map(h=>h.reduce((d,f)=>t.add(t.mul(d,r),f))),[u,l]=Rr(t,[o,c],!0);return r=t.mul(s,u),i=t.mul(i,t.mul(a,l)),{x:r,y:i}}}function Ud(t,e,n){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function r(s){return t.fromAffine(e(s))}function i(s){const o=s.clearCofactor();return o.equals(t.ZERO)?t.ZERO:(o.assertValidity(),o)}return{defaults:n,hashToCurve(s,o){const a=Nd(s,2,{...n,DST:n.DST,...o}),c=r(a[0]),u=r(a[1]);return i(c.add(u))},encodeToCurve(s,o){const a=Nd(s,1,{...n,DST:n.encodeDST,...o});return i(r(a[0]))},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(const o of s)if(typeof o!="bigint")throw new Error("expected array of bigints");return i(r(s))}}}const Fd=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ld=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),O8=BigInt(0),A8=BigInt(1),Hc=BigInt(2),kd=(t,e)=>(t+e/Hc)/e;function B8(t){const e=Fd,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=Pt(l,n,e)*l%e,d=Pt(h,n,e)*l%e,f=Pt(d,Hc,e)*u%e,p=Pt(f,i,e)*f%e,y=Pt(p,s,e)*p%e,m=Pt(y,a,e)*y%e,A=Pt(m,c,e)*m%e,$=Pt(A,a,e)*y%e,_=Pt($,n,e)*l%e,x=Pt(_,o,e)*p%e,T=Pt(x,r,e)*u%e,R=Pt(T,Hc,e);if(!Kc.eql(Kc.sqr(R),t))throw new Error("Cannot find square root");return R}const Kc=Yn(Fd,void 0,void 0,{sqrt:B8}),D8=_o({a:O8,b:BigInt(7),Fp:Kc,n:Ld,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Ld,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-A8*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=kd(s*t,e),c=kd(-r*t,e);let u=it(t-a*n-c*i,e),l=it(-a*r-c*s,e);const h=u>o,d=l>o;if(h&&(u=e-u),d&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}}},li);function $8(t){if(t.length!==130&&t.length!==132)throw new P8({signature:t});const e=BigInt(_n(t,0,32)),n=BigInt(_n(t,32,64)),r=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return T8(i)}catch{throw new R8({value:i})}})();return typeof r>"u"?{r:e,s:n}:{r:e,s:n,yParity:r}}function T8(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new N8({value:t})}class P8 extends be{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Sn(Dc(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class R8 extends be{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class N8 extends be{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}Object.freeze({1:0n,2:1n,3:2n,4:3n,5:4n,6:5n,7:6n,8:7n,9:8n,A:9n,B:10n,C:11n,D:12n,E:13n,F:14n,G:15n,H:16n,J:17n,K:18n,L:19n,M:20n,N:21n,P:22n,Q:23n,R:24n,S:25n,T:26n,U:27n,V:28n,W:29n,X:30n,Y:31n,Z:32n,a:33n,b:34n,c:35n,d:36n,e:37n,f:38n,g:39n,h:40n,i:41n,j:42n,k:43n,m:44n,n:45n,o:46n,p:47n,q:48n,r:49n,s:50n,t:51n,u:52n,v:53n,w:54n,x:55n,y:56n,z:57n}),Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((t,e)=>[e,t.charCodeAt(0)]),{...Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((t,e)=>[t.charCodeAt(0),e]))},mn.slice();const C8=BigInt(0),So=BigInt(1),qd=BigInt(2),hi=BigInt(3);function U8(t){const e=[];for(;t>So;t>>=So)(t&So)===C8?e.unshift(0):(t&hi)===hi?(e.unshift(-1),t+=So):e.unshift(1);return e}function F8(t){const{Fp:e,Fr:n,Fp2:r,Fp6:i,Fp12:s}=t.fields,o=t.params.xNegative,a=t.params.twistType,c=Vc({n:n.ORDER,...t.G1}),u=Object.assign(c,Ud(c.ProjectivePoint,t.G1.mapToCurve,{...t.htfDefaults,...t.G1.htfDefaults})),l=Vc({n:n.ORDER,...t.G2}),h=Object.assign(l,Ud(l.ProjectivePoint,t.G2.mapToCurve,{...t.htfDefaults,...t.G2.htfDefaults}));let d;if(a==="multiplicative")d=(C,k,N,q,z,W)=>s.mul014(q,C,r.mul(k,z),r.mul(N,W));else if(a==="divisive")d=(C,k,N,q,z,W)=>s.mul034(q,r.mul(N,W),r.mul(k,z),C);else throw new Error("bls: unknown twist type");const f=r.div(r.ONE,r.mul(r.ONE,qd));function p(C,k,N,q){const z=r.sqr(N),W=r.sqr(q),H=r.mulByB(r.mul(W,hi)),Z=r.mul(H,hi),Q=r.sub(r.sub(r.sqr(r.add(N,q)),W),z),ee=r.sub(H,z),se=r.mul(r.sqr(k),hi),he=r.neg(Q);return C.push([ee,se,he]),k=r.mul(r.mul(r.mul(r.sub(z,Z),k),N),f),N=r.sub(r.sqr(r.mul(r.add(z,Z),f)),r.mul(r.sqr(H),hi)),q=r.mul(z,Q),{Rx:k,Ry:N,Rz:q}}function y(C,k,N,q,z,W){const H=r.sub(N,r.mul(W,q)),Z=r.sub(k,r.mul(z,q)),Q=r.sub(r.mul(H,z),r.mul(Z,W)),ee=r.neg(H),se=Z;C.push([Q,ee,se]);const he=r.sqr(Z),Ee=r.mul(he,Z),qn=r.mul(he,k),Da=r.add(r.sub(Ee,r.mul(qn,qd)),r.mul(r.sqr(H),q));return k=r.mul(Z,Da),N=r.sub(r.mul(r.sub(qn,Da),H),r.mul(Ee,N)),q=r.mul(q,Ee),{Rx:k,Ry:N,Rz:q}}const m=U8(t.params.ateLoopSize),A=Ic(C=>{const k=C,{x:N,y:q}=k.toAffine(),z=N,W=q,H=r.neg(q);let Z=z,Q=W,ee=r.ONE;const se=[];for(const he of m){const Ee=[];({Rx:Z,Ry:Q,Rz:ee}=p(Ee,Z,Q,ee)),he&&({Rx:Z,Ry:Q,Rz:ee}=y(Ee,Z,Q,ee,z,he===-1?H:W)),se.push(Ee)}if(t.postPrecompute){const he=se[se.length-1];t.postPrecompute(Z,Q,ee,z,W,y.bind(null,he))}return se});function $(C,k=!1){let N=s.ONE;if(C.length){const q=C[0][0].length;for(let z=0;z<q;z++){N=s.sqr(N);for(const[W,H,Z]of C)for(const[Q,ee,se]of W[z])N=d(Q,ee,se,N,H,Z)}}return o&&(N=s.conjugate(N)),k?s.finalExponentiate(N):N}function _(C,k=!0){const N=[];u.ProjectivePoint.normalizeZ(C.map(({g1:q})=>q)),h.ProjectivePoint.normalizeZ(C.map(({g2:q})=>q));for(const{g1:q,g2:z}of C){if(q.equals(u.ProjectivePoint.ZERO)||z.equals(h.ProjectivePoint.ZERO))throw new Error("pairing is not available for ZERO point");q.assertValidity(),z.assertValidity();const W=q.toAffine();N.push([A(z),W.x,W.y])}return $(N,k)}function x(C,k,N=!0){return _([{g1:C,g2:k}],N)}const T={randomPrivateKey:()=>{const C=Uc(n.ORDER);return Od(t.randomBytes(C),n.ORDER)},calcPairingPrecomputes:A},{ShortSignature:R}=t.G1,{Signature:F}=t.G2;function U(C){return C instanceof u.ProjectivePoint?C:u.ProjectivePoint.fromHex(C)}function D(C,k){return C instanceof u.ProjectivePoint?C:u.hashToCurve(We("point",C),k)}function j(C){return C instanceof h.ProjectivePoint?C:F.fromHex(C)}function M(C,k){return C instanceof h.ProjectivePoint?C:h.hashToCurve(We("point",C),k)}function E(C){return u.ProjectivePoint.fromPrivateKey(C).toRawBytes(!0)}function b(C){return h.ProjectivePoint.fromPrivateKey(C).toRawBytes(!0)}function v(C,k,N){const q=M(C,N);q.assertValidity();const z=q.multiply(u.normPrivateKeyToScalar(k));return C instanceof h.ProjectivePoint?z:F.toRawBytes(z)}function g(C,k,N){const q=D(C,N);q.assertValidity();const z=q.multiply(u.normPrivateKeyToScalar(k));return C instanceof u.ProjectivePoint?z:R.toRawBytes(z)}function w(C,k,N,q){const z=U(N),W=M(k,q),H=u.ProjectivePoint.BASE,Z=j(C),Q=_([{g1:z.negate(),g2:W},{g1:H,g2:Z}]);return s.eql(Q,s.ONE)}function S(C,k,N,q){const z=j(N),W=D(k,q),H=h.ProjectivePoint.BASE,Z=U(C),Q=_([{g1:W,g2:z},{g1:Z,g2:H.negate()}]);return s.eql(Q,s.ONE)}function O(C){if(!Array.isArray(C)||C.length===0)throw new Error("expected non-empty array")}function I(C){O(C);const N=C.map(U).reduce((q,z)=>q.add(z),u.ProjectivePoint.ZERO);return C[0]instanceof u.ProjectivePoint?(N.assertValidity(),N):N.toRawBytes(!0)}function B(C){O(C);const N=C.map(j).reduce((q,z)=>q.add(z),h.ProjectivePoint.ZERO);return C[0]instanceof h.ProjectivePoint?(N.assertValidity(),N):F.toRawBytes(N)}function P(C){O(C);const N=C.map(U).reduce((q,z)=>q.add(z),u.ProjectivePoint.ZERO);return C[0]instanceof u.ProjectivePoint?(N.assertValidity(),N):R.toRawBytes(N)}function L(C,k,N,q){if(O(k),N.length!==k.length)throw new Error("amount of public keys and messages should be equal");const z=j(C),W=k.map(ee=>M(ee,q)),H=N.map(U),Z=new Map;for(let ee=0;ee<H.length;ee++){const se=H[ee],he=W[ee];let Ee=Z.get(he);Ee===void 0&&(Ee=[],Z.set(he,Ee)),Ee.push(se)}const Q=[];try{for(const[ee,se]of Z){const he=se.reduce((Ee,qn)=>Ee.add(qn));Q.push({g1:he,g2:ee})}return Q.push({g1:u.ProjectivePoint.BASE.negate(),g2:z}),s.eql(_(Q),s.ONE)}catch{return!1}}return u.ProjectivePoint.BASE._setWindowSize(4),{getPublicKey:E,getPublicKeyForShortSignatures:b,sign:v,signShortSignature:g,verify:w,verifyBatch:L,verifyShortSignature:S,aggregatePublicKeys:I,aggregateSignatures:B,aggregateShortSignatures:P,millerLoopBatch:$,pairing:x,pairingBatch:_,G1:u,G2:h,Signature:F,ShortSignature:R,fields:{Fr:n,Fp:e,Fp2:r,Fp6:i,Fp12:s},params:{ateLoopSize:t.params.ateLoopSize,r:t.params.r,G1b:t.G1.b,G2b:t.G2.b},utils:T}}const L8=BigInt(0),di=BigInt(1),On=BigInt(2),Md=BigInt(3);function Gc(t,e,n,r,i=1,s){const o=BigInt(s===void 0?r:s),a=n**BigInt(r),c=[];for(let u=0;u<i;u++){const l=BigInt(u+1),h=[];for(let d=0,f=di;d<r;d++){const p=(l*f-l)/o%a;h.push(t.pow(e,p)),f*=n}c.push(h)}return c}function k8(t,e,n){const r=e.pow(n,(t.ORDER-di)/Md),i=e.pow(n,(t.ORDER-di)/On);function s(d,f){const p=e.mul(e.frobeniusMap(d,1),r),y=e.mul(e.frobeniusMap(f,1),i);return[p,y]}const o=e.pow(n,(t.ORDER**On-di)/Md),a=e.pow(n,(t.ORDER**On-di)/On);if(!e.eql(a,e.neg(e.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(d,f){return[e.mul(d,o),e.neg(f)]}const u=d=>(f,p)=>{const y=p.toAffine(),m=d(y.x,y.y);return f.fromAffine({x:m[0],y:m[1]})},l=u(s),h=u(c);return{psi:s,psi2:c,G2psi:l,G2psi2:h,PSI_X:r,PSI_Y:i,PSI2_X:o,PSI2_Y:a}}function q8(t){const{ORDER:e}=t,n=Yn(e),r=n.create(t.NONRESIDUE||BigInt(-1)),i=n.div(n.ONE,On),s=Gc(n,r,n.ORDER,2)[0],o=({c0:E,c1:b},{c0:v,c1:g})=>({c0:n.add(E,v),c1:n.add(b,g)}),a=({c0:E,c1:b},{c0:v,c1:g})=>({c0:n.sub(E,v),c1:n.sub(b,g)}),c=({c0:E,c1:b},v)=>{if(typeof v=="bigint")return{c0:n.mul(E,v),c1:n.mul(b,v)};const{c0:g,c1:w}=v;let S=n.mul(E,g),O=n.mul(b,w);const I=n.sub(S,O),B=n.sub(n.mul(n.add(E,b),n.add(g,w)),n.add(S,O));return{c0:I,c1:B}},u=({c0:E,c1:b})=>{const v=n.add(E,b),g=n.sub(E,b),w=n.add(E,E);return{c0:n.mul(v,g),c1:n.mul(w,b)}},l=E=>{if(E.length!==2)throw new Error("invalid tuple");const b=E.map(v=>n.create(v));return{c0:b[0],c1:b[1]}},h=e*e,d=l(t.FP2_NONRESIDUE),f={ORDER:h,isLE:n.isLE,NONRESIDUE:d,BITS:Vi(h),BYTES:Math.ceil(Vi(h)/8),MASK:Tr(Vi(h)),ZERO:{c0:n.ZERO,c1:n.ZERO},ONE:{c0:n.ONE,c1:n.ZERO},create:E=>E,isValid:({c0:E,c1:b})=>typeof E=="bigint"&&typeof b=="bigint",is0:({c0:E,c1:b})=>n.is0(E)&&n.is0(b),eql:({c0:E,c1:b},{c0:v,c1:g})=>n.eql(E,v)&&n.eql(b,g),neg:({c0:E,c1:b})=>({c0:n.neg(E),c1:n.neg(b)}),pow:(E,b)=>Eo(f,E,b),invertBatch:E=>Rr(f,E),add:o,sub:a,mul:c,sqr:u,addN:o,subN:a,mulN:c,sqrN:u,div:(E,b)=>f.mul(E,typeof b=="bigint"?n.inv(n.create(b)):f.inv(b)),inv:({c0:E,c1:b})=>{const v=n.inv(n.create(E*E+b*b));return{c0:n.mul(v,n.create(E)),c1:n.mul(v,n.create(-b))}},sqrt:E=>{if(t.Fp2sqrt)return t.Fp2sqrt(E);const{c0:b,c1:v}=E;if(n.is0(v))return xo(n,b)===1?f.create({c0:n.sqrt(b),c1:n.ZERO}):f.create({c0:n.ZERO,c1:n.sqrt(n.div(b,r))});const g=n.sqrt(n.sub(n.sqr(b),n.mul(n.sqr(v),r)));let w=n.mul(n.add(g,b),i);xo(n,w)===-1&&(w=n.sub(w,g));const O=n.sqrt(w),I=f.create({c0:O,c1:n.div(n.mul(v,i),O)});if(!f.eql(f.sqr(I),E))throw new Error("Cannot find square root");const B=I,P=f.neg(B),{re:L,im:C}=f.reim(B),{re:k,im:N}=f.reim(P);return C>N||C===N&&L>k?B:P},isOdd:E=>{const{re:b,im:v}=f.reim(E),g=b%On,w=b===L8,S=v%On;return BigInt(g||w&&S)==di},fromBytes(E){if(E.length!==f.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:n.fromBytes(E.subarray(0,n.BYTES)),c1:n.fromBytes(E.subarray(n.BYTES))}},toBytes:({c0:E,c1:b})=>Se(n.toBytes(E),n.toBytes(b)),cmov:({c0:E,c1:b},{c0:v,c1:g},w)=>({c0:n.cmov(E,v,w),c1:n.cmov(b,g,w)}),reim:({c0:E,c1:b})=>({re:E,im:b}),mulByNonresidue:({c0:E,c1:b})=>f.mul({c0:E,c1:b},d),mulByB:t.Fp2mulByB,fromBigTuple:l,frobeniusMap:({c0:E,c1:b},v)=>({c0:E,c1:n.mul(b,s[v%2])})},p=({c0:E,c1:b,c2:v},{c0:g,c1:w,c2:S})=>({c0:f.add(E,g),c1:f.add(b,w),c2:f.add(v,S)}),y=({c0:E,c1:b,c2:v},{c0:g,c1:w,c2:S})=>({c0:f.sub(E,g),c1:f.sub(b,w),c2:f.sub(v,S)}),m=({c0:E,c1:b,c2:v},g)=>{if(typeof g=="bigint")return{c0:f.mul(E,g),c1:f.mul(b,g),c2:f.mul(v,g)};const{c0:w,c1:S,c2:O}=g,I=f.mul(E,w),B=f.mul(b,S),P=f.mul(v,O);return{c0:f.add(I,f.mulByNonresidue(f.sub(f.mul(f.add(b,v),f.add(S,O)),f.add(B,P)))),c1:f.add(f.sub(f.mul(f.add(E,b),f.add(w,S)),f.add(I,B)),f.mulByNonresidue(P)),c2:f.sub(f.add(B,f.mul(f.add(E,v),f.add(w,O))),f.add(I,P))}},A=({c0:E,c1:b,c2:v})=>{let g=f.sqr(E),w=f.mul(f.mul(E,b),On),S=f.mul(f.mul(b,v),On),O=f.sqr(v);return{c0:f.add(f.mulByNonresidue(S),g),c1:f.add(f.mulByNonresidue(O),w),c2:f.sub(f.sub(f.add(f.add(w,f.sqr(f.add(f.sub(E,b),v))),S),g),O)}},[$,_]=Gc(f,d,n.ORDER,6,2,3),x={ORDER:f.ORDER,isLE:f.isLE,BITS:3*f.BITS,BYTES:3*f.BYTES,MASK:Tr(3*f.BITS),ZERO:{c0:f.ZERO,c1:f.ZERO,c2:f.ZERO},ONE:{c0:f.ONE,c1:f.ZERO,c2:f.ZERO},create:E=>E,isValid:({c0:E,c1:b,c2:v})=>f.isValid(E)&&f.isValid(b)&&f.isValid(v),is0:({c0:E,c1:b,c2:v})=>f.is0(E)&&f.is0(b)&&f.is0(v),neg:({c0:E,c1:b,c2:v})=>({c0:f.neg(E),c1:f.neg(b),c2:f.neg(v)}),eql:({c0:E,c1:b,c2:v},{c0:g,c1:w,c2:S})=>f.eql(E,g)&&f.eql(b,w)&&f.eql(v,S),sqrt:sd,div:(E,b)=>x.mul(E,typeof b=="bigint"?n.inv(n.create(b)):x.inv(b)),pow:(E,b)=>Eo(x,E,b),invertBatch:E=>Rr(x,E),add:p,sub:y,mul:m,sqr:A,addN:p,subN:y,mulN:m,sqrN:A,inv:({c0:E,c1:b,c2:v})=>{let g=f.sub(f.sqr(E),f.mulByNonresidue(f.mul(v,b))),w=f.sub(f.mulByNonresidue(f.sqr(v)),f.mul(E,b)),S=f.sub(f.sqr(b),f.mul(E,v)),O=f.inv(f.add(f.mulByNonresidue(f.add(f.mul(v,w),f.mul(b,S))),f.mul(E,g)));return{c0:f.mul(O,g),c1:f.mul(O,w),c2:f.mul(O,S)}},fromBytes:E=>{if(E.length!==x.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:f.fromBytes(E.subarray(0,f.BYTES)),c1:f.fromBytes(E.subarray(f.BYTES,2*f.BYTES)),c2:f.fromBytes(E.subarray(2*f.BYTES))}},toBytes:({c0:E,c1:b,c2:v})=>Se(f.toBytes(E),f.toBytes(b),f.toBytes(v)),cmov:({c0:E,c1:b,c2:v},{c0:g,c1:w,c2:S},O)=>({c0:f.cmov(E,g,O),c1:f.cmov(b,w,O),c2:f.cmov(v,S,O)}),fromBigSix:E=>{if(!Array.isArray(E)||E.length!==6)throw new Error("invalid Fp6 usage");return{c0:f.fromBigTuple(E.slice(0,2)),c1:f.fromBigTuple(E.slice(2,4)),c2:f.fromBigTuple(E.slice(4,6))}},frobeniusMap:({c0:E,c1:b,c2:v},g)=>({c0:f.frobeniusMap(E,g),c1:f.mul(f.frobeniusMap(b,g),$[g%6]),c2:f.mul(f.frobeniusMap(v,g),_[g%6])}),mulByFp2:({c0:E,c1:b,c2:v},g)=>({c0:f.mul(E,g),c1:f.mul(b,g),c2:f.mul(v,g)}),mulByNonresidue:({c0:E,c1:b,c2:v})=>({c0:f.mulByNonresidue(v),c1:E,c2:b}),mul1:({c0:E,c1:b,c2:v},g)=>({c0:f.mulByNonresidue(f.mul(v,g)),c1:f.mul(E,g),c2:f.mul(b,g)}),mul01({c0:E,c1:b,c2:v},g,w){let S=f.mul(E,g),O=f.mul(b,w);return{c0:f.add(f.mulByNonresidue(f.sub(f.mul(f.add(b,v),w),O)),S),c1:f.sub(f.sub(f.mul(f.add(g,w),f.add(E,b)),S),O),c2:f.add(f.sub(f.mul(f.add(E,v),g),S),O)}}},T=Gc(f,d,n.ORDER,12,1,6)[0],R=({c0:E,c1:b},{c0:v,c1:g})=>({c0:x.add(E,v),c1:x.add(b,g)}),F=({c0:E,c1:b},{c0:v,c1:g})=>({c0:x.sub(E,v),c1:x.sub(b,g)}),U=({c0:E,c1:b},v)=>{if(typeof v=="bigint")return{c0:x.mul(E,v),c1:x.mul(b,v)};let{c0:g,c1:w}=v,S=x.mul(E,g),O=x.mul(b,w);return{c0:x.add(S,x.mulByNonresidue(O)),c1:x.sub(x.mul(x.add(E,b),x.add(g,w)),x.add(S,O))}},D=({c0:E,c1:b})=>{let v=x.mul(E,b);return{c0:x.sub(x.sub(x.mul(x.add(x.mulByNonresidue(b),E),x.add(E,b)),v),x.mulByNonresidue(v)),c1:x.add(v,v)}};function j(E,b){const v=f.sqr(E),g=f.sqr(b);return{first:f.add(f.mulByNonresidue(g),v),second:f.sub(f.sub(f.sqr(f.add(E,b)),v),g)}}const M={ORDER:f.ORDER,isLE:x.isLE,BITS:2*x.BITS,BYTES:2*x.BYTES,MASK:Tr(2*x.BITS),ZERO:{c0:x.ZERO,c1:x.ZERO},ONE:{c0:x.ONE,c1:x.ZERO},create:E=>E,isValid:({c0:E,c1:b})=>x.isValid(E)&&x.isValid(b),is0:({c0:E,c1:b})=>x.is0(E)&&x.is0(b),neg:({c0:E,c1:b})=>({c0:x.neg(E),c1:x.neg(b)}),eql:({c0:E,c1:b},{c0:v,c1:g})=>x.eql(E,v)&&x.eql(b,g),sqrt:sd,inv:({c0:E,c1:b})=>{let v=x.inv(x.sub(x.sqr(E),x.mulByNonresidue(x.sqr(b))));return{c0:x.mul(E,v),c1:x.neg(x.mul(b,v))}},div:(E,b)=>M.mul(E,typeof b=="bigint"?n.inv(n.create(b)):M.inv(b)),pow:(E,b)=>Eo(M,E,b),invertBatch:E=>Rr(M,E),add:R,sub:F,mul:U,sqr:D,addN:R,subN:F,mulN:U,sqrN:D,fromBytes:E=>{if(E.length!==M.BYTES)throw new Error("fromBytes invalid length="+E.length);return{c0:x.fromBytes(E.subarray(0,x.BYTES)),c1:x.fromBytes(E.subarray(x.BYTES))}},toBytes:({c0:E,c1:b})=>Se(x.toBytes(E),x.toBytes(b)),cmov:({c0:E,c1:b},{c0:v,c1:g},w)=>({c0:x.cmov(E,v,w),c1:x.cmov(b,g,w)}),fromBigTwelve:E=>({c0:x.fromBigSix(E.slice(0,6)),c1:x.fromBigSix(E.slice(6,12))}),frobeniusMap(E,b){const{c0:v,c1:g,c2:w}=x.frobeniusMap(E.c1,b),S=T[b%12];return{c0:x.frobeniusMap(E.c0,b),c1:x.create({c0:f.mul(v,S),c1:f.mul(g,S),c2:f.mul(w,S)})}},mulByFp2:({c0:E,c1:b},v)=>({c0:x.mulByFp2(E,v),c1:x.mulByFp2(b,v)}),conjugate:({c0:E,c1:b})=>({c0:E,c1:x.neg(b)}),mul014:({c0:E,c1:b},v,g,w)=>{let S=x.mul01(E,v,g),O=x.mul1(b,w);return{c0:x.add(x.mulByNonresidue(O),S),c1:x.sub(x.sub(x.mul01(x.add(b,E),v,f.add(g,w)),S),O)}},mul034:({c0:E,c1:b},v,g,w)=>{const S=x.create({c0:f.mul(E.c0,v),c1:f.mul(E.c1,v),c2:f.mul(E.c2,v)}),O=x.mul01(b,g,w),I=x.mul01(x.add(E,b),f.add(v,g),w);return{c0:x.add(x.mulByNonresidue(O),S),c1:x.sub(I,x.add(S,O))}},_cyclotomicSquare:t.Fp12cyclotomicSquare,_cyclotomicExp:t.Fp12cyclotomicExp,finalExponentiate:t.Fp12finalExponentiate};return{Fp:n,Fp2:f,Fp6:x,Fp4Square:j,Fp12:M}}const st=BigInt(0),Io=BigInt(1),Ce=BigInt(2),Oo=BigInt(3),Zi=BigInt(4),Qn=BigInt("0xd201000000010000"),M8=Vi(Qn),{Fp:X,Fp2:J,Fp6:Wc,Fp4Square:Zc,Fp12:ie}=q8({ORDER:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),FP2_NONRESIDUE:[Io,Io],Fp2mulByB:({c0:t,c1:e})=>{const n=X.mul(t,Zi),r=X.mul(e,Zi);return{c0:X.sub(n,r),c1:X.add(n,r)}},Fp12cyclotomicSquare:({c0:t,c1:e})=>{const{c0:n,c1:r,c2:i}=t,{c0:s,c1:o,c2:a}=e,{first:c,second:u}=Zc(n,o),{first:l,second:h}=Zc(s,i),{first:d,second:f}=Zc(r,a),p=J.mulByNonresidue(f);return{c0:Wc.create({c0:J.add(J.mul(J.sub(c,n),Ce),c),c1:J.add(J.mul(J.sub(l,r),Ce),l),c2:J.add(J.mul(J.sub(d,i),Ce),d)}),c1:Wc.create({c0:J.add(J.mul(J.add(p,s),Ce),p),c1:J.add(J.mul(J.add(u,o),Ce),u),c2:J.add(J.mul(J.add(h,a),Ce),h)})}},Fp12cyclotomicExp(t,e){let n=ie.ONE;for(let r=M8-1;r>=0;r--)n=ie._cyclotomicSquare(n),g3(e,r)&&(n=ie.mul(n,t));return n},Fp12finalExponentiate:t=>{const e=Qn,n=ie.div(ie.frobeniusMap(t,6),t),r=ie.mul(ie.frobeniusMap(n,2),n),i=ie.conjugate(ie._cyclotomicExp(r,e)),s=ie.mul(ie.conjugate(ie._cyclotomicSquare(r)),i),o=ie.conjugate(ie._cyclotomicExp(s,e)),a=ie.conjugate(ie._cyclotomicExp(o,e)),c=ie.mul(ie.conjugate(ie._cyclotomicExp(a,e)),ie._cyclotomicSquare(i)),u=ie.conjugate(ie._cyclotomicExp(c,e)),l=ie.frobeniusMap(ie.mul(i,a),2),h=ie.frobeniusMap(ie.mul(o,r),3),d=ie.frobeniusMap(ie.mul(c,ie.conjugate(r)),1),f=ie.mul(ie.mul(u,ie.conjugate(s)),r);return ie.mul(ie.mul(ie.mul(l,h),d),f)}}),jd=Yn(BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001")),j8=Cd(J,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(t=>t.map(e=>J.fromBigTuple(e.map(BigInt))))),z8=Cd(X,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),V8=Rd(J,{A:J.create({c0:X.create(st),c1:X.create(BigInt(240))}),B:J.create({c0:X.create(BigInt(1012)),c1:X.create(BigInt(1012))}),Z:J.create({c0:X.create(BigInt(-2)),c1:X.create(BigInt(-1))})}),H8=Rd(X,{A:X.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:X.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:X.create(BigInt(11))}),{G2psi:zd,G2psi2:K8}=k8(X,J,J.div(J.ONE,J.NONRESIDUE)),Yc=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:X.ORDER,m:2,k:128,expand:"xmd",hash:li}),Ao=Yi(X.toBytes(st),{infinity:!0,compressed:!0});function Bo(t){t=t.slice();const e=t[0]&224,n=!!(e>>7&1),r=!!(e>>6&1),i=!!(e>>5&1);return t[0]&=31,{compressed:n,infinity:r,sort:i,value:t}}function Yi(t,e){if(t[0]&224)throw new Error("setMask: non-empty mask");return e.compressed&&(t[0]|=128),e.infinity&&(t[0]|=64),e.sort&&(t[0]|=32),t}function Vd(t){t.assertValidity();const e=t.equals(Ht.G1.ProjectivePoint.ZERO),{x:n,y:r}=t.toAffine();if(e)return Ao.slice();const i=X.ORDER,s=!!(r*Ce/i);return Yi(De(n,X.BYTES),{compressed:!0,sort:s})}function Hd(t){t.assertValidity();const e=X.BYTES;if(t.equals(Ht.G2.ProjectivePoint.ZERO))return Se(Ao,De(st,e));const{x:n,y:r}=t.toAffine(),{re:i,im:s}=J.reim(n),{re:o,im:a}=J.reim(r),u=!!((a>st?a*Ce:o*Ce)/X.ORDER&Io),l=i;return Se(Yi(De(s,e),{sort:u,compressed:!0}),De(l,e))}const Ht=F8({fields:{Fp:X,Fp2:J,Fp6:Wc,Fp12:ie,Fr:jd},G1:{Fp:X,h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1"),a:X.ZERO,b:Zi,htfDefaults:{...Yc,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(t,e)=>{const n=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),r=new t(X.mul(e.px,n),e.py,e.pz);return e.multiplyUnsafe(Qn).negate().multiplyUnsafe(Qn).equals(r)},clearCofactor:(t,e)=>e.multiplyUnsafe(Qn).add(e),mapToCurve:t=>{const{x:e,y:n}=H8(X.create(t[0]));return z8(e,n)},fromBytes:t=>{const{compressed:e,infinity:n,sort:r,value:i}=Bo(t);if(i.length===48&&e){const s=X.ORDER,o=nt(i),a=X.create(o&X.MASK);if(n){if(a!==st)throw new Error("G1: non-empty compressed point at infinity");return{x:st,y:st}}const c=X.add(X.pow(a,Oo),X.create(Ht.params.G1b));let u=X.sqrt(c);if(!u)throw new Error("invalid compressed G1 point");return u*Ce/s!==BigInt(r)&&(u=X.neg(u)),{x:X.create(a),y:X.create(u)}}else if(i.length===96&&!e){const s=nt(i.subarray(0,X.BYTES)),o=nt(i.subarray(X.BYTES));if(n){if(s!==st||o!==st)throw new Error("G1: non-empty point at infinity");return Ht.G1.ProjectivePoint.ZERO.toAffine()}return{x:X.create(s),y:X.create(o)}}else throw new Error("invalid point G1, expected 48/96 bytes")},toBytes:(t,e,n)=>{const r=e.equals(t.ZERO),{x:i,y:s}=e.toAffine();if(n){if(r)return Ao.slice();const o=X.ORDER,a=!!(s*Ce/o);return Yi(De(i,X.BYTES),{compressed:!0,sort:a})}else return r?Se(new Uint8Array([64]),new Uint8Array(2*X.BYTES-1)):Se(De(i,X.BYTES),De(s,X.BYTES))},ShortSignature:{fromHex(t){const{infinity:e,sort:n,value:r}=Bo(We("signatureHex",t,48)),i=X.ORDER,s=nt(r);if(e)return Ht.G1.ProjectivePoint.ZERO;const o=X.create(s&X.MASK),a=X.add(X.pow(o,Oo),X.create(Ht.params.G1b));let c=X.sqrt(a);if(!c)throw new Error("invalid compressed G1 point");const u=BigInt(n);c*Ce/i!==u&&(c=X.neg(c));const l=Ht.G1.ProjectivePoint.fromAffine({x:o,y:c});return l.assertValidity(),l},toRawBytes(t){return Vd(t)},toHex(t){return $r(Vd(t))}}},G2:{Fp:J,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),Gx:J.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:J.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")]),a:J.ZERO,b:J.fromBigTuple([Zi,Zi]),hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...Yc},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:t=>{const{x:e,y:n}=V8(J.fromBigTuple(t));return j8(e,n)},isTorsionFree:(t,e)=>e.multiplyUnsafe(Qn).negate().equals(zd(t,e)),clearCofactor:(t,e)=>{const n=Qn;let r=e.multiplyUnsafe(n).negate(),i=zd(t,e),s=e.double();return s=K8(t,s),s=s.subtract(i),i=r.add(i),i=i.multiplyUnsafe(n).negate(),s=s.add(i),s=s.subtract(r),s.subtract(e)},fromBytes:t=>{const{compressed:e,infinity:n,sort:r,value:i}=Bo(t);if(!e&&!n&&r||!e&&n&&r||r&&n&&e)throw new Error("invalid encoding flag: "+(t[0]&224));const s=X.BYTES,o=(a,c,u)=>nt(a.slice(c,u));if(i.length===96&&e){const a=Ht.params.G2b,c=X.ORDER;if(n){if(i.reduce((y,m)=>y!==0?m+1:m,0)>0)throw new Error("invalid compressed G2 point");return{x:J.ZERO,y:J.ZERO}}const u=o(i,0,s),l=o(i,s,2*s),h=J.create({c0:X.create(l),c1:X.create(u)}),d=J.add(J.pow(h,Oo),a);let f=J.sqrt(d);const p=f.c1===st?f.c0*Ce/c:f.c1*Ce/c?Io:st;return f=r&&p>0?f:J.neg(f),{x:h,y:f}}else if(i.length===192&&!e){if(n){if(i.reduce((h,d)=>h!==0?d+1:d,0)>0)throw new Error("invalid uncompressed G2 point");return{x:J.ZERO,y:J.ZERO}}const a=o(i,0,s),c=o(i,s,2*s),u=o(i,2*s,3*s),l=o(i,3*s,4*s);return{x:J.fromBigTuple([c,a]),y:J.fromBigTuple([l,u])}}else throw new Error("invalid point G2, expected 96/192 bytes")},toBytes:(t,e,n)=>{const{BYTES:r,ORDER:i}=X,s=e.equals(t.ZERO),{x:o,y:a}=e.toAffine();if(n){if(s)return Se(Ao,De(st,r));const c=!!(a.c1===st?a.c0*Ce/i:a.c1*Ce/i);return Se(Yi(De(o.c1,r),{compressed:!0,sort:c}),De(o.c0,r))}else{if(s)return Se(new Uint8Array([64]),new Uint8Array(4*r-1));const{re:c,im:u}=J.reim(o),{re:l,im:h}=J.reim(a);return Se(De(u,r),De(c,r),De(h,r),De(l,r))}},Signature:{fromHex(t){const{infinity:e,sort:n,value:r}=Bo(We("signatureHex",t)),i=X.ORDER,s=r.length/2;if(s!==48&&s!==96)throw new Error("invalid compressed signature length, must be 96 or 192");const o=nt(r.slice(0,s)),a=nt(r.slice(s));if(e)return Ht.G2.ProjectivePoint.ZERO;const c=X.create(o&X.MASK),u=X.create(a),l=J.create({c0:u,c1:c}),h=J.add(J.pow(l,Oo),Ht.params.G2b);let d=J.sqrt(h);if(!d)throw new Error("Failed to find a square root");const{re:f,im:p}=J.reim(d),y=BigInt(n),m=p>st&&p*Ce/i!==y,A=p===st&&f*Ce/i!==y;(m||A)&&(d=J.neg(d));const $=Ht.G2.ProjectivePoint.fromAffine({x:l,y:d});return $.assertValidity(),$},toRawBytes(t){return Hd(t)},toHex(t){return $r(Hd(t))}}},params:{ateLoopSize:Qn,r:jd.ORDER,xNegative:!0,twistType:"multiplicative"},htfDefaults:Yc,hash:li,randomBytes:lo});BigInt(0),BigInt(1),BigInt(2),BigInt(8),BigInt(0),BigInt(1),BigInt(2),BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),BigInt(0),BigInt(1),BigInt(2),BigInt(3),BigInt(5),BigInt(8);const Xc=BigInt(0),Jc=BigInt(1);function Do(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function Nr(t,e,n=""){const r=oo(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){const o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function $o(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Kd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Xc:BigInt("0x"+t)}function To(t){return Kd(ai(t))}function Gd(t){return bn(t),Kd(ai(Uint8Array.from(t).reverse()))}function Qc(t,e){return ao(t.toString(16).padStart(e*2,"0"))}function Wd(t,e){return Qc(t,e).reverse()}function gt(t,e,n){let r;if(typeof e=="string")try{r=ao(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(oo(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}const eu=t=>typeof t=="bigint"&&Xc<=t;function G8(t,e,n){return eu(t)&&eu(e)&&eu(n)&&e<=t&&t<n}function W8(t,e,n,r){if(!G8(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Zd(t){let e;for(e=0;t>Xc;t>>=Jc,e+=1);return e}const Xi=t=>(Jc<<BigInt(t))-Jc;function Z8(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=r(t),o=r(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...f)=>n(o,s,...f),l=(f=r(0))=>{o=u(i(0),f),s=u(),f.length!==0&&(o=u(i(1),f),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=u();const y=s.slice();p.push(y),f+=s.length}return wn(...p)};return(f,p)=>{c(),l(f);let y;for(;!(y=p(h()));)l();return c(),y}}function tu(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function Yd(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const bt=BigInt(0),ot=BigInt(1),Cr=BigInt(2),Xd=BigInt(3),Jd=BigInt(4),Qd=BigInt(5),Y8=BigInt(7),ep=BigInt(8),X8=BigInt(9),tp=BigInt(16);function Kt(t,e){const n=t%e;return n>=bt?n:e+n}function Rt(t,e,n){let r=t;for(;e-- >bt;)r*=r,r%=n;return r}function np(t,e){if(t===bt)throw new Error("invert: expected non-zero number");if(e<=bt)throw new Error("invert: expected positive modulus, got "+e);let n=Kt(t,e),r=e,i=bt,s=ot;for(;n!==bt;){const a=r/n,c=r%n,u=i-s*a;r=n,n=c,i=s,s=u}if(r!==ot)throw new Error("invert: does not exist");return Kt(i,e)}function nu(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function rp(t,e){const n=(t.ORDER+ot)/Jd,r=t.pow(e,n);return nu(t,r,e),r}function J8(t,e){const n=(t.ORDER-Qd)/ep,r=t.mul(e,Cr),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Cr),i),a=t.mul(s,t.sub(o,t.ONE));return nu(t,a,e),a}function Q8(t){const e=Ji(t),n=ip(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+Y8)/tp;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,r);const h=a.mul(u,i),d=a.mul(u,s),f=a.eql(a.sqr(l),c),p=a.eql(a.sqr(h),c);u=a.cmov(u,l,f),l=a.cmov(d,h,p);const y=a.eql(a.sqr(l),c),m=a.cmov(u,l,y);return nu(a,m,c),m}}function ip(t){if(t<Xd)throw new Error("sqrt is not defined for small field");let e=t-ot,n=0;for(;e%Cr===bt;)e/=Cr,n++;let r=Cr;const i=Ji(t);for(;op(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return rp;let s=i.pow(r,e);const o=(e+ot)/Cr;return function(c,u){if(c.is0(u))return u;if(op(c,u)!==1)throw new Error("Cannot find square root");let l=n,h=c.mul(c.ONE,s),d=c.pow(u,e),f=c.pow(u,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let p=1,y=c.sqr(d);for(;!c.eql(y,c.ONE);)if(p++,y=c.sqr(y),p===l)throw new Error("Cannot find square root");const m=ot<<BigInt(l-p-1),A=c.pow(h,m);l=p,h=c.sqr(A),d=c.mul(d,h),f=c.mul(f,A)}return f}}function ex(t){return t%Jd===Xd?rp:t%ep===Qd?J8:t%tp===X8?Q8(t):ip(t)}const tx=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nx(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=tx.reduce((r,i)=>(r[i]="function",r),e);return tu(t,n),t}function rx(t,e,n){if(n<bt)throw new Error("invalid exponent, negatives unsupported");if(n===bt)return t.ONE;if(n===ot)return e;let r=t.ONE,i=e;for(;n>bt;)n&ot&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ot;return r}function sp(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function op(t,e){const n=(t.ORDER-ot)/Cr,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function ap(t,e){e!==void 0&&si(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Ji(t,e,n=!1,r={}){if(t<=bt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(i=d.BITS),d.sqrt&&(s=d.sqrt),typeof d.isLE=="boolean"&&(n=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:u}=ap(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:u,MASK:Xi(c),ZERO:bt,ONE:ot,allowedLengths:a,create:d=>Kt(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return bt<=d&&d<t},is0:d=>d===bt,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&ot)===ot,neg:d=>Kt(-d,t),eql:(d,f)=>d===f,sqr:d=>Kt(d*d,t),add:(d,f)=>Kt(d+f,t),sub:(d,f)=>Kt(d-f,t),mul:(d,f)=>Kt(d*f,t),pow:(d,f)=>rx(h,d,f),div:(d,f)=>Kt(d*np(f,t),t),sqrN:d=>d*d,addN:(d,f)=>d+f,subN:(d,f)=>d-f,mulN:(d,f)=>d*f,inv:d=>np(d,t),sqrt:s||(d=>(l||(l=ex(t)),l(h,d))),toBytes:d=>n?Wd(d,u):Qc(d,u),fromBytes:(d,f=!0)=>{if(a){if(!a.includes(d.length)||d.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const y=new Uint8Array(u);y.set(d,n?0:y.length-d.length),d=y}if(d.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+d.length);let p=n?Gd(d):To(d);if(o&&(p=Kt(p,t)),!f&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:d=>sp(h,d),cmov:(d,f,p)=>p?f:d});return Object.freeze(h)}function cp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function up(t){const e=cp(t);return e+Math.ceil(e/2)}function ix(t,e,n=!1){const r=t.length,i=cp(e),s=up(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Gd(t):To(t),a=Kt(o,e-ot)+ot;return n?Wd(a,i):Qc(a,i)}const pi=BigInt(0),Ur=BigInt(1);function Po(t,e){const n=e.negate();return t?n:e}function ru(t,e){const n=sp(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function lp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function iu(t,e){lp(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Xi(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function fp(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Ur);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:u}}function sx(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function ox(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const su=new WeakMap,hp=new WeakMap;function ou(t){return hp.get(t)||1}function dp(t){if(t!==pi)throw new Error("invalid wNAF")}class ax{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>pi;)n&Ur&&(r=r.add(i)),i=i.double(),n>>=Ur;return r}precomputeWindow(e,n){const{windows:r,windowSize:i}=iu(n,this.bits),s=[];let o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=iu(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}=fp(r,a,o);r=c,l?s=s.add(Po(d,n[f])):i=i.add(Po(h,n[u]))}return dp(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){const s=iu(e,this.bits);for(let o=0;o<s.windows&&r!==pi;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=fp(r,o,s);if(r=a,!u){const h=n[c];i=i.add(l?h.negate():h)}}return dp(r),i}getPrecomputes(e,n,r){let i=su.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),su.set(n,i))),i}cached(e,n,r){const i=ou(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){const s=ou(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){lp(n,this.bits),hp.set(e,n),su.delete(e)}hasCache(e){return ou(e)!==1}}function cx(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>pi||r>pi;)n&Ur&&(s=s.add(i)),r&Ur&&(o=o.add(i)),i=i.double(),n>>=Ur,r>>=Ur;return{p1:s,p2:o}}function ux(t,e,n,r){sx(n,t),ox(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Zd(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Xi(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){l.fill(o);for(let y=0;y<s;y++){const m=r[y],A=Number(m>>BigInt(f)&u);l[A]=l[A].add(n[y])}let p=o;for(let y=l.length-1,m=o;y>0;y--)m=m.add(l[y]),p=p.add(m);if(d=d.add(p),f!==0)for(let y=0;y<c;y++)d=d.double()}return d}function pp(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return nx(e),e}else return Ji(t,{isLE:n})}function lx(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const c of["p","n","h"]){const u=e[c];if(!(typeof u=="bigint"&&u>pi))throw new Error(`CURVE.${c} must be positive bigint`)}const i=pp(e.p,n.Fp,r),s=pp(e.n,n.Fn,r),a=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const c of a)if(!i.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}const gp=(t,e)=>(t+(t>=0?e:-e)/bp)/e;function fx(t,e,n){const[[r,i],[s,o]]=e,a=gp(o*t,n),c=gp(-i*t,n);let u=t-a*r-c*s,l=-a*i-c*o;const h=u<Bn,d=l<Bn;h&&(u=-u),d&&(l=-l);const f=Xi(Math.ceil(Zd(n)/2))+gi;if(u<Bn||u>=f||l<Bn||l>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}function au(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function cu(t,e){const n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return Do(n.lowS,"lowS"),Do(n.prehash,"prehash"),n.format!==void 0&&au(n.format),n}class hx extends Error{constructor(e=""){super(e)}}const An={Err:hx,_tlv:{encode:(t,e)=>{const{Err:n}=An;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=$o(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?$o(i.length/2|128):"";return $o(t)+s+i+e},decode(t,e){const{Err:n}=An;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=An;if(t<Bn)throw new e("integer: negative integers are not allowed");let n=$o(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=An;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return To(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=An,i=gt("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=An,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},Bn=BigInt(0),gi=BigInt(1),bp=BigInt(2),Ro=BigInt(3),dx=BigInt(4);function bi(t,e){const{BYTES:n}=t;let r;if(typeof e=="bigint")r=e;else{let i=gt("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function px(t,e={}){const n=lx("weierstrass",t,e),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;tu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=wp(r,i);function l(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(E,b,v){const{x:g,y:w}=b.toAffine(),S=r.toBytes(g);if(Do(v,"isCompressed"),v){l();const O=!r.isOdd(w);return wn(yp(O),S)}else return wn(Uint8Array.of(4),S,r.toBytes(w))}function d(E){Nr(E,void 0,"Point");const{publicKey:b,publicKeyUncompressed:v}=u,g=E.length,w=E[0],S=E.subarray(1);if(g===b&&(w===2||w===3)){const O=r.fromBytes(S);if(!r.isValid(O))throw new Error("bad point: is not on curve, wrong x");const I=y(O);let B;try{B=r.sqrt(I)}catch(C){const k=C instanceof Error?": "+C.message:"";throw new Error("bad point: is not on curve, sqrt error"+k)}l();const P=r.isOdd(B);return(w&1)===1!==P&&(B=r.neg(B)),{x:O,y:B}}else if(g===v&&w===4){const O=r.BYTES,I=r.fromBytes(S.subarray(0,O)),B=r.fromBytes(S.subarray(O,O*2));if(!m(I,B))throw new Error("bad point: is not on curve");return{x:I,y:B}}else throw new Error(`bad point: got length ${g}, expected compressed=${b} or uncompressed=${v}`)}const f=e.toBytes||h,p=e.fromBytes||d;function y(E){const b=r.sqr(E),v=r.mul(b,E);return r.add(r.add(v,r.mul(E,s.a)),s.b)}function m(E,b){const v=r.sqr(b),g=y(E);return r.eql(v,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const A=r.mul(r.pow(s.a,Ro),dx),$=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(A,$)))throw new Error("bad curve params: a or b");function _(E,b,v=!1){if(!r.isValid(b)||v&&r.is0(b))throw new Error(`bad point coordinate ${E}`);return b}function x(E){if(!(E instanceof D))throw new Error("ProjectivePoint expected")}function T(E){if(!c||!c.basises)throw new Error("no endo");return fx(E,c.basises,i.ORDER)}const R=Yd((E,b)=>{const{X:v,Y:g,Z:w}=E;if(r.eql(w,r.ONE))return{x:v,y:g};const S=E.is0();b==null&&(b=S?r.ONE:r.inv(w));const O=r.mul(v,b),I=r.mul(g,b),B=r.mul(w,b);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:O,y:I}}),F=Yd(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:b,y:v}=E.toAffine();if(!r.isValid(b)||!r.isValid(v))throw new Error("bad point: x or y not field elements");if(!m(b,v))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,b,v,g,w){return v=new D(r.mul(v.X,E),v.Y,v.Z),b=Po(g,b),v=Po(w,v),b.add(v)}class D{constructor(b,v,g){this.X=_("x",b),this.Y=_("y",v,!0),this.Z=_("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){const{x:v,y:g}=b||{};if(!b||!r.isValid(v)||!r.isValid(g))throw new Error("invalid affine point");if(b instanceof D)throw new Error("projective point not allowed");return r.is0(v)&&r.is0(g)?D.ZERO:new D(v,g,r.ONE)}static fromBytes(b){const v=D.fromAffine(p(Nr(b,void 0,"point")));return v.assertValidity(),v}static fromHex(b){return D.fromBytes(gt("pointHex",b))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,v=!0){return M.createCache(this,b),v||this.multiply(Ro),this}assertValidity(){F(this)}hasEvenY(){const{y:b}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(b)}equals(b){x(b);const{X:v,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=b,B=r.eql(r.mul(v,I),r.mul(S,w)),P=r.eql(r.mul(g,I),r.mul(O,w));return B&&P}negate(){return new D(this.X,r.neg(this.Y),this.Z)}double(){const{a:b,b:v}=s,g=r.mul(v,Ro),{X:w,Y:S,Z:O}=this;let I=r.ZERO,B=r.ZERO,P=r.ZERO,L=r.mul(w,w),C=r.mul(S,S),k=r.mul(O,O),N=r.mul(w,S);return N=r.add(N,N),P=r.mul(w,O),P=r.add(P,P),I=r.mul(b,P),B=r.mul(g,k),B=r.add(I,B),I=r.sub(C,B),B=r.add(C,B),B=r.mul(I,B),I=r.mul(N,I),P=r.mul(g,P),k=r.mul(b,k),N=r.sub(L,k),N=r.mul(b,N),N=r.add(N,P),P=r.add(L,L),L=r.add(P,L),L=r.add(L,k),L=r.mul(L,N),B=r.add(B,L),k=r.mul(S,O),k=r.add(k,k),L=r.mul(k,N),I=r.sub(I,L),P=r.mul(k,C),P=r.add(P,P),P=r.add(P,P),new D(I,B,P)}add(b){x(b);const{X:v,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=b;let B=r.ZERO,P=r.ZERO,L=r.ZERO;const C=s.a,k=r.mul(s.b,Ro);let N=r.mul(v,S),q=r.mul(g,O),z=r.mul(w,I),W=r.add(v,g),H=r.add(S,O);W=r.mul(W,H),H=r.add(N,q),W=r.sub(W,H),H=r.add(v,w);let Z=r.add(S,I);return H=r.mul(H,Z),Z=r.add(N,z),H=r.sub(H,Z),Z=r.add(g,w),B=r.add(O,I),Z=r.mul(Z,B),B=r.add(q,z),Z=r.sub(Z,B),L=r.mul(C,H),B=r.mul(k,z),L=r.add(B,L),B=r.sub(q,L),L=r.add(q,L),P=r.mul(B,L),q=r.add(N,N),q=r.add(q,N),z=r.mul(C,z),H=r.mul(k,H),q=r.add(q,z),z=r.sub(N,z),z=r.mul(C,z),H=r.add(H,z),N=r.mul(q,H),P=r.add(P,N),N=r.mul(Z,H),B=r.mul(W,B),B=r.sub(B,N),N=r.mul(W,q),L=r.mul(Z,L),L=r.add(L,N),new D(B,P,L)}subtract(b){return this.add(b.negate())}is0(){return this.equals(D.ZERO)}multiply(b){const{endo:v}=e;if(!i.isValidNot0(b))throw new Error("invalid scalar: out of range");let g,w;const S=O=>M.cached(this,O,I=>ru(D,I));if(v){const{k1neg:O,k1:I,k2neg:B,k2:P}=T(b),{p:L,f:C}=S(I),{p:k,f:N}=S(P);w=C.add(N),g=U(v.beta,L,k,O,B)}else{const{p:O,f:I}=S(b);g=O,w=I}return ru(D,[g,w])[0]}multiplyUnsafe(b){const{endo:v}=e,g=this;if(!i.isValid(b))throw new Error("invalid scalar: out of range");if(b===Bn||g.is0())return D.ZERO;if(b===gi)return g;if(M.hasCache(this))return this.multiply(b);if(v){const{k1neg:w,k1:S,k2neg:O,k2:I}=T(b),{p1:B,p2:P}=cx(D,g,S,I);return U(v.beta,B,P,w,O)}else return M.unsafe(g,b)}multiplyAndAddUnsafe(b,v,g){const w=this.multiplyUnsafe(v).add(b.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine(b){return R(this,b)}isTorsionFree(){const{isTorsionFree:b}=e;return o===gi?!0:b?b(D,this):M.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:b}=e;return o===gi?this:b?b(D,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(b=!0){return Do(b,"isCompressed"),this.assertValidity(),f(D,this,b)}toHex(b=!0){return ai(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(b=!0){return this.toBytes(b)}_setWindowSize(b){this.precompute(b)}static normalizeZ(b){return ru(D,b)}static msm(b,v){return ux(D,i,b,v)}static fromPrivateKey(b){return D.BASE.multiply(bi(i,b))}}D.BASE=new D(s.Gx,s.Gy,r.ONE),D.ZERO=new D(r.ZERO,r.ONE,r.ZERO),D.Fp=r,D.Fn=i;const j=i.BITS,M=new ax(D,e.endo?Math.ceil(j/2):j);return D.BASE.precompute(8),D}function yp(t){return Uint8Array.of(t?2:3)}function wp(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function gx(t,e={}){const{Fn:n}=t,r=e.randomBytes||lo,i=Object.assign(wp(t.Fp,n),{seed:up(n.ORDER)});function s(f){try{return!!bi(n,f)}catch{return!1}}function o(f,p){const{publicKey:y,publicKeyUncompressed:m}=i;try{const A=f.length;return p===!0&&A!==y||p===!1&&A!==m?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=r(i.seed)){return ix(Nr(f,i.seed,"seed"),n.ORDER)}function c(f,p=!0){return t.BASE.multiply(bi(n,f)).toBytes(p)}function u(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:y,publicKeyUncompressed:m}=i;if(n.allowedLengths||p===y)return;const A=gt("key",f).length;return A===y||A===m}function h(f,p,y=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(p)===!1)throw new Error("second arg must be public key");const m=bi(n,f);return t.fromHex(p).multiply(m).toBytes(y)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>bi(n,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:i})}function bx(t,e,n={}){Ch(e),tu(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||lo,i=n.hmac||((v,...g)=>Nc(e,v,wn(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f}=gx(t,n),p={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function m(v){const g=a>>gi;return v>g}function A(v,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${v}: out of range 1..Point.Fn.ORDER`);return g}function $(v,g){au(g);const w=f.signature,S=g==="compact"?w:g==="recovered"?w+1:void 0;return Nr(v,S,`${g} signature`)}class _{constructor(g,w,S){this.r=A("r",g),this.s=A("s",w),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(g,w=y){$(g,w);let S;if(w==="der"){const{r:P,s:L}=An.toSig(Nr(g));return new _(P,L)}w==="recovered"&&(S=g[0],w="compact",g=g.subarray(1));const O=o.BYTES,I=g.subarray(0,O),B=g.subarray(O,O*2);return new _(o.fromBytes(I),o.fromBytes(B),S)}static fromHex(g,w){return this.fromBytes(ao(g),w)}addRecoveryBit(g){return new _(this.r,this.s,g)}recoverPublicKey(g){const w=s.ORDER,{r:S,s:O,recovery:I}=this;if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(a*bp<w&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const P=I===2||I===3?S+a:S;if(!s.isValid(P))throw new Error("recovery id 2 or 3 invalid");const L=s.toBytes(P),C=t.fromBytes(wn(yp((I&1)===0),L)),k=o.inv(P),N=T(gt("msgHash",g)),q=o.create(-N*k),z=o.create(O*k),W=t.BASE.multiplyUnsafe(q).add(C.multiplyUnsafe(z));if(W.is0())throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return m(this.s)}toBytes(g=y){if(au(g),g==="der")return ao(An.hexFromSig(this));const w=o.toBytes(this.r),S=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return wn(Uint8Array.of(this.recovery),w,S)}return wn(w,S)}toHex(g){return ai(this.toBytes(g))}assertValidity(){}static fromCompact(g){return _.fromBytes(gt("sig",g),"compact")}static fromDER(g){return _.fromBytes(gt("sig",g),"der")}normalizeS(){return this.hasHighS()?new _(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return ai(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return ai(this.toBytes("compact"))}}const x=n.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=To(g),S=g.length*8-c;return S>0?w>>BigInt(S):w},T=n.bits2int_modN||function(g){return o.create(x(g))},R=Xi(c);function F(v){return W8("num < 2^"+c,v,Bn,R),o.toBytes(v)}function U(v,g){return Nr(v,void 0,"message"),g?Nr(e(v),void 0,"prehashed message"):v}function D(v,g,w){if(["recovered","canonical"].some(q=>q in w))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:O,extraEntropy:I}=cu(w,p);v=U(v,O);const B=T(v),P=bi(o,g),L=[F(P),F(B)];if(I!=null&&I!==!1){const q=I===!0?r(f.secretKey):I;L.push(gt("extraEntropy",q))}const C=wn(...L),k=B;function N(q){const z=x(q);if(!o.isValidNot0(z))return;const W=o.inv(z),H=t.BASE.multiply(z).toAffine(),Z=o.create(H.x);if(Z===Bn)return;const Q=o.create(W*o.create(k+Z*P));if(Q===Bn)return;let ee=(H.x===Z?0:2)|Number(H.y&gi),se=Q;return S&&m(Q)&&(se=o.neg(Q),ee^=1),new _(Z,se,ee)}return{seed:C,k2sig:N}}function j(v,g,w={}){v=gt("message",v);const{seed:S,k2sig:O}=D(v,g,w);return Z8(e.outputLen,o.BYTES,i)(S,O)}function M(v){let g;const w=typeof v=="string"||oo(v),S=!w&&v!==null&&typeof v=="object"&&typeof v.r=="bigint"&&typeof v.s=="bigint";if(!w&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)g=new _(v.r,v.s);else if(w){try{g=_.fromBytes(gt("sig",v),"der")}catch(O){if(!(O instanceof An.Err))throw O}if(!g)try{g=_.fromBytes(gt("sig",v),"compact")}catch{return!1}}return g||!1}function E(v,g,w,S={}){const{lowS:O,prehash:I,format:B}=cu(S,p);if(w=gt("publicKey",w),g=U(gt("message",g),I),"strict"in S)throw new Error("options.strict was renamed to lowS");const P=B===void 0?M(v):_.fromBytes(gt("sig",v),B);if(P===!1)return!1;try{const L=t.fromBytes(w);if(O&&P.hasHighS())return!1;const{r:C,s:k}=P,N=T(g),q=o.inv(k),z=o.create(N*q),W=o.create(C*q),H=t.BASE.multiplyUnsafe(z).add(L.multiplyUnsafe(W));return H.is0()?!1:o.create(H.x)===C}catch{return!1}}function b(v,g,w={}){const{prehash:S}=cu(w,p);return g=U(g,S),_.fromBytes(v,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f,Point:t,sign:j,verify:E,recoverPublicKey:b,Signature:_,hash:e})}function yx(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp;let r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Ji(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function wx(t){const{CURVE:e,curveOpts:n}=yx(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function mx(t,e){const n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,ap(n.Fn.ORDER,n.Fn.BITS))})}function vx(t){const{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=wx(t),s=px(e,n),o=bx(s,r,i);return mx(t,o)}function Ex(t,e){const n=r=>vx({...t,hash:r});return{...n(e),create:n}}yc("HashToScalar-");const uu={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},xx={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},mp=BigInt(2);function _x(t){const e=uu.p,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=Rt(l,n,e)*l%e,d=Rt(h,n,e)*l%e,f=Rt(d,mp,e)*u%e,p=Rt(f,i,e)*f%e,y=Rt(p,s,e)*p%e,m=Rt(y,a,e)*y%e,A=Rt(m,c,e)*m%e,$=Rt(A,a,e)*y%e,_=Rt($,n,e)*l%e,x=Rt(_,o,e)*p%e,T=Rt(x,r,e)*u%e,R=Rt(T,mp,e);if(!lu.eql(lu.sqr(R),t))throw new Error("Cannot find square root");return R}const lu=Ji(uu.p,{sqrt:_x});Ex({...uu,Fp:lu,lowS:!0,endo:xx},li);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function yi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fu(t,...e){if(!yi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function vp(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function hu(t){if(typeof t!="function")throw new Error("function expected");return!0}function er(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function wi(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function No(t){if(!Array.isArray(t))throw new Error("array expected")}function Co(t,e){if(!vp(!0,e))throw new Error(`${t}: array of strings expected`)}function du(t,e){if(!vp(!1,e))throw new Error(`${t}: array of numbers expected`)}function yt(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function It(t){const e=typeof t=="string"?t.split(""):t,n=e.length;Co("alphabet",e);const r=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(No(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(No(i),i.map(s=>{er("alphabet.decode",s);const o=r.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Ot(t=""){return er("join",t),{encode:e=>(Co("join.decode",e),e.join(t)),decode:e=>(er("join.decode",e),e.split(t))}}function Uo(t,e="="){return wi(t),er("padding",e),{encode(n){for(Co("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){Co("padding.decode",n);let r=n.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if((r-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}function Ep(t){return hu(t),{encode:e=>e,decode:e=>t(e)}}function xp(t,e,n){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(No(t),!t.length)return[];let r=0;const i=[],s=Array.from(t,a=>{if(wi(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=r;u<o;u++){const l=s[u],h=e*a,d=h+l;if(!Number.isSafeInteger(d)||h/e!==a||d-l!==h)throw new Error("convertRadix: carry overflow");const f=d/n;a=d%n;const p=Math.floor(f);if(s[u]=p,!Number.isSafeInteger(p)||p*n+a!==d)throw new Error("convertRadix: carry overflow");if(c)p?c=!1:r=u;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const _p=(t,e)=>e===0?t:_p(e,t%e),Fo=(t,e)=>t+(e-_p(t,e)),Lo=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function pu(t,e,n,r){if(No(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Fo(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Fo(e,n)}`);let i=0,s=0;const o=Lo[e],a=Lo[n]-1,c=[];for(const u of t){if(wi(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const l=Lo[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<n-s&a,!r&&s>=e)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function Sx(t){wi(t);const e=2**8;return{encode:n=>{if(!yi(n))throw new Error("radix.encode input should be Uint8Array");return xp(Array.from(n),e,t)},decode:n=>(du("radix.decode",n),Uint8Array.from(xp(n,t,e)))}}function Nt(t,e=!1){if(wi(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Fo(8,t)>32||Fo(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!yi(n))throw new Error("radix2.encode input should be Uint8Array");return pu(Array.from(n),8,t,!e)},decode:n=>(du("radix2.decode",n),Uint8Array.from(pu(n,t,8,e)))}}function Sp(t){return hu(t),function(...e){try{return t.apply(null,e)}catch{}}}function Ix(t,e){return wi(t),hu(e),{encode(n){if(!yi(n))throw new Error("checksum.encode: input should be Uint8Array");const r=e(n).slice(0,t),i=new Uint8Array(n.length+t);return i.set(n),i.set(r,n.length),i},decode(n){if(!yi(n))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-t),i=n.slice(-t),s=e(r).slice(0,t);for(let o=0;o<t;o++)if(s[o]!==i[o])throw new Error("Invalid checksum");return r}}}const Ox=yt(Nt(5),It("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Uo(5),Ot("")),Ip=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",Op=(t,e)=>{er("base64",t);const n=e?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=e?"base64url":"base64";if(t.length>0&&!n.test(t))throw new Error("invalid base64");return Uint8Array.fromBase64(t,{alphabet:r,lastChunkHandling:"strict"})},gu=t=>yt(Sx(58),It(t),Ot("")),Ax=gu("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Bx=t=>yt(Ix(4,e=>t(t(e))),Ax),bu=yt(It("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ot("")),Ap=[996825010,642813549,513874426,1027748829,705979059];function Qi(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<Ap.length;r++)(e>>r&1)===1&&(n^=Ap[r]);return n}function Bp(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Qi(i)^o>>5}i=Qi(i);for(let s=0;s<r;s++)i=Qi(i)^t.charCodeAt(s)&31;for(let s of e)i=Qi(i)^s;for(let s=0;s<6;s++)i=Qi(i);return i^=n,bu.encode(pu([i%Lo[30]],30,5,!1))}function Dp(t){const e=t==="bech32"?1:734539939,n=Nt(5),r=n.decode,i=n.encode,s=Sp(r);function o(h,d,f=90){er("bech32.encode prefix",h),yi(d)&&(d=Array.from(d)),du("bech32.encode",d);const p=h.length;if(p===0)throw new TypeError(`Invalid prefix length ${p}`);const y=p+7+d.length;if(f!==!1&&y>f)throw new TypeError(`Length ${y} exceeds limit ${f}`);const m=h.toLowerCase(),A=Bp(m,d,e);return`${m}1${bu.encode(d)}${A}`}function a(h,d=90){er("bech32.decode input",h);const f=h.length;if(f<8||d!==!1&&f>d)throw new TypeError(`invalid string length: ${f} (${h}). Expected (8..${d})`);const p=h.toLowerCase();if(h!==p&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");const y=p.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');const m=p.slice(0,y),A=p.slice(y+1);if(A.length<6)throw new Error("Data must be at least 6 characters long");const $=bu.decode(A).slice(0,-6),_=Bp(m,$,e);if(!A.endsWith(_))throw new Error(`Invalid checksum in ${h}: expected "${_}"`);return{prefix:m,words:$}}const c=Sp(a);function u(h){const{prefix:d,words:f}=a(h,!1);return{prefix:d,words:f,bytes:r(f)}}function l(h,d){return o(h,i(d))}return{encode:o,decode:a,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const Dx=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",$x={encode(t){return fu(t),t.toHex()},decode(t){return er("hex",t),Uint8Array.fromHex(t)}};Bx(li),yc("Bitcoin seed");function Tx(t){return J3(Px(t))}function Px(t){const{payload:e,signature:n}=t,{r,s:i,yParity:s}=n,a=new D8.Signature(BigInt(r),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Dc(e).substring(2));return z3(a)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function $p(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ko(t,...e){if(!$p(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function qo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Tp(t,e){ko(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function es(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function yu(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Rx(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Nx(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ts(t){if(typeof t=="string")t=Nx(t);else if($p(t))t=Pp(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Pp(t){return Uint8Array.from(t)}const Dn=16,wu=new Uint8Array(16),sn=es(wu),Cx=225,Ux=(t,e,n,r)=>{const i=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^Cx<<24&-(i&1)}},Ct=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function Fx(t){t.reverse();const e=t[15]&1;let n=0;for(let r=0;r<t.length;r++){const i=t[r];t[r]=i>>>1|n,n=(i&1)<<7}return t[0]^=-e&225,t}const Lx=t=>t>64*1024?8:t>1024?4:2;class Rp{constructor(e,n){this.blockLen=Dn,this.outputLen=Dn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=ts(e),ko(e,16);const r=Rx(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const c=[];for(let p=0;p<128;p++)c.push({s0:Ct(i),s1:Ct(s),s2:Ct(o),s3:Ct(a)}),{s0:i,s1:s,s2:o,s3:a}=Ux(i,s,o,a);const u=Lx(n||1024);if(![1,2,4,8].includes(u))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=u;const h=128/u,d=this.windowSize=2**u,f=[];for(let p=0;p<h;p++)for(let y=0;y<d;y++){let m=0,A=0,$=0,_=0;for(let x=0;x<u;x++){if(!(y>>>u-x-1&1))continue;const{s0:R,s1:F,s2:U,s3:D}=c[u*p+x];m^=R,A^=F,$^=U,_^=D}f.push({s0:m,s1:A,s2:$,s3:_})}this.t=f}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let c=0,u=0,l=0,h=0;const d=(1<<s)-1;let f=0;for(const p of[e,n,r,i])for(let y=0;y<4;y++){const m=p>>>8*y&255;for(let A=8/s-1;A>=0;A--){const $=m>>>s*A&d,{s0:_,s1:x,s2:T,s3:R}=o[f*a+$];c^=_,u^=x,l^=T,h^=R,f+=1}}this.s0=c,this.s1=u,this.s2=l,this.s3=h}update(e){qo(this),e=ts(e),ko(e);const n=es(e),r=Math.floor(e.length/Dn),i=e.length%Dn;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return i&&(wu.set(e.subarray(r*Dn)),this._updateBlock(sn[0],sn[1],sn[2],sn[3]),yu(sn)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){qo(this),Tp(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=es(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Dn);return this.digestInto(e),this.destroy(),e}}class kx extends Rp{constructor(e,n){e=ts(e),ko(e);const r=Fx(Pp(e));super(r,n),yu(r)}update(e){e=ts(e),qo(this);const n=es(e),r=e.length%Dn,i=Math.floor(e.length/Dn);for(let s=0;s<i;s++)this._updateBlock(Ct(n[s*4+3]),Ct(n[s*4+2]),Ct(n[s*4+1]),Ct(n[s*4+0]));return r&&(wu.set(e.subarray(i*Dn)),this._updateBlock(Ct(sn[3]),Ct(sn[2]),Ct(sn[1]),Ct(sn[0])),yu(sn)),this}digestInto(e){qo(this),Tp(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=es(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function Np(t){const e=(r,i)=>t(i,r.length).update(ts(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}Np((t,e)=>new Rp(t,e)),Np((t,e)=>new kx(t,e));const Cp=Yn(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),qx=Cp.create(BigInt("-3")),Mx=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");_o({a:qx,b:Mx,Fp:Cp,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},li);const Up=Yn(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),jx=Up.create(BigInt("-3")),zx=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");_o({a:jx,b:zx,Fp:Up,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},d3);const Fp=Yn(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),Vx=Fp.create(BigInt("-3")),Hx=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");_o({a:Vx,b:Hx,Fp,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},h3);var Kx={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,h,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new i(l,h||c,d),p=n?n+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],f]:c._events[p].push(f):(c._events[p]=f,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,h;if(this._eventsCount===0)return u;for(h in l=this._events)e.call(l,h)&&u.push(n?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=n?n+u:u,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,p=new Array(f);d<f;d++)p[d]=h[d].fn;return p},a.prototype.listenerCount=function(u){var l=n?n+u:u,h=this._events[l];return h?h.fn?1:h.length:0},a.prototype.emit=function(u,l,h,d,f,p){var y=n?n+u:u;if(!this._events[y])return!1;var m=this._events[y],A=arguments.length,$,_;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),A){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,l),!0;case 3:return m.fn.call(m.context,l,h),!0;case 4:return m.fn.call(m.context,l,h,d),!0;case 5:return m.fn.call(m.context,l,h,d,f),!0;case 6:return m.fn.call(m.context,l,h,d,f,p),!0}for(_=1,$=new Array(A-1);_<A;_++)$[_-1]=arguments[_];m.fn.apply(m.context,$)}else{var x=m.length,T;for(_=0;_<x;_++)switch(m[_].once&&this.removeListener(u,m[_].fn,void 0,!0),A){case 1:m[_].fn.call(m[_].context);break;case 2:m[_].fn.call(m[_].context,l);break;case 3:m[_].fn.call(m[_].context,l,h);break;case 4:m[_].fn.call(m[_].context,l,h,d);break;default:if(!$)for(T=1,$=new Array(A-1);T<A;T++)$[T-1]=arguments[T];m[_].fn.apply(m[_].context,$)}}return!0},a.prototype.on=function(u,l,h){return s(this,u,l,h,!1)},a.prototype.once=function(u,l,h){return s(this,u,l,h,!0)},a.prototype.removeListener=function(u,l,h,d){var f=n?n+u:u;if(!this._events[f])return this;if(!l)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===l&&(!d||p.once)&&(!h||p.context===h)&&o(this,f);else{for(var y=0,m=[],A=p.length;y<A;y++)(p[y].fn!==l||d&&!p[y].once||h&&p[y].context!==h)&&m.push(p[y]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=n?n+u:u,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a})(Kx);function Gx(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const f=u.length;for(;d!==f&&u[d]===0;)d++,l++;const p=(f-d)*s+1>>>0,y=new Uint8Array(p);for(;d!==f;){let $=u[d],_=0;for(let x=p-1;($!==0||_<h)&&x!==-1;x--,_++)$+=256*y[x]>>>0,y[x]=$%n>>>0,$=$/n>>>0;if($!==0)throw new Error("Non-zero carry");h=_,d++}let m=p-h;for(;m!==p&&y[m]===0;)m++;let A=r.repeat(l);for(;m<p;++m)A+=t.charAt(y[m]);return A}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===r;)h++,l++;const f=(u.length-l)*i+1>>>0,p=new Uint8Array(f);for(;l<u.length;){const $=u.charCodeAt(l);if($>255)return;let _=e[$];if(_===255)return;let x=0;for(let T=f-1;(_!==0||x<d)&&T!==-1;T--,x++)_+=n*p[T]>>>0,p[T]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");d=x,l++}let y=f-d;for(;y!==f&&p[y]===0;)y++;const m=new Uint8Array(h+(f-y));let A=h;for(;y!==f;)m[A++]=p[y++];return m}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Wx="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",ns=Gx(Wx);function Zx(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.charCodeAt(r++);if((i&4294967168)===0){n++;continue}else if((i&4294965248)===0)n+=2;else{if(i>=55296&&i<=56319&&r<e){const s=t.charCodeAt(r);(s&64512)===56320&&(++r,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?n+=3:n+=4}}return n}function Yx(t,e,n){const r=t.length;let i=n,s=0;for(;s<r;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const Xx=new TextEncoder,Jx=50;function Qx(t,e,n){Xx.encodeInto(t,e.subarray(n))}function e6(t,e,n){t.length>Jx?Qx(t,e,n):Yx(t,e,n)}const t6=4096;function Lp(t,e,n){let r=e;const i=r+n,s=[];let o="";for(;r<i;){const a=t[r++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[r++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[r++]&63,u=t[r++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[r++]&63,u=t[r++]&63,l=t[r++]&63;let h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=t6&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const n6=new TextDecoder,r6=200;function i6(t,e,n){const r=t.subarray(e,e+n);return n6.decode(r)}function s6(t,e,n){return n>r6?i6(t,e,n):Lp(t,e,n)}class Mo{constructor(e,n){this.type=e,this.data=n}}class At extends Error{constructor(e){super(e);const n=Object.create(At.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:At.name})}}const rs=4294967295;function o6(t,e,n){const r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function kp(t,e,n){const r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function qp(t,e){const n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function a6(t,e){const n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}const c6=-1,u6=4294967296-1,l6=17179869184-1;function f6({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=l6)if(e===0&&t<=u6){const n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t),n}else{const n=t/4294967296,r=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|n&3),s.setUint32(4,r),i}else{const n=new Uint8Array(12),r=new DataView(n.buffer);return r.setUint32(0,e),kp(r,4,t),n}}function h6(t){const e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function d6(t){if(t instanceof Date){const e=h6(t);return f6(e)}else return null}function p6(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const n=e.getUint32(0),r=e.getUint32(4),i=(n&3)*4294967296+r,s=n>>>2;return{sec:i,nsec:s}}case 12:{const n=qp(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new At(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function g6(t){const e=p6(t);return new Date(e.sec*1e3+e.nsec/1e6)}const b6={type:c6,encode:d6,decode:g6};class jo{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(b6)}register({type:e,encode:n,decode:r}){if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{const i=-1-e;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}}tryToEncode(e,n){for(let r=0;r<this.builtInEncoders.length;r++){const i=this.builtInEncoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=-1-r;return new Mo(o,s)}}}for(let r=0;r<this.encoders.length;r++){const i=this.encoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=r;return new Mo(o,s)}}}return e instanceof Mo?e:null}decode(e,n,r){const i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new Mo(n,e)}}jo.defaultCodec=new jo;function y6(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function mu(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):y6(t)?new Uint8Array(t):Uint8Array.from(t)}const w6=100,m6=2048;class vu{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??jo.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??w6,this.initialBufferSize=e?.initialBufferSize??m6,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new vu({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,n){if(n>this.maxDepth)throw new Error(`Too deep objects in depth ${n}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)}ensureBufferSizeToWrite(e){const n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)}resizeBuffer(e){const n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const r=Zx(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),e6(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,n){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error(`Too large binary: ${n}`);const r=mu(e);this.writeU8a(r)}encodeArray(e,n){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const i of e)this.doEncode(i,n+1)}countWithoutUndefined(e,n){let r=0;for(const i of n)e[i]!==void 0&&r++;return r}encodeMap(e,n){const r=Object.keys(e);this.sortKeys&&r.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of r){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,n+1))}}encodeExtension(e){if(typeof e.data=="function"){const r=e.data(this.pos+6),i=r.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(r);return}const n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error(`Too large extension object: ${n}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),o6(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),kp(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function v6(t,e){return new vu(e).encodeSharedRef(t)}function Eu(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const E6=16,x6=16;class _6{constructor(e=E6,n=x6){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=n,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,n,r){const i=this.caches[r-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<r;a++)if(o[a]!==e[n+a])continue e;return s.str}return null}store(e,n){const r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,n,r){const i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;const s=Lp(e,n,r),o=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(o,s),s}}const xu="array",is="map_key",Mp="map_value",S6=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new At("The type of key must be string or number but "+typeof t)};class I6{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const n=this.getUninitializedStateFromPool();n.type=xu,n.position=0,n.size=e,n.array=new Array(e)}pushMapState(e){const n=this.getUninitializedStateFromPool();n.type=is,n.readCount=0,n.size=e,n.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===xu){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===is||e.type===Mp){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const ss=-1,_u=new DataView(new ArrayBuffer(0)),O6=new Uint8Array(_u.buffer);try{_u.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const jp=new RangeError("Insufficient data"),A6=new _6;class Su{constructor(e){this.totalPos=0,this.pos=0,this.view=_u,this.bytes=O6,this.headByte=ss,this.stack=new I6,this.entered=!1,this.extensionCodec=e?.extensionCodec??jo.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??rs,this.maxBinLength=e?.maxBinLength??rs,this.maxArrayLength=e?.maxArrayLength??rs,this.maxMapLength=e?.maxMapLength??rs,this.maxExtLength=e?.maxExtLength??rs,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:A6,this.mapKeyConverter=e?.mapKeyConverter??S6}clone(){return new Su({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=ss,this.stack.reset()}setBuffer(e){const n=mu(e);this.bytes=n,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===ss&&!this.hasRemaining(1))this.setBuffer(e);else{const n=this.bytes.subarray(this.pos),r=mu(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:n,pos:r}=this;return new RangeError(`Extra ${n.byteLength-r} of ${n.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let n=!1,r;for await(const a of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{r=this.doDecodeSync(),n=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return r}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Eu(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,n){if(this.entered){yield*this.clone().decodeMultiAsync(e,n);return}try{this.entered=!0;let r=n,i=-1;for await(const s of e){if(n&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),r&&(i=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let n;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else{const i=e-160;n=this.decodeString(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){const i=this.lookU8();n=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();n=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();n=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===196){const i=this.lookU8();n=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();n=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();n=this.decodeBinary(i,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();n=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();n=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();n=this.decodeExtension(i,4)}else throw new At(`Unrecognized type byte: ${Eu(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const i=r.top();if(i.type===xu)if(i.array[i.position]=n,i.position++,i.position===i.size)n=i.array,r.release(i);else continue e;else if(i.type===is){if(n==="__proto__")throw new At("The key __proto__ is not allowed");i.key=this.mapKeyConverter(n),i.type=Mp;continue e}else if(i.map[i.key]=n,i.readCount++,i.readCount===i.size)n=i.map,r.release(i);else{i.key=null,i.type=is;continue e}}return n}}readHeadByte(){return this.headByte===ss&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=ss}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new At(`Unrecognized array type byte: ${Eu(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new At(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new At(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,n){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,n):this.decodeBinary(e,n)}decodeUtf8String(e,n){if(e>this.maxStrLength)throw new At(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+n+e)throw jp;const r=this.pos+n;let i;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?i=this.keyDecoder.decode(this.bytes,r,e):i=s6(this.bytes,r,e),this.pos+=n+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===is:!1}decodeBinary(e,n){if(e>this.maxBinLength)throw new At(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+n))throw jp;const r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i}decodeExtension(e,n){if(e>this.maxExtLength)throw new At(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=a6(this.view,this.pos);return this.pos+=8,e}readI64(){const e=qp(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function B6(t,e){return new Su(e).decode(t)}function Iu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function zp(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Iu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function os(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=zp(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return Iu(n)}function D6(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,m=0,A=0,$=p.length;A!==$&&p[A]===0;)A++,y++;for(var _=($-A)*l+1>>>0,x=new Uint8Array(_);A!==$;){for(var T=p[A],R=0,F=_-1;(T!==0||R<m)&&F!==-1;F--,R++)T+=256*x[F]>>>0,x[F]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");m=R,A++}for(var U=_-m;U!==_&&x[U]===0;)U++;for(var D=c.repeat(y);U<_;++U)D+=t.charAt(x[U]);return D}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var m=0,A=0;p[y]===c;)m++,y++;for(var $=(p.length-y)*u+1>>>0,_=new Uint8Array($);p[y];){var x=n[p.charCodeAt(y)];if(x===255)return;for(var T=0,R=$-1;(x!==0||T<A)&&R!==-1;R--,T++)x+=a*_[R]>>>0,_[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");A=T,y++}if(p[y]!==" "){for(var F=$-A;F!==$&&_[F]===0;)F++;for(var U=new Uint8Array(m+($-F)),D=m;F!==$;)U[D++]=_[F++];return U}}}function f(p){var y=d(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var $6=D6,T6=$6;const Vp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},P6=t=>new TextEncoder().encode(t),R6=t=>new TextDecoder().decode(t);class N6{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class C6{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hp(this,e)}}class U6{constructor(e){this.decoders=e}or(e){return Hp(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Hp=(t,e)=>new U6({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class F6{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new N6(e,n,r),this.decoder=new C6(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const zo=({name:t,prefix:e,encode:n,decode:r})=>new F6(t,e,n,r),as=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=T6(n,e);return zo({prefix:t,name:e,encode:r,decode:s=>Vp(i(s))})},L6=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},k6=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},qe=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>zo({prefix:e,name:t,encode(i){return k6(i,r,n)},decode(i){return L6(i,r,n,t)}}),q6=zo({prefix:"\0",name:"identity",encode:t=>R6(t),decode:t=>P6(t)});var M6=Object.freeze({__proto__:null,identity:q6});const j6=qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var z6=Object.freeze({__proto__:null,base2:j6});const V6=qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var H6=Object.freeze({__proto__:null,base8:V6});const K6=as({prefix:"9",name:"base10",alphabet:"0123456789"});var G6=Object.freeze({__proto__:null,base10:K6});const W6=qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Z6=qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Y6=Object.freeze({__proto__:null,base16:W6,base16upper:Z6});const X6=qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),J6=qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q6=qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),e_=qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),t_=qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),n_=qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),r_=qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),i_=qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),s_=qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var o_=Object.freeze({__proto__:null,base32:X6,base32upper:J6,base32pad:Q6,base32padupper:e_,base32hex:t_,base32hexupper:n_,base32hexpad:r_,base32hexpadupper:i_,base32z:s_});const a_=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),c_=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var u_=Object.freeze({__proto__:null,base36:a_,base36upper:c_});const l_=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),f_=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var h_=Object.freeze({__proto__:null,base58btc:l_,base58flickr:f_});const d_=qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),p_=qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),g_=qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b_=qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var y_=Object.freeze({__proto__:null,base64:d_,base64pad:p_,base64url:g_,base64urlpad:b_});const Kp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),w_=Kp.reduce((t,e,n)=>(t[n]=e,t),[]),m_=Kp.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function v_(t){return t.reduce((e,n)=>(e+=w_[n],e),"")}function E_(t){const e=[];for(const n of t){const r=m_[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const x_=zo({prefix:"\u{1F680}",name:"base256emoji",encode:v_,decode:E_});var __=Object.freeze({__proto__:null,base256emoji:x_}),S_=Wp,Gp=128,I_=127,O_=~I_,A_=Math.pow(2,31);function Wp(t,e,n){e=e||[],n=n||0;for(var r=n;t>=A_;)e[n++]=t&255|Gp,t/=128;for(;t&O_;)e[n++]=t&255|Gp,t>>>=7;return e[n]=t|0,Wp.bytes=n-r+1,e}var B_=Ou,D_=128,Zp=127;function Ou(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw Ou.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&Zp)<<i:(o&Zp)*Math.pow(2,i),i+=7}while(o>=D_);return Ou.bytes=s-r,n}var $_=Math.pow(2,7),T_=Math.pow(2,14),P_=Math.pow(2,21),R_=Math.pow(2,28),N_=Math.pow(2,35),C_=Math.pow(2,42),U_=Math.pow(2,49),F_=Math.pow(2,56),L_=Math.pow(2,63),k_=function(t){return t<$_?1:t<T_?2:t<P_?3:t<R_?4:t<N_?5:t<C_?6:t<U_?7:t<F_?8:t<L_?9:10},q_={encode:S_,decode:B_,encodingLength:k_},Yp=q_;const Xp=(t,e,n=0)=>(Yp.encode(t,e,n),e),Jp=t=>Yp.encodingLength(t),Au=(t,e)=>{const n=e.byteLength,r=Jp(t),i=r+Jp(n),s=new Uint8Array(i+n);return Xp(t,s,0),Xp(n,s,r),s.set(e,i),new M_(t,n,e,s)};class M_{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const Qp=({name:t,code:e,encode:n})=>new j_(t,e,n);class j_{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Au(this.code,n):n.then(r=>Au(this.code,r))}else throw Error("Unknown type, must be binary type")}}const e0=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),z_=Qp({name:"sha2-256",code:18,encode:e0("SHA-256")}),V_=Qp({name:"sha2-512",code:19,encode:e0("SHA-512")});var H_=Object.freeze({__proto__:null,sha256:z_,sha512:V_});const t0=0,K_="identity",n0=Vp;var G_=Object.freeze({__proto__:null,identity:{code:t0,name:K_,encode:n0,digest:t=>Au(t0,n0(t))}});new TextEncoder,new TextDecoder;const r0={...M6,...z6,...H6,...G6,...Y6,...o_,...u_,...h_,...y_,...__};({...H_,...G_});function i0(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const s0=i0("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Bu=i0("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=zp(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),o0={utf8:s0,"utf-8":s0,hex:r0.base16,latin1:Bu,ascii:Bu,binary:Bu,...r0};function Ut(t,e="utf8"){const n=o0[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Iu(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function wt(t,e="utf8"){const n=o0[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}const W_={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},Z_="Input must be an string, Buffer or Uint8Array";function Y_(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(Z_);return e}function X_(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function Vo(t){return(4294967296+t).toString(16).substring(1)}function J_(t,e,n){let r=`
`+t+" = ";for(let i=0;i<e.length;i+=2){if(n===32)r+=Vo(e[i]).toUpperCase(),r+=" ",r+=Vo(e[i+1]).toUpperCase();else if(n===64)r+=Vo(e[i+1]).toUpperCase(),r+=Vo(e[i]).toUpperCase();else throw new Error("Invalid size "+n);i%6===4?r+=`
`+new Array(t.length+4).join(" "):i<e.length-2&&(r+=" ")}console.log(r)}function Q_(t,e,n){let r=new Date().getTime();const i=new Uint8Array(e);for(let o=0;o<e;o++)i[o]=o%256;const s=new Date().getTime();console.log("Generated random input in "+(s-r)+"ms"),r=s;for(let o=0;o<n;o++){const a=t(i),c=new Date().getTime(),u=c-r;r=c,console.log("Hashed in "+u+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(u/1e3)*100)/100+" MB PER SECOND")}}var a0={normalizeInput:Y_,toHex:X_,debugPrint:J_,testSpeed:Q_};const Ho=a0;function Ko(t,e,n){const r=t[e]+t[n];let i=t[e+1]+t[n+1];r>=4294967296&&i++,t[e]=r,t[e+1]=i}function c0(t,e,n,r){let i=t[e]+n;n<0&&(i+=4294967296);let s=t[e+1]+r;i>=4294967296&&s++,t[e]=i,t[e+1]=s}function u0(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function tr(t,e,n,r,i,s){const o=cs[i],a=cs[i+1],c=cs[s],u=cs[s+1];Ko(te,t,e),c0(te,t,o,a);let l=te[r]^te[t],h=te[r+1]^te[t+1];te[r]=h,te[r+1]=l,Ko(te,n,r),l=te[e]^te[n],h=te[e+1]^te[n+1],te[e]=l>>>24^h<<8,te[e+1]=h>>>24^l<<8,Ko(te,t,e),c0(te,t,c,u),l=te[r]^te[t],h=te[r+1]^te[t+1],te[r]=l>>>16^h<<16,te[r+1]=h>>>16^l<<16,Ko(te,n,r),l=te[e]^te[n],h=te[e+1]^te[n+1],te[e]=h>>>31^l<<1,te[e+1]=l>>>31^h<<1}const l0=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),e4=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Ze=new Uint8Array(e4.map(function(t){return t*2})),te=new Uint32Array(32),cs=new Uint32Array(32);function f0(t,e){let n=0;for(n=0;n<16;n++)te[n]=t.h[n],te[n+16]=l0[n];for(te[24]=te[24]^t.t,te[25]=te[25]^t.t/4294967296,e&&(te[28]=~te[28],te[29]=~te[29]),n=0;n<32;n++)cs[n]=u0(t.b,4*n);for(n=0;n<12;n++)tr(0,8,16,24,Ze[n*16+0],Ze[n*16+1]),tr(2,10,18,26,Ze[n*16+2],Ze[n*16+3]),tr(4,12,20,28,Ze[n*16+4],Ze[n*16+5]),tr(6,14,22,30,Ze[n*16+6],Ze[n*16+7]),tr(0,10,20,30,Ze[n*16+8],Ze[n*16+9]),tr(2,12,22,24,Ze[n*16+10],Ze[n*16+11]),tr(4,14,16,26,Ze[n*16+12],Ze[n*16+13]),tr(6,8,18,28,Ze[n*16+14],Ze[n*16+15]);for(n=0;n<16;n++)t.h[n]=t.h[n]^te[n]^te[n+16]}const nr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function h0(t,e,n,r){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(n&&n.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(r&&r.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const i={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};nr.fill(0),nr[0]=t,e&&(nr[1]=e.length),nr[2]=1,nr[3]=1,n&&nr.set(n,32),r&&nr.set(r,48);for(let s=0;s<16;s++)i.h[s]=l0[s]^u0(nr,s*4);return e&&(Du(i,e),i.c=128),i}function Du(t,e){for(let n=0;n<e.length;n++)t.c===128&&(t.t+=t.c,f0(t,!1),t.c=0),t.b[t.c++]=e[n]}function d0(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;f0(t,!0);const e=new Uint8Array(t.outlen);for(let n=0;n<t.outlen;n++)e[n]=t.h[n>>2]>>8*(n&3);return e}function p0(t,e,n,r,i){n=n||64,t=Ho.normalizeInput(t),r&&(r=Ho.normalizeInput(r)),i&&(i=Ho.normalizeInput(i));const s=h0(n,e,r,i);return Du(s,t),d0(s)}function t4(t,e,n,r,i){const s=p0(t,e,n,r,i);return Ho.toHex(s)}var n4={blake2b:p0,blake2bHex:t4,blake2bInit:h0,blake2bUpdate:Du,blake2bFinal:d0};const g0=a0;function r4(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function rr(t,e,n,r,i,s){ce[t]=ce[t]+ce[e]+i,ce[r]=Go(ce[r]^ce[t],16),ce[n]=ce[n]+ce[r],ce[e]=Go(ce[e]^ce[n],12),ce[t]=ce[t]+ce[e]+s,ce[r]=Go(ce[r]^ce[t],8),ce[n]=ce[n]+ce[r],ce[e]=Go(ce[e]^ce[n],7)}function Go(t,e){return t>>>e^t<<32-e}const b0=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ye=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ce=new Uint32Array(16),Me=new Uint32Array(16);function y0(t,e){let n=0;for(n=0;n<8;n++)ce[n]=t.h[n],ce[n+8]=b0[n];for(ce[12]^=t.t,ce[13]^=t.t/4294967296,e&&(ce[14]=~ce[14]),n=0;n<16;n++)Me[n]=r4(t.b,4*n);for(n=0;n<10;n++)rr(0,4,8,12,Me[Ye[n*16+0]],Me[Ye[n*16+1]]),rr(1,5,9,13,Me[Ye[n*16+2]],Me[Ye[n*16+3]]),rr(2,6,10,14,Me[Ye[n*16+4]],Me[Ye[n*16+5]]),rr(3,7,11,15,Me[Ye[n*16+6]],Me[Ye[n*16+7]]),rr(0,5,10,15,Me[Ye[n*16+8]],Me[Ye[n*16+9]]),rr(1,6,11,12,Me[Ye[n*16+10]],Me[Ye[n*16+11]]),rr(2,7,8,13,Me[Ye[n*16+12]],Me[Ye[n*16+13]]),rr(3,4,9,14,Me[Ye[n*16+14]],Me[Ye[n*16+15]]);for(n=0;n<8;n++)t.h[n]^=ce[n]^ce[n+8]}function w0(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const n=e?e.length:0;if(e&&!(n>0&&n<=32))throw new Error("Incorrect key length, should be in [1, 32]");const r={h:new Uint32Array(b0),b:new Uint8Array(64),c:0,t:0,outlen:t};return r.h[0]^=16842752^n<<8^t,n>0&&($u(r,e),r.c=64),r}function $u(t,e){for(let n=0;n<e.length;n++)t.c===64&&(t.t+=t.c,y0(t,!1),t.c=0),t.b[t.c++]=e[n]}function m0(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;y0(t,!0);const e=new Uint8Array(t.outlen);for(let n=0;n<t.outlen;n++)e[n]=t.h[n>>2]>>8*(n&3)&255;return e}function v0(t,e,n){n=n||32,t=g0.normalizeInput(t);const r=w0(n,e);return $u(r,t),m0(r)}function i4(t,e,n){const r=v0(t,e,n);return g0.toHex(r)}var s4={blake2s:v0,blake2sHex:i4,blake2sInit:w0,blake2sUpdate:$u,blake2sFinal:m0};const us=n4,ls=s4;var o4={blake2b:us.blake2b,blake2bHex:us.blake2bHex,blake2bInit:us.blake2bInit,blake2bUpdate:us.blake2bUpdate,blake2bFinal:us.blake2bFinal,blake2s:ls.blake2s,blake2sHex:ls.blake2sHex,blake2sInit:ls.blake2sInit,blake2sUpdate:ls.blake2sUpdate,blake2sFinal:ls.blake2sFinal},a4=Object.defineProperty,c4=Object.defineProperties,u4=Object.getOwnPropertyDescriptors,E0=Object.getOwnPropertySymbols,l4=Object.prototype.hasOwnProperty,f4=Object.prototype.propertyIsEnumerable,x0=(t,e,n)=>e in t?a4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mi=(t,e)=>{for(var n in e||(e={}))l4.call(e,n)&&x0(t,n,e[n]);if(E0)for(var n of E0(e))f4.call(e,n)&&x0(t,n,e[n]);return t},fs=(t,e)=>c4(t,u4(e));const h4=":";function Wo(t){const[e,n]=t.split(h4);return{namespace:e,reference:n}}function _0(t,e){return t.includes(":")?[t]:e.chains||[]}var d4=Object.defineProperty,p4=Object.defineProperties,g4=Object.getOwnPropertyDescriptors,S0=Object.getOwnPropertySymbols,b4=Object.prototype.hasOwnProperty,y4=Object.prototype.propertyIsEnumerable,Tu=(t,e,n)=>e in t?d4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,I0=(t,e)=>{for(var n in e||(e={}))b4.call(e,n)&&Tu(t,n,e[n]);if(S0)for(var n of S0(e))y4.call(e,n)&&Tu(t,n,e[n]);return t},w4=(t,e)=>p4(t,g4(e)),O0=(t,e,n)=>Tu(t,typeof e!="symbol"?e+"":e,n);const m4="ReactNative",Bt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},v4="js";function Zo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ir(){return!Dr()&&!!pc()&&navigator.product===m4}function E4(){return ir()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function x4(){return ir()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function vi(){return!Zo()&&!!pc()&&!!Dr()}function hs(){return ir()?Bt.reactNative:Zo()?Bt.node:vi()?Bt.browser:Bt.unknown}function A0(){var t;try{return ir()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function _4(t,e){const n=new URLSearchParams(t);return Object.entries(e).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function S4(t){var e,n;const r=B0();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),w4(I0(I0({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(n=t?.icons)!=null&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function B0(){return Ph()||{name:"",description:"",url:"",icons:[""]}}function I4(){if(hs()===Bt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const t=pE();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function O4(){var t;const e=hs();return e===Bt.browser?[e,((t=Th())==null?void 0:t.host)||"unknown"].join(":"):e}function D0(t,e,n){const r=I4(),i=O4();return[[t,e].join("-"),[v4,n].join("-"),r,i].join("/")}function A4({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=n.split("?"),l=D0(t,e,r),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},d=_4(u[1]||"",h);return u[0]+"?"+d}function Fr(t,e){return t.filter(n=>e.includes(n)).length===t.length}function Pu(t){return Object.fromEntries(t.entries())}function Ru(t){return new Map(Object.entries(t))}function Lr(t=K.FIVE_MINUTES,e){const n=K.toMiliseconds(t||K.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},n),r=a,i=c})}}function on(t,e,n){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(new Error(n)),e);try{const o=await t;r(o)}catch(o){i(o)}clearTimeout(s)})}function $0(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function B4(t){return $0("topic",t)}function D4(t){return $0("id",t)}function T0(t){const[e,n]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")r.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return r}function $e(t,e){return K.fromMiliseconds((e||Date.now())+K.toMiliseconds(t))}function sr(t){return Date.now()>=K.toMiliseconds(t)}function de(t,e){return`${t}${e?`:${e}`:""}`}function kr(t=[],e=[]){return[...new Set([...t,...e])]}async function $4({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;const i=typeof n=="string"?JSON.parse(n):n,s=i?.href;if(typeof s!="string")return;const o=T4(s,t,e),a=hs();if(a===Bt.browser){if(!((r=Dr())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}P4(o)}else a===Bt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function T4(t,e,n){const r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${U4(r,!0)}`}else i=`${i}/wc?${r}`;return i}function P4(t){let e="_self";C4()?e="_top":(N4()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function R4(t,e){let n="";try{if(vi()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function P0(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function R0(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Nu(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function N4(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function C4(){try{return window.self!==window.top}catch{return!1}}function U4(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function N0(t){return Buffer.from(t,"base64").toString("utf-8")}function F4(t){return new Promise(e=>setTimeout(e,t))}class L4{constructor({limit:e}){O0(this,"limit"),O0(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}}const Yo=BigInt(2**32-1),C0=BigInt(32);function U0(t,e=!1){return e?{h:Number(t&Yo),l:Number(t>>C0&Yo)}:{h:Number(t>>C0&Yo)|0,l:Number(t&Yo)|0}}function F0(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=U0(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const L0=(t,e,n)=>t>>>n,k0=(t,e,n)=>t<<32-n|e>>>n,or=(t,e,n)=>t>>>n|e<<32-n,ar=(t,e,n)=>t<<32-n|e>>>n,ds=(t,e,n)=>t<<64-n|e>>>n-32,ps=(t,e,n)=>t>>>n-32|e<<64-n,k4=(t,e)=>e,q4=(t,e)=>t,M4=(t,e,n)=>t<<n|e>>>32-n,j4=(t,e,n)=>e<<n|t>>>32-n,z4=(t,e,n)=>e<<n-32|t>>>64-n,V4=(t,e,n)=>t<<n-32|e>>>64-n;function Gt(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const Cu=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Uu=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,H4=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),K4=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,G4=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),W4=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,Ei=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Xo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function $n(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Wt(t,...e){if(!Xo(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Jo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");$n(t.outputLen),$n(t.blockLen)}function cr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Fu(t,e){Wt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function gs(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ft(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Lu(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function an(t,e){return t<<32-e|t>>>e}const q0=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function M0(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Tn=q0?t=>t:t=>M0(t);function Z4(t){for(let e=0;e<t.length;e++)t[e]=M0(t[e]);return t}const ur=q0?t=>t:Z4,j0=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Y4=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function xi(t){if(Wt(t),j0)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Y4[t[n]];return e}const Pn={_0:48,_9:57,A:65,F:70,a:97,f:102};function z0(t){if(t>=Pn._0&&t<=Pn._9)return t-Pn._0;if(t>=Pn.A&&t<=Pn.F)return t-(Pn.A-10);if(t>=Pn.a&&t<=Pn.f)return t-(Pn.a-10)}function Qo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(j0)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=z0(t.charCodeAt(s)),a=z0(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function V0(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Zt(t){return typeof t=="string"&&(t=V0(t)),Wt(t),t}function lr(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Wt(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}class ea{}function bs(t){const e=r=>t().update(Zt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function X4(t){const e=(r,i)=>t(i).update(Zt(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function qr(t=32){if(Ei&&typeof Ei.getRandomValues=="function")return Ei.getRandomValues(new Uint8Array(t));if(Ei&&typeof Ei.randomBytes=="function")return Uint8Array.from(Ei.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const J4=BigInt(0),ys=BigInt(1),Q4=BigInt(2),e5=BigInt(7),t5=BigInt(256),n5=BigInt(113),H0=[],K0=[],G0=[];for(let t=0,e=ys,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],H0.push(2*(5*r+n)),K0.push((t+1)*(t+2)/2%64);let i=J4;for(let s=0;s<7;s++)e=(e<<ys^(e>>e5)*n5)%t5,e&Q4&&(i^=ys<<(ys<<BigInt(s))-ys);G0.push(i)}const W0=F0(G0,!0),r5=W0[0],i5=W0[1],Z0=(t,e,n)=>n>32?z4(t,e,n):M4(t,e,n),Y0=(t,e,n)=>n>32?V4(t,e,n):j4(t,e,n);function s5(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=Z0(u,l,1)^n[a],d=Y0(u,l,1)^n[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=K0[o],c=Z0(i,s,a),u=Y0(i,s,a),l=H0[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=r5[r],t[1]^=i5[r]}Ft(n)}class ku extends ea{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,$n(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=gs(this.state)}clone(){return this._cloneInto()}keccak(){ur(this.state32),s5(this.state32,this.rounds),ur(this.state32),this.posOut=0,this.pos=0}update(e){cr(this),e=Zt(e),Wt(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){cr(this,!1),Wt(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return $n(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Fu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ft(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new ku(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const o5=(t,e,n)=>bs(()=>new ku(e,t,n)),a5=o5(1,136,256/8);function c5(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function u5(t,e,n){return t&e^~t&n}function l5(t,e,n){return t&e^t&n^e&n}class X0 extends ea{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Lu(this.buffer)}update(e){cr(this),e=Zt(e),Wt(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Lu(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){cr(this),Fu(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,Ft(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;c5(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Lu(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const fr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xe=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Je=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),f5=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),hr=new Uint32Array(64);class h5 extends X0{constructor(e=32){super(64,e,8,!1),this.A=fr[0]|0,this.B=fr[1]|0,this.C=fr[2]|0,this.D=fr[3]|0,this.E=fr[4]|0,this.F=fr[5]|0,this.G=fr[6]|0,this.H=fr[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)hr[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=hr[h-15],f=hr[h-2],p=an(d,7)^an(d,18)^d>>>3,y=an(f,17)^an(f,19)^f>>>10;hr[h]=y+hr[h-7]+p+hr[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=an(a,6)^an(a,11)^an(a,25),f=l+d+u5(a,c,u)+f5[h]+hr[h]|0,p=(an(r,2)^an(r,13)^an(r,22))+l5(r,i,s)|0;l=u,u=c,c=a,a=o+f|0,o=s,s=i,i=r,r=f+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){Ft(hr)}destroy(){this.set(0,0,0,0,0,0,0,0),Ft(this.buffer)}}const J0=F0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),d5=J0[0],p5=J0[1],dr=new Uint32Array(80),pr=new Uint32Array(80);class qu extends X0{constructor(e=64){super(128,e,16,!1),this.Ah=Je[0]|0,this.Al=Je[1]|0,this.Bh=Je[2]|0,this.Bl=Je[3]|0,this.Ch=Je[4]|0,this.Cl=Je[5]|0,this.Dh=Je[6]|0,this.Dl=Je[7]|0,this.Eh=Je[8]|0,this.El=Je[9]|0,this.Fh=Je[10]|0,this.Fl=Je[11]|0,this.Gh=Je[12]|0,this.Gl=Je[13]|0,this.Hh=Je[14]|0,this.Hl=Je[15]|0}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:y,Hl:m}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=y|0,this.Hl=m|0}process(e,n){for(let _=0;_<16;_++,n+=4)dr[_]=e.getUint32(n),pr[_]=e.getUint32(n+=4);for(let _=16;_<80;_++){const x=dr[_-15]|0,T=pr[_-15]|0,R=or(x,T,1)^or(x,T,8)^L0(x,T,7),F=ar(x,T,1)^ar(x,T,8)^k0(x,T,7),U=dr[_-2]|0,D=pr[_-2]|0,j=or(U,D,19)^ds(U,D,61)^L0(U,D,6),M=ar(U,D,19)^ps(U,D,61)^k0(U,D,6),E=H4(F,M,pr[_-7],pr[_-16]),b=K4(E,R,j,dr[_-7],dr[_-16]);dr[_]=b|0,pr[_]=E|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:y,Gl:m,Hh:A,Hl:$}=this;for(let _=0;_<80;_++){const x=or(h,d,14)^or(h,d,18)^ds(h,d,41),T=ar(h,d,14)^ar(h,d,18)^ps(h,d,41),R=h&f^~h&y,F=d&p^~d&m,U=G4($,T,F,p5[_],pr[_]),D=W4(U,A,x,R,d5[_],dr[_]),j=U|0,M=or(r,i,28)^ds(r,i,34)^ds(r,i,39),E=ar(r,i,28)^ps(r,i,34)^ps(r,i,39),b=r&s^r&a^s&a,v=i&o^i&c^o&c;A=y|0,$=m|0,y=f|0,m=p|0,f=h|0,p=d|0,{h,l:d}=Gt(u|0,l|0,D|0,j|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const g=Cu(j,E,v);r=Uu(g,D,M,b),i=g|0}({h:r,l:i}=Gt(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Gt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Gt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Gt(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=Gt(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=Gt(this.Fh|0,this.Fl|0,f|0,p|0),{h:y,l:m}=Gt(this.Gh|0,this.Gl|0,y|0,m|0),{h:A,l:$}=Gt(this.Hh|0,this.Hl|0,A|0,$|0),this.set(r,i,s,o,a,c,u,l,h,d,f,p,y,m,A,$)}roundClean(){Ft(dr,pr)}destroy(){Ft(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class g5 extends qu{constructor(){super(48),this.Ah=Xe[0]|0,this.Al=Xe[1]|0,this.Bh=Xe[2]|0,this.Bl=Xe[3]|0,this.Ch=Xe[4]|0,this.Cl=Xe[5]|0,this.Dh=Xe[6]|0,this.Dl=Xe[7]|0,this.Eh=Xe[8]|0,this.El=Xe[9]|0,this.Fh=Xe[10]|0,this.Fl=Xe[11]|0,this.Gh=Xe[12]|0,this.Gl=Xe[13]|0,this.Hh=Xe[14]|0,this.Hl=Xe[15]|0}}const Qe=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class b5 extends qu{constructor(){super(32),this.Ah=Qe[0]|0,this.Al=Qe[1]|0,this.Bh=Qe[2]|0,this.Bl=Qe[3]|0,this.Ch=Qe[4]|0,this.Cl=Qe[5]|0,this.Dh=Qe[6]|0,this.Dl=Qe[7]|0,this.Eh=Qe[8]|0,this.El=Qe[9]|0,this.Fh=Qe[10]|0,this.Fl=Qe[11]|0,this.Gh=Qe[12]|0,this.Gl=Qe[13]|0,this.Hh=Qe[14]|0,this.Hl=Qe[15]|0}}const ta=bs(()=>new h5),y5=bs(()=>new qu),w5=bs(()=>new g5),m5=bs(()=>new b5),v5=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Te=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Y=new Uint32Array(32);function gr(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=Y[2*t],u=Y[2*t+1],l=Y[2*e],h=Y[2*e+1],d=Y[2*n],f=Y[2*n+1],p=Y[2*r],y=Y[2*r+1],m=Cu(c,l,o);u=Uu(m,u,h,a),c=m|0,{Dh:y,Dl:p}={Dh:y^u,Dl:p^c},{Dh:y,Dl:p}={Dh:k4(y,p),Dl:q4(y)},{h:f,l:d}=Gt(f,d,y,p),{Bh:h,Bl:l}={Bh:h^f,Bl:l^d},{Bh:h,Bl:l}={Bh:or(h,l,24),Bl:ar(h,l,24)},Y[2*t]=c,Y[2*t+1]=u,Y[2*e]=l,Y[2*e+1]=h,Y[2*n]=d,Y[2*n+1]=f,Y[2*r]=p,Y[2*r+1]=y}function br(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=Y[2*t],u=Y[2*t+1],l=Y[2*e],h=Y[2*e+1],d=Y[2*n],f=Y[2*n+1],p=Y[2*r],y=Y[2*r+1],m=Cu(c,l,o);u=Uu(m,u,h,a),c=m|0,{Dh:y,Dl:p}={Dh:y^u,Dl:p^c},{Dh:y,Dl:p}={Dh:or(y,p,16),Dl:ar(y,p,16)},{h:f,l:d}=Gt(f,d,y,p),{Bh:h,Bl:l}={Bh:h^f,Bl:l^d},{Bh:h,Bl:l}={Bh:ds(h,l,63),Bl:ps(h,l,63)},Y[2*t]=c,Y[2*t+1]=u,Y[2*e]=l,Y[2*e+1]=h,Y[2*n]=d,Y[2*n+1]=f,Y[2*r]=p,Y[2*r+1]=y}function E5(t,e={},n,r,i){if($n(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class x5 extends ea{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,$n(e),$n(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=gs(this.buffer)}update(e){cr(this),e=Zt(e),Wt(e);const{blockLen:n,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(ur(i),this.compress(i,0,!1),ur(i),this.pos=0);const u=Math.min(n-this.pos,s-c),l=o+c;if(u===n&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));ur(h);for(let d=0;c+n<s;d+=i.length,c+=n)this.length+=n,this.compress(h,d,!1);ur(h);continue}r.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){cr(this),Fu(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,Ft(this.buffer.subarray(n)),ur(r),this.compress(r,0,!0),ur(r);const i=gs(e);this.get().forEach((s,o)=>i[o]=Tn(s))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class _5 extends x5{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=Te[0]|0,this.v0h=Te[1]|0,this.v1l=Te[2]|0,this.v1h=Te[3]|0,this.v2l=Te[4]|0,this.v2h=Te[5]|0,this.v3l=Te[6]|0,this.v3h=Te[7]|0,this.v4l=Te[8]|0,this.v4h=Te[9]|0,this.v5l=Te[10]|0,this.v5h=Te[11]|0,this.v6l=Te[12]|0,this.v6h=Te[13]|0,this.v7l=Te[14]|0,this.v7h=Te[15]|0,E5(n,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(r!==void 0&&(r=Zt(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Zt(s);const a=gs(s);this.v4l^=Tn(a[0]),this.v4h^=Tn(a[1]),this.v5l^=Tn(a[2]),this.v5h^=Tn(a[3])}if(i!==void 0){i=Zt(i);const a=gs(i);this.v6l^=Tn(a[0]),this.v6h^=Tn(a[1]),this.v7l^=Tn(a[2]),this.v7h^=Tn(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:d,v6l:f,v6h:p,v7l:y,v7h:m}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m]}set(e,n,r,i,s,o,a,c,u,l,h,d,f,p,y,m){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=d|0,this.v6l=f|0,this.v6h=p|0,this.v7l=y|0,this.v7h=m|0}compress(e,n,r){this.get().forEach((c,u)=>Y[u]=c),Y.set(Te,16);let{h:i,l:s}=U0(BigInt(this.length));Y[24]=Te[8]^s,Y[25]=Te[9]^i,r&&(Y[28]=~Y[28],Y[29]=~Y[29]);let o=0;const a=v5;for(let c=0;c<12;c++)gr(0,4,8,12,e,n+2*a[o++]),br(0,4,8,12,e,n+2*a[o++]),gr(1,5,9,13,e,n+2*a[o++]),br(1,5,9,13,e,n+2*a[o++]),gr(2,6,10,14,e,n+2*a[o++]),br(2,6,10,14,e,n+2*a[o++]),gr(3,7,11,15,e,n+2*a[o++]),br(3,7,11,15,e,n+2*a[o++]),gr(0,5,10,15,e,n+2*a[o++]),br(0,5,10,15,e,n+2*a[o++]),gr(1,6,11,12,e,n+2*a[o++]),br(1,6,11,12,e,n+2*a[o++]),gr(2,7,8,13,e,n+2*a[o++]),br(2,7,8,13,e,n+2*a[o++]),gr(3,4,9,14,e,n+2*a[o++]),br(3,4,9,14,e,n+2*a[o++]);this.v0l^=Y[0]^Y[16],this.v0h^=Y[1]^Y[17],this.v1l^=Y[2]^Y[18],this.v1h^=Y[3]^Y[19],this.v2l^=Y[4]^Y[20],this.v2h^=Y[5]^Y[21],this.v3l^=Y[6]^Y[22],this.v3h^=Y[7]^Y[23],this.v4l^=Y[8]^Y[24],this.v4h^=Y[9]^Y[25],this.v5l^=Y[10]^Y[26],this.v5h^=Y[11]^Y[27],this.v6l^=Y[12]^Y[28],this.v6h^=Y[13]^Y[29],this.v7l^=Y[14]^Y[30],this.v7h^=Y[15]^Y[31],Ft(Y)}destroy(){this.destroyed=!0,Ft(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const S5=X4(t=>new _5(t)),I5="https://rpc.walletconnect.org/v1";function Q0(t){const e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(a5(n)).toString("hex")}async function O5(t,e,n,r,i,s){switch(n.t){case"eip191":return await A5(t,e,n.s);case"eip1271":return await B5(t,e,n.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function A5(t,e,n){const r=$8(n);return Tx({payload:Q0(e),signature:r}).toLowerCase()===t.toLowerCase()}async function B5(t,e,n,r,i,s){const o=Wo(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=n.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Q0(e)).substring(2),d=a+h+c+l+u,f=await fetch(`${s||I5}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:D5(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function D5(){return Date.now()+Math.floor(Math.random()*1e3)}function $5(t){const e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);const r=n[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(n.length<i)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return ns.encode(s)}function T5(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);const i=S5(r,{dkLen:32});return ns.encode(i)}function eg(t){const e=new Uint8Array(ta(P5(t)));return ns.encode(e)}function P5(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function tg(t){const e=Buffer.from(t,"base64"),n=B6(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const r=v6(n),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=m5(s);return Ox.encode(o).replace(/=+$/,"")}function Mu(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function R5(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(Mu(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(Mu(n.length)),i.push(n),i.push(Buffer.from([26])),i.push(Mu(r.length)),i.push(r);const s=Buffer.concat(i),o=ta(s);return Buffer.from(o).toString("hex").toUpperCase()}function N5(t){var e,n;const r=[];try{if(typeof t=="string")return r.push(t),r;if(typeof t!="object")return r;t!=null&&t.id&&r.push(t.id);const i=(n=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:n.transactionHashes;i&&r.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return r}var C5=Object.defineProperty,U5=Object.defineProperties,F5=Object.getOwnPropertyDescriptors,ng=Object.getOwnPropertySymbols,L5=Object.prototype.hasOwnProperty,k5=Object.prototype.propertyIsEnumerable,rg=(t,e,n)=>e in t?C5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q5=(t,e)=>{for(var n in e||(e={}))L5.call(e,n)&&rg(t,n,e[n]);if(ng)for(var n of ng(e))k5.call(e,n)&&rg(t,n,e[n]);return t},M5=(t,e)=>U5(t,F5(e));const ig="did:pkh:",j5={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},z5=t=>t?j5[t]||t:"",na=t=>t?.split(":"),V5=t=>{const e=t&&na(t);if(e)return t.includes(ig)?e[3]:e[1]},H5=t=>{const e=t&&na(t);if(e)return t.includes(ig)?e[2]:e[0]},ju=t=>{const e=t&&na(t);if(e)return e[2]+":"+e[3]},ra=t=>{const e=t&&na(t);if(e)return e.pop()};async function sg(t){const{cacao:e,projectId:n}=t,{s:r,p:i}=e,s=og(i,i.iss),o=ra(i.iss);return await O5(o,s,r,ju(i.iss),n)}const og=(t,e)=>{const n=H5(e);if(!n)throw new Error("Invalid issuer: "+e);const r=`${t.domain} wants you to sign in with your ${z5(n)} account:`,i=ra(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${V5(e)}`,u=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,d=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,y=ia(t.resources);if(y){const m=ws(y);s=eS(s,m)}return[r,i,"",s,"",o,a,c,u,l,h,d,f,p].filter(m=>m!=null).join(`
`)};function K5(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function G5(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Mr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{const r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(i=>{const s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function W5(t,e,n,r={}){return n?.sort((i,s)=>i.localeCompare(s)),{att:{[t]:Z5(e,n,r)}}}function Z5(t,e,n={}){e=e?.sort((i,s)=>i.localeCompare(s));const r=e.map(i=>({[`${t}/${i}`]:[n]}));return Object.assign({},...r)}function ag(t){return Mr(t),`urn:recap:${K5(t).replace(/=/g,"")}`}function ws(t){const e=G5(t.replace("urn:recap:",""));return Mr(e),e}function Y5(t,e,n){const r=W5(t,e,n);return ag(r)}function X5(t){return t&&t.includes("urn:recap:")}function J5(t,e){const n=ws(t),r=ws(e),i=Q5(n,r);return ag(i)}function Q5(t,e){Mr(t),Mr(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return n.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;r.att[i]=M5(q5({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),r}function eS(t="",e){Mr(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(i++,`(${i}) '${h}': '${u[h].join("', '")}' for '${a}'.`));r.push(l.join(", ").replace(".,","."))});const s=r.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function cg(t){var e;const n=ws(t);Mr(n);const r=(e=n.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function ug(t){const e=ws(t);Mr(e);const n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;(s=i?.[0])!=null&&s.chains&&n.push(i[0].chains)})}),[...new Set(n.flat())]}function ia(t){if(!t)return;const e=t?.[t.length-1];return X5(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function lg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function zu(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Vu(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function mt(t,...e){if(!lg(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function fg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function tS(t,e){mt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function yr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function _i(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function nS(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const rS=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function iS(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Hu(t){if(typeof t=="string")t=iS(t);else if(lg(t))t=Ku(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function sS(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function oS(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const aS=(t,e)=>{function n(r,...i){if(mt(r),!rS)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?mt(u):mt(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&mt(i[1]);const o=e(r,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");mt(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,mt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(mt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(n,t),n};function hg(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!uS(e))throw new Error("invalid output, must be aligned");return e}function dg(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function cS(t,e,n){zu(n);const r=new Uint8Array(16),i=nS(r);return dg(i,0,BigInt(e),n),dg(i,8,BigInt(t),n),r}function uS(t){return t.byteOffset%4===0}function Ku(t){return Uint8Array.from(t)}const pg=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),lS=pg("expand 16-byte k"),fS=pg("expand 32-byte k"),hS=yr(lS),dS=yr(fS);function ue(t,e){return t<<e|t>>>32-e}function Gu(t){return t.byteOffset%4===0}const sa=64,pS=16,gg=2**32-1,bg=new Uint32Array;function gS(t,e,n,r,i,s,o,a){const c=i.length,u=new Uint8Array(sa),l=yr(u),h=Gu(i)&&Gu(s),d=h?yr(i):bg,f=h?yr(s):bg;for(let p=0;p<c;o++){if(t(e,n,r,l,o,a),o>=gg)throw new Error("arx: counter overflow");const y=Math.min(sa,c-p);if(h&&y===sa){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let A=0,$;A<pS;A++)$=m+A,f[$]=d[$]^l[A];p+=sa;continue}for(let m=0,A;m<y;m++)A=p+m,s[A]=i[A]^u[m];p+=y}}function bS(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=sS({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Vu(i),Vu(o),zu(s),zu(n),(a,c,u,l,h=0)=>{mt(a),mt(c),mt(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),mt(l),Vu(h),h<0||h>=gg)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const f=[];let p=a.length,y,m;if(p===32)f.push(y=Ku(a)),m=dS;else if(p===16&&n)y=new Uint8Array(32),y.set(a),y.set(a,16),m=hS,f.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Gu(c)||f.push(c=Ku(c));const A=yr(y);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,A,yr(c.subarray(0,16)),A),c=c.subarray(16)}const $=16-i;if($!==c.length)throw new Error(`arx: nonce must be ${$} or 16 bytes`);if($!==12){const x=new Uint8Array(12);x.set(c,s?0:12-c.length),c=x,f.push(c)}const _=yr(c);return gS(t,m,A,_,u,l,h,o),_i(...f),l}}const je=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class yS{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Hu(e),mt(e,32);const n=je(e,0),r=je(e,2),i=je(e,4),s=je(e,6),o=je(e,8),a=je(e,10),c=je(e,12),u=je(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=je(e,16+2*l)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],f=o[6],p=o[7],y=o[8],m=o[9],A=je(e,n+0),$=je(e,n+2),_=je(e,n+4),x=je(e,n+6),T=je(e,n+8),R=je(e,n+10),F=je(e,n+12),U=je(e,n+14);let D=s[0]+(A&8191),j=s[1]+((A>>>13|$<<3)&8191),M=s[2]+(($>>>10|_<<6)&8191),E=s[3]+((_>>>7|x<<9)&8191),b=s[4]+((x>>>4|T<<12)&8191),v=s[5]+(T>>>1&8191),g=s[6]+((T>>>14|R<<2)&8191),w=s[7]+((R>>>11|F<<5)&8191),S=s[8]+((F>>>8|U<<8)&8191),O=s[9]+(U>>>5|i),I=0,B=I+D*a+j*(5*m)+M*(5*y)+E*(5*p)+b*(5*f);I=B>>>13,B&=8191,B+=v*(5*d)+g*(5*h)+w*(5*l)+S*(5*u)+O*(5*c),I+=B>>>13,B&=8191;let P=I+D*c+j*a+M*(5*m)+E*(5*y)+b*(5*p);I=P>>>13,P&=8191,P+=v*(5*f)+g*(5*d)+w*(5*h)+S*(5*l)+O*(5*u),I+=P>>>13,P&=8191;let L=I+D*u+j*c+M*a+E*(5*m)+b*(5*y);I=L>>>13,L&=8191,L+=v*(5*p)+g*(5*f)+w*(5*d)+S*(5*h)+O*(5*l),I+=L>>>13,L&=8191;let C=I+D*l+j*u+M*c+E*a+b*(5*m);I=C>>>13,C&=8191,C+=v*(5*y)+g*(5*p)+w*(5*f)+S*(5*d)+O*(5*h),I+=C>>>13,C&=8191;let k=I+D*h+j*l+M*u+E*c+b*a;I=k>>>13,k&=8191,k+=v*(5*m)+g*(5*y)+w*(5*p)+S*(5*f)+O*(5*d),I+=k>>>13,k&=8191;let N=I+D*d+j*h+M*l+E*u+b*c;I=N>>>13,N&=8191,N+=v*a+g*(5*m)+w*(5*y)+S*(5*p)+O*(5*f),I+=N>>>13,N&=8191;let q=I+D*f+j*d+M*h+E*l+b*u;I=q>>>13,q&=8191,q+=v*c+g*a+w*(5*m)+S*(5*y)+O*(5*p),I+=q>>>13,q&=8191;let z=I+D*p+j*f+M*d+E*h+b*l;I=z>>>13,z&=8191,z+=v*u+g*c+w*a+S*(5*m)+O*(5*y),I+=z>>>13,z&=8191;let W=I+D*y+j*p+M*f+E*d+b*h;I=W>>>13,W&=8191,W+=v*l+g*u+w*c+S*a+O*(5*m),I+=W>>>13,W&=8191;let H=I+D*m+j*y+M*p+E*f+b*d;I=H>>>13,H&=8191,H+=v*h+g*l+w*u+S*c+O*a,I+=H>>>13,H&=8191,I=(I<<2)+I|0,I=I+B|0,B=I&8191,I=I>>>13,P+=I,s[0]=B,s[1]=P,s[2]=L,s[3]=C,s[4]=k,s[5]=N,s[6]=q,s[7]=z,s[8]=W,s[9]=H}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;_i(r)}update(e){fg(this),e=Hu(e),mt(e);const{buffer:n,blockLen:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){_i(this.h,this.r,this.buffer,this.pad)}digestInto(e){fg(this),tS(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}function wS(t){const e=(r,i)=>t(i).update(Hu(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}const mS=wS(t=>new yS(t));function vS(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],f=e[3],p=e[4],y=e[5],m=e[6],A=e[7],$=i,_=n[0],x=n[1],T=n[2],R=o,F=a,U=c,D=u,j=l,M=h,E=d,b=f,v=p,g=y,w=m,S=A,O=$,I=_,B=x,P=T;for(let C=0;C<s;C+=2)R=R+j|0,O=ue(O^R,16),v=v+O|0,j=ue(j^v,12),R=R+j|0,O=ue(O^R,8),v=v+O|0,j=ue(j^v,7),F=F+M|0,I=ue(I^F,16),g=g+I|0,M=ue(M^g,12),F=F+M|0,I=ue(I^F,8),g=g+I|0,M=ue(M^g,7),U=U+E|0,B=ue(B^U,16),w=w+B|0,E=ue(E^w,12),U=U+E|0,B=ue(B^U,8),w=w+B|0,E=ue(E^w,7),D=D+b|0,P=ue(P^D,16),S=S+P|0,b=ue(b^S,12),D=D+b|0,P=ue(P^D,8),S=S+P|0,b=ue(b^S,7),R=R+M|0,P=ue(P^R,16),w=w+P|0,M=ue(M^w,12),R=R+M|0,P=ue(P^R,8),w=w+P|0,M=ue(M^w,7),F=F+E|0,O=ue(O^F,16),S=S+O|0,E=ue(E^S,12),F=F+E|0,O=ue(O^F,8),S=S+O|0,E=ue(E^S,7),U=U+b|0,I=ue(I^U,16),v=v+I|0,b=ue(b^v,12),U=U+b|0,I=ue(I^U,8),v=v+I|0,b=ue(b^v,7),D=D+j|0,B=ue(B^D,16),g=g+B|0,j=ue(j^g,12),D=D+j|0,B=ue(B^D,8),g=g+B|0,j=ue(j^g,7);let L=0;r[L++]=o+R|0,r[L++]=a+F|0,r[L++]=c+U|0,r[L++]=u+D|0,r[L++]=l+j|0,r[L++]=h+M|0,r[L++]=d+E|0,r[L++]=f+b|0,r[L++]=p+v|0,r[L++]=y+g|0,r[L++]=m+w|0,r[L++]=A+S|0,r[L++]=$+O|0,r[L++]=_+I|0,r[L++]=x+B|0,r[L++]=T+P|0}const ES=bS(vS,{counterRight:!1,counterLength:4,allowShortKeys:!1}),xS=new Uint8Array(16),yg=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(xS.subarray(n))},_S=new Uint8Array(32);function wg(t,e,n,r,i){const s=t(e,n,_S),o=mS.create(s);i&&yg(o,i),yg(o,r);const a=cS(r.length,i?i.length:0,!0);o.update(a);const c=o.digest();return _i(s,a),c}const SS=t=>(e,n,r)=>({encrypt(i,s){const o=i.length;s=hg(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,n,a,a,1);const c=wg(t,e,n,a,r);return s.set(c,o),_i(c),s},decrypt(i,s){s=hg(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=wg(t,e,n,o,r);if(!oS(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),_i(c),s}}),mg=aS({blockSize:64,nonceLength:12,tagLength:16},SS(ES));class vg extends ea{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Jo(e);const r=Zt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Ft(s)}update(e){return cr(this),this.iHash.update(e),this}digestInto(e){cr(this),Wt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const oa=(t,e,n)=>new vg(t,e).update(n).digest();oa.create=(t,e)=>new vg(t,e);function IS(t,e,n){return Jo(t),n===void 0&&(n=new Uint8Array(t.outputLen)),oa(t,Zt(n),Zt(e))}const Wu=Uint8Array.from([0]),Eg=Uint8Array.of();function OS(t,e,n,r=32){Jo(t),$n(r);const i=t.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0&&(n=Eg);const o=new Uint8Array(s*i),a=oa.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Wu[0]=l+1,c.update(l===0?Eg:u).update(n).update(Wu).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),Ft(u,Wu),o.slice(0,r)}const AS=(t,e,n,r,i)=>OS(t,IS(t,e,n),r,i),aa=ta,Zu=BigInt(0),Yu=BigInt(1);function ca(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function jr(t,e,n=""){const r=Xo(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){const o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function ua(t){const e=t.toString(16);return e.length&1?"0"+e:e}function xg(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Zu:BigInt("0x"+t)}function la(t){return xg(xi(t))}function fa(t){return Wt(t),xg(xi(Uint8Array.from(t).reverse()))}function Xu(t,e){return Qo(t.toString(16).padStart(e*2,"0"))}function Ju(t,e){return Xu(t,e).reverse()}function et(t,e,n){let r;if(typeof e=="string")try{r=Qo(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Xo(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}const Qu=t=>typeof t=="bigint"&&Zu<=t;function BS(t,e,n){return Qu(t)&&Qu(e)&&Qu(n)&&e<=t&&t<n}function el(t,e,n,r){if(!BS(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function _g(t){let e;for(e=0;t>Zu;t>>=Yu,e+=1);return e}const ms=t=>(Yu<<BigInt(t))-Yu;function DS(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=d=>new Uint8Array(d),i=d=>Uint8Array.of(d);let s=r(t),o=r(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...d)=>n(o,s,...d),l=(d=r(0))=>{o=u(i(0),d),s=u(),d.length!==0&&(o=u(i(1),d),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){s=u();const p=s.slice();f.push(p),d+=s.length}return lr(...f)};return(d,f)=>{c(),l(d);let p;for(;!(p=f(h()));)l();return c(),p}}function ha(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function Sg(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const vt=BigInt(0),at=BigInt(1),zr=BigInt(2),Ig=BigInt(3),Og=BigInt(4),Ag=BigInt(5),$S=BigInt(7),Bg=BigInt(8),TS=BigInt(9),Dg=BigInt(16);function Dt(t,e){const n=t%e;return n>=vt?n:e+n}function Yt(t,e,n){let r=t;for(;e-- >vt;)r*=r,r%=n;return r}function $g(t,e){if(t===vt)throw new Error("invert: expected non-zero number");if(e<=vt)throw new Error("invert: expected positive modulus, got "+e);let n=Dt(t,e),r=e,i=vt,s=at;for(;n!==vt;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==at)throw new Error("invert: does not exist");return Dt(i,e)}function tl(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function Tg(t,e){const n=(t.ORDER+at)/Og,r=t.pow(e,n);return tl(t,r,e),r}function PS(t,e){const n=(t.ORDER-Ag)/Bg,r=t.mul(e,zr),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,zr),i),a=t.mul(s,t.sub(o,t.ONE));return tl(t,a,e),a}function RS(t){const e=wr(t),n=Pg(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+$S)/Dg;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,r);const h=a.mul(u,i),d=a.mul(u,s),f=a.eql(a.sqr(l),c),p=a.eql(a.sqr(h),c);u=a.cmov(u,l,f),l=a.cmov(d,h,p);const y=a.eql(a.sqr(l),c),m=a.cmov(u,l,y);return tl(a,m,c),m}}function Pg(t){if(t<Ig)throw new Error("sqrt is not defined for small field");let e=t-at,n=0;for(;e%zr===vt;)e/=zr,n++;let r=zr;const i=wr(t);for(;Ng(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Tg;let s=i.pow(r,e);const o=(e+at)/zr;return function(a,c){if(a.is0(c))return c;if(Ng(a,c)!==1)throw new Error("Cannot find square root");let u=n,l=a.mul(a.ONE,s),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let f=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(f++,p=a.sqr(p),f===u)throw new Error("Cannot find square root");const y=at<<BigInt(u-f-1),m=a.pow(l,y);u=f,l=a.sqr(m),h=a.mul(h,l),d=a.mul(d,m)}return d}}function NS(t){return t%Og===Ig?Tg:t%Bg===Ag?PS:t%Dg===TS?RS(t):Pg(t)}const CS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function US(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=CS.reduce((r,i)=>(r[i]="function",r),e);return ha(t,n),t}function FS(t,e,n){if(n<vt)throw new Error("invalid exponent, negatives unsupported");if(n===vt)return t.ONE;if(n===at)return e;let r=t.ONE,i=e;for(;n>vt;)n&at&&(r=t.mul(r,i)),i=t.sqr(i),n>>=at;return r}function Rg(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function Ng(t,e){const n=(t.ORDER-at)/zr,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Cg(t,e){e!==void 0&&$n(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function wr(t,e,n=!1,r={}){if(t<=vt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(i=d.BITS),d.sqrt&&(s=d.sqrt),typeof d.isLE=="boolean"&&(n=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:u}=Cg(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:u,MASK:ms(c),ZERO:vt,ONE:at,allowedLengths:a,create:d=>Dt(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return vt<=d&&d<t},is0:d=>d===vt,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&at)===at,neg:d=>Dt(-d,t),eql:(d,f)=>d===f,sqr:d=>Dt(d*d,t),add:(d,f)=>Dt(d+f,t),sub:(d,f)=>Dt(d-f,t),mul:(d,f)=>Dt(d*f,t),pow:(d,f)=>FS(h,d,f),div:(d,f)=>Dt(d*$g(f,t),t),sqrN:d=>d*d,addN:(d,f)=>d+f,subN:(d,f)=>d-f,mulN:(d,f)=>d*f,inv:d=>$g(d,t),sqrt:s||(d=>(l||(l=NS(t)),l(h,d))),toBytes:d=>n?Ju(d,u):Xu(d,u),fromBytes:(d,f=!0)=>{if(a){if(!a.includes(d.length)||d.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const y=new Uint8Array(u);y.set(d,n?0:y.length-d.length),d=y}if(d.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+d.length);let p=n?fa(d):la(d);if(o&&(p=Dt(p,t)),!f&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:d=>Rg(h,d),cmov:(d,f,p)=>p?f:d});return Object.freeze(h)}function Ug(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Fg(t){const e=Ug(t);return e+Math.ceil(e/2)}function LS(t,e,n=!1){const r=t.length,i=Ug(e),s=Fg(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?fa(t):la(t),a=Dt(o,e-at)+at;return n?Ju(a,i):Xu(a,i)}const Si=BigInt(0),Vr=BigInt(1);function da(t,e){const n=e.negate();return t?n:e}function nl(t,e){const n=Rg(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function Lg(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function rl(t,e){Lg(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=ms(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function kg(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Vr);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:f,offsetF:u}}function kS(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function qS(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const il=new WeakMap,qg=new WeakMap;function sl(t){return qg.get(t)||1}function Mg(t){if(t!==Si)throw new Error("invalid wNAF")}class MS{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>Si;)n&Vr&&(r=r.add(i)),i=i.double(),n>>=Vr;return r}precomputeWindow(e,n){const{windows:r,windowSize:i}=rl(n,this.bits),s=[];let o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=rl(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:d,offsetF:f}=kg(r,a,o);r=c,l?s=s.add(da(d,n[f])):i=i.add(da(h,n[u]))}return Mg(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){const s=rl(e,this.bits);for(let o=0;o<s.windows&&r!==Si;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=kg(r,o,s);if(r=a,!u){const h=n[c];i=i.add(l?h.negate():h)}}return Mg(r),i}getPrecomputes(e,n,r){let i=il.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),il.set(n,i))),i}cached(e,n,r){const i=sl(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){const s=sl(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){Lg(n,this.bits),qg.set(e,n),il.delete(e)}hasCache(e){return sl(e)!==1}}function jS(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>Si||r>Si;)n&Vr&&(s=s.add(i)),r&Vr&&(o=o.add(i)),i=i.double(),n>>=Vr,r>>=Vr;return{p1:s,p2:o}}function zS(t,e,n,r){kS(n,t),qS(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=_g(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=ms(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let f=h;f>=0;f-=c){l.fill(o);for(let y=0;y<s;y++){const m=r[y],A=Number(m>>BigInt(f)&u);l[A]=l[A].add(n[y])}let p=o;for(let y=l.length-1,m=o;y>0;y--)m=m.add(l[y]),p=p.add(m);if(d=d.add(p),f!==0)for(let y=0;y<c;y++)d=d.double()}return d}function jg(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return US(e),e}else return wr(t,{isLE:n})}function VS(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Si))throw new Error(`CURVE.${a} must be positive bigint`)}const i=jg(e.p,n.Fp,r),s=jg(e.n,n.Fn,r),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),V0("HashToScalar-");const vs=BigInt(0),Ii=BigInt(1),pa=BigInt(2);function HS(t){return ha(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(mi({},t))}function KS(t){const e=HS(t),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const c=o||qr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),f=a?pa**BigInt(254):pa**BigInt(447),p=a?BigInt(8)*pa**BigInt(251)-Ii:BigInt(4)*pa**BigInt(445)-Ii,y=f+p+Ii,m=E=>Dt(E,n),A=$(h);function $(E){return Ju(m(E),l)}function _(E){const b=et("u coordinate",E,l);return a&&(b[31]&=127),m(fa(b))}function x(E){return fa(i(et("scalar",E,l)))}function T(E,b){const v=U(_(b),x(E));if(v===vs)throw new Error("invalid private or public key received");return $(v)}function R(E){return T(E,A)}function F(E,b,v){const g=m(E*(b-v));return b=m(b-g),v=m(v+g),{x_2:b,x_3:v}}function U(E,b){el("u",E,vs,n),el("scalar",b,f,y);const v=b,g=E;let w=Ii,S=vs,O=E,I=Ii,B=vs;for(let L=BigInt(u-1);L>=vs;L--){const C=v>>L&Ii;B^=C,{x_2:w,x_3:O}=F(B,w,O),{x_2:S,x_3:I}=F(B,S,I),B=C;const k=w+S,N=m(k*k),q=w-S,z=m(q*q),W=N-z,H=O+I,Z=O-I,Q=m(Z*k),ee=m(H*q),se=Q+ee,he=Q-ee;O=m(se*se),I=m(g*m(he*he)),w=m(N*z),S=m(W*(N+m(d*W)))}({x_2:w,x_3:O}=F(B,w,O)),{x_2:S,x_3:I}=F(B,S,I);const P=s(S);return m(w*P)}const D={secretKey:l,publicKey:l,seed:l},j=(E=c(l))=>(Wt(E,D.seed),E);function M(E){const b=j(E);return{secretKey:b,publicKey:R(b)}}return{keygen:M,getSharedSecret:(E,b)=>T(E,b),getPublicKey:E=>R(E),scalarMult:T,scalarMultBase:R,utils:{randomSecretKey:j,randomPrivateKey:j},GuBytes:A.slice(),lengths:D}}const GS=BigInt(1),zg=BigInt(2),WS=BigInt(3),ZS=BigInt(5),YS=BigInt(8),Vg=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),XS={p:Vg,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:YS,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function JS(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=Vg,o=t*t%s*t%s,a=Yt(o,zg,s)*o%s,c=Yt(a,GS,s)*t%s,u=Yt(c,ZS,s)*c%s,l=Yt(u,e,s)*u%s,h=Yt(l,n,s)*l%s,d=Yt(h,r,s)*h%s,f=Yt(d,i,s)*d%s,p=Yt(f,i,s)*d%s,y=Yt(p,e,s)*u%s;return{pow_p_5_8:Yt(y,zg,s)*t%s,b2:o}}function QS(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const eI=wr(XS.p,{isLE:!0}),ol=(()=>{const t=eI.ORDER;return KS({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:r}=JS(e);return Dt(Yt(n,WS,t)*r,t)},adjustScalarBytes:QS})})(),Hg=(t,e)=>(t+(t>=0?e:-e)/Kg)/e;function tI(t,e,n){const[[r,i],[s,o]]=e,a=Hg(o*t,n),c=Hg(-i*t,n);let u=t-a*r-c*s,l=-a*i-c*o;const h=u<Nn,d=l<Nn;h&&(u=-u),d&&(l=-l);const f=ms(Math.ceil(_g(n)/2))+Oi;if(u<Nn||u>=f||l<Nn||l>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}function al(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function cl(t,e){const n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return ca(n.lowS,"lowS"),ca(n.prehash,"prehash"),n.format!==void 0&&al(n.format),n}class nI extends Error{constructor(e=""){super(e)}}const Rn={Err:nI,_tlv:{encode:(t,e)=>{const{Err:n}=Rn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=ua(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?ua(i.length/2|128):"";return ua(t)+s+i+e},decode(t,e){const{Err:n}=Rn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=Rn;if(t<Nn)throw new e("integer: negative integers are not allowed");let n=ua(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=Rn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return la(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=Rn,i=et("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=Rn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},Nn=BigInt(0),Oi=BigInt(1),Kg=BigInt(2),ga=BigInt(3),rI=BigInt(4);function Ai(t,e){const{BYTES:n}=t;let r;if(typeof e=="bigint")r=e;else{let i=et("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function iI(t,e={}){const n=VS("weierstrass",t,e),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;ha(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=Wg(r,i);function l(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(E,b,v){const{x:g,y:w}=b.toAffine(),S=r.toBytes(g);if(ca(v,"isCompressed"),v){l();const O=!r.isOdd(w);return lr(Gg(O),S)}else return lr(Uint8Array.of(4),S,r.toBytes(w))}function d(E){jr(E,void 0,"Point");const{publicKey:b,publicKeyUncompressed:v}=u,g=E.length,w=E[0],S=E.subarray(1);if(g===b&&(w===2||w===3)){const O=r.fromBytes(S);if(!r.isValid(O))throw new Error("bad point: is not on curve, wrong x");const I=y(O);let B;try{B=r.sqrt(I)}catch(L){const C=L instanceof Error?": "+L.message:"";throw new Error("bad point: is not on curve, sqrt error"+C)}l();const P=r.isOdd(B);return(w&1)===1!==P&&(B=r.neg(B)),{x:O,y:B}}else if(g===v&&w===4){const O=r.BYTES,I=r.fromBytes(S.subarray(0,O)),B=r.fromBytes(S.subarray(O,O*2));if(!m(I,B))throw new Error("bad point: is not on curve");return{x:I,y:B}}else throw new Error(`bad point: got length ${g}, expected compressed=${b} or uncompressed=${v}`)}const f=e.toBytes||h,p=e.fromBytes||d;function y(E){const b=r.sqr(E),v=r.mul(b,E);return r.add(r.add(v,r.mul(E,s.a)),s.b)}function m(E,b){const v=r.sqr(b),g=y(E);return r.eql(v,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const A=r.mul(r.pow(s.a,ga),rI),$=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(A,$)))throw new Error("bad curve params: a or b");function _(E,b,v=!1){if(!r.isValid(b)||v&&r.is0(b))throw new Error(`bad point coordinate ${E}`);return b}function x(E){if(!(E instanceof D))throw new Error("ProjectivePoint expected")}function T(E){if(!c||!c.basises)throw new Error("no endo");return tI(E,c.basises,i.ORDER)}const R=Sg((E,b)=>{const{X:v,Y:g,Z:w}=E;if(r.eql(w,r.ONE))return{x:v,y:g};const S=E.is0();b==null&&(b=S?r.ONE:r.inv(w));const O=r.mul(v,b),I=r.mul(g,b),B=r.mul(w,b);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(B,r.ONE))throw new Error("invZ was invalid");return{x:O,y:I}}),F=Sg(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:b,y:v}=E.toAffine();if(!r.isValid(b)||!r.isValid(v))throw new Error("bad point: x or y not field elements");if(!m(b,v))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function U(E,b,v,g,w){return v=new D(r.mul(v.X,E),v.Y,v.Z),b=da(g,b),v=da(w,v),b.add(v)}class D{constructor(b,v,g){this.X=_("x",b),this.Y=_("y",v,!0),this.Z=_("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(b){const{x:v,y:g}=b||{};if(!b||!r.isValid(v)||!r.isValid(g))throw new Error("invalid affine point");if(b instanceof D)throw new Error("projective point not allowed");return r.is0(v)&&r.is0(g)?D.ZERO:new D(v,g,r.ONE)}static fromBytes(b){const v=D.fromAffine(p(jr(b,void 0,"point")));return v.assertValidity(),v}static fromHex(b){return D.fromBytes(et("pointHex",b))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(b=8,v=!0){return M.createCache(this,b),v||this.multiply(ga),this}assertValidity(){F(this)}hasEvenY(){const{y:b}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(b)}equals(b){x(b);const{X:v,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=b,B=r.eql(r.mul(v,I),r.mul(S,w)),P=r.eql(r.mul(g,I),r.mul(O,w));return B&&P}negate(){return new D(this.X,r.neg(this.Y),this.Z)}double(){const{a:b,b:v}=s,g=r.mul(v,ga),{X:w,Y:S,Z:O}=this;let I=r.ZERO,B=r.ZERO,P=r.ZERO,L=r.mul(w,w),C=r.mul(S,S),k=r.mul(O,O),N=r.mul(w,S);return N=r.add(N,N),P=r.mul(w,O),P=r.add(P,P),I=r.mul(b,P),B=r.mul(g,k),B=r.add(I,B),I=r.sub(C,B),B=r.add(C,B),B=r.mul(I,B),I=r.mul(N,I),P=r.mul(g,P),k=r.mul(b,k),N=r.sub(L,k),N=r.mul(b,N),N=r.add(N,P),P=r.add(L,L),L=r.add(P,L),L=r.add(L,k),L=r.mul(L,N),B=r.add(B,L),k=r.mul(S,O),k=r.add(k,k),L=r.mul(k,N),I=r.sub(I,L),P=r.mul(k,C),P=r.add(P,P),P=r.add(P,P),new D(I,B,P)}add(b){x(b);const{X:v,Y:g,Z:w}=this,{X:S,Y:O,Z:I}=b;let B=r.ZERO,P=r.ZERO,L=r.ZERO;const C=s.a,k=r.mul(s.b,ga);let N=r.mul(v,S),q=r.mul(g,O),z=r.mul(w,I),W=r.add(v,g),H=r.add(S,O);W=r.mul(W,H),H=r.add(N,q),W=r.sub(W,H),H=r.add(v,w);let Z=r.add(S,I);return H=r.mul(H,Z),Z=r.add(N,z),H=r.sub(H,Z),Z=r.add(g,w),B=r.add(O,I),Z=r.mul(Z,B),B=r.add(q,z),Z=r.sub(Z,B),L=r.mul(C,H),B=r.mul(k,z),L=r.add(B,L),B=r.sub(q,L),L=r.add(q,L),P=r.mul(B,L),q=r.add(N,N),q=r.add(q,N),z=r.mul(C,z),H=r.mul(k,H),q=r.add(q,z),z=r.sub(N,z),z=r.mul(C,z),H=r.add(H,z),N=r.mul(q,H),P=r.add(P,N),N=r.mul(Z,H),B=r.mul(W,B),B=r.sub(B,N),N=r.mul(W,q),L=r.mul(Z,L),L=r.add(L,N),new D(B,P,L)}subtract(b){return this.add(b.negate())}is0(){return this.equals(D.ZERO)}multiply(b){const{endo:v}=e;if(!i.isValidNot0(b))throw new Error("invalid scalar: out of range");let g,w;const S=O=>M.cached(this,O,I=>nl(D,I));if(v){const{k1neg:O,k1:I,k2neg:B,k2:P}=T(b),{p:L,f:C}=S(I),{p:k,f:N}=S(P);w=C.add(N),g=U(v.beta,L,k,O,B)}else{const{p:O,f:I}=S(b);g=O,w=I}return nl(D,[g,w])[0]}multiplyUnsafe(b){const{endo:v}=e,g=this;if(!i.isValid(b))throw new Error("invalid scalar: out of range");if(b===Nn||g.is0())return D.ZERO;if(b===Oi)return g;if(M.hasCache(this))return this.multiply(b);if(v){const{k1neg:w,k1:S,k2neg:O,k2:I}=T(b),{p1:B,p2:P}=jS(D,g,S,I);return U(v.beta,B,P,w,O)}else return M.unsafe(g,b)}multiplyAndAddUnsafe(b,v,g){const w=this.multiplyUnsafe(v).add(b.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine(b){return R(this,b)}isTorsionFree(){const{isTorsionFree:b}=e;return o===Oi?!0:b?b(D,this):M.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:b}=e;return o===Oi?this:b?b(D,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(b=!0){return ca(b,"isCompressed"),this.assertValidity(),f(D,this,b)}toHex(b=!0){return xi(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(b=!0){return this.toBytes(b)}_setWindowSize(b){this.precompute(b)}static normalizeZ(b){return nl(D,b)}static msm(b,v){return zS(D,i,b,v)}static fromPrivateKey(b){return D.BASE.multiply(Ai(i,b))}}D.BASE=new D(s.Gx,s.Gy,r.ONE),D.ZERO=new D(r.ZERO,r.ONE,r.ZERO),D.Fp=r,D.Fn=i;const j=i.BITS,M=new MS(D,e.endo?Math.ceil(j/2):j);return D.BASE.precompute(8),D}function Gg(t){return Uint8Array.of(t?2:3)}function Wg(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function sI(t,e={}){const{Fn:n}=t,r=e.randomBytes||qr,i=Object.assign(Wg(t.Fp,n),{seed:Fg(n.ORDER)});function s(d){try{return!!Ai(n,d)}catch{return!1}}function o(d,f){const{publicKey:p,publicKeyUncompressed:y}=i;try{const m=d.length;return f===!0&&m!==p||f===!1&&m!==y?!1:!!t.fromBytes(d)}catch{return!1}}function a(d=r(i.seed)){return LS(jr(d,i.seed,"seed"),n.ORDER)}function c(d,f=!0){return t.BASE.multiply(Ai(n,d)).toBytes(f)}function u(d){const f=a(d);return{secretKey:f,publicKey:c(f)}}function l(d){if(typeof d=="bigint")return!1;if(d instanceof t)return!0;const{secretKey:f,publicKey:p,publicKeyUncompressed:y}=i;if(n.allowedLengths||f===p)return;const m=et("key",d).length;return m===p||m===y}function h(d,f,p=!0){if(l(d)===!0)throw new Error("first arg must be private key");if(l(f)===!1)throw new Error("second arg must be public key");const y=Ai(n,d);return t.fromHex(f).multiply(y).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:d=>Ai(n,d),precompute(d=8,f=t.BASE){return f.precompute(d,!1)}},lengths:i})}function oI(t,e,n={}){Jo(e),ha(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||qr,i=n.hmac||((v,...g)=>oa(e,v,lr(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f}=sI(t,n),p={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function m(v){const g=a>>Oi;return v>g}function A(v,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${v}: out of range 1..Point.Fn.ORDER`);return g}function $(v,g){al(g);const w=f.signature,S=g==="compact"?w:g==="recovered"?w+1:void 0;return jr(v,S,`${g} signature`)}class _{constructor(g,w,S){this.r=A("r",g),this.s=A("s",w),S!=null&&(this.recovery=S),Object.freeze(this)}static fromBytes(g,w=y){$(g,w);let S;if(w==="der"){const{r:P,s:L}=Rn.toSig(jr(g));return new _(P,L)}w==="recovered"&&(S=g[0],w="compact",g=g.subarray(1));const O=o.BYTES,I=g.subarray(0,O),B=g.subarray(O,O*2);return new _(o.fromBytes(I),o.fromBytes(B),S)}static fromHex(g,w){return this.fromBytes(Qo(g),w)}addRecoveryBit(g){return new _(this.r,this.s,g)}recoverPublicKey(g){const w=s.ORDER,{r:S,s:O,recovery:I}=this;if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(a*Kg<w&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const B=I===2||I===3?S+a:S;if(!s.isValid(B))throw new Error("recovery id 2 or 3 invalid");const P=s.toBytes(B),L=t.fromBytes(lr(Gg((I&1)===0),P)),C=o.inv(B),k=T(et("msgHash",g)),N=o.create(-k*C),q=o.create(O*C),z=t.BASE.multiplyUnsafe(N).add(L.multiplyUnsafe(q));if(z.is0())throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return m(this.s)}toBytes(g=y){if(al(g),g==="der")return Qo(Rn.hexFromSig(this));const w=o.toBytes(this.r),S=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return lr(Uint8Array.of(this.recovery),w,S)}return lr(w,S)}toHex(g){return xi(this.toBytes(g))}assertValidity(){}static fromCompact(g){return _.fromBytes(et("sig",g),"compact")}static fromDER(g){return _.fromBytes(et("sig",g),"der")}normalizeS(){return this.hasHighS()?new _(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return xi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return xi(this.toBytes("compact"))}}const x=n.bits2int||function(v){if(v.length>8192)throw new Error("input is too large");const g=la(v),w=v.length*8-c;return w>0?g>>BigInt(w):g},T=n.bits2int_modN||function(v){return o.create(x(v))},R=ms(c);function F(v){return el("num < 2^"+c,v,Nn,R),o.toBytes(v)}function U(v,g){return jr(v,void 0,"message"),g?jr(e(v),void 0,"prehashed message"):v}function D(v,g,w){if(["recovered","canonical"].some(q=>q in w))throw new Error("sign() legacy options not supported");const{lowS:S,prehash:O,extraEntropy:I}=cl(w,p);v=U(v,O);const B=T(v),P=Ai(o,g),L=[F(P),F(B)];if(I!=null&&I!==!1){const q=I===!0?r(f.secretKey):I;L.push(et("extraEntropy",q))}const C=lr(...L),k=B;function N(q){const z=x(q);if(!o.isValidNot0(z))return;const W=o.inv(z),H=t.BASE.multiply(z).toAffine(),Z=o.create(H.x);if(Z===Nn)return;const Q=o.create(W*o.create(k+Z*P));if(Q===Nn)return;let ee=(H.x===Z?0:2)|Number(H.y&Oi),se=Q;return S&&m(Q)&&(se=o.neg(Q),ee^=1),new _(Z,se,ee)}return{seed:C,k2sig:N}}function j(v,g,w={}){v=et("message",v);const{seed:S,k2sig:O}=D(v,g,w);return DS(e.outputLen,o.BYTES,i)(S,O)}function M(v){let g;const w=typeof v=="string"||Xo(v),S=!w&&v!==null&&typeof v=="object"&&typeof v.r=="bigint"&&typeof v.s=="bigint";if(!w&&!S)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(S)g=new _(v.r,v.s);else if(w){try{g=_.fromBytes(et("sig",v),"der")}catch(O){if(!(O instanceof Rn.Err))throw O}if(!g)try{g=_.fromBytes(et("sig",v),"compact")}catch{return!1}}return g||!1}function E(v,g,w,S={}){const{lowS:O,prehash:I,format:B}=cl(S,p);if(w=et("publicKey",w),g=U(et("message",g),I),"strict"in S)throw new Error("options.strict was renamed to lowS");const P=B===void 0?M(v):_.fromBytes(et("sig",v),B);if(P===!1)return!1;try{const L=t.fromBytes(w);if(O&&P.hasHighS())return!1;const{r:C,s:k}=P,N=T(g),q=o.inv(k),z=o.create(N*q),W=o.create(C*q),H=t.BASE.multiplyUnsafe(z).add(L.multiplyUnsafe(W));return H.is0()?!1:o.create(H.x)===C}catch{return!1}}function b(v,g,w={}){const{prehash:S}=cl(w,p);return g=U(g,S),_.fromBytes(v,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:d,lengths:f,Point:t,sign:j,verify:E,recoverPublicKey:b,Signature:_,hash:e})}function aI(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp;let r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=wr(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function cI(t){const{CURVE:e,curveOpts:n}=aI(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function uI(t,e){const n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,Cg(n.Fn.ORDER,n.Fn.BITS))})}function lI(t){const{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=cI(t),s=iI(e,n),o=oI(s,r,i);return uI(t,o)}function ul(t,e){const n=r=>lI(fs(mi({},t),{hash:r}));return fs(mi({},n(e)),{create:n})}const Zg={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Yg={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Xg={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},fI=wr(Zg.p),hI=wr(Yg.p),dI=wr(Xg.p),pI=ul(fs(mi({},Zg),{Fp:fI,lowS:!1}),ta);ul(fs(mi({},Yg),{Fp:hI,lowS:!1}),w5),ul(fs(mi({},Xg),{Fp:dI,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),y5);const gI=pI,Jg="base10",ct="base16",Et="base64pad",mr="base64url",Es="utf8",Qg=0,Cn=1,xs=2,bI=0,e1=1,_s=12,ll=32;function yI(){const t=ol.utils.randomPrivateKey(),e=ol.getPublicKey(t);return{privateKey:wt(t,ct),publicKey:wt(e,ct)}}function fl(){const t=qr(ll);return wt(t,ct)}function wI(t,e){const n=ol.getSharedSecret(Ut(t,ct),Ut(e,ct)),r=AS(aa,n,void 0,void 0,ll);return wt(r,ct)}function ba(t){const e=aa(Ut(t,ct));return wt(e,ct)}function Lt(t){const e=aa(Ut(t,Es));return wt(e,ct)}function t1(t){return Ut(`${t}`,Jg)}function Hr(t){return Number(wt(t,Jg))}function n1(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function r1(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function mI(t){const e=t1(typeof t.type<"u"?t.type:Qg);if(Hr(e)===Cn&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?Ut(t.senderPublicKey,ct):void 0,r=typeof t.iv<"u"?Ut(t.iv,ct):qr(_s),i=Ut(t.symKey,ct),s=mg(i,r).encrypt(Ut(t.message,Es)),o=i1({type:e,sealed:s,iv:r,senderPublicKey:n});return t.encoding===mr?n1(o):o}function vI(t){const e=Ut(t.symKey,ct),{sealed:n,iv:r}=Ss({encoded:t.encoded,encoding:t.encoding}),i=mg(e,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return wt(i,Es)}function EI(t,e){const n=t1(xs),r=qr(_s),i=Ut(t,Es),s=i1({type:n,sealed:i,iv:r});return e===mr?n1(s):s}function xI(t,e){const{sealed:n}=Ss({encoded:t,encoding:e});return wt(n,Es)}function i1(t){if(Hr(t.type)===xs)return wt(os([t.type,t.sealed]),Et);if(Hr(t.type)===Cn){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return wt(os([t.type,t.senderPublicKey,t.iv,t.sealed]),Et)}return wt(os([t.type,t.iv,t.sealed]),Et)}function Ss(t){const e=(t.encoding||Et)===mr?r1(t.encoded):t.encoded,n=Ut(e,Et),r=n.slice(bI,e1),i=e1;if(Hr(r)===Cn){const c=i+ll,u=c+_s,l=n.slice(i,c),h=n.slice(c,u),d=n.slice(u);return{type:r,sealed:d,iv:h,senderPublicKey:l}}if(Hr(r)===xs){const c=n.slice(i),u=qr(_s);return{type:r,sealed:c,iv:u}}const s=i+_s,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function _I(t,e){const n=Ss({encoded:t,encoding:e?.encoding});return s1({type:Hr(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?wt(n.senderPublicKey,ct):void 0,receiverPublicKey:e?.receiverPublicKey})}function s1(t){const e=t?.type||Qg;if(e===Cn){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function o1(t){return t.type===Cn&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function a1(t){return t.type===xs}function SI(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return os([new Uint8Array([4]),e,n])}function II(t,e){const[n,r,i]=t.split("."),s=Buffer.from(r1(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,u=aa(c),l=SI(e);if(!gI.verify(os([o,a]),u,l))throw new Error("Invalid signature");return dc(t).payload}const OI="irn";function ya(t){return t?.relay||{protocol:OI}}function Bi(t){const e=W_[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var AI=Object.defineProperty,BI=Object.defineProperties,DI=Object.getOwnPropertyDescriptors,c1=Object.getOwnPropertySymbols,$I=Object.prototype.hasOwnProperty,TI=Object.prototype.propertyIsEnumerable,u1=(t,e,n)=>e in t?AI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,hl=(t,e)=>{for(var n in e||(e={}))$I.call(e,n)&&u1(t,n,e[n]);if(c1)for(var n of c1(e))TI.call(e,n)&&u1(t,n,e[n]);return t},PI=(t,e)=>BI(t,DI(e));function RI(t,e="-"){const n={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,""),o=t[i];n[s]=o}}),n}function l1(t){if(!t.includes("wc:")){const u=N0(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:NI(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:RI(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function NI(t){return t.startsWith("//")?t.substring(2):t}function CI(t,e="-"){const n="relay",r={};return Object.keys(t).forEach(i=>{const s=i,o=n+e+s;t[s]&&(r[o]=t[s])}),r}function f1(t){const e=new URLSearchParams,n=hl(hl(PI(hl({},CI(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&e.append(r,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function wa(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var UI=Object.defineProperty,FI=Object.defineProperties,LI=Object.getOwnPropertyDescriptors,h1=Object.getOwnPropertySymbols,kI=Object.prototype.hasOwnProperty,qI=Object.prototype.propertyIsEnumerable,d1=(t,e,n)=>e in t?UI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,MI=(t,e)=>{for(var n in e||(e={}))kI.call(e,n)&&d1(t,n,e[n]);if(h1)for(var n of h1(e))qI.call(e,n)&&d1(t,n,e[n]);return t},jI=(t,e)=>FI(t,LI(e));function Di(t){const e=[];return t.forEach(n=>{const[r,i]=n.split(":");e.push(`${r}:${i}`)}),e}function p1(t){const e=[];return Object.values(t).forEach(n=>{e.push(...Di(n.accounts))}),[...new Set(e)]}function zI(t){const e=[];return Object.values(t).forEach(n=>{e.push(...n.methods)}),[...new Set(e)]}function VI(t){const e=[];return Object.values(t).forEach(n=>{e.push(...n.events)}),[...new Set(e)]}function HI(t,e){const n=[];return Object.values(t).forEach(r=>{Di(r.accounts).includes(e)&&n.push(...r.methods)}),n}function KI(t,e){const n=[];return Object.values(t).forEach(r=>{Di(r.accounts).includes(e)&&n.push(...r.events)}),n}function g1(t){return t.includes(":")}function GI(t){return g1(t)?t.split(":")[0]:t}function b1(t){var e,n,r;const i={};if(!Is(t))return i;for(const[s,o]of Object.entries(t)){const a=g1(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=GI(s);i[l]=jI(MI({},i[l]),{chains:kr(a,(e=i[l])==null?void 0:e.chains),methods:kr(c,(n=i[l])==null?void 0:n.methods),events:kr(u,(r=i[l])==null?void 0:r.events)})}return i}function WI(t){const e={};return t?.forEach(n=>{var r;const[i,s]=n.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(n),(r=e[i].chains)==null||r.push(`${i}:${s}`)}),e}function y1(t,e){e=e.map(r=>r.replace("did:pkh:",""));const n=WI(e);for(const[r,i]of Object.entries(n))i.methods?i.methods=kr(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return n}function ZI(t,e){var n,r,i,s,o,a;const c=b1(t),u=b1(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const d of h)l[d]={chains:kr((n=c[d])==null?void 0:n.chains,(r=u[d])==null?void 0:r.chains),methods:kr((i=c[d])==null?void 0:i.methods,(s=u[d])==null?void 0:s.methods),events:kr((o=c[d])==null?void 0:o.events,(a=u[d])==null?void 0:a.events)};return l}const YI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},XI={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function G(t,e){const{message:n,code:r}=XI[t];return{message:e?`${n} ${e}`:n,code:r}}function xe(t,e){const{message:n,code:r}=YI[t];return{message:e?`${n} ${e}`:n,code:r}}function $i(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Is(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Pe(t){return typeof t>"u"}function Ie(t,e){return e&&Pe(t)?!0:typeof t=="string"&&!!t.trim().length}function dl(t,e){return e&&Pe(t)?!0:typeof t=="number"&&!isNaN(t)}function JI(t,e){const{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),i=Object.keys(n);let s=!0;return Fr(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=Di(a),h=n[o];(!Fr(_0(o,h),l)||!Fr(h.methods,c)||!Fr(h.events,u))&&(s=!1)}),s):!1}function ma(t){return Ie(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function QI(t){if(Ie(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const n=e[0]+":"+e[1];return!!e[2]&&ma(n)}}return!1}function e9(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(Ie(t,!1)){if(e(t))return!0;const n=N0(t);return e(n)}}catch{}return!1}function t9(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function n9(t){return t?.topic}function r9(t,e){let n=null;return Ie(t?.publicKey,!1)||(n=G("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function w1(t){let e=!0;return $i(t)?t.length&&(e=t.every(n=>Ie(n,!1))):e=!1,e}function i9(t,e,n){let r=null;return $i(e)&&e.length?e.forEach(i=>{r||ma(i)||(r=xe("UNSUPPORTED_CHAINS",`${n}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):ma(t)||(r=xe("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function s9(t,e,n){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const o=i9(i,_0(i,s),`${e} ${n}`);o&&(r=o)}),r}function o9(t,e){let n=null;return $i(t)?t.forEach(r=>{n||QI(r)||(n=xe("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=xe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function a9(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=o9(r?.accounts,`${e} namespace`);i&&(n=i)}),n}function c9(t,e){let n=null;return w1(t?.methods)?w1(t?.events)||(n=xe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=xe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function m1(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=c9(r,`${e}, namespace`);i&&(n=i)}),n}function u9(t,e,n){let r=null;if(t&&Is(t)){const i=m1(t,e);i&&(r=i);const s=s9(t,e,n);s&&(r=s)}else r=G("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function pl(t,e){let n=null;if(t&&Is(t)){const r=m1(t,e);r&&(n=r);const i=a9(t,e);i&&(n=i)}else n=G("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function v1(t){return Ie(t.protocol,!0)}function l9(t,e){let n=!1;return e&&!t?n=!0:t&&$i(t)&&t.length&&t.forEach(r=>{n=v1(r)}),n}function f9(t){return typeof t=="number"}function xt(t){return typeof t<"u"&&typeof t!==null}function h9(t){return!(!t||typeof t!="object"||!t.code||!dl(t.code,!1)||!t.message||!Ie(t.message,!1))}function d9(t){return!(Pe(t)||!Ie(t.method,!1))}function p9(t){return!(Pe(t)||Pe(t.result)&&Pe(t.error)||!dl(t.id,!1)||!Ie(t.jsonrpc,!1))}function g9(t){return!(Pe(t)||!Ie(t.name,!1))}function E1(t,e){return!(!ma(e)||!p1(t).includes(e))}function b9(t,e,n){return Ie(n,!1)?HI(t,e).includes(n):!1}function y9(t,e,n){return Ie(n,!1)?KI(t,e).includes(n):!1}function x1(t,e,n){let r=null;const i=w9(t),s=m9(e),o=Object.keys(i),a=Object.keys(s),c=_1(Object.keys(t)),u=_1(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Fr(o,a)||(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const d=Di(e[h].accounts);d.includes(h)||(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(Fr(i[h].methods,s[h].methods)?Fr(i[h].events,s[h].events)||(r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${h}`)):r=G("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function w9(t){const e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:(r=t[n].chains)==null||r.forEach(i=>{e[i]={methods:t[n].methods,events:t[n].events}})}),e}function _1(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function m9(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const r=Di(t[n].accounts);r?.forEach(i=>{e[i]={accounts:t[n].accounts.filter(s=>s.includes(`${i}:`)),methods:t[n].methods,events:t[n].events}})}}),e}function v9(t,e){return dl(t,!1)&&t<=e.max&&t>=e.min}function S1(){const t=hs();return new Promise(e=>{switch(t){case Bt.browser:e(E9());break;case Bt.reactNative:e(x9());break;case Bt.node:e(_9());break;default:e(!0)}})}function E9(){return vi()&&navigator?.onLine}async function x9(){if(ir()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function _9(){return!0}function S9(t){switch(hs()){case Bt.browser:I9(t);break;case Bt.reactNative:O9(t);break}}function I9(t){!ir()&&vi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function O9(t){ir()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function A9(){var t;return vi()&&Dr()?((t=Dr())==null?void 0:t.visibilityState)==="visible":!0}const gl={};class Os{static get(e){return gl[e]}static set(e,n){gl[e]=n}static delete(e){delete gl[e]}}function B9(t){const e=ns.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function D9({publicKey:t,signature:e,payload:n}){var r;const i=bl(n.method),s=128|parseInt(((r=n.version)==null?void 0:r.toString())||"4"),o=P9(n.address),a=n.era==="00"?new Uint8Array([0]):bl(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(n.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${T9(n.tip)}`),h=N9(l),d=new Uint8Array([0,...t,o,...e,...a,...u,...h,...i]),f=R9(d.length+1);return new Uint8Array([...f,s,...d])}function $9(t){const e=bl(t),n=o4.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function bl(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function T9(t){return t.startsWith("0x")?t.slice(2):t}function P9(t){const e=ns.decode(t)[0];return e===42?0:e===60?2:1}function R9(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function N9(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function C9(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=B9(t.transaction.address),r=D9({publicKey:n,signature:e,payload:t.transaction}),i=Buffer.from(r).toString("hex");return $9(i)}function I1({logger:t,name:e}){const n=typeof t=="string"?$f({opts:{level:t,name:e}}).logger:t;return n.level=typeof t=="string"?t:t.level,n}const U9="PARSE_ERROR",F9="INVALID_REQUEST",L9="METHOD_NOT_FOUND",k9="INVALID_PARAMS",O1="INTERNAL_ERROR",yl="SERVER_ERROR",q9=[-32700,-32600,-32601,-32602,-32603],As={[U9]:{code:-32700,message:"Parse error"},[F9]:{code:-32600,message:"Invalid Request"},[L9]:{code:-32601,message:"Method not found"},[k9]:{code:-32602,message:"Invalid params"},[O1]:{code:-32603,message:"Internal error"},[yl]:{code:-32e3,message:"Server error"}},A1=yl;function M9(t){return q9.includes(t)}function B1(t){return Object.keys(As).includes(t)?As[t]:As[A1]}function j9(t){const e=Object.values(As).find(n=>n.code===t);return e||As[A1]}function z9(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var D1={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var wl=function(t,e){return wl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},wl(t,e)};function V9(t,e){wl(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ml=function(){return ml=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ml.apply(this,arguments)};function H9(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function K9(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function G9(t,e){return function(n,r){e(n,r,t)}}function W9(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Z9(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function Y9(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function X9(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function J9(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function vl(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function $1(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Q9(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat($1(arguments[e]));return t}function e7(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Bs(t){return this instanceof Bs?(this.v=t,this):new Bs(t)}function t7(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(f){return new Promise(function(p,y){s.push([d,f,p,y])>1||a(d,f)})})}function a(d,f){try{c(r[d](f))}catch(p){h(s[0][3],p)}}function c(d){d.value instanceof Bs?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function n7(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Bs(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function r7(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof vl=="function"?vl(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function i7(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function s7(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o7(t){return t&&t.__esModule?t:{default:t}}function a7(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function c7(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var u7=Object.freeze({__proto__:null,__extends:V9,get __assign(){return ml},__rest:H9,__decorate:K9,__param:G9,__metadata:W9,__awaiter:Z9,__generator:Y9,__createBinding:X9,__exportStar:J9,__values:vl,__read:$1,__spread:Q9,__spreadArrays:e7,__await:Bs,__asyncGenerator:t7,__asyncDelegator:n7,__asyncValues:r7,__makeTemplateObject:i7,__importStar:s7,__importDefault:o7,__classPrivateFieldGet:a7,__classPrivateFieldSet:c7}),l7=Hl(u7),Un={},T1;function f7(){if(T1)return Un;T1=1,Object.defineProperty(Un,"__esModule",{value:!0}),Un.isBrowserCryptoAvailable=Un.getSubtleCrypto=Un.getBrowerCrypto=void 0;function t(){return en?.crypto||en?.msCrypto||{}}Un.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}Un.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return Un.isBrowserCryptoAvailable=n,Un}var Fn={},P1;function h7(){if(P1)return Fn;P1=1,Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.isBrowser=Fn.isNode=Fn.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Fn.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Fn.isNode=e;function n(){return!t()&&!e()}return Fn.isBrowser=n,Fn}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=l7;e.__exportStar(f7(),t),e.__exportStar(h7(),t)})(D1);function cn(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function vr(t=6){return BigInt(cn(t))}function Ln(t,e,n){return{id:n||cn(),jsonrpc:"2.0",method:t,params:e}}function va(t,e){return{id:t,jsonrpc:"2.0",result:e}}function El(t,e,n){return{id:t,jsonrpc:"2.0",error:d7(e,n)}}function d7(t,e){return typeof t>"u"?B1(O1):(typeof t=="string"&&(t=Object.assign(Object.assign({},B1(yl)),{message:t})),typeof e<"u"&&(t.data=e),M9(t.code)&&(t=j9(t.code)),t)}class p7{}class g7 extends p7{constructor(){super()}}class b7 extends g7{constructor(e){super()}}const y7="^wss?:";function w7(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function m7(t,e){const n=w7(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function R1(t){return m7(t,y7)}function v7(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function N1(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function xl(t){return N1(t)&&"method"in t}function Ea(t){return N1(t)&&(un(t)||kt(t))}function un(t){return"result"in t}function kt(t){return"error"in t}class E7 extends b7{constructor(e){super(e),this.events=new lt.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(Ln(e.method,e.params||[],e.id||vr().toString()),n)}async requestStrict(e,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{kt(s)?i(s.error):r(s.result)});try{await this.connection.send(e,n)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ea(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const x7=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),_7=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",C1=t=>t.split("?")[0],U1=10,S7=x7();class I7{constructor(e){if(this.url=e,this.events=new lt.exports.EventEmitter,this.registering=!1,!R1(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Fi(e))}catch(n){this.onError(e.id,n)}}register(e=this.url){if(!R1(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((n,r)=>{const i=D1.isReactNative()?void 0:{rejectUnauthorized:!v7(e)},s=new S7(e,[],i);_7()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(e){e.onmessage=n=>this.onPayload(n),e.onclose=n=>this.onClose(n),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?Qr(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const r=this.parseError(n),i=r.message||r.toString(),s=El(e,i);this.events.emit("payload",s)}parseError(e,n=this.url){return z9(e,C1(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>U1&&this.events.setMaxListeners(U1)}emitError(e){const n=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${C1(this.url)}`));return this.events.emit("register_error",n),n}}var O7=Object.defineProperty,F1=Object.getOwnPropertySymbols,A7=Object.prototype.hasOwnProperty,B7=Object.prototype.propertyIsEnumerable,L1=(t,e,n)=>e in t?O7(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ut=(t,e)=>{for(var n in e||(e={}))A7.call(e,n)&&L1(t,n,e[n]);if(F1)for(var n of F1(e))B7.call(e,n)&&L1(t,n,e[n]);return t};const k1="wc",q1=2,xa="core",ln=`${k1}@2:${xa}:`,D7={name:xa,logger:"error"},$7={database:":memory:"},T7="crypto",M1="client_ed25519_seed",P7=K.ONE_DAY,R7="keychain",N7="0.3",C7="messages",U7="0.3",F7=K.SIX_HOURS,L7="publisher",j1="irn",k7="error",z1="wss://relay.walletconnect.org",q7="relayer",Oe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},M7="_subscription",qt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},j7=.1,_l="2.23.1",ve={link_mode:"link_mode",relay:"relay"},_a={inbound:"inbound",outbound:"outbound"},z7="0.3",V7="WALLETCONNECT_CLIENT_ID",V1="WALLETCONNECT_LINK_MODE_APPS",$t={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},H7="subscription",K7="0.3",G7="pairing",W7="0.3",Ds={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},Kr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Xt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Z7="history",Y7="0.3",X7="expirer",Mt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},J7="0.3",Q7="verify-api",eO="https://verify.walletconnect.com",H1="https://verify.walletconnect.org",$s=H1,tO=`${$s}/v3`,nO=[eO,H1],rO="echo",iO="https://echo.walletconnect.com",fn={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},kn={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Jt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Gr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Wr={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Ts={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},sO=.1,oO="event-client",aO=86400,cO="https://pulse.walletconnect.org/batch";function uO(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var y=0,m=0,A=0,$=p.length;A!==$&&p[A]===0;)A++,y++;for(var _=($-A)*l+1>>>0,x=new Uint8Array(_);A!==$;){for(var T=p[A],R=0,F=_-1;(T!==0||R<m)&&F!==-1;F--,R++)T+=256*x[F]>>>0,x[F]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");m=R,A++}for(var U=_-m;U!==_&&x[U]===0;)U++;for(var D=c.repeat(y);U<_;++U)D+=t.charAt(x[U]);return D}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var y=0;if(p[y]!==" "){for(var m=0,A=0;p[y]===c;)m++,y++;for(var $=(p.length-y)*u+1>>>0,_=new Uint8Array($);p[y];){var x=n[p.charCodeAt(y)];if(x===255)return;for(var T=0,R=$-1;(x!==0||T<A)&&R!==-1;R--,T++)x+=a*_[R]>>>0,_[R]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");A=T,y++}if(p[y]!==" "){for(var F=$-A;F!==$&&_[F]===0;)F++;for(var U=new Uint8Array(m+($-F)),D=m;F!==$;)U[D++]=_[F++];return U}}}function f(p){var y=d(p);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var lO=uO,fO=lO;const K1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},hO=t=>new TextEncoder().encode(t),dO=t=>new TextDecoder().decode(t);class pO{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class gO{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return G1(this,e)}}class bO{constructor(e){this.decoders=e}or(e){return G1(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const G1=(t,e)=>new bO(ut(ut({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class yO{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new pO(e,n,r),this.decoder=new gO(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Sa=({name:t,prefix:e,encode:n,decode:r})=>new yO(t,e,n,r),Ps=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=fO(n,e);return Sa({prefix:t,name:e,encode:r,decode:s=>K1(i(s))})},wO=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},mO=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},ze=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Sa({prefix:e,name:t,encode(i){return mO(i,r,n)},decode(i){return wO(i,r,n,t)}}),vO=Sa({prefix:"\0",name:"identity",encode:t=>dO(t),decode:t=>hO(t)});var EO=Object.freeze({__proto__:null,identity:vO});const xO=ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var _O=Object.freeze({__proto__:null,base2:xO});const SO=ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var IO=Object.freeze({__proto__:null,base8:SO});const OO=Ps({prefix:"9",name:"base10",alphabet:"0123456789"});var AO=Object.freeze({__proto__:null,base10:OO});const BO=ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),DO=ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var $O=Object.freeze({__proto__:null,base16:BO,base16upper:DO});const TO=ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),PO=ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),RO=ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),NO=ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),CO=ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),UO=ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),FO=ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),LO=ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kO=ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var qO=Object.freeze({__proto__:null,base32:TO,base32upper:PO,base32pad:RO,base32padupper:NO,base32hex:CO,base32hexupper:UO,base32hexpad:FO,base32hexpadupper:LO,base32z:kO});const MO=Ps({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jO=Ps({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zO=Object.freeze({__proto__:null,base36:MO,base36upper:jO});const VO=Ps({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),HO=Ps({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var KO=Object.freeze({__proto__:null,base58btc:VO,base58flickr:HO});const GO=ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),WO=ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ZO=ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),YO=ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var XO=Object.freeze({__proto__:null,base64:GO,base64pad:WO,base64url:ZO,base64urlpad:YO});const W1=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),JO=W1.reduce((t,e,n)=>(t[n]=e,t),[]),QO=W1.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function eA(t){return t.reduce((e,n)=>(e+=JO[n],e),"")}function tA(t){const e=[];for(const n of t){const r=QO[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const nA=Sa({prefix:"\u{1F680}",name:"base256emoji",encode:eA,decode:tA});var rA=Object.freeze({__proto__:null,base256emoji:nA}),iA=Y1,Z1=128,sA=127,oA=~sA,aA=Math.pow(2,31);function Y1(t,e,n){e=e||[],n=n||0;for(var r=n;t>=aA;)e[n++]=t&255|Z1,t/=128;for(;t&oA;)e[n++]=t&255|Z1,t>>>=7;return e[n]=t|0,Y1.bytes=n-r+1,e}var cA=Sl,uA=128,X1=127;function Sl(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw Sl.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&X1)<<i:(o&X1)*Math.pow(2,i),i+=7}while(o>=uA);return Sl.bytes=s-r,n}var lA=Math.pow(2,7),fA=Math.pow(2,14),hA=Math.pow(2,21),dA=Math.pow(2,28),pA=Math.pow(2,35),gA=Math.pow(2,42),bA=Math.pow(2,49),yA=Math.pow(2,56),wA=Math.pow(2,63),mA=function(t){return t<lA?1:t<fA?2:t<hA?3:t<dA?4:t<pA?5:t<gA?6:t<bA?7:t<yA?8:t<wA?9:10},vA={encode:iA,decode:cA,encodingLength:mA},J1=vA;const Q1=(t,e,n=0)=>(J1.encode(t,e,n),e),eb=t=>J1.encodingLength(t),Il=(t,e)=>{const n=e.byteLength,r=eb(t),i=r+eb(n),s=new Uint8Array(i+n);return Q1(t,s,0),Q1(n,s,r),s.set(e,i),new EA(t,n,e,s)};class EA{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const tb=({name:t,code:e,encode:n})=>new xA(t,e,n);class xA{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Il(this.code,n):n.then(r=>Il(this.code,r))}else throw Error("Unknown type, must be binary type")}}const nb=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),_A=tb({name:"sha2-256",code:18,encode:nb("SHA-256")}),SA=tb({name:"sha2-512",code:19,encode:nb("SHA-512")});var IA=Object.freeze({__proto__:null,sha256:_A,sha512:SA});const rb=0,OA="identity",ib=K1;var AA=Object.freeze({__proto__:null,identity:{code:rb,name:OA,encode:ib,digest:t=>Il(rb,ib(t))}});new TextEncoder,new TextDecoder;const sb=ut(ut(ut(ut(ut(ut(ut(ut(ut(ut({},EO),_O),IO),AO),$O),qO),zO),KO),XO),rA);ut(ut({},IA),AA);function ob(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function BA(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ob(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ab(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const cb=ab("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ol=ab("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=BA(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),DA=ut({utf8:cb,"utf-8":cb,hex:sb.base16,latin1:Ol,ascii:Ol,binary:Ol},sb);function $A(t,e="utf8"){const n=DA[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ob(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var TA=Object.defineProperty,PA=(t,e,n)=>e in t?TA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,hn=(t,e,n)=>PA(t,typeof e!="symbol"?e+"":e,n);class RA{constructor(e,n){this.core=e,this.logger=n,hn(this,"keychain",new Map),hn(this,"name",R7),hn(this,"version",N7),hn(this,"initialized",!1),hn(this,"storagePrefix",ln),hn(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),hn(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),hn(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),hn(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:s}=G("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),hn(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=St(n,this.name)}get context(){return ht(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Pu(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ru(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var NA=Object.defineProperty,CA=(t,e,n)=>e in t?NA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ue=(t,e,n)=>CA(t,typeof e!="symbol"?e+"":e,n);class UA{constructor(e,n,r){this.core=e,this.logger=n,Ue(this,"name",T7),Ue(this,"keychain"),Ue(this,"randomSessionIdentifier",fl()),Ue(this,"initialized",!1),Ue(this,"clientId"),Ue(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ue(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Ue(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),s=Oh(i),o=Ih(s.publicKey);return this.clientId=o,o}),Ue(this,"generateKeyPair",()=>{this.isInitialized();const i=yI();return this.setPrivateKey(i.publicKey,i.privateKey)}),Ue(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=Oh(s),a=this.randomSessionIdentifier;return await sE(a,i,P7,o)}),Ue(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=wI(a,s);return this.setSymKey(c,o)}),Ue(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||ba(i);return await this.keychain.set(o,i),o}),Ue(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Ue(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Ue(this,"encode",async(i,s,o)=>{this.isInitialized();const a=s1(o),c=Fi(s);if(a1(a))return EI(c,o?.encoding);if(o1(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(d,f)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return mI({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),Ue(this,"decode",async(i,s,o)=>{this.isInitialized();const a=_I(s,o);if(a1(a)){const c=xI(s,o?.encoding);return Qr(c)}if(o1(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=vI({symKey:c,encoded:s,encoding:o?.encoding});return Qr(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Ue(this,"getPayloadType",(i,s=Et)=>{const o=Ss({encoded:i,encoding:s});return Hr(o.type)}),Ue(this,"getPayloadSenderPublicKey",(i,s=Et)=>{const o=Ss({encoded:i,encoding:s});return o.senderPublicKey?wt(o.senderPublicKey,ct):void 0}),this.core=e,this.logger=St(n,this.name),this.keychain=r||new RA(this.core,this.logger)}get context(){return ht(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(M1)}catch{e=fl(),await this.keychain.set(M1,e)}return $A(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var FA=Object.defineProperty,LA=Object.defineProperties,kA=Object.getOwnPropertyDescriptors,ub=Object.getOwnPropertySymbols,qA=Object.prototype.hasOwnProperty,MA=Object.prototype.propertyIsEnumerable,Al=(t,e,n)=>e in t?FA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jA=(t,e)=>{for(var n in e||(e={}))qA.call(e,n)&&Al(t,n,e[n]);if(ub)for(var n of ub(e))MA.call(e,n)&&Al(t,n,e[n]);return t},zA=(t,e)=>LA(t,kA(e)),Tt=(t,e,n)=>Al(t,typeof e!="symbol"?e+"":e,n);class VA extends im{constructor(e,n){super(e,n),this.logger=e,this.core=n,Tt(this,"messages",new Map),Tt(this,"messagesWithoutClientAck",new Map),Tt(this,"name",C7),Tt(this,"version",U7),Tt(this,"initialized",!1),Tt(this,"storagePrefix",ln),Tt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),Tt(this,"set",async(r,i,s)=>{this.isInitialized();const o=Lt(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===_a.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,zA(jA({},c),{[o]:i}))}return await this.persist(),o}),Tt(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),Tt(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),Tt(this,"has",(r,i)=>{this.isInitialized();const s=this.get(r),o=Lt(i);return typeof s[o]<"u"}),Tt(this,"ack",async(r,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=Lt(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),Tt(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=St(e,this.name),this.core=n}get context(){return ht(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Pu(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Pu(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ru(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ru(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var HA=Object.defineProperty,KA=Object.defineProperties,GA=Object.getOwnPropertyDescriptors,lb=Object.getOwnPropertySymbols,WA=Object.prototype.hasOwnProperty,ZA=Object.prototype.propertyIsEnumerable,Bl=(t,e,n)=>e in t?HA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ti=(t,e)=>{for(var n in e||(e={}))WA.call(e,n)&&Bl(t,n,e[n]);if(lb)for(var n of lb(e))ZA.call(e,n)&&Bl(t,n,e[n]);return t},fb=(t,e)=>KA(t,GA(e)),jt=(t,e,n)=>Bl(t,typeof e!="symbol"?e+"":e,n);class YA extends sm{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,jt(this,"events",new lt.exports.EventEmitter),jt(this,"name",L7),jt(this,"queue",new Map),jt(this,"publishTimeout",K.toMiliseconds(K.ONE_MINUTE)),jt(this,"initialPublishTimeout",K.toMiliseconds(K.ONE_SECOND*15)),jt(this,"needsTransportRestart",!1),jt(this,"publish",async(r,i,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});const h=s?.ttl||F7,d=s?.prompt||!1,f=s?.tag||0,p=s?.id||vr().toString(),y=Bi(ya().protocol),m={id:p,method:s?.publishMethod||y.publish,params:Ti({topic:r,message:i,ttl:h,prompt:d,tag:f,attestation:s?.attestation},s?.tvf)},A=`Failed to publish payload, please try again. id:${p} tag:${f}`;try{Pe((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),Pe((c=m.params)==null?void 0:c.tag)&&((u=m.params)==null||delete u.tag);const $=new Promise(async _=>{const x=({id:R})=>{var F;((F=m.id)==null?void 0:F.toString())===R.toString()&&(this.removeRequestFromQueue(R),this.relayer.events.removeListener(Oe.publish,x),_())};this.relayer.events.on(Oe.publish,x);const T=on(new Promise((R,F)=>{this.rpcPublish(m,s).then(R).catch(U=>{this.logger.warn(U,U?.message),F(U)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${f}`);try{await T,this.events.removeListener(Oe.publish,x)}catch(R){this.queue.set(p,{request:m,opts:s,attempt:1}),this.logger.warn(R,R?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:r,message:i,opts:s}}),await on($,this.publishTimeout,A)}catch($){if(this.logger.debug("Failed to Publish Payload"),this.logger.error($),(l=s?.internal)!=null&&l.throwOnFailedPublish)throw $}finally{this.queue.delete(p)}}),jt(this,"publishCustom",async r=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});const{payload:u,opts:l={}}=r,{attestation:h,tvf:d,publishMethod:f,prompt:p,tag:y,ttl:m=K.FIVE_MINUTES}=l,A=l.id||vr().toString(),$=Bi(ya().protocol),_=f||$.publish,x={id:A,method:_,params:Ti(fb(Ti({},u),{ttl:m,prompt:p,tag:y,attestation:h}),d)},T=`Failed to publish custom payload, please try again. id:${A} tag:${y}`;try{Pe((i=x.params)==null?void 0:i.prompt)&&((s=x.params)==null||delete s.prompt),Pe((o=x.params)==null?void 0:o.tag)&&((a=x.params)==null||delete a.tag);const R=new Promise(async F=>{const U=({id:j})=>{var M;((M=x.id)==null?void 0:M.toString())===j.toString()&&(this.removeRequestFromQueue(j),this.relayer.events.removeListener(Oe.publish,U),F())};this.relayer.events.on(Oe.publish,U);const D=on(new Promise((j,M)=>{this.rpcPublish(x,l).then(j).catch(E=>{this.logger.warn(E,E?.message),M(E)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${_} id:${A} tag:${y}`);try{await D,this.events.removeListener(Oe.publish,U)}catch(j){this.queue.set(A,{request:x,opts:l,attempt:1}),this.logger.warn(j,j?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:A,payload:u,opts:l}}),await on(R,this.publishTimeout,T)}catch(R){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(R),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw R}finally{this.queue.delete(A)}}),jt(this,"on",(r,i)=>{this.events.on(r,i)}),jt(this,"once",(r,i)=>{this.events.once(r,i)}),jt(this,"off",(r,i)=>{this.events.off(r,i)}),jt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=St(n,this.name),this.registerEventListeners()}get context(){return ht(this.logger)}async rpcPublish(e,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const r=await this.relayer.request(e);return this.relayer.events.emit(Oe.publish,Ti(Ti({},e),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{var r;const i=e.attempt+1;this.queue.set(n,fb(Ti({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Sr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Oe.connection_stalled);return}this.checkQueue()}),this.relayer.on(Oe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var XA=Object.defineProperty,JA=(t,e,n)=>e in t?XA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Pi=(t,e,n)=>JA(t,typeof e!="symbol"?e+"":e,n);class QA{constructor(){Pi(this,"map",new Map),Pi(this,"set",(e,n)=>{const r=this.get(e);this.exists(e,n)||this.map.set(e,[...r,n])}),Pi(this,"get",e=>this.map.get(e)||[]),Pi(this,"exists",(e,n)=>this.get(e).includes(n)),Pi(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,n))return;const i=r.filter(s=>s!==n);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Pi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var eB=Object.defineProperty,tB=Object.defineProperties,nB=Object.getOwnPropertyDescriptors,hb=Object.getOwnPropertySymbols,rB=Object.prototype.hasOwnProperty,iB=Object.prototype.propertyIsEnumerable,Dl=(t,e,n)=>e in t?eB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rs=(t,e)=>{for(var n in e||(e={}))rB.call(e,n)&&Dl(t,n,e[n]);if(hb)for(var n of hb(e))iB.call(e,n)&&Dl(t,n,e[n]);return t},$l=(t,e)=>tB(t,nB(e)),ye=(t,e,n)=>Dl(t,typeof e!="symbol"?e+"":e,n);class sB extends cm{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,ye(this,"subscriptions",new Map),ye(this,"topicMap",new QA),ye(this,"events",new lt.exports.EventEmitter),ye(this,"name",H7),ye(this,"version",K7),ye(this,"pending",new Map),ye(this,"cached",[]),ye(this,"initialized",!1),ye(this,"storagePrefix",ln),ye(this,"subscribeTimeout",K.toMiliseconds(K.ONE_MINUTE)),ye(this,"initialSubscribeTimeout",K.toMiliseconds(K.ONE_SECOND*15)),ye(this,"clientId"),ye(this,"batchSubscribeTopicsLimit",500),ye(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ye(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const o=ya(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);const c=await this.rpcSubscribe(r,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ye(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),ye(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),ye(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),ye(this,"on",(r,i)=>{this.events.on(r,i)}),ye(this,"once",(r,i)=>{this.events.once(r,i)}),ye(this,"off",(r,i)=>{this.events.off(r,i)}),ye(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),ye(this,"start",async()=>{await this.onConnect()}),ye(this,"stop",async()=>{await this.onDisconnect()}),ye(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ye(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),ye(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Sr.pulse,async()=>{await this.checkPending()}),this.events.on($t.created,async r=>{const i=$t.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on($t.deleted,async r=>{const i=$t.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=St(n,this.name),this.clientId=""}get context(){return ht(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let r=!1;try{r=this.getSubscription(e).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,n)))}async unsubscribeById(e,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}});try{const i=ya(r);await this.restartToComplete({topic:e,id:n,relay:i}),await this.rpcUnsubscribe(e,n,i);const s=xe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,n,r){var i,s;const o=await this.getSubscriptionId(e);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===ve.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});const a={method:Bi(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===ve.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},K.toMiliseconds(K.ONE_SECOND)),o;const u=new Promise(async h=>{const d=f=>{f.topic===e&&(this.events.removeListener($t.created,d),h(f.id))};this.events.on($t.created,d);try{const f=await on(new Promise((p,y)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),y(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener($t.created,d),h(f)}catch{}}),l=await on(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Oe.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;const n=e[0].relay,r={method:Bi(n.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await on(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Oe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const n=e[0].relay,r={method:Bi(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await on(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Oe.connection_stalled)}return i}rpcUnsubscribe(e,n,r){const i={method:Bi(r.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,n){this.setSubscription(e,$l(Rs({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Rs({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Rs({},n)),this.topicMap.set(n.topic,e),this.events.emit($t.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const n=this.subscriptions.get(e);if(!n){const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit($t.deleted,$l(Rs({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit($t.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit($t.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>$l(Rs({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await F4(K.toMiliseconds(K.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Lt(e+await this.getClientId())}}var oB=Object.defineProperty,db=Object.getOwnPropertySymbols,aB=Object.prototype.hasOwnProperty,cB=Object.prototype.propertyIsEnumerable,Tl=(t,e,n)=>e in t?oB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,pb=(t,e)=>{for(var n in e||(e={}))aB.call(e,n)&&Tl(t,n,e[n]);if(db)for(var n of db(e))cB.call(e,n)&&Tl(t,n,e[n]);return t},le=(t,e,n)=>Tl(t,typeof e!="symbol"?e+"":e,n);class uB extends om{constructor(e){var n;super(e),le(this,"protocol","wc"),le(this,"version",2),le(this,"core"),le(this,"logger"),le(this,"events",new lt.exports.EventEmitter),le(this,"provider"),le(this,"messages"),le(this,"subscriber"),le(this,"publisher"),le(this,"name",q7),le(this,"transportExplicitlyClosed",!1),le(this,"initialized",!1),le(this,"connectionAttemptInProgress",!1),le(this,"relayUrl"),le(this,"projectId"),le(this,"packageName"),le(this,"bundleId"),le(this,"hasExperiencedNetworkDisruption",!1),le(this,"pingTimeout"),le(this,"heartBeatTimeout",K.toMiliseconds(K.THIRTY_SECONDS+K.FIVE_SECONDS)),le(this,"reconnectTimeout"),le(this,"connectPromise"),le(this,"reconnectInProgress",!1),le(this,"requestsInFlight",[]),le(this,"connectTimeout",K.toMiliseconds(K.ONE_SECOND*15)),le(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const o=r.id||vr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),le(this,"resetPingTimeout",()=>{Zo()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),le(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),le(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(Oe.connect)}),le(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),le(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(Oe.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),le(this,"registerProviderListeners",()=>{this.provider.on(qt.payload,this.onPayloadHandler),this.provider.on(qt.connect,this.onConnectHandler),this.provider.on(qt.disconnect,this.onDisconnectHandler),this.provider.on(qt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=I1({logger:(n=e.logger)!=null?n:k7,name:this.name}),this.messages=new VA(this.logger,e.core),this.subscriber=new sB(this,this.logger),this.publisher=new YA(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||z1,E4()?this.packageName=A0():x4()&&(this.bundleId=A0()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return ht(this.logger)}get connected(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,r){this.isInitialized(),await this.publisher.publish(e,n,r),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:ve.relay},_a.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off($t.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on($t.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,pb({internal:{throwOnFailedPublish:o}},n)).catch(d=>{o&&h(d)})||a,l()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await on(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(e).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await S1())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){const{topic:r}=e;if(!n.sessionExists){const i=$e(K.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(Oe.message,e),await this.recordMessageEvent(e,_a.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(qt.disconnect,s),await on(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(qt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(qt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(qt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,K.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,r,i,s;if(Zo())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new E7(new I7(A4({sdkVersion:_l,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){const{topic:r,message:i}=e;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(e){const{topic:n,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),xl(e)){if(!e.method.endsWith(M7))return;const n=e.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:ve.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pb({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Ea(e)&&this.events.emit(Oe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,_a.inbound),this.events.emit(Oe.message,e))}async acknowledgePayload(e){const n=va(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(qt.payload,this.onPayloadHandler),this.provider.off(qt.connect,this.onConnectHandler),this.provider.off(qt.disconnect,this.onDisconnectHandler),this.provider.off(qt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await S1();S9(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Sr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&A9())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Oe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},K.toMiliseconds(j7)))))}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function lB(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function gb(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function bb(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const fB="[object RegExp]",hB="[object String]",dB="[object Number]",pB="[object Boolean]",yb="[object Arguments]",gB="[object Symbol]",bB="[object Date]",yB="[object Map]",wB="[object Set]",mB="[object Array]",vB="[object Function]",EB="[object ArrayBuffer]",Pl="[object Object]",xB="[object Error]",_B="[object DataView]",SB="[object Uint8Array]",IB="[object Uint8ClampedArray]",OB="[object Uint16Array]",AB="[object Uint32Array]",BB="[object BigUint64Array]",DB="[object Int8Array]",$B="[object Int16Array]",TB="[object Int32Array]",PB="[object BigInt64Array]",RB="[object Float32Array]",NB="[object Float64Array]";function CB(){}function wb(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function UB(t,e,n){return Ns(t,e,void 0,void 0,void 0,void 0,n)}function Ns(t,e,n,r,i,s,o){const a=o(t,e,n,r,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Cs(t,e,s,o)}return Cs(t,e,s,o)}function Cs(t,e,n,r){if(Object.is(t,e))return!0;let i=bb(t),s=bb(e);if(i===yb&&(i=Pl),s===yb&&(s=Pl),i!==s)return!1;switch(i){case hB:return t.toString()===e.toString();case dB:{const c=t.valueOf(),u=e.valueOf();return lB(c,u)}case pB:case bB:case gB:return Object.is(t.valueOf(),e.valueOf());case fB:return t.source===e.source&&t.flags===e.flags;case vB:return t===e}n=n??new Map;const o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(i){case yB:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Ns(u,e.get(c),c,t,e,n,r))return!1;return!0}case wB:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],d=u.findIndex(f=>Ns(h,f,void 0,t,e,n,r));if(d===-1)return!1;u.splice(d,1)}return!0}case mB:case SB:case IB:case OB:case AB:case BB:case DB:case $B:case TB:case PB:case RB:case NB:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ns(t[c],e[c],c,t,e,n,r))return!1;return!0}case EB:return t.byteLength!==e.byteLength?!1:Cs(new Uint8Array(t),new Uint8Array(e),n,r);case _B:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Cs(new Uint8Array(t),new Uint8Array(e),n,r);case xB:return t.name===e.name&&t.message===e.message;case Pl:{if(!(Cs(t.constructor,e.constructor,n,r)||wb(t)&&wb(e)))return!1;const c=[...Object.keys(t),...gb(t)],u=[...Object.keys(e),...gb(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!Ns(d,f,h,t,e,n,r))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function FB(t,e){return UB(t,e,CB)}var LB=Object.defineProperty,mb=Object.getOwnPropertySymbols,kB=Object.prototype.hasOwnProperty,qB=Object.prototype.propertyIsEnumerable,Rl=(t,e,n)=>e in t?LB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vb=(t,e)=>{for(var n in e||(e={}))kB.call(e,n)&&Rl(t,n,e[n]);if(mb)for(var n of mb(e))qB.call(e,n)&&Rl(t,n,e[n]);return t},_t=(t,e,n)=>Rl(t,typeof e!="symbol"?e+"":e,n);class Zr extends am{constructor(e,n,r,i=ln,s=void 0){super(e,n,r,i),this.core=e,this.logger=n,this.name=r,_t(this,"map",new Map),_t(this,"version",z7),_t(this,"cached",[]),_t(this,"initialized",!1),_t(this,"getKey"),_t(this,"storagePrefix",ln),_t(this,"recentlyDeleted",[]),_t(this,"recentlyDeletedLimit",200),_t(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Pe(o)?this.map.set(this.getKey(o),o):t9(o)?this.map.set(o.id,o):n9(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),_t(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),_t(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),_t(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>FB(a[c],o[c]))):this.values)),_t(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=vb(vb({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),_t(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=St(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return ht(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){const{message:i}=G("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var MB=Object.defineProperty,jB=(t,e,n)=>e in t?MB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,oe=(t,e,n)=>jB(t,typeof e!="symbol"?e+"":e,n);class zB{constructor(e,n){this.core=e,this.logger=n,oe(this,"name",G7),oe(this,"version",W7),oe(this,"events",new lt.exports),oe(this,"pairings"),oe(this,"initialized",!1),oe(this,"storagePrefix",ln),oe(this,"ignoredPayloadTypes",[Cn]),oe(this,"registeredMethods",[]),oe(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),oe(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),oe(this,"create",async r=>{this.isInitialized();const i=fl(),s=await this.core.crypto.setSymKey(i),o=$e(K.FIVE_MINUTES),a={protocol:j1},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},u=f1({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(Kr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:u}}),oe(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[fn.pairing_started]}});this.isValidPair(r,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=l1(r.uri);i.props.properties.topic=s,i.addTrace(fn.pairing_uri_validation_success),i.addTrace(fn.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(fn.existing_pairing),l.active)throw i.setError(kn.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(fn.pairing_not_expired)}const h=c||$e(K.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,d),i.addTrace(fn.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Kr.create,d),i.addTrace(fn.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(fn.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(kn.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(f){throw i.setError(kn.subscribe_pairing_topic_failure),f}return i.addTrace(fn.subscribe_pairing_topic_success),d}),oe(this,"activate",async({topic:r})=>{this.isInitialized();const i=$e(K.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),oe(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Lr();this.events.once(de("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),oe(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),oe(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),oe(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),oe(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",xe("USER_DISCONNECTED")),await this.deletePairing(i))}),oe(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return f1({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),oe(this,"sendRequest",async(r,i,s)=>{const o=Ln(i,s),a=await this.core.crypto.encode(r,o),c=Ds[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),oe(this,"sendResult",async(r,i,s)=>{const o=va(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,u=Ds[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),oe(this,"sendError",async(r,i,s)=>{const o=El(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,u=Ds[c]?Ds[c].res:Ds.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),oe(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,xe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),oe(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>sr(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),oe(this,"onRelayEventRequest",async r=>{const{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),oe(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),oe(this,"onPairingPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(Kr.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),oe(this,"onPairingPingResponse",(r,i)=>{const{id:s}=i;setTimeout(()=>{un(i)?this.events.emit(de("pairing_ping",s),{}):kt(i)&&this.events.emit(de("pairing_ping",s),{error:i.error})},500)}),oe(this,"onPairingDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Kr.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),oe(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=xe("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),oe(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(xe("WC_METHOD_UNSUPPORTED",r))}),oe(this,"isValidPair",(r,i)=>{var s;if(!xt(r)){const{message:a}=G("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(kn.malformed_pairing_uri),new Error(a)}if(!e9(r.uri)){const{message:a}=G("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(kn.malformed_pairing_uri),new Error(a)}const o=l1(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=G("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(kn.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=G("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(kn.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&K.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(kn.pairing_expired);const{message:a}=G("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),oe(this,"isValidPing",async r=>{if(!xt(r)){const{message:s}=G("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),oe(this,"isValidDisconnect",async r=>{if(!xt(r)){const{message:s}=G("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),oe(this,"isValidPairingTopic",async r=>{if(!Ie(r,!1)){const{message:i}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(sr(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=G("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=St(n,this.name),this.pairings=new Zr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ht(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Oe.message,async e=>{const{topic:n,message:r,transportType:i}=e;if(this.pairings.keys.includes(n)&&i!==ve.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(n,r);xl(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):Ea(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Mt.expired,async e=>{const{topic:n}=T0(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(Kr.expire,{topic:n}))})}}var VB=Object.defineProperty,HB=(t,e,n)=>e in t?VB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ve=(t,e,n)=>HB(t,typeof e!="symbol"?e+"":e,n);class KB extends rm{constructor(e,n){super(e,n),this.core=e,this.logger=n,Ve(this,"records",new Map),Ve(this,"events",new lt.exports.EventEmitter),Ve(this,"name",Z7),Ve(this,"version",Y7),Ve(this,"cached",[]),Ve(this,"initialized",!1),Ve(this,"storagePrefix",ln),Ve(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ve(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:$e(K.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Xt.created,o)}),Ve(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=kt(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Xt.updated,i))}),Ve(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Ve(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Xt.deleted,s)}}),this.persist()}),Ve(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Ve(this,"on",(r,i)=>{this.events.on(r,i)}),Ve(this,"once",(r,i)=>{this.events.once(r,i)}),Ve(this,"off",(r,i)=>{this.events.off(r,i)}),Ve(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=St(n,this.name)}get context(){return ht(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const r={topic:n.topic,request:Ln(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const n=this.records.get(e);if(!n){const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Xt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Xt.created,e=>{const n=Xt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Xt.updated,e=>{const n=Xt.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Xt.deleted,e=>{const n=Xt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(Sr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{K.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(Xt.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var GB=Object.defineProperty,WB=(t,e,n)=>e in t?GB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tt=(t,e,n)=>WB(t,typeof e!="symbol"?e+"":e,n);class ZB extends um{constructor(e,n){super(e,n),this.core=e,this.logger=n,tt(this,"expirations",new Map),tt(this,"events",new lt.exports.EventEmitter),tt(this,"name",X7),tt(this,"version",J7),tt(this,"cached",[]),tt(this,"initialized",!1),tt(this,"storagePrefix",ln),tt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),tt(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),tt(this,"set",(r,i)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Mt.created,{target:s,expiration:o})}),tt(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),tt(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Mt.deleted,{target:i,expiration:s})}}),tt(this,"on",(r,i)=>{this.events.on(r,i)}),tt(this,"once",(r,i)=>{this.events.once(r,i)}),tt(this,"off",(r,i)=>{this.events.off(r,i)}),tt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=St(n,this.name)}get context(){return ht(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return B4(e);if(typeof e=="number")return D4(e);const{message:n}=G("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Mt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:n}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const n=this.expirations.get(e);if(!n){const{message:r}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(e,n){const{expiry:r}=n;K.toMiliseconds(r)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(Mt.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(Sr.pulse,()=>this.checkExpirations()),this.events.on(Mt.created,e=>{const n=Mt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Mt.expired,e=>{const n=Mt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Mt.deleted,e=>{const n=Mt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var YB=Object.defineProperty,XB=(t,e,n)=>e in t?YB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ae=(t,e,n)=>XB(t,typeof e!="symbol"?e+"":e,n);class JB extends lm{constructor(e,n,r){super(e,n,r),this.core=e,this.logger=n,this.store=r,Ae(this,"name",Q7),Ae(this,"abortController"),Ae(this,"isDevEnv"),Ae(this,"verifyUrlV3",tO),Ae(this,"storagePrefix",ln),Ae(this,"version",q1),Ae(this,"publicKey"),Ae(this,"fetchPromise"),Ae(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&K.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ae(this,"register",async i=>{if(!vi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Dr(),l=this.startAbortTimer(K.ONE_SECOND*5),h=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",m),u.body.removeChild(y),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const y=u.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",p,{signal:this.abortController.signal});const m=A=>{if(A.data&&typeof A.data=="string")try{const $=JSON.parse(A.data);if($.type==="verify_attestation"){if(dc($.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(y),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),d($.attestation===null?"":$.attestation)}}catch($){this.logger.warn($)}};u.body.appendChild(y),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(u){this.logger.warn(u)}return""}),Ae(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(dc(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),Ae(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(K.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ae(this,"getVerifyUrl",i=>{let s=i||$s;return nO.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${$s}`),s=$s),s}),Ae(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(K.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),Ae(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Ae(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ae(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ae(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ae(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Ae(this,"validateAttestation",(i,s)=>{const o=II(i,s.publicKey),a={hasExpired:K.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=St(n,this.name),this.abortController=new AbortController,this.isDevEnv=Nu(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ht(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),K.toMiliseconds(e))}}var QB=Object.defineProperty,eD=(t,e,n)=>e in t?QB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Eb=(t,e,n)=>eD(t,typeof e!="symbol"?e+"":e,n);class tD extends fm{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,Eb(this,"context",rO),Eb(this,"registerDeviceToken",async r=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${iO}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=St(n,this.context)}}var nD=Object.defineProperty,xb=Object.getOwnPropertySymbols,rD=Object.prototype.hasOwnProperty,iD=Object.prototype.propertyIsEnumerable,Nl=(t,e,n)=>e in t?nD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Us=(t,e)=>{for(var n in e||(e={}))rD.call(e,n)&&Nl(t,n,e[n]);if(xb)for(var n of xb(e))iD.call(e,n)&&Nl(t,n,e[n]);return t},Fe=(t,e,n)=>Nl(t,typeof e!="symbol"?e+"":e,n);class sD extends hm{constructor(e,n,r=!0){super(e,n,r),this.core=e,this.logger=n,Fe(this,"context",oO),Fe(this,"storagePrefix",ln),Fe(this,"storageVersion",sO),Fe(this,"events",new Map),Fe(this,"shouldPersist",!1),Fe(this,"init",async()=>{if(!Nu())try{const i={eventId:R0(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:D0(this.core.relayer.protocol,this.core.relayer.version,_l)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Fe(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=R0(),l=this.core.projectId||"",h=Date.now(),d=Us({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),Fe(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Us(Us({},a),this.setMethods(a.eventId))}),Fe(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Fe(this,"setEventListeners",()=>{this.core.heartbeat.on(Sr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{K.fromMiliseconds(Date.now())-K.fromMiliseconds(i.timestamp)>aO&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Fe(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Fe(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Fe(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Fe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Fe(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Us(Us({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Fe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Fe(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${cO}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${_l}${s}`,{method:"POST",body:JSON.stringify(i)})}),Fe(this,"getAppDomain",()=>B0().url),this.logger=St(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var oD=Object.defineProperty,_b=Object.getOwnPropertySymbols,aD=Object.prototype.hasOwnProperty,cD=Object.prototype.propertyIsEnumerable,Cl=(t,e,n)=>e in t?oD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sb=(t,e)=>{for(var n in e||(e={}))aD.call(e,n)&&Cl(t,n,e[n]);if(_b)for(var n of _b(e))cD.call(e,n)&&Cl(t,n,e[n]);return t},me=(t,e,n)=>Cl(t,typeof e!="symbol"?e+"":e,n);class Ul extends Qw{constructor(e){var n;super(e),me(this,"protocol",k1),me(this,"version",q1),me(this,"name",xa),me(this,"relayUrl"),me(this,"projectId"),me(this,"customStoragePrefix"),me(this,"events",new lt.exports.EventEmitter),me(this,"logger"),me(this,"heartbeat"),me(this,"relayer"),me(this,"crypto"),me(this,"storage"),me(this,"history"),me(this,"expirer"),me(this,"pairing"),me(this,"verify"),me(this,"echoClient"),me(this,"linkModeSupportedApps"),me(this,"eventClient"),me(this,"initialized",!1),me(this,"logChunkController"),me(this,"on",(a,c)=>this.events.on(a,c)),me(this,"once",(a,c)=>this.events.once(a,c)),me(this,"off",(a,c)=>this.events.off(a,c)),me(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),me(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ve.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||z1,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Kw({level:typeof e?.logger=="string"&&e.logger?e.logger:D7.logger,name:xa}),{logger:s,chunkLoggerController:o}=$f({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=St(s,this.name),this.heartbeat=new Fa,this.crypto=new UA(this,this.logger,e?.keychain),this.history=new KB(this,this.logger),this.expirer=new ZB(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new aw(Sb(Sb({},$7),e?.storageOptions)),this.relayer=new uB({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new zB(this,this.logger),this.verify=new JB(this,this.logger,this.storage),this.echoClient=new tD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new sD(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const n=new Ul(e);await n.initialize();const r=await n.crypto.getClientId();return await n.storage.setItem(V7,r),n}get context(){return ht(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(V1,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(V1)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${e}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const uD=Ul,Fl="wc",Ll=2,kl="client",Ia=`${Fl}@${Ll}:${kl}:`,Oa={name:kl,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},lD={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},fD={database:":memory:"},ql="WALLETCONNECT_DEEPLINK_CHOICE",hD={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},dD="history",pD="0.3",Ib="proposal",gD=K.THIRTY_DAYS,Ml="Proposal expired",Ob="session",Yr=K.SEVEN_DAYS,Ab="engine",Le={wc_sessionPropose:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1104},res:{ttl:K.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1106},res:{ttl:K.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:K.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1112},res:{ttl:K.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1114},res:{ttl:K.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:K.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:K.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:K.FIVE_MINUTES,prompt:!1,tag:1119}}},Aa={min:K.FIVE_MINUTES,max:K.SEVEN_DAYS},Qt={idle:"IDLE",active:"ACTIVE"},Bb={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},Db="request",$b=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Tb="wc",bD=1.5,Pb="auth",Rb="authKeys",Nb="pairingTopics",Cb="requests",Fs=`${Tb}@${1.5}:${Pb}:`,Ls=`${Fs}:PUB_KEY`;var yD=Object.defineProperty,wD=Object.defineProperties,mD=Object.getOwnPropertyDescriptors,Ub=Object.getOwnPropertySymbols,vD=Object.prototype.hasOwnProperty,ED=Object.prototype.propertyIsEnumerable,jl=(t,e,n)=>e in t?yD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fe=(t,e)=>{for(var n in e||(e={}))vD.call(e,n)&&jl(t,n,e[n]);if(Ub)for(var n of Ub(e))ED.call(e,n)&&jl(t,n,e[n]);return t},He=(t,e)=>wD(t,mD(e)),V=(t,e,n)=>jl(t,typeof e!="symbol"?e+"":e,n);class xD extends bm{constructor(e){super(e),V(this,"name",Ab),V(this,"events",new lt.exports),V(this,"initialized",!1),V(this,"requestQueue",{state:Qt.idle,queue:[]}),V(this,"sessionRequestQueue",{state:Qt.idle,queue:[]}),V(this,"emittedSessionRequests",new L4({limit:500})),V(this,"requestQueueDelay",K.ONE_SECOND),V(this,"expectedPairingMethodMap",new Map),V(this,"recentlyDeletedMap",new Map),V(this,"recentlyDeletedLimit",200),V(this,"relayMessageCache",[]),V(this,"pendingSessions",new Map),V(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Le)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay)))}),V(this,"connect",async n=>{var r;this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=He(fe({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=ZI(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:u,relays:l,authentication:h,walletPay:d}=i,f=((r=h?.[0])==null?void 0:r.ttl)||Le.wc_sessionPropose.req.ttl||K.FIVE_MINUTES;this.validateRequestExpiry(f);let p=s,y,m=!1;try{if(p){const D=this.client.core.pairing.pairings.get(p);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),m=D.active}}catch(D){throw this.client.logger.error(`connect() -> pairing.get(${p}) failed`),D}if(!p||!m){const{topic:D,uri:j}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});p=D,y=j}if(!p){const{message:D}=G("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(D)}const A=await this.client.core.crypto.generateKeyPair(),$=$e(f),_=fe(He(fe(fe({requiredNamespaces:o,optionalNamespaces:a,relays:l??[{protocol:j1}],proposer:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:$,pairingTopic:p},c&&{sessionProperties:c}),u&&{scopedProperties:u}),{id:cn()}),(h||d)&&{requests:{authentication:h?.map(D=>{const{domain:j,chains:M,nonce:E,uri:b,exp:v,nbf:g,type:w,statement:S,requestId:O,resources:I,signatureTypes:B}=D;return{domain:j,chains:M,nonce:E,type:w??"caip122",aud:b,version:"1",iat:new Date().toISOString(),exp:v,nbf:g,statement:S,requestId:O,resources:I,signatureTypes:B}}),walletPay:d}}),x=de("session_connect",_.id),{reject:T,resolve:R,done:F}=Lr(f,Ml),U=({id:D})=>{D===_.id&&(this.client.events.off("proposal_expire",U),this.pendingSessions.delete(_.id),this.events.emit(x,{error:{message:Ml,code:0}}))};return this.client.events.on("proposal_expire",U),this.events.once(x,({error:D,session:j})=>{this.client.events.off("proposal_expire",U),D?T(D):j&&R(j)}),await this.setProposal(_.id,_),await this.sendProposeSession({proposal:_,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:_.id}}}).catch(D=>{throw this.deleteProposal(_.id),D}),{uri:y,approval:F}}),V(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(r){throw this.client.logger.error("pair() failed"),r}}),V(this,"approve",async n=>{var r,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=n?.id)==null?void 0:r.toString(),trace:[Jt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(j){throw o.setError(Gr.no_internet_connection),j}try{await this.isValidProposalId(n?.id)}catch(j){throw this.client.logger.error(`approve() -> proposal.get(${n?.id}) failed`),o.setError(Gr.proposal_not_found),j}try{await this.isValidApprove(n)}catch(j){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Gr.session_approve_namespace_validation_failure),j}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d,proposalRequestsResponses:f}=n,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:y,proposer:m,requiredNamespaces:A,optionalNamespaces:$}=p;let _=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:y});_||(_=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:Jt.session_approve_started,properties:{topic:y,trace:[Jt.session_approve_started,Jt.session_namespaces_validation_success]}}));const x=await this.client.core.crypto.generateKeyPair(),T=m.publicKey,R=await this.client.core.crypto.generateSharedKey(x,T),F=He(fe(fe(fe({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:x,metadata:this.client.metadata},expiry:$e(Yr)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{proposalRequestsResponses:f}),U=ve.relay;_.addTrace(Jt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(R,{transportType:U,internal:{skipSubscribe:!0}})}catch(j){throw _.setError(Gr.subscribe_session_topic_failure),j}_.addTrace(Jt.subscribe_session_topic_success);const D=He(fe({},F),{topic:R,requiredNamespaces:A,optionalNamespaces:$,pairingTopic:y,acknowledged:!1,self:F.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:x,transportType:ve.relay,authentication:f?.authentication,walletPayResult:f?.walletPay});await this.client.session.set(R,D),_.addTrace(Jt.store_session);try{await this.sendApproveSession({sessionTopic:R,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:x},sessionSettleRequest:F,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:fe({correlationId:a},this.getTVFApproveParams(D))}}),_.addTrace(Jt.session_approve_publish_success)}catch(j){throw this.client.logger.error(j),this.client.session.delete(R,xe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(R),j}return this.client.core.eventClient.deleteEvent({eventId:_.eventId}),await this.client.core.pairing.updateMetadata({topic:y,metadata:m.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:y}),await this.setExpiry(R,$e(Yr)),{topic:R,acknowledged:()=>Promise.resolve(this.client.session.get(R))}}),V(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=n;let s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&await this.sendError({id:r,topic:s,error:i,rpcOpts:Le.wc_sessionPropose.reject}),await this.deleteProposal(r)}),V(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:i}=n,{done:s,resolve:o,reject:a}=Lr(K.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=cn(),u=vr().toString(),l=this.client.session.get(r).namespaces;return this.events.once(de("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:l}),a(h)}),{acknowledged:s}}),V(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=n,i=cn(),{done:s,resolve:o,reject:a}=Lr(K.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(de("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,$e(Yr)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),V(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:r,request:i,topic:s,expiry:o=Le.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);a?.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const c=cn(),u=vr().toString(),{done:l,resolve:h,reject:d}=Lr(o,"Request expired. Please try again.");this.events.once(de("session_request",c),({error:m,result:A})=>{m?d(m):h(A)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:f,params:{request:He(fe({},i),{expiryTimestamp:$e(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),await l();const y={request:He(fe({},i),{expiryTimestamp:$e(o)}),chainId:r};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:f,params:y,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,y)}).catch(A=>d(A)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),m()}),new Promise(async m=>{var A;if(!((A=a.sessionConfig)!=null&&A.disableDeepLink)){const $=await R4(this.client.core.storage,ql);await $4({id:c,topic:s,wcDeepLink:$})}m()}),l()]).then(m=>m[2])}),V(this,"respond",async n=>{var r,i;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:n?.topic||((i=(r=n?.response)==null?void 0:r.id)==null?void 0:i.toString()),trace:[Jt.session_request_response_started]}});try{await this.isValidRespond(n)}catch(h){throw s.addTrace(h?.message),s.setError(Gr.session_request_response_validation_failure),h}s.addTrace(Jt.session_request_response_validation_success);const{topic:o,response:a}=n,{id:c}=a,u=this.client.session.get(o);u.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const l=this.getAppLinkIfEnabled(u.peer.metadata,u.transportType);try{s.addTrace(Jt.session_request_response_publish_started),un(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):kt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(n)}catch(h){throw s.addTrace(h?.message),s.setError(Gr.session_request_response_publish_failure),h}}),V(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=n;if(this.client.session.keys.includes(r)){const i=cn(),s=vr().toString(),{done:o,resolve:a,reject:c}=Lr(K.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(de("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),V(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);const{topic:r,event:i,chainId:s}=n,o=vr().toString(),a=cn();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),V(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);const{topic:r}=n;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:xe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=G("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),V(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(r=>JI(r,n)))),V(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),V(this,"authenticate",async(n,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(n);const s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?ve.link_mode:ve.relay;o===ve.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:d,exp:f,nbf:p,methods:y=[],expiry:m}=n,A=[...n.resources||[]],{topic:$,uri:_}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:$,uri:_}});const x=await this.client.core.crypto.generateKeyPair(),T=ba(x);if(await Promise.all([this.client.auth.authKeys.set(Ls,{responseTopic:T,publicKey:x}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:$})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${$}`),y.length>0){const{namespace:I}=Wo(a[0]);let B=Y5(I,"request",y);ia(A)&&(B=J5(B,A.pop())),A.push(B)}const R=m&&m>Le.wc_sessionAuthenticate.req.ttl?m:Le.wc_sessionAuthenticate.req.ttl,F={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:p,resources:A},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:$e(R)},U={eip155:{chains:a,methods:[...new Set(["personal_sign",...y])],events:["chainChanged","accountsChanged"]}},D={requiredNamespaces:{},optionalNamespaces:U,relays:[{protocol:"irn"}],pairingTopic:$,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:$e(Le.wc_sessionPropose.req.ttl),id:cn()},{done:j,resolve:M,reject:E}=Lr(R,"Request expired"),b=cn(),v=de("session_connect",D.id),g=de("session_request",b),w=async({error:I,session:B})=>{this.events.off(g,S),I?E(I):B&&M({session:B})},S=async I=>{var B,P,L;if(await this.deletePendingAuthRequest(b,{message:"fulfilled",code:0}),I.error){const H=xe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return I.error.code===H.code?void 0:(this.events.off(v,w),E(I.error.message))}await this.deleteProposal(D.id),this.events.off(v,w);const{cacaos:C,responder:k}=I.result,N=[],q=[];for(const H of C){await sg({cacao:H,projectId:this.client.core.projectId})||(this.client.logger.error(H,"Signature verification failed"),E(xe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Z}=H,Q=ia(Z.resources),ee=[ju(Z.iss)],se=ra(Z.iss);if(Q){const he=cg(Q),Ee=ug(Q);N.push(...he),ee.push(...Ee)}for(const he of ee)q.push(`${he}:${se}`)}const z=await this.client.core.crypto.generateSharedKey(x,k.publicKey);let W;N.length>0&&(W={topic:z,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:k,controller:k.publicKey,expiry:$e(Yr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:$,namespaces:y1([...new Set(N)],[...new Set(q)]),transportType:o},await this.client.core.relayer.subscribe(z,{transportType:o}),await this.client.session.set(z,W),$&&await this.client.core.pairing.updateMetadata({topic:$,metadata:k.metadata}),W=this.client.session.get(z)),(B=this.client.metadata.redirect)!=null&&B.linkMode&&(P=k.metadata.redirect)!=null&&P.linkMode&&(L=k.metadata.redirect)!=null&&L.universal&&r&&(this.client.core.addLinkModeSupportedApp(k.metadata.redirect.universal),this.client.session.update(z,{transportType:ve.link_mode})),M({auths:C,session:W})};this.events.once(v,w),this.events.once(g,S);let O;try{if(s){const I=Ln("wc_sessionAuthenticate",F,b);this.client.core.history.set($,I);const B=await this.client.core.crypto.encode("",I,{type:xs,encoding:mr});O=wa(r,$,B)}else await Promise.all([this.sendRequest({topic:$,method:"wc_sessionAuthenticate",params:F,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:b}),this.sendRequest({topic:$,method:"wc_sessionPropose",params:D,expiry:Le.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:D.id})])}catch(I){throw this.events.off(v,w),this.events.off(g,S),I}return await this.setProposal(D.id,D),await this.setAuthRequest(b,{request:He(fe({},F),{verifyContext:{}}),pairingTopic:$,transportType:o}),{uri:O??_,response:j}}),V(this,"approveSessionAuthenticate",async n=>{const{id:r,auths:i}=n,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[Wr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(Ts.no_internet_connection),m}const o=this.getPendingAuthRequest(r);if(!o)throw s.setError(Ts.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||ve.relay;a===ve.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=ba(c),h={type:Cn,receiverPublicKey:c,senderPublicKey:u},d=[],f=[];for(const m of i){if(!await sg({cacao:m,projectId:this.client.core.projectId})){s.setError(Ts.invalid_cacao);const T=xe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:l,error:T,encodeOpts:h}),new Error(T.message)}s.addTrace(Wr.cacaos_verified);const{p:A}=m,$=ia(A.resources),_=[ju(A.iss)],x=ra(A.iss);if($){const T=cg($),R=ug($);d.push(...T),_.push(...R)}for(const T of _)f.push(`${T}:${x}`)}const p=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Wr.create_authenticated_session_topic);let y;if(d?.length>0){y={topic:p,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:$e(Yr),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:y1([...new Set(d)],[...new Set(f)]),transportType:a},s.addTrace(Wr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw s.setError(Ts.subscribe_authenticated_session_topic_failure),m}s.addTrace(Wr.subscribe_authenticated_session_topic_success),await this.client.session.set(p,y),s.addTrace(Wr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Wr.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:r,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(Ts.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:y}}),V(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();const{id:r,reason:i}=n,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===ve.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ba(o),u={type:Cn,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:u,rpcOpts:Le.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),V(this,"formatAuthMessage",n=>{this.isInitialized();const{request:r,iss:i}=n;return og(r,i)}),V(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),V(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{const r=this.client.core.pairing.pairings.get(n.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),V(this,"deleteSession",async n=>{var r;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,xe("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(ql).catch(u=>this.client.logger.warn(u)),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=Qt.idle),await Promise.all(this.getPendingSessionRequests().filter(u=>u.topic===i).map(u=>this.deletePendingSessionRequest(u.id,xe("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),V(this,"deleteProposal",async(n,r)=>{if(r)try{const i=this.client.proposal.get(n),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s?.setError(Gr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,xe("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),V(this,"deletePendingSessionRequest",async(n,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),i&&(this.sessionRequestQueue.state=Qt.idle,this.client.events.emit("session_request_expire",{id:n}))}),V(this,"deletePendingAuthRequest",async(n,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)])}),V(this,"setExpiry",async(n,r)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,r),await this.client.session.update(n,{expiry:r}))}),V(this,"setProposal",async(n,r)=>{this.client.core.expirer.set(n,$e(Le.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,r)}),V(this,"setAuthRequest",async(n,r)=>{const{request:i,pairingTopic:s,transportType:o=ve.relay}=r;this.client.core.expirer.set(n,i.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:n,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),V(this,"setPendingSessionRequest",async n=>{const{id:r,topic:i,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||$e(Le.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:s,verifyContext:o})}),V(this,"sendRequest",async n=>{const{topic:r,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:d={}}=n,f=Ln(i,s,c);let p;const y=!!l;try{const $=y?mr:Et;p=await this.client.core.crypto.encode(r,f,{encoding:$})}catch($){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),$}let m;if($b.includes(i)){const $=Lt(JSON.stringify(f)),_=Lt(p);m=await this.client.core.verify.register({id:_,decryptedId:$})}const A=fe(fe({},Le[i].req),d);if(A.attestation=m,o&&(A.ttl=o),a&&(A.id=a),this.client.core.history.set(r,f),y){const $=wa(l,r,p);await global.Linking.openURL($,this.client.name)}else A.tvf=He(fe({},h),{correlationId:f.id}),u?(A.internal=He(fe({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,p,A)):this.client.core.relayer.publish(r,p,A).catch($=>this.client.logger.error($));return f.id}),V(this,"sendProposeSession",async n=>{const{proposal:r,publishOpts:i}=n,s=Ln("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,s);const o=await this.client.core.crypto.encode(r.pairingTopic,s,{encoding:Et}),a=Lt(JSON.stringify(s)),c=Lt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:He(fe({},i),{publishMethod:"wc_proposeSession",attestation:u})})}),V(this,"sendApproveSession",async n=>{const{sessionTopic:r,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=n,c=va(s.id,i),u=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:Et}),l=Ln("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(r,l,{encoding:Et});this.client.core.history.set(r,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:s.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:He(fe({},a),{publishMethod:"wc_approveSession"})})}),V(this,"sendResult",async n=>{const{id:r,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,u=va(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?mr:Et;l=await this.client.core.crypto.encode(i,u,He(fe({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),p}let d,f;try{d=await this.client.core.history.get(i,r);const p=d.request;try{f=this.getTVFParams(r,p.params,s)}catch(y){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${y?.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),p}if(h){const p=wa(c,i,l);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,y=Le[p].res;y.tvf=He(fe({},f),{correlationId:r}),o?(y.internal=He(fe({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,l,y)):this.client.core.relayer.publish(i,l,y).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(u)}),V(this,"sendError",async n=>{const{id:r,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,u=El(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?mr:Et;l=await this.client.core.crypto.encode(i,u,He(fe({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let d;try{d=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(h){const f=wa(c,i,l);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||Le[f].res;this.client.core.relayer.publish(i,l,p)}await this.client.core.history.resolve(u)}),V(this,"cleanup",async()=>{const n=[],r=[];this.client.session.getAll().forEach(i=>{let s=!1;sr(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&n.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{sr(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...n.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),V(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),V(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),V(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Qt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Qt.active;const n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=Qt.idle}),V(this,"processRequest",async n=>{const{topic:r,payload:i,attestation:s,transportType:o,encryptedId:a}=n,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),V(this,"onRelayEventResponse",async n=>{const{topic:r,payload:i,transportType:s}=n,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),V(this,"onRelayEventUnknownPayload",n=>{const{topic:r}=n,{message:i}=G("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),V(this,"shouldIgnorePairingRequest",n=>{const{topic:r,requestMethod:i}=n,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),V(this,"onSessionProposeRequest",async n=>{const{topic:r,payload:i,attestation:s,encryptedId:o}=n,{params:a,id:c}=i;try{const u=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(kn.proposal_listener_not_found)),this.isValidConnect(fe({},i.params));const l=a.expiryTimestamp||$e(Le.wc_sessionPropose.req.ttl),h=fe({id:c,pairingTopic:r,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:s,hash:Lt(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(fn.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(u){await this.sendError({id:c,topic:r,error:u,rpcOpts:Le.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),V(this,"onSessionProposeResponse",async(n,r,i)=>{const{id:s}=r;if(un(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:n,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:n})}else if(kt(r)){await this.deleteProposal(s);const o=de("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),V(this,"onSessionSettleRequest",async(n,r)=>{const{id:i,params:s}=r;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d,proposalRequestsResponses:f}=r.params,p=[...this.pendingSessions.values()].find(A=>A.sessionTopic===n);if(!p)return this.client.logger.error(`Pending session not found for topic ${n}`);const y=this.client.proposal.get(p.proposalId),m=He(fe(fe(fe({topic:n,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:ve.relay,authentication:f?.authentication,walletPayResult:f?.walletPay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:m.peer.metadata}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:r.id,topic:n,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:m}),this.events.emit(de("session_connect",p.proposalId),{session:m})}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),V(this,"onSessionSettleResponse",async(n,r)=>{const{id:i}=r;un(r)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(de("session_approve",i),{})):kt(r)&&(await this.client.session.delete(n,xe("USER_DISCONNECTED")),this.events.emit(de("session_approve",i),{error:r.error}))}),V(this,"onSessionUpdateRequest",async(n,r)=>{const{params:i,id:s}=r;try{const o=`${n}_session_update`,a=Os.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:xe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(fe({topic:n},i));try{Os.set(o,s),await this.client.session.update(n,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw Os.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:i})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),V(this,"isRequestOutOfSync",(n,r)=>r.toString().slice(0,-3)<n.toString().slice(0,-3)),V(this,"onSessionUpdateResponse",(n,r)=>{const{id:i}=r,s=de("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);un(r)?this.events.emit(de("session_update",i),{}):kt(r)&&this.events.emit(de("session_update",i),{error:r.error})}),V(this,"onSessionExtendRequest",async(n,r)=>{const{id:i}=r;try{this.isValidExtend({topic:n}),await this.setExpiry(n,$e(Yr)),await this.sendResult({id:i,topic:n,result:!0}),this.client.events.emit("session_extend",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),V(this,"onSessionExtendResponse",(n,r)=>{const{id:i}=r,s=de("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);un(r)?this.events.emit(de("session_extend",i),{}):kt(r)&&this.events.emit(de("session_extend",i),{error:r.error})}),V(this,"onSessionPingRequest",async(n,r)=>{const{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult({id:i,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),V(this,"onSessionPingResponse",(n,r)=>{const{id:i}=r,s=de("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);un(r)?this.events.emit(de("session_ping",i),{}):kt(r)&&this.events.emit(de("session_ping",i),{error:r.error})},500)}),V(this,"onSessionDeleteRequest",async(n,r)=>{const{id:i}=r;try{await this.isValidDisconnect({topic:n,reason:r.params}),this.cleanupPendingSentRequestsForTopic({topic:n,error:xe("USER_DISCONNECTED")}),await this.deleteSession({topic:n,id:i})}catch(s){this.client.logger.error(s)}}),V(this,"onSessionRequest",async n=>{var r,i,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=n,{id:h,params:d}=a;try{await this.isValidRequest(fe({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Lt(JSON.stringify(Ln("wc_sessionRequest",d,h))),encryptedId:u,metadata:f.peer.metadata,transportType:l}),y={id:h,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(y),l===ve.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(y):(this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),V(this,"onSessionRequestResponse",(n,r)=>{const{id:i}=r,s=de("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);un(r)?this.events.emit(de("session_request",i),{result:r.result}):kt(r)&&this.events.emit(de("session_request",i),{error:r.error})}),V(this,"onSessionEventRequest",async(n,r)=>{const{id:i,params:s}=r;try{const o=`${n}_session_event_${s.event.name}`,a=Os.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(fe({topic:n},s)),this.client.events.emit("session_event",{id:i,topic:n,params:s}),Os.set(o,i)}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),V(this,"onSessionAuthenticateResponse",(n,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:r}),un(r)?this.events.emit(de("session_request",i),{result:r.result}):kt(r)&&this.events.emit(de("session_request",i),{error:r.error})}),V(this,"onSessionAuthenticateRequest",async n=>{var r;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:Lt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),f={requester:u,pairingTopic:i,id:s.id,authPayload:l,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:f,pairingTopic:i,transportType:c}),c===ve.link_mode&&(r=u.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:d})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),f={type:Cn,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:u,encodeOpts:f,rpcOpts:Le.wc_sessionAuthenticate.autoReject,appLink:d})}}),V(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),V(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Qt.idle,this.processSessionRequestQueue()},K.toMiliseconds(this.requestQueueDelay))}),V(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(de("session_request",s.request.id),{error:r})})}),V(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Qt.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(n)}catch(r){this.client.logger.error(r)}}),V(this,"emitSessionRequest",n=>{if(this.emittedSessionRequests.has(n.id)){this.client.logger.warn({id:n.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${n.id}`);return}this.sessionRequestQueue.state=Qt.active,this.emittedSessionRequests.add(n.id),this.client.events.emit("session_request",n)}),V(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===n.topic);r&&this.onSessionProposeRequest({topic:n.topic,payload:Ln("wc_sessionPropose",He(fe({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),V(this,"isValidConnect",async n=>{if(!xt(n)){const{message:u}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(u)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if(Pe(r)||await this.isValidPairingTopic(r),!l9(c,!0)){const{message:u}=G("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(i&&!Pe(i)&&Is(i)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!Pe(s)&&Is(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!Pe(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Pe(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),V(this,"validateNamespaces",(n,r)=>{const i=u9(n,"connect()",r);if(i)throw new Error(i.message)}),V(this,"isValidApprove",async n=>{if(!xt(n))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:r,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),u=pl(i,"approve()");if(u)throw new Error(u.message);const l=x1(c.requiredNamespaces,i,"approve()");if(l)throw new Error(l.message);if(!Ie(s,!0)){const{message:h}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!Pe(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Pe(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),V(this,"isValidReject",async n=>{if(!xt(n)){const{message:s}=G("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}const{id:r,reason:i}=n;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!h9(i)){const{message:s}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),V(this,"isValidSessionSettleRequest",n=>{if(!xt(n)){const{message:u}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(u)}const{relay:r,controller:i,namespaces:s,expiry:o}=n;if(!v1(r)){const{message:u}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=r9(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=pl(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(sr(o)){const{message:u}=G("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),V(this,"isValidUpdate",async n=>{if(!xt(n)){const{message:c}=G("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}const{topic:r,namespaces:i}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const s=this.client.session.get(r),o=pl(i,"update()");if(o)throw new Error(o.message);const a=x1(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),V(this,"isValidExtend",async n=>{if(!xt(n)){const{message:i}=G("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(i)}const{topic:r}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),V(this,"isValidRequest",async n=>{if(!xt(n)){const{message:c}=G("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}const{topic:r,request:i,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!E1(a,s)){const{message:c}=G("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!d9(i)){const{message:c}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!b9(a,s,i.method)){const{message:c}=G("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),V(this,"isValidRespond",async n=>{var r;if(!xt(n)){const{message:a}=G("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(a)}const{topic:i,response:s}=n;try{await this.isValidSessionTopic(i)}catch(a){throw(r=n?.response)!=null&&r.id&&this.cleanupAfterResponse(n),a}if(!p9(s)){const{message:a}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==i){const{message:a}=G("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),V(this,"isValidPing",async n=>{if(!xt(n)){const{message:i}=G("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),V(this,"isValidEmit",async n=>{if(!xt(n)){const{message:a}=G("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}const{topic:r,event:i,chainId:s}=n;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!E1(o,s)){const{message:a}=G("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!g9(i)){const{message:a}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!y9(o,s,i.name)){const{message:a}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),V(this,"isValidDisconnect",async n=>{if(!xt(n)){const{message:i}=G("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),V(this,"isValidAuthenticate",n=>{const{chains:r,uri:i,domain:s,nonce:o}=n;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ie(i,!1))throw new Error("uri is required parameter");if(!Ie(s,!1))throw new Error("domain is required parameter");if(!Ie(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>Wo(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Wo(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),V(this,"getVerifyContext",async n=>{const{attestationId:r,hash:i,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||$s,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ve.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),V(this,"validateSessionProps",(n,r)=>{Object.values(n).forEach((i,s)=>{if(i==null){const{message:o}=G("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),V(this,"getPendingAuthRequest",n=>{const r=this.client.auth.requests.get(n);return typeof r=="object"?r:void 0}),V(this,"addToRecentlyDeleted",(n,r)=>{if(this.recentlyDeletedMap.set(n,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),V(this,"checkRecentlyDeleted",n=>{const r=this.recentlyDeletedMap.get(n);if(r){const{message:i}=G("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${n}`);throw new Error(i)}}),V(this,"isLinkModeEnabled",(n,r)=>{var i,s,o,a,c,u,l,h,d;return!n||r!==ve.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=n?.redirect)==null?void 0:l.universal)!==void 0&&((h=n?.redirect)==null?void 0:h.universal)!==""&&((d=n?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),V(this,"getAppLinkIfEnabled",(n,r)=>{var i;return this.isLinkModeEnabled(n,r)?(i=n?.redirect)==null?void 0:i.universal:void 0}),V(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;const r=P0(n,"topic")||"",i=decodeURIComponent(P0(n,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:ve.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:s})}),V(this,"registerLinkModeListeners",async()=>{var n;if(Nu()||ir()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){const r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),V(this,"getTVFApproveParams",n=>{try{const r=p1(n.namespaces),i=zI(n.namespaces),s=VI(n.namespaces),o=n.sessionProperties,a=n.scopedProperties;return{approvedChains:r,approvedMethods:i,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(r){return this.client.logger.warn(r,"Error getting TVF approve params"),{}}}),V(this,"getTVFParams",(n,r,i)=>{var s,o,a;if(!((s=r.request)!=null&&s.method))return{};const c={correlationId:n,rpcMethods:[r.request.method],chainId:r.chainId};try{const u=this.extractTxHashesFromResult(r.request,i);c.txHashes=u,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn(u,"Error getting TVF params")}return c}),V(this,"isValidContractData",n=>{var r;if(!n)return!1;try{const i=n?.data||((r=n?.[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),V(this,"extractTxHashesFromResult",(n,r)=>{var i;try{if(!r)return[];const s=n.method,o=Bb[s];if(s==="sui_signTransaction")return[T5(r.transactionBytes)];if(s==="near_signTransaction")return[eg(r)];if(s==="near_signTransactions")return r.map(c=>eg(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=r.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[C9({transaction:n.params.transactionPayload,signature:r.signature})];if(s==="algo_signTxn")return $i(r)?r.map(c=>tg(c)):[tg(r)];if(s==="cosmos_signDirect")return[R5(r)];if(s==="wallet_sendCalls")return N5(r);if(typeof r=="string")return[r];const a=r[o.key];if($i(a))return s==="solana_signAllTransactions"?a.map(c=>$5(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(n))for(const s of i)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Oe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:n,message:r,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ls)?this.client.auth.authKeys.get(Ls):{responseTopic:void 0,publicKey:void 0};try{const a=await this.client.core.crypto.decode(n,r,{receiverPublicKey:o,encoding:s===ve.link_mode?mr:Et});xl(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:i,transportType:s,encryptedId:Lt(r)})):Ea(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(n,r)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${r}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Mt.expired,async e=>{const{topic:n,id:r}=T0(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,G("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,G("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Kr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Kr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ie(e,!1)){const{message:n}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:n}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(sr(this.client.core.pairing.pairings.get(e).expiry)){const{message:n}=G("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!Ie(e,!1)){const{message:n}=G("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:n}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(sr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:n}=G("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){const{message:n}=G("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ie(e,!1)){const{message:n}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{const{message:n}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!f9(e)){const{message:n}=G("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){const{message:n}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(sr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:n}=G("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}validateRequestExpiry(e){if(e&&!v9(e,Aa)){const{message:n}=G("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Aa.min} and ${Aa.max}`);throw new Error(n)}}}class _D extends Zr{constructor(e,n){super(e,n,Ib,Ia),this.core=e,this.logger=n}}class Fb extends Zr{constructor(e,n){super(e,n,Ob,Ia),this.core=e,this.logger=n}}class SD extends Zr{constructor(e,n){super(e,n,Db,Ia,r=>r.id),this.core=e,this.logger=n}}class ID extends Zr{constructor(e,n){super(e,n,Rb,Fs,()=>Ls),this.core=e,this.logger=n}}class OD extends Zr{constructor(e,n){super(e,n,Nb,Fs),this.core=e,this.logger=n}}class AD extends Zr{constructor(e,n){super(e,n,Cb,Fs,r=>r.id),this.core=e,this.logger=n}}var BD=Object.defineProperty,DD=(t,e,n)=>e in t?BD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zl=(t,e,n)=>DD(t,typeof e!="symbol"?e+"":e,n);class $D{constructor(e,n){this.core=e,this.logger=n,zl(this,"authKeys"),zl(this,"pairingTopics"),zl(this,"requests"),this.authKeys=new ID(this.core,this.logger),this.pairingTopics=new OD(this.core,this.logger),this.requests=new AD(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var TD=Object.defineProperty,PD=(t,e,n)=>e in t?TD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ae=(t,e,n)=>PD(t,typeof e!="symbol"?e+"":e,n);class Ba extends gm{constructor(e){super(e),ae(this,"protocol",Fl),ae(this,"version",Ll),ae(this,"name",Oa.name),ae(this,"metadata"),ae(this,"core"),ae(this,"logger"),ae(this,"events",new lt.exports.EventEmitter),ae(this,"engine"),ae(this,"session"),ae(this,"proposal"),ae(this,"pendingRequest"),ae(this,"auth"),ae(this,"signConfig"),ae(this,"on",(r,i)=>this.events.on(r,i)),ae(this,"once",(r,i)=>this.events.once(r,i)),ae(this,"off",(r,i)=>this.events.off(r,i)),ae(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),ae(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),ae(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),ae(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(s){throw this.logger.error(s.message),s}}),ae(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),ae(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||Oa.name,this.metadata=S4(e?.metadata),this.signConfig=e?.signConfig;const n=I1({logger:e?.logger||Oa.logger,name:this.name});this.logger=n,this.core=e?.core||new uD(e),this.session=new Fb(this.core,this.logger),this.proposal=new _D(this.core,this.logger),this.pendingRequest=new SD(this.core,this.logger),this.engine=new xD(this),this.auth=new $D(this.core,this.logger)}static async init(e){const n=new Ba(e);return await n.initialize(),n}get context(){return ht(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const RD=Fb,ND=Ba;re.AUTH_CONTEXT=Pb,re.AUTH_KEYS_CONTEXT=Rb,re.AUTH_PAIRING_TOPIC_CONTEXT=Nb,re.AUTH_PROTOCOL=Tb,re.AUTH_PUBLIC_KEY_NAME=Ls,re.AUTH_REQUEST_CONTEXT=Cb,re.AUTH_STORAGE_PREFIX=Fs,re.AUTH_VERSION=bD,re.ENGINE_CONTEXT=Ab,re.ENGINE_QUEUE_STATES=Qt,re.ENGINE_RPC_OPTS=Le,re.HISTORY_CONTEXT=dD,re.HISTORY_EVENTS=hD,re.HISTORY_STORAGE_VERSION=pD,re.METHODS_TO_VERIFY=$b,re.PROPOSAL_CONTEXT=Ib,re.PROPOSAL_EXPIRY=gD,re.PROPOSAL_EXPIRY_MESSAGE=Ml,re.REQUEST_CONTEXT=Db,re.SESSION_CONTEXT=Ob,re.SESSION_EXPIRY=Yr,re.SESSION_REQUEST_EXPIRY_BOUNDARIES=Aa,re.SIGN_CLIENT_CONTEXT=kl,re.SIGN_CLIENT_DEFAULT=Oa,re.SIGN_CLIENT_EVENTS=lD,re.SIGN_CLIENT_PROTOCOL=Fl,re.SIGN_CLIENT_STORAGE_OPTIONS=fD,re.SIGN_CLIENT_STORAGE_PREFIX=Ia,re.SIGN_CLIENT_VERSION=Ll,re.SessionStore=RD,re.SignClient=ND,re.TVF_METHODS=Bb,re.WALLETCONNECT_DEEPLINK_CHOICE=ql,re.default=Ba,Object.defineProperty(re,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
