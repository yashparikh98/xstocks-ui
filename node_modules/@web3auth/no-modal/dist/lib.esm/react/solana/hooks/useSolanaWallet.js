import { Connection } from '@solana/web3.js';
import { useState, useMemo, useEffect } from 'react';
import { CHAIN_NAMESPACES } from '@toruslabs/base-controllers';
import { useWeb3Auth } from '../../hooks/useWeb3Auth.js';
import { useChain } from '../../hooks/useChain.js';
import { SolanaWallet } from '../../../providers/solana-provider/solanaWallet.js';

const useSolanaWallet = () => {
  const {
    provider,
    web3Auth
  } = useWeb3Auth();
  const {
    chainNamespace
  } = useChain();
  const [accounts, setAccounts] = useState(null);
  const solanaWallet = useMemo(() => {
    if (!provider) return null;
    if (chainNamespace !== CHAIN_NAMESPACES.SOLANA) return null;
    return new SolanaWallet(provider);
  }, [provider, chainNamespace]);
  const connection = useMemo(() => {
    if (!web3Auth || !provider || chainNamespace !== CHAIN_NAMESPACES.SOLANA) return null;
    return new Connection(web3Auth.currentChain.rpcTarget);
  }, [web3Auth, provider, chainNamespace]);
  useEffect(() => {
    const init = async () => {
      if (chainNamespace !== CHAIN_NAMESPACES.SOLANA) {
        setAccounts(null);
        return;
      }
      if (!solanaWallet) return;
      const accounts = await solanaWallet.getAccounts();
      if ((accounts === null || accounts === void 0 ? void 0 : accounts.length) > 0) {
        setAccounts(accounts);
      }
    };
    if (solanaWallet) init();
  }, [solanaWallet, chainNamespace]);
  return {
    solanaWallet,
    accounts,
    connection
  };
};

export { useSolanaWallet };
